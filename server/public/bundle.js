!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=205)}([function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return o}),n.d(t,"d",function(){return s}),n.d(t,"g",function(){return u}),n.d(t,"e",function(){return c}),n.d(t,"f",function(){return l});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})}function s(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return r});var r=function(){function t(){}return t.getGlobalVariable=function(){return"undefined"!=typeof window?window:e},t.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},t.pathNormalize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},t.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},t.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},t.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},t.getEnvVariable=function(e){},t.readFileSync=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("'+e+'").');return null},t.appendFileSync=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("'+e+'").')},t.writeFile=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile("'+e+'").');return Promise.reject(null)},t.highlightSql=function(e){return e},t.highlightJson=function(e){return e},t.logInfo=function(e,t){console.info(e+" ",t)},t.logError=function(e,t){console.error(e+" ",t)},t.logWarn=function(e,t){console.warn(e+" ",t)},t.log=function(e){console.log(e)},t.warn=function(e){return e},t.type="browser",t}();"undefined"!=typeof window&&(window.Buffer=n(65).Buffer),void 0!==e&&(e.Buffer=n(65).Buffer)}).call(this,n(94))},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(11),i=n(24),a=n(26),o=n(89),s=n(9),u=n(29),c=n(77),l=function(){function e(e){this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,e&&(this.name=e.name,e.columns&&(this.columns=e.columns.map(function(e){return new r.a(e)})),e.indices&&(this.indices=e.indices.map(function(e){return new i.a(e)})),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map(function(e){return new a.a(e)})),e.uniques&&(this.uniques=e.uniques.map(function(e){return new s.a(e)})),e.checks&&(this.checks=e.checks.map(function(e){return new u.a(e)})),e.exclusions&&(this.exclusions=e.exclusions.map(function(e){return new c.a(e)})),void 0!==e.justCreated&&(this.justCreated=e.justCreated),this.engine=e.engine)}return Object.defineProperty(e.prototype,"primaryColumns",{get:function(){return this.columns.filter(function(e){return e.isPrimary})},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e({name:this.name,columns:this.columns.map(function(e){return e.clone()}),indices:this.indices.map(function(e){return e.clone()}),foreignKeys:this.foreignKeys.map(function(e){return e.clone()}),uniques:this.uniques.map(function(e){return e.clone()}),checks:this.checks.map(function(e){return e.clone()}),exclusions:this.exclusions.map(function(e){return e.clone()}),justCreated:this.justCreated,engine:this.engine})},e.prototype.addColumn=function(e){this.columns.push(e)},e.prototype.removeColumn=function(e){var t=this.columns.find(function(t){return t.name===e.name});t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.addUniqueConstraint=function(e){if(this.uniques.push(e),1===e.columnNames.length){var t=this.columns.find(function(t){return t.name===e.columnNames[0]});t&&(t.isUnique=!0)}},e.prototype.removeUniqueConstraint=function(e){var t=this.uniques.find(function(t){return t.name===e.name});if(t&&(this.uniques.splice(this.uniques.indexOf(t),1),1===t.columnNames.length)){var n=this.columns.find(function(e){return e.name===t.columnNames[0]});n&&(n.isUnique=!1)}},e.prototype.addCheckConstraint=function(e){this.checks.push(e)},e.prototype.removeCheckConstraint=function(e){var t=this.checks.find(function(t){return t.name===e.name});t&&this.checks.splice(this.checks.indexOf(t),1)},e.prototype.addExclusionConstraint=function(e){this.exclusions.push(e)},e.prototype.removeExclusionConstraint=function(e){var t=this.exclusions.find(function(t){return t.name===e.name});t&&this.exclusions.splice(this.exclusions.indexOf(t),1)},e.prototype.addForeignKey=function(e){this.foreignKeys.push(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find(function(t){return t.name===e.name});t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.addIndex=function(e,t){if(void 0===t&&(t=!1),this.indices.push(e),1===e.columnNames.length&&e.isUnique&&t){var n=this.columns.find(function(t){return t.name===e.columnNames[0]});n&&(n.isUnique=!0)}},e.prototype.removeIndex=function(e,t){void 0===t&&(t=!1);var n=this.indices.find(function(t){return t.name===e.name});if(n&&(this.indices.splice(this.indices.indexOf(n),1),1===n.columnNames.length&&n.isUnique&&t)){var r=this.columns.find(function(e){return e.name===n.columnNames[0]});r&&(r.isUnique=this.indices.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===r.name&&!!n.isUnique}))}},e.prototype.findColumnByName=function(e){return this.columns.find(function(t){return t.name===e})},e.prototype.findColumnIndices=function(e){return this.indices.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnForeignKeys=function(e){return this.foreignKeys.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnUniques=function(e){return this.uniques.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnChecks=function(e){return this.checks.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.create=function(t,n){return new e({name:n.buildTableName(t.tableName,t.schema,t.database),engine:t.engine,columns:t.columns.filter(function(e){return e}).map(function(e){return o.a.createTableColumnOptions(e,n)}),indices:t.indices.filter(function(e){return!0===e.synchronize}).map(function(e){return i.a.create(e)}),uniques:t.uniques.map(function(e){return s.a.create(e)}),checks:t.checks.map(function(e){return u.a.create(e)}),exclusions:t.exclusions.map(function(e){return c.a.create(e)})})},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return a}),n.d(t,"d",function(){return o}),n.d(t,"g",function(){return s}),n.d(t,"h",function(){return u}),n.d(t,"e",function(){return c}),n.d(t,"f",function(){return l});var r=function(){return function(){}}(),i=function(){return function(){}}(),a=function(){return function(){}}(),o=function(){return function(){}}(),s=function(){return function(){}}(),u=function(){return function(){}}(),c=function(){return function(){}}(),l=function(){return function(){}}()},function(e,t,n){var r=n(14),i=n(35),a=n(46),o=n(40),s=n(58),u=function(e,t,n){var c,l,f,p,h=e&u.F,d=e&u.G,m=e&u.S,y=e&u.P,v=e&u.B,g=d?r:m?r[t]||(r[t]={}):(r[t]||{}).prototype,b=d?i:i[t]||(i[t]={}),E=b.prototype||(b.prototype={});for(c in d&&(n=t),n)f=((l=!h&&g&&void 0!==g[c])?g:n)[c],p=v&&l?s(f,r):y&&"function"==typeof f?s(Function.call,f):f,g&&o(g,c,f,e&u.U),b[c]!=f&&a(b,c,p),y&&E[c]!=f&&(E[c]=f)};r.core=i,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return i});var r=n(0),i=function(){function t(){}return t.chunk=function(e,t){return Array.from(Array(Math.ceil(e.length/t)),function(n,r){return e.slice(r*t,r*t+t)})},t.splitClassesAndStrings=function(e){return[e.filter(function(e){return"string"!=typeof e}),e.filter(function(e){return"string"==typeof e})]},t.groupBy=function(e,t){return e.reduce(function(e,n){var r=t(n),i=e.find(function(e){return e.id===r});return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e},[])},t.uniq=function(e,t){return e.reduce(function(e,n){var r=!1;if(t instanceof Function){var i=t(n);r=!!e.find(function(e){return t(e)===i})}else r="string"==typeof t?!!e.find(function(e){return e[t]===n[t]}):-1!==e.indexOf(n);return r||e.push(n),e},[])},t.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},t.mergeDeep=function(t){for(var n,i,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];if(!a.length)return t;var s=a.shift();if(this.isObject(t)&&this.isObject(s))for(var u in s){var c=u;s[u]instanceof Promise||(!this.isObject(s[c])||s[c]instanceof Map||s[c]instanceof Set||s[c]instanceof Date||s[c]instanceof e?Object.assign(t,((i={})[u]=s[c],i)):(t[u]||Object.assign(t,((n={})[u]=Object.create(Object.getPrototypeOf(s[c])),n)),this.mergeDeep(t[u],s[c])))}return this.mergeDeep.apply(this,r.f([t],a))},t.deepCompare=function(){for(var e,t,n,r,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(arguments.length<1)return!0;for(e=1,t=arguments.length;e<t;e++)if(n=[],r=[],!this.compare2Objects(n,r,arguments[0],arguments[e]))return!1;return!0},t.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0},t.zipObject=function(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})},t.isArraysEqual=function(e,t){return e.length===t.length&&e.every(function(e){return-1!==t.indexOf(e)})},t.compare2Objects=function(e,t,n,r){var i;if(isNaN(n)&&isNaN(r)&&"number"==typeof n&&"number"==typeof r)return!0;if(n===r)return!0;if(null===n||null===r||void 0===n||void 0===r)return!1;if(("function"==typeof n.equals||n.equals instanceof Function)&&n.equals(r))return!0;if("function"==typeof n&&"function"==typeof r||n instanceof Date&&r instanceof Date||n instanceof RegExp&&r instanceof RegExp||n instanceof String&&r instanceof String||n instanceof Number&&r instanceof Number)return n.toString()===r.toString();if(!(n instanceof Object&&r instanceof Object))return!1;if(n.isPrototypeOf(r)||r.isPrototypeOf(n))return!1;if(n.constructor!==r.constructor)return!1;if(n.prototype!==r.prototype)return!1;if(e.indexOf(n)>-1||t.indexOf(r)>-1)return!1;for(i in r){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1}for(i in n){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1;switch(typeof n[i]){case"object":case"function":if(e.push(n),t.push(r),!this.compare2Objects(e,t,n[i],r[i]))return!1;e.pop(),t.pop();break;default:if(n[i]!==r[i])return!1}}return!0},t}()}).call(this,n(65).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(){}return e.normalizeHydratedDate=function(e){return e&&"string"==typeof e?new Date(e):e},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r="string"==typeof e?new Date(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r},e.mixedDateToTimeString=function(e,t){return void 0===t&&(t=!1),e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if("string"==typeof e){var t=r.e(e.split(":"),3),n=t[0],i=t[1],a=t[2],o=new Date;return n&&o.setHours(parseInt(n)),i&&o.setMinutes(parseInt(i)),a&&o.setSeconds(parseInt(a)),o}return e},e.mixedTimeToString=function(e,t){return void 0===t&&(t=!1),"string"==typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e)?e.split(":").map(function(e){return 1===e.length?"0"+e:e}).join(":"):e},e.mixedDateToDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds())+"."+this.formatMilliseconds(e.getMilliseconds()):e},e.mixedDateToUtcDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return e instanceof Array?e.map(function(e){return String(e)}).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?e.length>0?e.split(","):[]:e},e.simpleJsonToString=function(e){return JSON.stringify(e)},e.stringToSimpleJson=function(e){return"string"==typeof e?JSON.parse(e):e},e.simpleEnumToString=function(e){return""+e},e.stringToSimpleEnum=function(e,t){return t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e.formatMilliseconds=function(e){return e<10?"00"+e:e<100?"0"+e:String(e)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.create=function(e){var t=Promise.resolve(e);return t.__value__=e,t},e.extractValue=function(e){return e instanceof Promise&&e.__value__?e.__value__:e},e.runInSequence=function(e,t){var n=[];return e.reduce(function(e,r){return e.then(function(){return t(r)}).then(function(e){n.push(e)})},Promise.resolve()).then(function(){return n})},e.settle=function(e){return Promise.all(e.map(function(e){return Promise.resolve(e).then(function(e){return{state:"fulfilled",value:e}},function(e){return{state:"rejected",reason:e}})})).then(function(e){var t=e.find(function(e){return"rejected"===e.state});return t?Promise.reject(t.reason):e.map(function(e){return e.value})})},e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return h});var r=n(0),i=n(85),a=n(31),o=n(19),s=n(186),u=n(6),c=n(1),l=n(66),f=n(20),p=n(5),h=function(){function t(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","bigint","bit","decimal","money","numeric","smallint","smallmoney","tinyint","float","real","date","datetime2","datetime","datetimeoffset","smalldatetime","time","char","varchar","text","nchar","nvarchar","ntext","binary","image","varbinary","hierarchyid","sql_variant","timestamp","uniqueidentifier","xml","geometry","geography","rowversion"],this.spatialTypes=["geometry","geography"],this.withLengthColumnTypes=["char","varchar","nchar","nvarchar","binary","varbinary"],this.withPrecisionColumnTypes=["decimal","numeric","time","datetime2","datetimeoffset"],this.withScaleColumnTypes=["decimal","numeric"],this.mappedDataTypes={createDate:"datetime2",createDateDefault:"getdate()",updateDate:"datetime2",updateDateDefault:"getdate()",version:"int",treeLevel:"int",migrationId:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"nvarchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"nvarchar(MAX)",cacheResult:"nvarchar(MAX)"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},nvarchar:{length:255},binary:{length:1},varbinary:{length:1},decimal:{precision:18,scale:0},numeric:{precision:18,scale:0},time:{precision:7},datetime2:{precision:7},datetimeoffset:{precision:7}},this.maxAliasLength=128,this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return t.prototype.connect=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i=this;return r.d(this,function(r){switch(r.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))]):[3,3];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}})})},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new i.a("mssql"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},t.prototype.closePool=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){return[2,new Promise(function(t,n){e.close(function(e){return e?n(e):t()})})]})})},t.prototype.createSchemaBuilder=function(){return new l.a(this.connection)},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new s.a(this,e)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(i,"g"),function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map(function(e){return r.push(e),"@"+(r.length-1)}).join(", "):n instanceof Function?n():(r.push(n),"@"+(r.length-1))}),r]},t.prototype.escape=function(e){return'"'+e+'"'},t.prototype.buildTableName=function(e,t,n){var r=e;return t&&(r=t+"."+e),n&&(r=t?n+"."+r:n+".."+e),r},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?u.a.mixedDateToDate(e):"time"===t.type?u.a.mixedTimeToDate(e):"datetime"===t.type||"smalldatetime"===t.type||t.type===Date?u.a.mixedDateToDate(e,!1,!1):"datetime2"===t.type||"datetimeoffset"===t.type?u.a.mixedDateToDate(e,!1,!0):"simple-array"===t.type?u.a.simpleArrayToString(e):"simple-json"===t.type?u.a.simpleJsonToString(e):"simple-enum"===t.type?u.a.simpleEnumToString(e):e},t.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?t.transformer.from(e):e:(t.type===Boolean?e=!!e:"datetime"===t.type||t.type===Date||"datetime2"===t.type||"smalldatetime"===t.type||"datetimeoffset"===t.type?e=u.a.normalizeHydratedDate(e):"date"===t.type?e=u.a.mixedDateToDateString(e):"time"===t.type?e=u.a.mixedTimeToString(e):"simple-array"===t.type?e=u.a.stringToSimpleArray(e):"simple-json"===t.type?e=u.a.stringToSimpleJson(e):"simple-enum"===t.type&&(e=u.a.stringToSimpleEnum(e,t)),t.transformer&&(e=t.transformer.from(e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||"integer"===t.type?"int":t.type===String?"nvarchar":t.type===Date?"datetime":t.type===Boolean?"bit":t.type===e?"binary":"uuid"===t.type?"uniqueidentifier":"simple-array"===t.type||"simple-json"===t.type?"ntext":"simple-enum"===t.type?"nvarchar":"dec"===t.type?"decimal":"double precision"===t.type?"float":"rowversion"===t.type?"timestamp":t.type||""},t.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"1":"0":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":t},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},t.prototype.getColumnLength=function(e){return e.length?e.length.toString():"varchar"===e.type||"nvarchar"===e.type||e.type===String?"255":""},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},t.prototype.obtainMasterConnection=function(){return Promise.resolve(this.master)},t.prototype.obtainSlaveConnection=function(){if(!this.slaves.length)return this.obtainMasterConnection();var e=Math.floor(Math.random()*this.slaves.length);return Promise.resolve(this.slaves[e])},t.prototype.createGeneratedMap=function(e,t){var n=this;if(t)return Object.keys(t).reduce(function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&p.a.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r},{})},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&n.lowerDefaultValueIfNessesary(n.normalizeDefault(t))!==n.lowerDefaultValueIfNessesary(r.default)||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||r.isGenerated!==t.isGenerated)})},t.prototype.lowerDefaultValueIfNessesary=function(e){return e?e.split("'").map(function(e,t){return t%2==1?e:e.toLowerCase()}).join("'"):e},t.prototype.isReturningSqlSupported=function(){return!this.options.options||!this.options.options.disableOutputReturning},t.prototype.isUUIDGenerationSupported=function(){return!0},t.prototype.createParameter=function(e,t){return"@"+t},t.prototype.parametrizeValue=function(e,t){if(t instanceof f.a)return t;var n=this.normalizeType({type:e.type});return e.length?new f.a(t,n,e.length):null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?new f.a(t,n,e.precision,e.scale):null!==e.precision&&void 0!==e.precision?new f.a(t,n,e.precision):null!==e.scale&&void 0!==e.scale?new f.a(t,n,e.scale):new f.a(t,n)},t.prototype.parametrizeMap=function(e,t){var n=this;if(!this.connection.hasMetadata(e))return t;var r=this.connection.getMetadata(e);return Object.keys(t).reduce(function(e,i){var a=t[i],o=r.findColumnWithDatabaseName(i);return o?(e[i]=n.parametrizeValue(o,a),e):a},{})},t.prototype.loadDependencies=function(){try{this.mssql=c.a.load("mssql")}catch(e){throw new a.a("SQL Server","mssql")}},t.prototype.createPool=function(e,t){var n=this;t=Object.assign(t,o.a.buildDriverOptions(t));var r=Object.assign({},{connectionTimeout:this.options.connectionTimeout,requestTimeout:this.options.requestTimeout,stream:this.options.stream,pool:this.options.pool,options:this.options.options},{server:t.host,user:t.username,password:t.password,database:t.database,port:t.port,domain:t.domain},e.extra||{});return r.options?r.options.useUTC||(r.options.useUTC=!1):r.options={useUTC:!1},new Promise(function(e,t){var i=new n.mssql.ConnectionPool(r),a=n.connection.logger;i.on("error",function(e){return a.log("warn","MSSQL pool raised an error. "+e)});var o=i.connect(function(n){if(n)return t(n);e(o)})})},t}()}).call(this,n(65).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames}return e.prototype.clone=function(){return new e({name:this.name,columnNames:r.f(this.columnNames)})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map(function(e){return e.databaseName})})},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1),this._type=e,this._value=t,this._useParameter=n,this._multipleParameters=r}return Object.defineProperty(e.prototype,"useParameter",{get:function(){return this._value instanceof e?this._value.useParameter:this._useParameter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multipleParameters",{get:function(){return this._value instanceof e?this._value.multipleParameters:this._multipleParameters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value instanceof e?this._value.value:this._value},enumerable:!0,configurable:!0}),e.prototype.toSql=function(t,n,r){switch(this._type){case"not":return this._value instanceof e?"NOT("+this._value.toSql(t,n,r)+")":n+" != "+r[0];case"lessThan":return n+" < "+r[0];case"lessThanOrEqual":return n+" <= "+r[0];case"moreThan":return n+" > "+r[0];case"moreThanOrEqual":return n+" >= "+r[0];case"equal":return n+" = "+r[0];case"like":return n+" LIKE "+r[0];case"between":return n+" BETWEEN "+r[0]+" AND "+r[1];case"in":return n+" IN ("+r.join(", ")+")";case"any":return n+" = ANY("+r[0]+")";case"isNull":return n+" IS NULL";case"raw":return this.value instanceof Function?this.value(n):n+" = "+this.value}return""},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=!!this.zerofill||(e.unsigned||!1),this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}return e.prototype.clone=function(){return new e({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})},e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return p});var r=n(0),i=n(85),a=n(31),o=n(187),s=n(6),u=n(1),c=n(66),l=n(19),f=n(5),p=function(){function t(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["char","nchar","nvarchar2","varchar2","long","raw","long raw","number","numeric","float","dec","decimal","integer","int","smallint","real","double precision","date","timestamp","timestamp with time zone","timestamp with local time zone","interval year to month","interval day to second","bfile","blob","clob","nclob","rowid","urowid"],this.spatialTypes=[],this.withLengthColumnTypes=["char","nchar","nvarchar2","varchar2","varchar","raw"],this.withPrecisionColumnTypes=["number","float","timestamp","timestamp with time zone","timestamp with local time zone"],this.withScaleColumnTypes=["number"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"timestamp",updateDateDefault:"CURRENT_TIMESTAMP",version:"number",treeLevel:"number",migrationId:"number",migrationName:"varchar2",migrationTimestamp:"number",cacheId:"number",cacheIdentifier:"varchar2",cacheTime:"number",cacheDuration:"number",cacheQuery:"clob",cacheResult:"clob"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},varchar2:{length:255},nvarchar2:{length:255},raw:{length:2e3},float:{precision:126},timestamp:{precision:6},"timestamp with time zone":{precision:6},"timestamp with local time zone":{precision:6}},this.maxAliasLength=30,this.connection=e,this.options=e.options,this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return t.prototype.connect=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i=this;return r.d(this,function(r){switch(r.label){case 0:return this.oracle.fetchAsString=[this.oracle.CLOB],this.oracle.fetchAsBuffer=[this.oracle.BLOB],this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))]):[3,3];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}})})},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new i.a("oracle"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},t.prototype.createSchemaBuilder=function(){return new c.a(this.connection)},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new o.a(this,e)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return"boolean"==typeof n[e]?n[e]?1:0:n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(i,"g"),function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map(function(t,n){return r.push(t),":"+e.substr(4)+n}).join(", "):n instanceof Function?n():"boolean"==typeof n?n?1:0:(r.push(n),e)}),r]},t.prototype.escape=function(e){return'"'+e+'"'},t.prototype.buildTableName=function(e,t,n){return e},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean?e?1:0:"date"===t.type?("string"==typeof e&&(e=e.replace(/[^0-9-]/g,"")),function(){return"TO_DATE('"+s.a.mixedDateToDateString(e)+"', 'YYYY-MM-DD')"}):t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp with local time zone"===t.type?s.a.mixedDateToDate(e):"simple-array"===t.type?s.a.simpleArrayToString(e):"simple-json"===t.type?s.a.simpleJsonToString(e):e},t.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?t.transformer.from(e):e:(t.type===Boolean?e=1===e:"date"===t.type?e=s.a.mixedDateToDateString(e):"time"===t.type?e=s.a.mixedTimeToString(e):t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp with local time zone"===t.type?e=s.a.normalizeHydratedDate(e):"json"===t.type?e=JSON.parse(e):"simple-array"===t.type?e=s.a.stringToSimpleArray(e):"simple-json"===t.type&&(e=s.a.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||t.type===Boolean||"numeric"===t.type||"dec"===t.type||"decimal"===t.type||"int"===t.type||"integer"===t.type||"smallint"===t.type?"number":"real"===t.type||"double precision"===t.type?"float":t.type===String||"varchar"===t.type?"varchar2":t.type===Date?"timestamp":t.type===e?"blob":"uuid"===t.type?"varchar2":"simple-array"===t.type?"clob":"simple-json"===t.type?"clob":t.type||""},t.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"1":"0":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":t},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},t.prototype.getColumnLength=function(e){if(e.length)return e.length.toString();switch(e.type){case String:case"varchar":case"varchar2":case"nvarchar2":return"255";case"raw":return"2000";case"uuid":return"36";default:return""}},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),"timestamp with time zone"===e.type?t="TIMESTAMP"+(null!==e.precision&&void 0!==e.precision?"("+e.precision+")":"")+" WITH TIME ZONE":"timestamp with local time zone"===e.type&&(t="TIMESTAMP"+(null!==e.precision&&void 0!==e.precision?"("+e.precision+")":"")+" WITH LOCAL TIME ZONE"),e.isArray&&(t+=" array"),t},t.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,n){e.master.getConnection(function(e,r,i){if(e)return n(e);t(r)})})},t.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise(function(t,n){var r=Math.floor(Math.random()*e.slaves.length);e.slaves[r].getConnection(function(e,r){if(e)return n(e);t(r)})}):this.obtainMasterConnection()},t.prototype.createGeneratedMap=function(e,t){var n=this;if(t)return Object.keys(t).reduce(function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&f.a.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r},{})},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)})},t.prototype.isReturningSqlSupported=function(){return!0},t.prototype.isUUIDGenerationSupported=function(){return!1},t.prototype.createParameter=function(e,t){return":"+e},t.prototype.columnTypeToNativeParameter=function(e){switch(this.normalizeType({type:e})){case"number":case"numeric":case"int":case"integer":case"smallint":case"dec":case"decimal":return this.oracle.NUMBER;case"char":case"nchar":case"nvarchar2":case"varchar2":return this.oracle.STRING;case"blob":return this.oracle.BLOB;case"clob":return this.oracle.CLOB;case"date":case"timestamp":case"timestamp with time zone":case"timestamp with local time zone":return this.oracle.DATE}},t.prototype.loadDependencies=function(){try{this.oracle=u.a.load("oracledb")}catch(e){throw new a.a("Oracle","oracledb")}},t.prototype.createPool=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){return t=Object.assign(t,l.a.buildDriverOptions(t)),n=Object.assign({},{user:t.username,password:t.password,connectString:t.connectString?t.connectString:t.host+":"+t.port+"/"+t.sid},e.extra||{}),[2,new Promise(function(e,t){i.oracle.createPool(n,function(n,r){if(n)return t(n);e(r)})})]})})},t.prototype.closePool=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){return[2,new Promise(function(t,n){e.close(function(e){return e?n(e):t()}),e=void 0})]})})},t}()}).call(this,n(65).Buffer)},function(e,t,n){"use strict";n.r(t);var r=n(0),i=(n(372),n(52)),a=n(43),o=n(2),s=function(){function e(){}return e.prototype.tableName=function(e,t){return t||Object(a.c)(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,n){return n.length?Object(a.a)(n.join("_"))+(t?Object(a.d)(t):Object(a.d)(e)):t||e},e.prototype.relationName=function(e){return e},e.prototype.primaryKeyName=function(e,t){var n=r.f(t);n.sort();var a=(e instanceof o.a?e.name:e).replace(".","_")+"_"+n.join("_");return"PK_"+i.a.sha1(a).substr(0,27)},e.prototype.uniqueConstraintName=function(e,t){var n=r.f(t);n.sort();var a=(e instanceof o.a?e.name:e).replace(".","_")+"_"+n.join("_");return"UQ_"+i.a.sha1(a).substr(0,27)},e.prototype.relationConstraintName=function(e,t,n){var a=r.f(t);a.sort();var s=(e instanceof o.a?e.name:e).replace(".","_")+"_"+a.join("_");return n&&(s+="_"+n),"REL_"+i.a.sha1(s).substr(0,26)},e.prototype.defaultConstraintName=function(e,t){var n=(e instanceof o.a?e.name:e).replace(".","_")+"_"+t;return"DF_"+i.a.sha1(n).substr(0,27)},e.prototype.foreignKeyName=function(e,t){var n=r.f(t);n.sort();var a=(e instanceof o.a?e.name:e).replace(".","_")+"_"+n.join("_");return"FK_"+i.a.sha1(a).substr(0,27)},e.prototype.indexName=function(e,t,n){var a=r.f(t);a.sort();var s=(e instanceof o.a?e.name:e).replace(".","_")+"_"+a.join("_");return n&&(s+="_"+n),"IDX_"+i.a.sha1(s).substr(0,26)},e.prototype.checkConstraintName=function(e,t){var n=(e instanceof o.a?e.name:e).replace(".","_")+"_"+t;return"CHK_"+i.a.sha1(n).substr(0,26)},e.prototype.exclusionConstraintName=function(e,t){var n=(e instanceof o.a?e.name:e).replace(".","_")+"_"+t;return"XCL_"+i.a.sha1(n).substr(0,26)},e.prototype.joinColumnName=function(e,t){return Object(a.a)(e+"_"+t)},e.prototype.joinTableName=function(e,t,n,r){return Object(a.c)(e+"_"+n.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,n){return Object(a.a)(e+"_"+(n||t))},e.prototype.joinTableInverseColumnName=function(e,t,n){return this.joinTableColumnName(e,t,n)},e.prototype.prefixTableName=function(e,t){return e+t},e}(),u=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotExecuteNotConnectedError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot execute operation on "'+n+'" connection because connection is not yet established.',r}return r.c(t,e),t}(Error),c=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotConnectAlreadyConnectedError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a "'+n+'" connection because connection to the database already established.',r}return r.c(t,e),t}(Error),l=function(e){function t(n){var r,i=e.call(this)||this;return i.name="EntityMetadataNotFound",Object.setPrototypeOf(i,t.prototype),r=n instanceof ct?n.options.name:"function"==typeof n?n.name:n,i.message='No metadata for "'+r+'" was found.',i}return r.c(t,e),t}(Error),f=function(){return function(e,t,n,r){this.id=e,this.timestamp=t,this.name=n,this.instance=r}}(),p=n(7),h=n(8),d=n(20),m=n(3),y=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.transaction=!0;var n=this.connection.driver.options;this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n.schema,n.database)}return e.prototype.executePendingMigrations=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u,c=this;return r.d(this,function(r){switch(r.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(e)];case 1:return r.sent(),[4,this.loadExecutedMigrations(e)];case 2:return t=r.sent(),n=this.getLatestTimestampMigration(t),i=this.getMigrations(),a=[],(o=i.filter(function(e){return!t.find(function(t){return t.name===e.name})})).length?[3,5]:(this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner?[3,4]:[4,e.release()]);case 3:r.sent(),r.label=4;case 4:return[2,[]];case 5:return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(i.length+" migrations were found in the source code."),n&&this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild(o.length+" migrations are new migrations that needs to be executed."),s=!1,!this.transaction||e.isTransactionActive?[3,7]:[4,e.startTransaction()];case 6:r.sent(),s=!0,r.label=7;case 7:return r.trys.push([7,11,16,19]),[4,p.a.runInSequence(o,function(t){return t.instance.up(e).then(function(){return c.insertExecutedMigration(e,t)}).then(function(){a.push(t),c.connection.logger.logSchemaBuild("Migration "+t.name+" has been executed successfully.")})})];case 8:return r.sent(),s?[4,e.commitTransaction()]:[3,10];case 9:r.sent(),r.label=10;case 10:return[3,19];case 11:if(u=r.sent(),!s)return[3,15];r.label=12;case 12:return r.trys.push([12,14,,15]),[4,e.rollbackTransaction()];case 13:return r.sent(),[3,15];case 14:return r.sent(),[3,15];case 15:throw u;case 16:return this.queryRunner?[3,18]:[4,e.release()];case 17:r.sent(),r.label=18;case 18:return[7];case 19:return[2,a]}})})},e.prototype.undoLastMigration=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(e)];case 1:return r.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=r.sent(),!(n=this.getLatestExecutedMigration(t)))return this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!"),[2];if(i=this.getMigrations(),!(a=i.find(function(e){return e.name===n.name})))throw new Error("No migration "+n.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild("Now reverting it..."),o=!1,!this.transaction||e.isTransactionActive?[3,4]:[4,e.startTransaction()];case 3:r.sent(),o=!0,r.label=4;case 4:return r.trys.push([4,9,14,17]),[4,a.instance.down(e)];case 5:return r.sent(),[4,this.deleteExecutedMigration(e,a)];case 6:return r.sent(),this.connection.logger.logSchemaBuild("Migration "+a.name+" has been reverted successfully."),o?[4,e.commitTransaction()]:[3,8];case 7:r.sent(),r.label=8;case 8:return[3,17];case 9:if(s=r.sent(),!o)return[3,13];r.label=10;case 10:return r.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:return r.sent(),[3,13];case 12:return r.sent(),[3,13];case 13:throw s;case 14:return this.queryRunner?[3,16]:[4,e.release()];case 15:r.sent(),r.label=16;case 16:return[7];case 17:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return this.connection.driver instanceof m.a?[2]:[4,e.hasTable(this.migrationsTable)];case 1:return t.sent()?[3,3]:[4,e.createTable(new o.a({name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))];case 2:t.sent(),t.label=3;case 3:return[2]}})})},e.prototype.loadExecutedMigrations=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return this.connection.driver instanceof m.a?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().toArray()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,this.connection.manager.createQueryBuilder(e).select().from(this.migrationsTable,this.migrationsTableName).getRawMany()];case 3:return[2,t.sent().map(function(e){return new f(parseInt(e.id),parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){return this.connection.migrations.map(function(e){var t=e.constructor.name,n=parseInt(t.substr(-13));if(!n)throw new Error(t+" migration name is wrong. Migration class name should have a JavaScript timestamp appended.");return new f(void 0,n,t,e)}).sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.getLatestTimestampMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*(e.timestamp-t.timestamp)});return t.length>0?t[0]:void 0},e.prototype.getLatestExecutedMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*((e.id||0)-(t.id||0))});return t.length>0?t[0]:void 0},e.prototype.insertExecutedMigration=function(e,t){return r.b(this,void 0,void 0,function(){var n;return r.d(this,function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof h.a?(n.timestamp=new d.a(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new d.a(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof m.a?(e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insert(n),[3,3]):[3,1];case 1:return[4,e.manager.createQueryBuilder().insert().into(this.migrationsTable).values(n).execute()];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.deleteExecutedMigration=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof h.a?(n.timestamp=new d.a(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new d.a(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof m.a?(e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n),[3,3]):[3,1];case 1:return[4,(i=e.manager.createQueryBuilder()).delete().from(this.migrationsTable).where(i.escape("timestamp")+" = :timestamp").andWhere(i.escape("name")+" = :name").setParameters(n).execute()];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e}(),v=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingPrimaryColumnError",Object.setPrototypeOf(r,t.prototype),r.message='Entity "'+n.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',r}return r.c(t,e),t}(Error),g=function(e){function t(n){var r=e.call(this)||this;return r.name="CircularRelationsError",Object.setPrototypeOf(r,t.prototype),r.message="Circular relations detected: "+n+". To resolve this issue you need to set nullable: false somewhere in this dependency structure.",r}return r.c(t,e),t}(Error);function b(e,t,n){var r=[],i={};return function a(o){i[o]=!0,r.push(o),e[o].forEach(function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new Error("Dependency Cycle Found: "+r.join(" -> "))}else a(e)}),r.pop(),t&&0!==e[o].length||-1!==n.indexOf(o)||n.push(o)}}var E=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(2===arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){Object.keys(t).forEach(function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var n=[];b(this.outgoingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var n=[];b(this.incomingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,n=[],r=Object.keys(this.nodes);if(0===r.length)return n;var i=b(this.outgoingEdges,!1,[]);r.forEach(function(e){i(e)});var a=b(this.outgoingEdges,e,n);return r.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){a(e)}),n},e}(),T=function(e){function t(n,r,i){var a=e.call(this)||this;a.name="DataTypeNotSupportedError",Object.setPrototypeOf(a,t.prototype);var o="string"==typeof r?r:r.name;return a.message='Data type "'+o+'" in "'+n.entityMetadata.targetName+"."+n.propertyName+'" is not supported by "'+i+'" database.',a}return r.c(t,e),t}(Error),w=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Option "'+n+'" is not set in your connection options, please define "'+n+'" option in your connection options or ormconfig.json',r}return r.c(t,e),t}(Error),N=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "'+n.entityMetadata.targetName+"#"+n.propertyPath+'". This is ORM requirement to make relations to work properly. Refer docs for more information.',r}return r.c(t,e),t}(Error),C=function(){function e(){}return e.prototype.validateMany=function(e,t){var n=this;e.forEach(function(r){return n.validate(r,e,t)}),this.validateDependencies(e),this.validateEagerRelations(e)},e.prototype.validate=function(e,t,n){if(!e.primaryColumns.length&&!e.isJunction)throw new v(e);if("STI"===e.inheritancePattern){if(!e.discriminatorColumn)throw new Error("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?");if(-1!==["",void 0,null].indexOf(e.discriminatorValue))throw new Error("Entity "+e.name+" has empty discriminator value. Discriminator value should not be empty.");var r=t.find(function(t){return t!==e&&t.discriminatorValue===e.discriminatorValue});if(r)throw new Error("Entities "+e.name+" and "+r.name+" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.")}if((e.relationCounts.forEach(function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),n instanceof m.a||e.columns.forEach(function(t){var r=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(r))throw new T(t,r,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(r))throw new Error("Column "+t.propertyName+" of Entity "+e.name+" does not support length property.")}),n instanceof m.e)&&e.columns.filter(function(e){return e.isGenerated&&"uuid"!==e.generationStrategy}).length>1)throw new Error("Error in "+e.name+" entity. There can be only one auto-increment column in MySql table.");if(n instanceof m.e&&(0===t.filter(function(e){return e.database}).length&&!n.database))throw new w("database");if(n instanceof h.a&&e.columns.filter(function(e){return e.charset}).length>1)throw new Error("Character set specifying is not supported in Sql Server");var i=e.create();e.relations.forEach(function(e){if(e.isManyToMany||e.isOneToMany){if(!1===e.persistenceEnabled)return;if(e.getEntityValue(i)instanceof Array)throw new N(e)}}),e.relations.forEach(function(e){}),e.relations.forEach(function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Error("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")}),e.eagerRelations.forEach(function(e){})},e.prototype.validateDependencies=function(e){var t=new E;e.forEach(function(e){t.addNode(e.name)}),e.forEach(function(e){e.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)})});try{t.overallOrder()}catch(e){throw new g(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e.prototype.validateEagerRelations=function(e){e.forEach(function(e){e.eagerRelations.forEach(function(t){if(t.inverseRelation&&t.inverseRelation.isEager)throw new Error("Circular eager relations are disallowed. "+e.targetName+"#"+t.propertyPath+' contains "eager: true", and its inverse side '+t.inverseEntityMetadata.targetName+"#"+t.inverseRelation.propertyPath+' contains "eager: true" as well. Remove "eager: true" from one side of the relation.')})})},e}(),S=function(e){function t(){var n=e.call(this)||this;return n.name="QueryRunnerProviderAlreadyReleasedError",Object.setPrototypeOf(n,t.prototype),n.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",n}return r.c(t,e),t}(Error),A=function(e){function t(n,r){var i,a=e.call(this)||this;a.name="EntityNotFound",Object.setPrototypeOf(a,t.prototype),i=n instanceof ct?n.options.name:"function"==typeof n?n.name:n;var o=a.stringifyCriteria(r);return a.message='Could not find any entity of type "'+i+'" matching: '+o,a}return r.c(t,e),t.prototype.stringifyCriteria=function(e){try{return JSON.stringify(e,null,4)}catch(e){}return""+e},t}(Error),O=function(e){function t(){var n=e.call(this)||this;return n.name="NoNeedToReleaseEntityManagerError",Object.setPrototypeOf(n,t.prototype),n.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",n}return r.c(t,e),t}(Error),R=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this.manager).merge.apply(t,r.f([this.metadata.target,e],n))},e.prototype.preload=function(e){return this.manager.preload(this.metadata.target,e)},e.prototype.save=function(e,t){return this.manager.save(this.metadata.target,e,t)},e.prototype.remove=function(e,t){return this.manager.remove(this.metadata.target,e,t)},e.prototype.insert=function(e,t){return this.manager.insert(this.metadata.target,e,t)},e.prototype.update=function(e,t,n){return this.manager.update(this.metadata.target,e,t,n)},e.prototype.delete=function(e,t){return this.manager.delete(this.metadata.target,e,t)},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e,t){return this.manager.findOne(this.metadata.target,e,t)},e.prototype.findOneOrFail=function(e,t){return this.manager.findOneOrFail(this.metadata.target,e,t)},e.prototype.query=function(e,t){return this.manager.query(e,t)},e.prototype.clear=function(){return this.manager.clear(this.metadata.target)},e.prototype.increment=function(e,t,n){return this.manager.increment(this.metadata.target,e,t,n)},e.prototype.decrement=function(e,t,n){return this.manager.decrement(this.metadata.target,e,t,n)},e}(),M=n(18),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.c(t,e),t.prototype.findTrees=function(){return r.b(this,void 0,void 0,function(){var e,t=this;return r.d(this,function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return e=n.sent(),[4,Promise.all(e.map(function(e){return t.findDescendantsTree(e)}))];case 2:return n.sent(),[2,e]}})})},t.prototype.findRoots=function(){var e,t,n=this,r=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,"id");return this.createQueryBuilder("treeEntity").where((t="treeEntity",n.manager.connection.driver.escape(t)+"."+(e=r,n.manager.connection.driver.escape(e))+" IS NULL")).getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildChildrenEntityTree(e,n.entities,r),e})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)};if("closure-table"===this.metadata.treeType){var a=this.metadata.closureJunctionTable.descendantColumns.map(function(n){return i(t)+"."+i(n.propertyPath)+" = "+i(e)+"."+i(n.referencedColumn.propertyPath)}).join(" AND "),o={},s=this.metadata.closureJunctionTable.ancestorColumns.map(function(e){return o[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),i(t)+"."+i(e.propertyPath)+" = :"+e.referencedColumn.propertyName}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(s).setParameters(o)}if("nested-set"===this.metadata.treeType){s=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath;var u={};a=this.metadata.treeParentRelation.joinColumns.map(function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return u[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",s).where(a,u)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where(function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof M.a?e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE "+i.getQuery()+" || '%'":e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE CONCAT("+i.getQuery()+", '%')"});throw new Error("Supported only in tree entities")},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildParentEntityTree(e,n.entities,r),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this;if("closure-table"===this.metadata.treeType){var i=this.metadata.closureJunctionTable.ancestorColumns.map(function(n){return t+"."+n.propertyPath+" = "+e+"."+n.referencedColumn.propertyPath}).join(" AND "),a={},o=this.metadata.closureJunctionTable.descendantColumns.map(function(e){return a[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),t+"."+e.propertyPath+" = :"+e.referencedColumn.propertyName}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,i).where(o).setParameters(a)}if("nested-set"===this.metadata.treeType){i="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath;var s={};o=this.metadata.treeParentRelation.joinColumns.map(function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return s[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",i).where(o,s)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where(function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof M.a?i.getQuery()+" LIKE "+e+"."+r.metadata.materializedPathColumn.propertyPath+" || '%'":i.getQuery()+" LIKE CONCAT("+e+"."+r.metadata.materializedPathColumn.propertyPath+", '%')"});throw new Error("Supported only in tree entities")},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map(function(t){var r=n.metadata.treeParentRelation.joinColumns[0],i=r.givenDatabaseName||r.databaseName,a=t[e+"_"+n.metadata.primaryColumns[0].databaseName],o=t[e+"_"+i];return{id:n.manager.connection.driver.prepareHydratedValue(a,n.metadata.primaryColumns[0]),parentId:n.manager.connection.driver.prepareHydratedValue(o,r)}})},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.filter(function(e){return e.parentId===a}).map(function(e){return e.id});e[i]=t.filter(function(e){return-1!==o.indexOf(e.id)}),e[i].forEach(function(e){r.buildChildrenEntityTree(e,t,n)})},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.find(function(e){return e.id===a}),s=t.find(function(e){return!!o&&e[r.metadata.primaryColumns[0].propertyName]===o.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(R),P=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),1===n.length?r.message='Relation "'+n[0]+'" was not found, please check if it is correct and really exist in your entity.':r.message="Relations "+n.map(function(e){return'"'+e+'"'}).join(", ")+" were not found, please check if relations are correct and they exist in your entities.",r}return r.c(t,e),t}(Error),x=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(t.select instanceof Array||t.where instanceof Object||"string"==typeof t.where||t.relations instanceof Array||t.join instanceof Object||t.order instanceof Object||t.cache instanceof Object||"boolean"==typeof t.cache||"number"==typeof t.cache||t.loadRelationIds instanceof Object||"boolean"==typeof t.loadRelationIds||"boolean"==typeof t.loadEagerRelations)},e.isFindManyOptions=function(e){var t=e;return t&&(this.isFindOneOptions(t)||"number"==typeof t.skip||"number"==typeof t.take||"string"==typeof t.skip||"string"==typeof t.take)},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(e,t){if(!t||!this.isFindOneOptions(t)&&!this.isFindManyOptions(t))return e;if(!e.expressionMap.mainAlias||!e.expressionMap.mainAlias.hasMetadata)return e;var n=e.expressionMap.mainAlias.metadata;if(t.select&&(e.select([]),t.select.forEach(function(t){if(!n.findColumnWithPropertyPath(String(t)))throw new Error(t+" column was not found in the "+n.name+" entity.");e.addSelect(e.alias+"."+t)})),t.where&&e.where(t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach(function(r){var i=t.order[r];if(!n.findColumnWithPropertyPath(r))throw new Error(r+" column was not found in the "+n.name+" entity.");switch(i){case 1:e.addOrderBy(e.alias+"."+r,"ASC");break;case-1:e.addOrderBy(e.alias+"."+r,"DESC");break;case"ASC":e.addOrderBy(e.alias+"."+r,"ASC");break;case"DESC":e.addOrderBy(e.alias+"."+r,"DESC")}}),t.relations){var r=t.relations.map(function(e){return e});if(this.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),r.length>0)throw new P(r)}if(t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach(function(n){e.leftJoin(t.join.leftJoin[n],n)}),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach(function(n){e.innerJoin(t.join.innerJoin[n],n)}),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach(function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)}),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach(function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)})),t.cache)if(t.cache instanceof Object){var i=t.cache;e.cache(i.id,i.milliseconds)}else e.cache(t.cache);return!0===t.loadRelationIds?e.loadAllRelationIds():t.loadRelationIds instanceof Object&&e.loadAllRelationIds(t.loadRelationIds),e},e.applyRelationsRecursively=function(e,t,n,r,i){var a=this,o=[];if(i){var s=new RegExp("^"+i.replace(".","\\.")+"\\.");o=t.filter(function(e){return e.match(s)}).map(function(e){return e.replace(s,"")}).filter(function(e){return r.findRelationWithPropertyPath(e)})}else o=t.filter(function(e){return r.findRelationWithPropertyPath(e)});o.forEach(function(o){var s=n+"."+o;e.leftJoinAndSelect(s,n+"__"+o);var u=r.relations.find(function(e){return e.propertyName===o});u&&a.joinEagerRelations(e,n+"__"+o,u.inverseEntityMetadata),t.splice(t.indexOf(i?i+"."+o:o),1);var c=e.expressionMap.joinAttributes.find(function(e){return e.entityOrProperty===s});a.applyRelationsRecursively(e,t,c.alias.name,c.metadata,i?i+"."+o:o)})},e.joinEagerRelations=function(e,t,n){var r=this;n.eagerRelations.forEach(function(n){var i=t+"_"+n.propertyPath.replace(".","_");e.leftJoinAndSelect(t+"."+n.propertyPath,i),r.joinEagerRelations(e,i,n.inverseEntityMetadata)})},e}(),I=function(){function e(){}return e.prototype.transform=function(e,t,n,r){return void 0===r&&(r=!1),this.groupAndTransform(e,t,n,r),e},e.prototype.groupAndTransform=function(e,t,n,r){var i=this;void 0===r&&(r=!1),n.nonVirtualColumns.forEach(function(n){var r=n.getEntityValue(t);void 0!==r&&n.setEntityValue(e,r)}),n.relations.length&&n.relations.forEach(function(n){var a=n.getEntityValue(e),o=n.getEntityValue(t,r);if(void 0!==o)if(n.isOneToMany||n.isManyToMany){if(!(o instanceof Array))return;a||(a=[],n.setEntityValue(e,a)),o.forEach(function(e){var t=a.find(function(t){return n.inverseEntityMetadata.compareEntities(e,t)});t||(t=n.inverseEntityMetadata.create(),a.push(t)),i.groupAndTransform(t,e,n.inverseEntityMetadata,r)})}else{if(!(o instanceof Object))return void(a instanceof Object||n.setEntityValue(e,o));a||(a=n.inverseEntityMetadata.create(),n.setEntityValue(e,a)),i.groupAndTransform(a,o,n.inverseEntityMetadata,r)}})},e}(),L=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e}(),j=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find(function(t){return t.target===e.target&&t.id===e.id})||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach(function(t){var r=n.loadMapItems.find(function(n){return n.target===e&&n.metadata.compareEntities(t,n.plainEntity)});r&&(r.entity=t)})},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach(function(t){var n=e.find(function(e){return e.target===t.target});n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)}),e},e}(),D=function(){function e(e){this.manager=e}return e.prototype.transform=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a=this;return r.d(this,function(o){switch(o.label){case 0:return t.hasAllPrimaryKeys(e)?(n=new j,(i=function(e,a,o,s){var u=new L(e,a,o,s);n.addLoadMap(u),a.extractRelationValuesFromEntity(e,t.relations).filter(function(e){return null!=e}).forEach(function(e){var t=r.e(e,3),n=t[0],a=t[1],o=t[2];return i(a,o,u,n)})})(e,t),[4,Promise.all(n.groupByTargetIds().map(function(e){return a.manager.findByIds(e.target,e.ids).then(function(t){return n.fillEntities(e.target,t)})}))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return o.sent(),n.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0]}})})},e}(),k=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryNotFoundError",Object.setPrototypeOf(r,t.prototype),r.message="Custom repository "+(n instanceof Function?n.name:n.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",r}return r.c(t,e),t}(Error),q=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryDoesNotHaveEntityError",Object.setPrototypeOf(r,t.prototype),r.message="Custom repository "+(n instanceof Function?n.name:n.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ",r}return r.c(t,e),t}(Error),B=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new q(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new q(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new q(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=Hn().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new k(e);return t.entity},e}(),U=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryCannotInheritRepositoryError",Object.setPrototypeOf(r,t.prototype),r.message="Custom entity repository "+(n instanceof Function?n.name:n.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.",r}return r.c(t,e),t}(Error),F=function(e){function t(n,r){var i,a=e.call(this)||this;return a.name="RepositoryNotFoundError",Object.setPrototypeOf(a,t.prototype),i=r instanceof ct?r.options.name:"function"==typeof r?r.name:r,a.message='No repository for "'+i+'" was found. Looks like this entity is not registered in current "'+n+'" connection?',a}return r.c(t,e),t}(Error),V=function(e){function t(n){var r,i=e.call(this)||this;return i.name="RepositoryNotTreeError",Object.setPrototypeOf(i,t.prototype),r=n instanceof ct?n.options.name:"function"==typeof n?n.name:n,i.message='Repository of the "'+r+'" class is not a TreeRepository. Try to apply @Tree decorator on your entity.',i}return r.c(t,e),t}(Error),Q=function(){function e(){}return e.prototype.create=function(e,t,n){if(t.treeType){var r=new _;return Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r}r=void 0;return r=e.connection.driver instanceof m.a?new m.d:new R,Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r},e}(),K=function(e){function t(n){var r=e.call(this)||this;return r.name="TreeRepositoryNotSupportedError",Object.setPrototypeOf(r,t.prototype),r.message="Tree repositories are not supported in "+n.options.type+" driver.",r}return r.c(t,e),t}(Error),W=function(e){function t(n,r){var i=e.call(this)||this;return i.name="MustBeEntityError",Object.setPrototypeOf(i,t.prototype),i.message="Cannot "+n+', given value must be an entity, instead "'+r+'" is given.',i}return r.c(t,e),t}(Error),H=function(){function e(e){this.subjects=r.f(e),this.metadatas=this.getUniqueMetadatas(this.subjects)}return e.prototype.sort=function(e){var t=this;if(!this.metadatas.length)return this.subjects;var n=[];if("delete"===e){var i=this.subjects.filter(function(e){return!e.entity&&!e.databaseEntity});n.push.apply(n,r.f(i)),this.removeAlreadySorted(i)}var a=this.getNonNullableDependencies(),o=this.toposort(a);"insert"===e&&(o=o.reverse()),o.forEach(function(e){var i=t.subjects.filter(function(t){return t.metadata.targetName===e});n.push.apply(n,r.f(i)),t.removeAlreadySorted(i)});var s=this.getDependencies(),u=this.toposort(s);return"insert"===e&&(u=u.reverse()),u.forEach(function(e){var i=t.subjects.filter(function(t){return t.metadata.targetName===e});n.push.apply(n,r.f(i)),t.removeAlreadySorted(i)}),n.push.apply(n,r.f(this.subjects)),n},e.prototype.removeAlreadySorted=function(e){var t=this;e.forEach(function(e){t.subjects.splice(t.subjects.indexOf(e),1)})},e.prototype.getUniqueMetadatas=function(e){var t=[];return e.forEach(function(e){-1===t.indexOf(e.metadata)&&t.push(e.metadata)}),t},e.prototype.getNonNullableDependencies=function(){return this.metadatas.reduce(function(e,t){return t.relationsWithJoinColumns.forEach(function(n){n.isNullable||e.push([t.targetName,n.inverseEntityMetadata.targetName])}),e},[])},e.prototype.getDependencies=function(){return this.metadatas.reduce(function(e,t){return t.relationsWithJoinColumns.forEach(function(n){n.inverseEntityMetadata!==t&&e.push([t.targetName,n.inverseEntityMetadata.targetName])}),e},[])},e.prototype.toposort=function(e){for(var t=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.indexOf(i[0])<0&&t.push(i[0]),t.indexOf(i[1])<0&&t.push(i[1])}return t}(e),n=t.length,r=new Array(n),i={},a=n;a--;)i[a]||o(t[a],a,[]);function o(a,s,u){if(u.indexOf(a)>=0)throw new Error("Cyclic dependency: "+JSON.stringify(a));if(!~t.indexOf(a))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(a));if(!i[s]){i[s]=!0;var c=e.filter(function(e){return e[0]===a});if(s=c.length){var l=u.concat(a);do{var f=c[--s][1];o(f,t.indexOf(f),l)}while(s)}r[--n]=a}}return r},e}(),Y=n(6),z=n(23),J=n(5),G=function(){function e(){}return e.prototype.compute=function(e){var t=this;e.forEach(function(n){t.computeDiffColumns(n),t.computeDiffRelationalColumns(e,n)})},e.prototype.computeDiffColumns=function(e){e.entity&&e.metadata.columns.forEach(function(t){if(!(t.isVirtual||t.isDiscriminator||t.isUpdateDate||t.isVersion||t.isCreateDate)){var n=e.changeMaps.find(function(e){return e.column===t});n&&e.changeMaps.splice(e.changeMaps.indexOf(n),1);var r=t.getEntityValue(e.entity);if(void 0!==r){if(e.databaseEntity){var i=t.getEntityValue(e.databaseEntity);if(t.relationMetadata){var a=t.relationMetadata.getEntityValue(e.entity);if(null!=a)return}var o=r;if(null!==r)if("date"===t.type)o=Y.a.mixedDateToDateString(r);else if("time"===t.type)o=Y.a.mixedDateToTimeString(r);else if("datetime"===t.type||t.type===Date)o=Y.a.mixedDateToUtcDatetimeString(r),i=Y.a.mixedDateToUtcDatetimeString(i);else if("json"===t.type||"jsonb"===t.type){if(J.a.deepCompare(r,i))return}else"simple-array"===t.type?(o=Y.a.simpleArrayToString(r),i=Y.a.simpleArrayToString(i)):"simple-enum"===t.type&&(o=Y.a.simpleEnumToString(r),i=Y.a.simpleEnumToString(i));if(o===i)return}e.diffColumns.push(t),e.changeMaps.push({column:t,value:r})}}})},e.prototype.computeDiffRelationalColumns=function(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach(function(n){var r=n.getEntityValue(t.entity);if(void 0!==r){if(t.databaseEntity){var i=r;null!==i&&i instanceof Object&&(i=n.getRelationIdMap(i));var a=n.getEntityValue(t.databaseEntity);if(z.a.compareIds(i,a))return;t.diffRelations.push(n)}var o=e.find(function(e){return e.mustBeInserted&&e.entity===r});o&&(r=o);var s=t.changeMaps.find(function(e){return e.relation===n});s?s.value=r:t.changeMaps.push({relation:n,value:r})}})},e}(),X=function(e){function t(n){var r=e.call(this)||this;return r.name="SubjectWithoutIdentifierError",Object.setPrototypeOf(r,t.prototype),r.message="Internal error. Subject "+n.metadata.targetName+" must have an identifier to perform operation. Please report a github issue if you face this error.",r}return r.c(t,e),t}(Error),Z=function(e){function t(n){var r=e.call(this)||this;return r.name="SubjectRemovedAndUpdatedError",Object.setPrototypeOf(r,t.prototype),r.message='Removed entity "'+n.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).',r}return r.c(t,e),t}(Error),$=n(39),ee=n(12),te=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c=this;return r.d(this,function(r){switch(r.label){case 0:return t=function(e){return c.queryRunner.connection.driver.escape(e)},n=this.getTableName(e.metadata.tablePath),i=t(e.metadata.nestedSetLeftColumn.databaseName),a=t(e.metadata.nestedSetRightColumn.databaseName),!(o=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(o=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),s=e.metadata.getEntityIdMap(o),u=void 0,s?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(s).getRawOne().then(function(e){var t=e?e.right:void 0;return"string"==typeof t?parseInt(t):t})]:[3,2];case 1:u=r.sent(),r.label=2;case 2:return void 0===u?[3,4]:[4,this.queryRunner.query("UPDATE "+n+" SET "+i+" = CASE WHEN "+i+" > "+u+" THEN "+i+" + 2 ELSE "+i+" END,"+a+" = "+a+" + 2 WHERE "+a+" >= "+u)];case 3:return r.sent(),J.a.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(u),e.metadata.nestedSetRightColumn.createValueMap(u+1)),[3,5];case 4:J.a.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2)),r.label=5;case 5:return[2]}})})},e.prototype.getTableName=function(e){var t=this;return e.split(".").map(function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)}).join(".")},e}(),ne=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotAttachTreeChildrenEntityError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot attach entity "'+n+'" to its parent. Please make sure parent is saved in the database before saving children nodes.',r}return r.c(t,e),t}(Error),re=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c,l,f,p=this;return r.d(this,function(h){switch(h.label){case 0:return t={},e.metadata.closureJunctionTable.ancestorColumns.forEach(function(n){t[n.databaseName]=e.identifier}),e.metadata.closureJunctionTable.descendantColumns.forEach(function(n){t[n.databaseName]=e.identifier}),[4,this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(t).updateEntity(!1).callListeners(!1).execute()];case 1:return h.sent(),!(n=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n?(i=function(e){return p.queryRunner.connection.driver.escape(e)},a=this.getTableName(e.metadata.closureJunctionTable.tablePath),o=e.metadata.closureJunctionTable.ancestorColumns.map(function(e){return i(e.databaseName)}),s=e.metadata.closureJunctionTable.descendantColumns.map(function(e){return i(e.databaseName)}),u=[],c=e.metadata.primaryColumns.map(function(t){return t.getEntityValue(e.insertedValueSet)}),l=e.metadata.primaryColumns.map(function(e,t){return u.push(c[t]),p.queryRunner.connection.driver.createParameter("child_entity_"+e.databaseName,u.length-1)}),f=e.metadata.primaryColumns.map(function(t){var r=i(t.databaseName+"_descendant"),a=t.getEntityValue(n);if(!a)throw new ne(e.metadata.name);return u.push(a),r+" = "+p.queryRunner.connection.driver.createParameter("parent_entity_"+t.databaseName,u.length-1)}).join(", "),[4,this.queryRunner.query("INSERT INTO "+a+" ("+r.f(o,s).join(", ")+") SELECT "+o.join(", ")+", "+l.join(", ")+" FROM "+a+" WHERE "+f,u)]):[3,3];case 2:h.sent(),h.label=3;case 3:return[2]}})})},e.prototype.getTableName=function(e){var t=this;return e.split(".").map(function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)}).join(".")},e}(),ie=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return!(n=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),i=e.metadata.getEntityIdMap(n),a="",i?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).whereInIds(i).getRawOne().then(function(e){return e?e.path:void 0})]:[3,2];case 1:a=r.sent(),r.label=2;case 2:return o=e.metadata.treeParentRelation.joinColumns.map(function(t){return t.referencedColumn.getEntityValue(e.insertedValueSet)}).join("_"),[4,this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set((t={},t[e.metadata.materializedPathColumn.propertyPath]=a+o+".",t)).where(e.identifier).execute()];case 3:return r.sent(),[2]}})})},e}(),ae=function(){function e(e,t,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=n,this.validate(),this.recompute()}return e.prototype.execute=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return e=void 0,this.options&&!1===this.options.listeners?[3,2]:(e=this.broadcastBeforeEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e&&e.count>0&&(this.insertSubjects.forEach(function(e){return e.recompute()}),this.updateSubjects.forEach(function(e){return e.recompute()}),this.removeSubjects.forEach(function(e){return e.recompute()}),this.recompute()),this.insertSubjects=new H(this.insertSubjects).sort("insert"),[4,this.executeInsertOperations()];case 3:return t.sent(),this.updateSubjects=this.allSubjects.filter(function(e){return e.mustBeUpdated}),[4,this.executeUpdateOperations()];case 4:return t.sent(),this.removeSubjects=new H(this.removeSubjects).sort("delete"),[4,this.executeRemoveOperations()];case 5:return t.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 6:return t.sent(),this.options&&!1===this.options.listeners?[3,8]:(e=this.broadcastAfterEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,8];case 7:t.sent(),t.label=8;case 8:return[2]}})})},e.prototype.validate=function(){this.allSubjects.forEach(function(e){if(e.mustBeUpdated&&e.mustBeRemoved)throw new Z(e)})},e.prototype.recompute=function(){(new G).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter(function(e){return e.mustBeInserted}),this.updateSubjects=this.allSubjects.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=this.allSubjects.filter(function(e){return e.mustBeRemoved}),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0},e.prototype.broadcastBeforeEventsForAll=function(){var e=this,t=new $.a;return this.insertSubjects.length&&this.insertSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeInsertEvent(t,n.metadata,n.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)}),t},e.prototype.broadcastAfterEventsForAll=function(){var e=this,t=new $.a;return this.insertSubjects.length&&this.insertSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterInsertEvent(t,n.metadata,n.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)}),t},e.prototype.executeInsertOperations=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i=this;return r.d(this,function(a){switch(a.label){case 0:return e=r.e(this.groupBulkSubjects(this.insertSubjects,"insert"),2),t=e[0],n=e[1],[4,p.a.runInSequence(n,function(e){return r.b(i,void 0,void 0,function(){var n,i,a,o,s,u,c=this;return r.d(this,function(l){switch(l.label){case 0:return n=t[e],i=[],a=[],o=[],this.queryRunner.connection.driver instanceof m.a?n.forEach(function(e){e.metadata.createDateColumn&&e.entity&&(e.entity[e.metadata.createDateColumn.databaseName]=new Date),e.metadata.updateDateColumn&&e.entity&&(e.entity[e.metadata.updateDateColumn.databaseName]=new Date),e.createValueSetAndPopChangeMap(),a.push(e),i.push(e.entity)}):this.queryRunner.connection.driver instanceof ee.a?n.forEach(function(e){o.push(e)}):n.forEach(function(e){0===e.changeMaps.length||e.metadata.treeType||c.queryRunner.connection.driver instanceof ee.a?o.push(e):(a.push(e),i.push(e.createValueSetAndPopChangeMap()))}),this.queryRunner instanceof m.c?[4,this.queryRunner.manager.insert(n[0].metadata.target,i)]:[3,2];case 1:return s=l.sent(),n.forEach(function(e,t){e.identifier=s.identifiers[t],e.generatedMap=s.generatedMaps[t],e.insertedValueSet=i[t]}),[3,6];case 2:return i.length>0?[4,this.queryRunner.manager.createQueryBuilder().insert().into(n[0].metadata.target).values(i).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute()]:[3,4];case 3:u=l.sent(),a.forEach(function(e,t){e.identifier=u.identifiers[t],e.generatedMap=u.generatedMaps[t],e.insertedValueSet=i[t]}),l.label=4;case 4:return o.length>0?[4,p.a.runInSequence(o,function(e){return r.b(c,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return e.insertedValueSet=e.createValueSetAndPopChangeMap(),"nested-set"!==e.metadata.treeType?[3,2]:[4,new te(this.queryRunner).insert(e)];case 1:t.sent(),t.label=2;case 2:return[4,this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.target).values(e.insertedValueSet).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute().then(function(t){e.identifier=t.identifiers[0],e.generatedMap=t.generatedMaps[0]})];case 3:return t.sent(),"closure-table"!==e.metadata.treeType?[3,5]:[4,new re(this.queryRunner).insert(e)];case 4:return t.sent(),[3,7];case 5:return"materialized-path"!==e.metadata.treeType?[3,7]:[4,new ie(this.queryRunner).insert(e)];case 6:t.sent(),t.label=7;case 7:return[2]}})})})]:[3,6];case 5:l.sent(),l.label=6;case 6:return n.forEach(function(e){e.generatedMap&&e.metadata.columns.forEach(function(t){var n=t.getEntityValue(e.generatedMap);if(null!=n){var r=c.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}})}),[2]}})})})];case 1:return a.sent(),[2]}})})},e.prototype.executeUpdateOperations=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(t){return r.b(e,void 0,void 0,function(){var e,n,i,a,o=this;return r.d(this,function(r){switch(r.label){case 0:if(!t.identifier)throw new X(t);return this.queryRunner instanceof m.c?(e=J.a.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return n=t.createValueSetAndPopChangeMap(),i=this.queryRunner.manager.createQueryBuilder().update(t.metadata.target).set(n).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?i.whereEntity(t.identifier):i.where(t.identifier),[4,i.execute()];case 3:a=r.sent(),t.generatedMap=a.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach(function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=o.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}}),r.label=4;case 4:return[2]}})})}))];case 1:return t.sent(),[2]}})})},e.prototype.executeRemoveOperations=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i=this;return r.d(this,function(a){switch(a.label){case 0:return e=r.e(this.groupBulkSubjects(this.removeSubjects,"delete"),2),t=e[0],n=e[1],[4,p.a.runInSequence(n,function(e){return r.b(i,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n=t[e],i=n.map(function(e){if(!e.identifier)throw new X(e);return e.identifier}),this.queryRunner instanceof m.c?[4,this.queryRunner.manager.delete(n[0].metadata.target,i)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this.queryRunner.manager.createQueryBuilder().delete().from(n[0].metadata.target).where(i).callListeners(!1).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}})})})];case 1:return a.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){var e=this;this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.removeSubjects.length&&this.removeSubjects.forEach(function(e){e.entity&&e.metadata.primaryColumns.forEach(function(t){t.setEntityValue(e.entity,void 0)})}),this.allSubjects.forEach(function(t){t.entity&&(t.metadata.relationIds.forEach(function(e){e.setValue(t.entity)}),e.queryRunner instanceof m.c&&t.metadata.objectIdColumn&&t.metadata.objectIdColumn.databaseName&&t.metadata.objectIdColumn.databaseName!==t.metadata.objectIdColumn.propertyName&&delete t.entity[t.metadata.objectIdColumn.databaseName])})},e.prototype.updateSpecialColumnsInInsertedAndUpdatedEntities=function(e){var t=this;e.forEach(function(e){e.entity&&(e.metadata.columns.forEach(function(t){if(!(e.metadata.childEntityMetadatas.length>0&&-1!==e.metadata.childEntityMetadatas.map(function(e){return e.target}).indexOf(t.target)||t.isVirtual)){if(t.isNullable)void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null);e.updatedRelationMaps.length>0&&e.updatedRelationMaps.forEach(function(t){t.relation.joinColumns.forEach(function(n){!0!==n.isVirtual&&n.setEntityValue(e.entity,t.value instanceof Object?n.referencedColumn.getEntityValue(t.value):t.value)})})}}),e.generatedMap&&t.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))})},e.prototype.groupBulkSubjects=function(e,t){var n={},r=[],i="delete"===t||this.queryRunner.connection.driver.isReturningSqlSupported();return e.forEach(function(e,t){var a=i||e.metadata.isJunction?e.metadata.name:e.metadata.name+"_"+t;n[a]?n[a].push(e):(n[a]=[e],r.push(a))}),[n,r]},e}(),oe=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotDetermineEntityError",Object.setPrototypeOf(r,t.prototype),r.message="Cannot "+n+", given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.",r}return r.c(t,e),t}(Error),se=function(){function e(e){var t;this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&(t=this.changeMaps).push.apply(t,r.f(e.changeMaps)),this.recompute()}return Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.length>0},enumerable:!0,configurable:!0}),e.prototype.createValueSetAndPopChangeMap=function(){var t=this,n=[],r=this.changeMaps.reduce(function(r,i){var a,o=i.value;if(o instanceof e&&(o=o.insertedValueSet?o.insertedValueSet:o.entity),t.metadata.isJunction&&i.column)a=i.column.createValueMap(i.column.referencedColumn.getEntityValue(o));else if(i.column)a=i.column.createValueMap(o);else if(i.relation)if(o instanceof Object){var s=i.relation.getRelationIdMap(o);if(void 0===s)return n.push(i),t.canBeUpdated=!0,r;a=i.relation.createValueMap(s),t.updatedRelationMaps.push({relation:i.relation,value:s})}else a=i.relation.createValueMap(o),t.updatedRelationMaps.push({relation:i.relation,value:o});return J.a.mergeDeep(r,a),r},{});return this.changeMaps=n,r},e.prototype.recompute=function(){var e=this;this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach(function(t){t.relationMetadata&&t.relationMetadata.inverseEntityMetadata===e.parentSubject.metadata&&t.setEntityValue(e.entityWithFulfilledIds,e.parentSubject.entity)}),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))},e}(),ue=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.metadata.oneToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)})})},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),void 0!==i){var a=[];i.forEach(function(i){var o=t.inverseEntityMetadata.getEntityIdMap(i),s=n.subjects.find(function(e){return e.entity===i});if(s&&(o=s.identifier),o){r.find(function(e){return J.a.deepCompare(o,e)})||(s||(s=new se({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:o}),n.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e})),a.push(o)}else{if(!s)return;s.changeMaps.push({relation:t.inverseRelation,value:e})}}),z.a.difference(r,a).forEach(function(r){var i=new se({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:r,changeMaps:[{relation:t.inverseRelation,value:null}]});n.subjects.push(i)})}},e}(),ce=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.metadata.oneToOneRelations.forEach(function(n){n.isOwning||!1===n.persistenceEnabled||e.buildForSubjectRelation(t,n)})})},e.prototype.buildForSubjectRelation=function(e,t){var n=void 0;e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));var r=t.getEntityValue(e.entity);if(void 0!==r)if(null!==r){var i=t.inverseEntityMetadata.getEntityIdMap(r),a=this.subjects.find(function(e){return!!e.entity&&e.entity===r});if(a&&(i=a.identifier),!i){if(!a)return;a.changeMaps.push({relation:t.inverseRelation,value:e})}n&&J.a.deepCompare(i,n)||(a||(a=new se({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:i}),this.subjects.push(a)),a.changeMaps.push({relation:t.inverseRelation,value:e}))}else if(n){var o=new se({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:n,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(o)}},e}(),le=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.entity&&t.metadata.manyToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)})})},e.prototype.buildForAllRemoval=function(e){var t=this;e.databaseEntity&&e.metadata.manyToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&n.getEntityValue(e.databaseEntity).forEach(function(r){var i=new se({metadata:n.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:t.buildJunctionIdentifier(e,n,r)});t.subjects.push(i)})})},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),i instanceof Array){i.forEach(function(i){var a=t.inverseEntityMetadata.getEntityIdMap(i),o=n.subjects.find(function(e){return e.entity===i});if((o&&(a=o.identifier),a||o)&&!r.find(function(e){return z.a.compareIds(e,a)})){var s=t.isOwning?e:o||i,u=t.isOwning?o||i:e,c=new se({metadata:t.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});n.subjects.push(c),t.junctionEntityMetadata.ownerColumns.forEach(function(e){c.changeMaps.push({column:e,value:s})}),t.junctionEntityMetadata.inverseColumns.forEach(function(e){c.changeMaps.push({column:e,value:u})})}});var a=[];i.forEach(function(e){var r=t.inverseEntityMetadata.getEntityIdMap(e),i=n.subjects.find(function(t){return t.entity===e});i&&(r=i.identifier),null!=r&&a.push(r)}),r.filter(function(e){return!a.find(function(t){return z.a.compareIds(t,e)})}).forEach(function(r){var i=new se({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:n.buildJunctionIdentifier(e,t,r)});n.subjects.push(i)})}},e.prototype.buildJunctionIdentifier=function(e,t,n){var r=t.isOwning?e.entity:n,i=t.isOwning?n:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach(function(e){J.a.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(r)))}),t.junctionEntityMetadata.inverseColumns.forEach(function(e){J.a.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))}),a},e}(),fe=function(){function e(e,t){this.queryRunner=e,this.subjects=t}return e.prototype.load=function(e){return r.b(this,void 0,void 0,function(){var t,n=this;return r.d(this,function(i){switch(i.label){case 0:return t=this.groupByEntityTargets().map(function(t){return r.b(n,void 0,void 0,function(){var n,i,a,o,s,u,c,l,f=this;return r.d(this,function(p){switch(p.label){case 0:return a=[],o=[],t.subjects.forEach(function(e){!e.databaseEntity&&e.identifier&&(a.push(e.identifier),o.push(e))}),a.length?(s=[],"save"===e?t.subjects.forEach(function(e){e.metadata.relations.forEach(function(t){void 0!==t.getEntityValue(e.entityWithFulfilledIds)&&-1===s.indexOf(t.propertyPath)&&s.push(t.propertyPath)})}):s.push.apply(s,r.f(t.subjects[0].metadata.manyToManyRelations.map(function(e){return e.propertyPath}))),u={loadEagerRelations:!1,loadRelationIds:{relations:s,disableMixedMap:!0}},[4,this.queryRunner.manager.getRepository(t.target).findByIds(a,u)]):[2];case 1:p.sent().forEach(function(e){f.findByPersistEntityLike(t.target,e).forEach(function(t){t.databaseEntity=e,t.identifier||(t.identifier=t.metadata.hasAllPrimaryKeys(e)?t.metadata.getEntityIdMap(e):void 0)})});try{for(c=r.g(o),l=c.next();!l.done;l=c.next())l.value.databaseEntityLoaded=!0}catch(e){n={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return[2]}})})}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},e.prototype.findByPersistEntityLike=function(e,t){return this.subjects.filter(function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))})},e.prototype.groupByEntityTargets=function(){return this.subjects.reduce(function(e,t){var n=e.find(function(e){return e.target===t.metadata.target});return n||(n={target:t.metadata.target,subjects:[]},e.push(n)),n.subjects.push(t),e},[])},e}(),pe=function(){function e(e){this.allSubjects=e}return e.prototype.build=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach(function(n){var i=r.e(n,3),a=i[0],o=i[1],s=i[2];if(null!=o&&(a.isCascadeInsert||a.isCascadeUpdate)&&o instanceof Object){var u=t.findByPersistEntityLike(s.target,o);if(u)return!1===u.canBeInserted&&(u.canBeInserted=!0===a.isCascadeInsert),void(!1===u.canBeUpdated&&(u.canBeUpdated=!0===a.isCascadeUpdate));var c=new se({metadata:s,parentSubject:e,entity:o,canBeInserted:!0===a.isCascadeInsert,canBeUpdated:!0===a.isCascadeUpdate});t.allSubjects.push(c),t.build(c)}})},e.prototype.findByPersistEntityLike=function(e,t){return this.allSubjects.find(function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))})},e}(),he=function(){function e(e,t,n,r,i,a){this.connection=e,this.queryRunner=t,this.mode=n,this.target=r,this.entity=i,this.options=a}return e.prototype.execute=function(){var e=this;return this.entity&&this.entity instanceof Object?Promise.resolve().then(function(){return r.b(e,void 0,void 0,function(){var e,t,n,i,a,o,s,u=this;return r.d(this,function(c){switch(c.label){case 0:e=this.queryRunner||this.connection.createQueryRunner("master"),this.options&&this.options.data&&(e.data=this.options.data),c.label=1;case 1:return c.trys.push([1,,15,18]),t=this.entity instanceof Array?this.entity:[this.entity],n=this.options&&this.options.chunk&&this.options.chunk>0?J.a.chunk(t,this.options.chunk):[t],[4,Promise.all(n.map(function(t){return r.b(u,void 0,void 0,function(){var n,i,a=this;return r.d(this,function(r){switch(r.label){case 0:return n=[],t.forEach(function(e){var t=a.target?a.target:e.constructor;if(t===Object)throw new oe(a.mode);n.push(new se({metadata:a.connection.getMetadata(t),entity:e,canBeInserted:"save"===a.mode,canBeUpdated:"save"===a.mode,mustBeRemoved:"remove"===a.mode}))}),i=new pe(n),n.forEach(function(e){i.build(e)}),[4,new fe(e,n).load(this.mode)];case 1:return r.sent(),"save"===this.mode?(new ue(n).build(),new ce(n).build(),new le(n).build()):n.forEach(function(e){e.mustBeRemoved&&new le(n).buildForAllRemoval(e)}),[2,new ae(e,n,this.options)]}})})}))];case 2:if(i=c.sent(),0===(a=i.filter(function(e){return e.hasExecutableOperations})).length)return[2];o=!1,c.label=3;case 3:return c.trys.push([3,9,,14]),e.isTransactionActive?[3,5]:this.options&&!1===this.options.transaction?[3,5]:(o=!0,[4,e.startTransaction()]);case 4:c.sent(),c.label=5;case 5:return[4,p.a.runInSequence(a,function(e){return e.execute()})];case 6:return c.sent(),!0!==o?[3,8]:[4,e.commitTransaction()];case 7:c.sent(),c.label=8;case 8:return[3,14];case 9:if(s=c.sent(),!o)return[3,13];c.label=10;case 10:return c.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:return c.sent(),[3,13];case 12:return c.sent(),[3,13];case 13:throw s;case 14:return[3,18];case 15:return this.queryRunner?[3,17]:[4,e.release()];case 16:c.sent(),c.label=17;case 17:return[7];case 18:return[2]}})})}):Promise.reject(new W(this.mode,this.entity))},e}(),de=n(25),me=function(){function e(e,t){this.repositories=[],this.plainObjectToEntityTransformer=new I,this.connection=e,t&&(this.queryRunner=t,de.a.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:if(n="string"==typeof e?e:void 0,!(i="function"==typeof e?e:t))throw new Error("Transaction method requires callback in second paramter if isolation level is supplied.");if(this.connection.driver instanceof m.a)throw new Error("Transactions aren't supported by MongoDB.");if(this.queryRunner&&this.queryRunner.isReleased)throw new S;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new Error("Cannot start transaction because its already started");a=this.queryRunner||this.connection.createQueryRunner("master"),r.label=1;case 1:return r.trys.push([1,8,13,16]),n?[4,a.startTransaction(n)]:[3,3];case 2:return r.sent(),[3,5];case 3:return[4,a.startTransaction()];case 4:r.sent(),r.label=5;case 5:return[4,i(a.manager)];case 6:return o=r.sent(),[4,a.commitTransaction()];case 7:return r.sent(),[2,o];case 8:s=r.sent(),r.label=9;case 9:return r.trys.push([9,11,,12]),[4,a.rollbackTransaction()];case 10:return r.sent(),[3,12];case 11:return r.sent(),[3,12];case 12:throw s;case 13:return this.queryRunner?[3,15]:[4,a.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}})})},e.prototype.query=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(n){return[2,this.connection.query(e,t,this.queryRunner)]})})},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||n||this.queryRunner)},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(r)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);if(!t)return r.create(this.queryRunner);if(t instanceof Array)return t.map(function(t){return n.create(e,t)});var i=r.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(i,t,r,!0),i},e.prototype.merge=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=this.connection.getMetadata(e);return r.forEach(function(e){return n.plainObjectToEntityTransformer.transform(t,e,a)}),t},e.prototype.preload=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n=this.connection.getMetadata(e),[4,new D(this.connection.manager).transform(t,n)];case 1:return(i=r.sent())?[2,this.merge(e,i,t)]:[2,void 0]}})})},e.prototype.save=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof ct||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof ct&&(r=r.options.name),i instanceof Array&&0===i.length?Promise.resolve(i):new he(this.connection,this.queryRunner,"save",r,i,a).execute().then(function(){return i})},e.prototype.remove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return i instanceof Array&&0===i.length?Promise.resolve(i):new he(this.connection,this.queryRunner,"remove",r,i,a).execute().then(function(){return i})},e.prototype.insert=function(e,t,n){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return this.connection.driver instanceof ee.a&&t instanceof Array?[4,Promise.all(t.map(function(t){return n.insert(e,t)}))]:[3,2];case 1:return[2,r.sent().reduce(function(e,t){return Object.assign(e,t)},{})];case 2:return[2,this.createQueryBuilder().insert().into(e).values(t).execute()]}})})},e.prototype.update=function(e,t,n,r){return null==t||""===t||t instanceof Array&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the update method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||t instanceof Array?this.createQueryBuilder().update(e).set(n).whereInIds(t).execute():this.createQueryBuilder().update(e).set(n).where(t).execute()},e.prototype.delete=function(e,t,n){return null==t||""===t||t instanceof Array&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||t instanceof Array?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()},e.prototype.count=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,x.extractFindManyOptionsAlias(t)||n.name),[2,x.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getCount()]})})},e.prototype.find=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,x.extractFindManyOptionsAlias(t)||n.name),x.isFindManyOptions(t)&&!1===t.loadEagerRelations||x.joinEagerRelations(i,i.alias,n),[2,x.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getMany()]})})},e.prototype.findAndCount=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,x.extractFindManyOptionsAlias(t)||n.name),x.isFindManyOptions(t)&&!1===t.loadEagerRelations||x.joinEagerRelations(i,i.alias,n),[2,x.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getManyAndCount()]})})},e.prototype.findByIds=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a;return r.d(this,function(r){return t.length?(i=this.connection.getMetadata(e),a=this.createQueryBuilder(e,x.extractFindManyOptionsAlias(n)||i.name),x.applyFindManyOptionsOrConditionsToQueryBuilder(a,n),x.isFindManyOptions(n)&&!1===n.loadEagerRelations||x.joinEagerRelations(a,a.alias,i),[2,a.andWhereInIds(t).getMany()]):[2,Promise.resolve([])]})})},e.prototype.findOne=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,o,s,u;return r.d(this,function(c){return i=void 0,x.isFindOneOptions(t)?i=t:n&&x.isFindOneOptions(n)&&(i=n),a=void 0,t instanceof Object&&!x.isFindOneOptions(t)&&(a=t),o=this.connection.getMetadata(e),s=o.name,i&&i.join?s=i.join.alias:n&&x.isFindOneOptions(n)&&n.join&&(s=n.join.alias),u=this.createQueryBuilder(e,s),i&&!1===i.loadEagerRelations||x.joinEagerRelations(u,u.alias,u.expressionMap.mainAlias.metadata),i=r.a({},i||{},{take:1}),x.applyOptionsToQueryBuilder(u,i),a?u.where(a):("string"==typeof t||"number"==typeof t||t instanceof Date)&&u.andWhereInIds(o.ensureEntityIdMap(t)),[2,u.getOne()]})})},e.prototype.findOneOrFail=function(e,t,n){return r.b(this,void 0,void 0,function(){return r.d(this,function(r){return[2,this.findOne(e,t,n).then(function(n){return void 0===n?Promise.reject(new A(e,t)):Promise.resolve(n)})]})})},e.prototype.clear=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.d(this,function(r){switch(r.label){case 0:t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner("master"),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.clearTable(t.tablePath)];case 2:return[2,r.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.increment=function(e,t,n,i){return r.b(this,void 0,void 0,function(){var a,o,s,u=this;return r.d(this,function(r){if(a=this.connection.getMetadata(e),!(o=a.findColumnWithPropertyPath(n)))throw new Error("Column "+n+" was not found in "+a.targetName+" entity.");if(isNaN(Number(i)))throw new Error('Value "'+i+'" is not a number.');return s=n.split(".").reduceRight(function(e,t){var n;return(n={})[t]=e,n},function(){return u.connection.driver.escape(o.databaseName)+" + "+i}),[2,this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()]})})},e.prototype.decrement=function(e,t,n,i){return r.b(this,void 0,void 0,function(){var a,o,s,u=this;return r.d(this,function(r){if(a=this.connection.getMetadata(e),!(o=a.findColumnWithPropertyPath(n)))throw new Error("Column "+n+" was not found in "+a.targetName+" entity.");if(isNaN(Number(i)))throw new Error('Value "'+i+'" is not a number.');return s=n.split(".").reduceRight(function(e,t){var n;return(n={})[t]=e,n},function(){return u.connection.driver.escape(o.databaseName)+" - "+i}),[2,this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()]})})},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new F(this.connection.name,e);var t=this.connection.getMetadata(e),n=this.repositories.find(function(e){return e.metadata===t});if(n)return n;var r=(new Q).create(this,t,this.queryRunner);return this.repositories.push(r),r},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new K(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof _))throw new V(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=Hn().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new k(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof B&&(r.manager||(r.manager=this)),r instanceof R){if(!n)throw new U(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){if(!this.queryRunner)throw new O;return[2,this.queryRunner.release()]})})},e}(),ye=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.driver=t.driver,r}return r.c(t,e),t.prototype.loadDatabase=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.driver.load(e)];case 1:return t.sent(),[2]}})})},t.prototype.saveDatabase=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.driver.save(e)];case 1:return t.sent(),[2]}})})},t.prototype.exportDatabase=function(){return this.driver.export()},t}(me),ve=n(49),ge=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof m.a?new m.b(e):e.driver instanceof ve.a?new ye(e,t):new me(e,t)},e}(),be=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingDriverError",Object.setPrototypeOf(r,t.prototype),r.message='Wrong driver: "'+n+'" given. Supported drivers are: "cordova", "expo", "mariadb", "mongodb", "mssql", "mysql", "oracle", "postgres", "sqlite", "sqljs", "react-native".',r}return r.c(t,e),t}(Error),Ee=n(36),Te=n(189),we=n(21),Ne=n(28),Ce=n(50),Se=n(32),Ae=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Se.a(n),n}return r.c(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new we.a;return new Promise(function(i,a){return r.b(n,void 0,void 0,function(){var n,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.executeSql(e,t,function(n){var r=s.driver.connection.options.maxQueryExecutionTime,a=+new Date-o;if(r&&a>r&&s.driver.connection.logger.logQuerySlow(a,e,t,s),"INSERT INTO"===e.substr(0,11))i(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));i(u)}},function(n){s.driver.connection.logger.logQueryError(n,e,t,s),a(new Ne.a(e,t,n))}),[2]}})})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'"'+e+'"=?'})},t}(Ce.a),Oe=n(38),Re=n(31),Me=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new Oe.a("database");if(!n.options.location)throw new Oe.a("location");return n.loadDependencies(),n}return r.c(t,e),t.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new Ae(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,function(e){var r=e;r.executeSql("PRAGMA foreign_keys = ON;",[],function(e){t(r)},function(e){n(e)})},function(e){n(e)})})},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new Re.a("Cordova-SQLite","cordova-sqlite-storage")}},t}(M.a),_e=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Se.a(n),n}return r.c(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new we.a;return new Promise(function(i,a){return r.b(n,void 0,void 0,function(){var n,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.executeSql(e,t,function(n){var r=s.driver.connection.options.maxQueryExecutionTime,a=+new Date-o;if(r&&a>r&&s.driver.connection.logger.logQuerySlow(a,e,t,s),"INSERT INTO"===e.substr(0,11))i(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));i(u)}},function(n){s.driver.connection.logger.logQueryError(n,e,t,s),a(new Ne.a(e,t,n))}),[2]}})})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'"'+e+'"=?'})},t}(Ce.a),Pe=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new Oe.a("database");if(!n.options.location)throw new Oe.a("location");return n.loadDependencies(),n}return r.c(t,e),t.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new _e(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,function(e){var r=e;r.executeSql("PRAGMA foreign_keys = ON;",[],function(e){t(r)},function(e){n(e)})},function(e){n(e)})})},t.prototype.loadDependencies=function(){try{this.sqlite=n(!function(){var e=new Error("Cannot find module 'react-native-sqlite-storage'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){throw new Re.a("React-Native","react-native-sqlite-storage")}},t}(M.a),xe=n(191),Ie=n(57),Le=n(37),je=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Se.a(n),n}return r.c(t,e),t.prototype.startTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){if(this.isTransactionActive&&void 0!==this.transaction)throw new Ie.a;return this.isTransactionActive=!0,[2]})})},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){if(!this.isTransactionActive&&void 0===this.transaction)throw new Le.a;return this.isTransactionActive=!1,this.transaction=void 0,[2]})})},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){if(!this.isTransactionActive&&void 0===this.transaction)throw new Le.a;return this.isTransactionActive=!1,this.transaction=void 0,[2]})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new we.a;return new Promise(function(i,a){return r.b(n,void 0,void 0,function(){var n,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.transaction(function(n){void 0===s.transaction&&(s.startTransaction(),s.transaction=n),s.transaction.executeSql(e,t,function(n,r){var a=s.driver.connection.options.maxQueryExecutionTime,u=+new Date-o;if(a&&u>a&&s.driver.connection.logger.logQuerySlow(u,e,t,s),"INSERT INTO"===e.substr(0,11))i(r.insertId);else{for(var c=[],l=0;l<r.rows.length;l++)c.push(r.rows.item(l));i(c)}},function(n,r){s.driver.connection.logger.logQueryError(r,e,t,s),a(new Ne.a(e,t,r))})},function(e){s.rollbackTransaction()},function(){s.isTransactionActive=!1,s.transaction=void 0}),[2]}})})})},t}(Ce.a),De=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new Oe.a("database");return n.loadDependencies(),n}return r.c(t,e),t.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){try{e.queryRunner=void 0,e.databaseConnection=void 0,t()}catch(e){n(e)}})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new je(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){try{var r=e.sqlite.openDatabase(e.options.database);r.transaction(function(e){e.executeSql("PRAGMA foreign_keys = ON;",[],function(e,n){t(r)},function(e,t){n({transaction:e,error:t})})},function(e){n(e)})}catch(e){n(e)}})},t.prototype.loadDependencies=function(){try{this.sqlite=window.Expo.SQLite}catch(e){throw new Re.a("Expo","expo")}},t}(M.a),ke=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case"mysql":return new m.e(e);case"postgres":return new m.g(e);case"cockroachdb":return new Ee.a(e);case"mariadb":return new m.e(e);case"sqlite":return new Te.a(e);case"cordova":return new Me(e);case"nativescript":return new xe.a(e);case"react-native":return new Pe(e);case"sqljs":return new ve.a(e);case"oracle":return new ee.a(e);case"mssql":return new h.a(e);case"mongodb":return new m.a(e);case"expo":return new De(e);default:throw new be(t)}},e}(),qe=n(1);function Be(e,t){return void 0===t&&(t=[".js",".ts"]),function e(t,n){return"function"==typeof t||t instanceof ct?n.push(t):Array.isArray(t)?t.forEach(function(t){return e(t,n)}):"object"==typeof t&&null!==t&&Object.keys(t).forEach(function(r){return e(t[r],n)}),n}(e.reduce(function(e,t){return e.concat(qe.a.load("glob").sync(qe.a.pathNormalize(t)))},[]).filter(function(e){var n=e.substring(e.length-5,e.length);return-1!==t.indexOf(qe.a.pathExtname(e))&&".d.ts"!==n}).map(function(e){return qe.a.load(qe.a.pathResolve(e))}),[])}var Ue,Fe,Ve=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find(function(t){return t.type===e});return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}());function Qe(e,t){Ue=e,Fe=t}function Ke(e){if(Ue)try{var t=Ue.get(e);if(t)return t;if(!Fe||!Fe.fallback)return t}catch(e){if(!Fe||!Fe.fallbackOnErrors)throw e}return Ve.get(e)}var We=n(33),He=function(){function e(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,null!==e.args.synchronize&&void 0!==e.args.synchronize&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this;if(!1===this.synchronize)return this.name=this.givenName,this;var n={};if(this.givenColumnNames){var r=[];if(this.givenColumnNames instanceof Array)(r=this.givenColumnNames.map(function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e})).forEach(function(e){return n[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);i instanceof Array?(r=i.map(function(e){return String(e)})).forEach(function(e){return n[e]=1}):(r=Object.keys(i).map(function(e){return String(e)}),Object.keys(i).forEach(function(e){return n[e]=i[e]}))}this.columns=r.map(function(e){var n=t.entityMetadata.columns.find(function(t){return t.propertyPath===e});if(n)return[n];var r=t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyName===e});if(r)return r.joinColumns;throw new Error("Index "+(t.givenName?'"'+t.givenName+'" ':"")+"contains column that is missing in the entity: "+e)}).reduce(function(e,t){return e.concat(t)})}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(e,r){var i=t.entityMetadata.columns.find(function(e){return e.propertyPath===r});return i&&(e[i.databasePath]=n[r]),e},{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tablePath,this.columns.map(function(e){return e.databaseName}),this.where),this},e}(),Ye=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||t.options.cascade instanceof Array&&-1!==t.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===t.options.cascade||t.options.cascade instanceof Array&&-1!==t.options.cascade.indexOf("update"),this.isCascadeRemove=!0===t.options.cascade||t.options.cascade instanceof Array&&-1!==t.options.cascade.indexOf("remove"),this.isPrimary=t.options.primary||!1,this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.onUpdate=t.options.onUpdate,this.isEager=t.options.eager||!1,this.persistenceEnabled=!1!==t.options.persistence,this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getRelationIdMap=function(e){var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(e){return e.referencedColumn});return z.a.getValueMap(e,t)},e.prototype.ensureRelationIdMap=function(e){if(e instanceof Object)return e;var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(e){return e.referencedColumn});if(t.length>1)throw new Error("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return t[0].createValueMap(e)},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){if(this.embeddedMetadata){var n=r.f(this.embeddedMetadata.parentPropertyNames),i=function(e,t){var n=e.shift();return n?t[n]?i(e,t[n]):void 0:t},a=i(n,e);return this.isLazy?void 0!==a["__"+this.propertyName+"__"]?a["__"+this.propertyName+"__"]:!0===t?a[this.propertyName]:void 0:a?a[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==e["__"+this.propertyName+"__"]?e["__"+this.propertyName+"__"]:!0===t?e[this.propertyName]:void 0:e[this.propertyName]}},e.prototype.setEntityValue=function(e,t){var n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){var i=function(e,r){var a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n]=t,r)};return i(r.f(this.embeddedMetadata.embeddedMetadataTree),e)}e[n]=t},e.prototype.createValueMap=function(e){var t,n=this;if(this.embeddedMetadata){var i=r.f(this.embeddedMetadata.parentPropertyNames),a=function(t,r){var i=t.shift();return i?(r[i]={},a(t,r[i]),r):(r[n.propertyName]=e,r)};return a(i,{})}return(t={})[this.propertyName]=e,t},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.foreignKeys).push.apply(e,r.f(t)),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),ze=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach(function(t){return t.build(e)}),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),this},e.prototype.buildPartialPrefix=function(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(""===this.customPrefix||!1===this.customPrefix)return[];if("string"==typeof this.customPrefix)return[this.customPrefix];throw new Error("Invalid prefix option given for "+this.entityMetadata.targetName+"#"+this.propertyName)},e.prototype.buildPrefix=function(e){if(e.driver instanceof m.a)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),t.push.apply(t,r.f(this.buildPartialPrefix())),t.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildColumnsFromTree())},this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationsFromTree())},this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildListenersFromTree())},this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildIndicesFromTree())},this.indices)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationIdsFromTree())},this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationCountsFromTree())},this.relationCounts)},e}(),Je=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,n=this.relation.getEntityValue(e);if(n instanceof Array)e[this.propertyName]=n.map(function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)}).filter(function(e){return null!=e});else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(e[this.propertyName]=r)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),Ge=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),Xe=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],n=function(e){var r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter(function(e){return e.target&&-1!==t.indexOf(e.target)}):e},e}(),Ze=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map(function(e){return e.databaseName}),this.referencedColumnNames=this.referencedColumns.map(function(e){return e.databaseName}),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=e.foreignKeyName(this.entityMetadata.tablePath,this.columnNames)},e}(),$e=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this,i=this.collectReferencedColumns(e,t),a=this.collectInverseReferencedColumns(e,t),o=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),s=new z.a({connection:this.connection,args:{target:"",name:o,type:"junction",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}});s.build();var u=i.map(function(r){var i=t.joinColumns?t.joinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new We.a({connection:n.connection,entityMetadata:s,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{name:a,length:r.length,width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,nullable:!1,primary:!0}}})}),c=a.map(function(r){var i=t.inverseJoinColumns?t.inverseJoinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new We.a({connection:n.connection,entityMetadata:s,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{length:r.length,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,name:a,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(u,c),s.ownerColumns=u,s.inverseColumns=c,s.ownColumns=r.f(u,c),s.ownColumns.forEach(function(t){return t.relationMetadata=e}),s.foreignKeys=[new Ze({entityMetadata:s,referencedEntityMetadata:e.entityMetadata,columns:u,referencedColumns:i,onDelete:e.onDelete||"CASCADE"}),new Ze({entityMetadata:s,referencedEntityMetadata:e.inverseEntityMetadata,columns:c,referencedColumns:a,onDelete:e.onDelete||"CASCADE"})],s.ownIndices=[new He({entityMetadata:s,columns:u,args:{target:s.target,synchronize:!0}}),new He({entityMetadata:s,columns:c,args:{target:s.target,synchronize:!0}})],s},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find(function(e){return!!e.referencedColumnName});return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter(function(e){return e.isPrimary}):t.joinColumns.map(function(t){var n=e.entityMetadata.columns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.entityMetadata.name);return n})},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find(function(e){return!!e.referencedColumnName});return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map(function(t){var n=e.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return n})},e.prototype.changeDuplicatedColumnNames=function(e,t){var n=this;e.forEach(function(e){t.forEach(function(t){if(e.givenDatabaseName===t.givenDatabaseName){var r=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=r,e.givenDatabaseName=r;var i=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}})})},e}(),et=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,n=new z.a({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.tableNameWithoutPrefix,type:"closure-junction"}});return n.build(),e.primaryColumns.forEach(function(e){n.ownColumns.push(new We.a({connection:t.connection,entityMetadata:n,closureType:"ancestor",referencedColumn:e,args:{target:"",mode:"virtual",propertyName:e.propertyName+"_ancestor",options:{primary:!0,length:e.length,type:e.type}}})),n.ownColumns.push(new We.a({connection:t.connection,entityMetadata:n,closureType:"descendant",referencedColumn:e,args:{target:"",mode:"virtual",propertyName:e.propertyName+"_descendant",options:{primary:!0,length:e.length,type:e.type}}}))}),n.ownIndices=[new He({entityMetadata:n,columns:[n.ownColumns[0]],args:{target:n.target,synchronize:!0}}),new He({entityMetadata:n,columns:[n.ownColumns[1]],args:{target:n.target,synchronize:!0}})],e.treeLevelColumn&&n.ownColumns.push(new We.a({connection:this.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),n.foreignKeys=[new Ze({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[0]],referencedColumns:e.primaryColumns}),new Ze({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[1]],referencedColumns:e.primaryColumns})],n},e}(),tt=function(){function e(e){this.columns=[],this.entityMetadata=e.entityMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,n={};if(this.givenColumnNames){var r=[];if(this.givenColumnNames instanceof Array)(r=this.givenColumnNames).forEach(function(e){return n[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);i instanceof Array?(r=i.map(function(e){return String(e)})).forEach(function(e){return n[e]=1}):(r=Object.keys(i).map(function(e){return String(e)}),Object.keys(i).forEach(function(e){return n[e]=i[e]}))}this.columns=r.map(function(e){var n=t.entityMetadata.columns.find(function(t){return t.propertyPath===e});if(n)return[n];var r=t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyName===e});if(r)return r.joinColumns;throw new Error("Unique constraint "+(t.givenName?'"'+t.givenName+'" ':"")+"contains column that is missing in the entity: "+e)}).reduce(function(e,t){return e.concat(t)})}return this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tablePath,this.columns.map(function(e){return e.databaseName})),this},e}(),nt=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(!n.length)return{foreignKey:void 0,uniqueConstraint:void 0};var r=this.collectColumns(e,t,n),i=new Ze({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:n,onDelete:t.onDelete,onUpdate:t.onUpdate});if(this.connection.driver instanceof ee.a&&r.every(function(e){return e.isPrimary}))return{foreignKey:i,uniqueConstraint:void 0};if(n.length>0&&t.isOneToOne){var a=new tt({entityMetadata:t.entityMetadata,columns:i.columns,args:{name:this.connection.namingStrategy.relationConstraintName(t.entityMetadata.tablePath,i.columns.map(function(e){return e.databaseName})),target:t.entityMetadata.target}});return a.build(this.connection.namingStrategy),{foreignKey:i,uniqueConstraint:a}}return{foreignKey:i,uniqueConstraint:void 0}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find(function(e){return!!e.referencedColumnName}),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map(function(e){var n=t.inverseEntityMetadata.ownColumns.find(function(t){return t.propertyName===e.referencedColumnName});if(!n)throw new Error("Referenced column "+e.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return n})},e.prototype.collectColumns=function(e,t,n){var r=this;return n.map(function(n){var i=e.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}),a=i?i.name:r.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName),o=t.entityMetadata.ownColumns.find(function(e){return e.databaseName===a});return o||(o=new We.a({connection:r.connection,entityMetadata:t.entityMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:a,type:n.type,length:n.length,width:n.width,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,zerofill:n.zerofill,unsigned:n.unsigned,comment:n.comment,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(o)),o.referencedColumn=n,o.type=n.type,o.relationMetadata=t,o.build(r.connection),o})},e}(),rt=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))},e.prototype.callEntityEmbeddedMethod=function(e,t){var n=t.shift();n&&e[n]&&(0===t.length?e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))},e}(),it=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),at=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),ot=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new $e(e),this.closureJunctionEntityMetadataBuilder=new et(e),this.relationJoinColumnBuilder=new nt(e)}return e.prototype.build=function(e){var t=this,n=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(function(e){return"regular"===e.type||"closure"===e.type||"entity-child"===e.type}).map(function(e){return t.createEntityMetadata(e)});return n.forEach(function(e){return t.computeParentEntityMetadata(n,e)}),n.forEach(function(e){e.childEntityMetadatas=n.filter(function(t){return e.target instanceof Function&&t.target instanceof Function&&Xe.isInherited(t.target,e.target)})}),n.filter(function(e){return"entity-child"!==e.tableType}).forEach(function(e){return e.build()}),n.filter(function(e){return"entity-child"===e.tableType}).forEach(function(e){return e.build()}),n.filter(function(e){return"entity-child"!==e.tableType}).forEach(function(e){return t.computeEntityMetadataStep1(n,e)}),n.filter(function(e){return"entity-child"===e.tableType}).forEach(function(e){return t.computeEntityMetadataStep1(n,e)}),n.forEach(function(e){return t.computeEntityMetadataStep2(e)}),n.forEach(function(e){return t.computeInverseProperties(e,n)}),n.filter(function(e){return"entity-child"!==e.tableType}).forEach(function(e){e.relations.filter(function(e){return e.isOneToOne||e.isManyToOne}).forEach(function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n),a=i.foreignKey,o=i.uniqueConstraint;if(a&&(n.registerForeignKeys(a),e.foreignKeys.push(a)),o)if(t.connection.driver instanceof m.e||t.connection.driver instanceof h.a){var s=new He({entityMetadata:o.entityMetadata,columns:o.columns,args:{target:o.target,name:o.name,unique:!0,synchronize:!0}});t.connection.driver instanceof h.a&&(s.where=s.columns.map(function(e){return t.connection.driver.escape(e.databaseName)+" IS NOT NULL"}).join(" AND ")),n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}else n.entityMetadata.uniques.push(o),t.computeEntityMetadataStep2(e);if(a&&t.connection.driver instanceof Ee.a){s=new He({entityMetadata:n.entityMetadata,columns:a.columns,args:{target:n.entityMetadata.target,synchronize:!0}});n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}}),e.relations.filter(function(e){return e.isManyToMany}).forEach(function(e){var i=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(i){var a=t.junctionEntityMetadataBuilder.build(e,i);e.registerForeignKeys.apply(e,r.f(a.foreignKeys)),e.registerJunctionEntityMetadata(a),t.computeEntityMetadataStep2(a),t.computeInverseProperties(a,n),n.push(a)}})}),n.forEach(function(e){e.relationsWithJoinColumns=e.relations.filter(function(e){return e.isWithJoinColumn}),e.hasNonNullableRelations=e.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})}),n.filter(function(e){return"closure-table"===e.treeType}).forEach(function(e){var r=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=r,t.computeEntityMetadataStep2(r),t.computeInverseProperties(r,n),n.push(r)}),n.filter(function(e){return"STI"===e.inheritancePattern&&e.discriminatorColumn}).forEach(function(e){return t.createKeysForTableInheritance(e)}),n.forEach(function(e){e.indices.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.uniques.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.checks.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.exclusions.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.filter(function(e){return e.target instanceof Function}).forEach(function(e){e.relations.filter(function(e){return e.isLazy}).forEach(function(n){t.connection.relationLoader.enableLazyLoad(n,e.target.prototype)})}),n.forEach(function(e){e.columns.forEach(function(n){var r=t.metadataArgsStorage.findGenerated(n.target,n.propertyName);r&&(n.isGenerated=!0,n.generationStrategy=r.strategy,"uuid"===r.strategy?n.type="uuid":"rowid"===r.strategy?n.type="int":n.type=n.type||Number,n.build(t.connection),t.computeEntityMetadataStep2(e))})}),n},e.prototype.createEntityMetadata=function(e){var t,n=e.target instanceof Function?Xe.getInheritanceTree(e.target):[e.target],i=this.metadataArgsStorage.findInheritanceType(e.target),a=this.metadataArgsStorage.findTree(e.target);return(i&&"STI"===i.pattern||"entity-child"===e.type)&&(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(function(e){return e.target}).filter(function(e){return e instanceof Function}),n.push.apply(n,r.f(t))),new z.a({connection:this.connection,args:e,inheritanceTree:n,tableTree:a,inheritancePattern:i?i.pattern:void 0})},e.prototype.computeParentEntityMetadata=function(e,t){"entity-child"===t.tableType&&(t.parentEntityMetadata=e.find(function(e){return-1!==e.inheritanceTree.indexOf(t.target)&&"STI"===e.inheritancePattern}))},e.prototype.computeEntityMetadataStep1=function(e,t){var n,i,a,o=this,s=this.metadataArgsStorage.findInheritanceType(t.target),u=this.metadataArgsStorage.findDiscriminatorValue(t.target);if(t.discriminatorValue=u?u.value:t.target.name,t.embeddeds=this.createEmbeddedsRecursively(t,this.metadataArgsStorage.filterEmbeddeds(t.inheritanceTree)).map(function(e){return"STI"===t.inheritancePattern&&(e.columns=e.columns.map(function(e){return e.isNullable=!0,e})),e}),t.ownColumns=this.metadataArgsStorage.filterColumns(t.inheritanceTree).map(function(n){if("entity-child"===t.tableType)return t.parentEntityMetadata.ownColumns.find(function(e){return e.propertyName===n.propertyName});var r=new We.a({connection:o.connection,entityMetadata:t,args:n});return e.find(function(e){return"entity-child"===e.tableType&&e.target===n.target})&&(r.isNullable=!0),r}),s&&s.column){var c=s.column&&s.column.name?s.column.name:"type",l=t.ownColumns.find(function(e){return e.propertyName===c});l?l.isDiscriminator=!0:((l=new We.a({connection:this.connection,entityMetadata:t,args:{target:t.target,mode:"virtual",propertyName:c,options:s.column||{name:c,type:"varchar",nullable:!1}}})).isVirtual=!0,l.isDiscriminator=!0,t.ownColumns.push(l))}if("entity-child"===t.tableType){var f=t.parentEntityMetadata.ownColumns.find(function(e){return e.isDiscriminator});f&&!t.ownColumns.find(function(e){return e===f})&&t.ownColumns.push(f)}if("materialized-path"===t.treeType?t.ownColumns.push(new We.a({connection:this.connection,entityMetadata:t,materializedPath:!0,args:{target:t.target,mode:"virtual",propertyName:"mpath",options:{name:"mpath",type:"varchar",nullable:!0,default:""}}})):"nested-set"===t.treeType&&(t.ownColumns.push(new We.a({connection:this.connection,entityMetadata:t,nestedSetLeft:!0,args:{target:t.target,mode:"virtual",propertyName:"nsleft",options:{name:"nsleft",type:"integer",nullable:!1,default:1}}})),t.ownColumns.push(new We.a({connection:this.connection,entityMetadata:t,nestedSetRight:!0,args:{target:t.target,mode:"virtual",propertyName:"nsright",options:{name:"nsright",type:"integer",nullable:!1,default:2}}}))),t.ownRelations=this.metadataArgsStorage.filterRelations(t.inheritanceTree).map(function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.ownRelations.find(function(t){return t.propertyName===e.propertyName}):new Ye({entityMetadata:t,args:e})}),t.relationIds=this.metadataArgsStorage.filterRelationIds(t.inheritanceTree).map(function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationIds.find(function(t){return t.propertyName===e.propertyName}):new Je({entityMetadata:t,args:e})}),t.relationCounts=this.metadataArgsStorage.filterRelationCounts(t.inheritanceTree).map(function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationCounts.find(function(t){return t.propertyName===e.propertyName}):new Ge({entityMetadata:t,args:e})}),t.ownListeners=this.metadataArgsStorage.filterListeners(t.inheritanceTree).map(function(e){return new rt({entityMetadata:t,args:e})}),t.checks=this.metadataArgsStorage.filterChecks(t.inheritanceTree).map(function(e){return new it({entityMetadata:t,args:e})}),this.connection.driver instanceof m.g&&(t.exclusions=this.metadataArgsStorage.filterExclusions(t.inheritanceTree).map(function(e){return new at({entityMetadata:t,args:e})})),this.connection.driver instanceof Ee.a){t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter(function(e){return!e.unique}).map(function(e){return new He({entityMetadata:t,args:e})});var p=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter(function(e){return e.unique}).map(function(e){return new tt({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns}})});(n=t.uniques).push.apply(n,r.f(p))}else t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).map(function(e){return new He({entityMetadata:t,args:e})});if(this.connection.driver instanceof m.e){var h=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map(function(e){return new He({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns,unique:!0,synchronize:!0}})});(i=t.ownIndices).push.apply(i,r.f(h))}else{p=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map(function(e){return new tt({entityMetadata:t,args:e})});(a=t.uniques).push.apply(a,r.f(p))}},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map(function(t){var r=new ze({entityMetadata:e,args:t}),i=Xe.getInheritanceTree(r.type);return r.columns=n.metadataArgsStorage.filterColumns(i).map(function(t){return new We.a({connection:n.connection,entityMetadata:e,embeddedMetadata:r,args:t})}),r.relations=n.metadataArgsStorage.filterRelations(i).map(function(t){return new Ye({entityMetadata:e,embeddedMetadata:r,args:t})}),r.listeners=n.metadataArgsStorage.filterListeners(i).map(function(t){return new rt({entityMetadata:e,embeddedMetadata:r,args:t})}),r.indices=n.metadataArgsStorage.filterIndices(i).map(function(t){return new He({entityMetadata:e,embeddedMetadata:r,args:t})}),r.relationIds=n.metadataArgsStorage.filterRelationIds(i).map(function(t){return new Je({entityMetadata:e,args:t})}),r.relationCounts=n.metadataArgsStorage.filterRelationCounts(i).map(function(t){return new Ge({entityMetadata:e,args:t})}),r.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(i)),r.embeddeds.forEach(function(e){return e.parentEmbeddedMetadata=r}),e.allEmbeddeds.push(r),r})},e.prototype.computeEntityMetadataStep2=function(e){var t=this;e.embeddeds.forEach(function(e){return e.build(t.connection)}),e.embeddeds.forEach(function(e){e.columnsFromTree.forEach(function(e){return e.build(t.connection)}),e.relationsFromTree.forEach(function(e){return e.build()})}),e.ownColumns.forEach(function(e){return e.build(t.connection)}),e.ownRelations.forEach(function(e){return e.build()}),e.relations=e.embeddeds.reduce(function(e,t){return e.concat(t.relationsFromTree)},e.ownRelations),e.eagerRelations=e.relations.filter(function(e){return e.isEager}),e.lazyRelations=e.relations.filter(function(e){return e.isLazy}),e.oneToOneRelations=e.relations.filter(function(e){return e.isOneToOne}),e.oneToManyRelations=e.relations.filter(function(e){return e.isOneToMany}),e.manyToOneRelations=e.relations.filter(function(e){return e.isManyToOne}),e.manyToManyRelations=e.relations.filter(function(e){return e.isManyToMany}),e.ownerOneToOneRelations=e.relations.filter(function(e){return e.isOneToOneOwner}),e.ownerManyToManyRelations=e.relations.filter(function(e){return e.isManyToManyOwner}),e.treeParentRelation=e.relations.find(function(e){return e.isTreeParent}),e.treeChildrenRelation=e.relations.find(function(e){return e.isTreeChildren}),e.columns=e.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},e.ownColumns),e.listeners=e.embeddeds.reduce(function(e,t){return e.concat(t.listenersFromTree)},e.ownListeners),e.afterLoadListeners=e.listeners.filter(function(e){return"after-load"===e.type}),e.afterInsertListeners=e.listeners.filter(function(e){return"after-insert"===e.type}),e.afterUpdateListeners=e.listeners.filter(function(e){return"after-update"===e.type}),e.afterRemoveListeners=e.listeners.filter(function(e){return"after-remove"===e.type}),e.beforeInsertListeners=e.listeners.filter(function(e){return"before-insert"===e.type}),e.beforeUpdateListeners=e.listeners.filter(function(e){return"before-update"===e.type}),e.beforeRemoveListeners=e.listeners.filter(function(e){return"before-remove"===e.type}),e.indices=e.embeddeds.reduce(function(e,t){return e.concat(t.indicesFromTree)},e.ownIndices),e.primaryColumns=e.columns.filter(function(e){return e.isPrimary}),e.nonVirtualColumns=e.columns.filter(function(e){return!e.isVirtual}),e.ancestorColumns=e.columns.filter(function(e){return"ancestor"===e.closureType}),e.descendantColumns=e.columns.filter(function(e){return"descendant"===e.closureType}),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter(function(e){return e.isGenerated||e.isObjectId}),e.hasUUIDGeneratedColumns=e.columns.filter(function(e){return e.isGenerated||"uuid"===e.generationStrategy}).length>0,e.createDateColumn=e.columns.find(function(e){return e.isCreateDate}),e.updateDateColumn=e.columns.find(function(e){return e.isUpdateDate}),e.versionColumn=e.columns.find(function(e){return e.isVersion}),e.discriminatorColumn=e.columns.find(function(e){return e.isDiscriminator}),e.treeLevelColumn=e.columns.find(function(e){return e.isTreeLevel}),e.nestedSetLeftColumn=e.columns.find(function(e){return e.isNestedSetLeft}),e.nestedSetRightColumn=e.columns.find(function(e){return e.isNestedSetRight}),e.materializedPathColumn=e.columns.find(function(e){return e.isMaterializedPath}),e.objectIdColumn=e.columns.find(function(e){return e.isObjectId}),e.foreignKeys.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(function(e){return e.build()}),e.relationCounts.forEach(function(e){return e.build()}),e.embeddeds.forEach(function(e){e.relationIdsFromTree.forEach(function(e){return e.build()}),e.relationCountsFromTree.forEach(function(e){return e.build()})})},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach(function(n){var r=t.find(function(e){return e.target===n.type||"string"==typeof n.type&&e.targetName===n.type});if(!r)throw new Error("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find(function(e){return e.propertyPath===n.inverseSidePropertyPath})})},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new He({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))},e}(),st=function(){function e(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(e,t){return this.generations.find(function(n){return(e instanceof Array?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t})},e.prototype.findTree=function(e){return this.trees.find(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(e){return this.indices.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterUniques=function(e){return this.uniques.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterChecks=function(e){return this.checks.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterExclusions=function(e){return this.exclusions.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(e,t){return this.joinTables.find(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e,t){return this.transactionEntityManagers.filter(function(n){return(e instanceof Array?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t})},e.prototype.filterTransactionRepository=function(e,t){return this.transactionRepositories.filter(function(n){return(e instanceof Array?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t})},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter(function(t){return t.target instanceof Function&&e instanceof Function&&Xe.isInherited(t.target,e)&&"entity-child"===t.type})},e.prototype.findInheritanceType=function(e){return this.inheritances.find(function(t){return t.target===e})},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find(function(t){return t.target===e})},e.prototype.filterByTarget=function(e,t){return e.filter(function(e){return t instanceof Array?-1!==t.indexOf(e.target):e.target===t})},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,t){var n=[];return e.forEach(function(e){(t instanceof Array?-1!==t.indexOf(e.target):e.target===t)&&(n.find(function(t){return t.propertyName===e.propertyName})||n.push(e))}),n},e.prototype.filterByTargetAndWithoutDuplicateEmbeddedProperties=function(e,t){var n=[];return e.forEach(function(e){(t instanceof Array?-1!==t.indexOf(e.target):e.target===t)&&(n.find(function(t){return t.prefix===e.prefix&&t.propertyName===e.propertyName})||n.push(e))}),n},e}(),ut=function(){function e(){}return e.prototype.transform=function(e){var t=new st;return e.forEach(function(e){var n=e.options,r={target:n.target||n.name,name:n.tableName,database:n.database,schema:n.schema,type:n.type||"regular",orderBy:n.orderBy,synchronize:n.synchronize};t.tables.push(r),Object.keys(n.columns).forEach(function(e){var r=n.columns[e],i="regular";r.createDate&&(i="createDate"),r.updateDate&&(i="updateDate"),r.version&&(i="version"),r.treeChildrenCount&&(i="treeChildrenCount"),r.treeLevel&&(i="treeLevel"),r.objectId&&(i="objectId");var a={target:n.target||n.name,mode:i,propertyName:e,options:{type:r.type,name:r.objectId?"_id":r.name,length:r.length,width:r.width,nullable:r.nullable,readonly:r.readonly,select:r.select,primary:r.primary,unique:r.unique,comment:r.comment,default:r.default,onUpdate:r.onUpdate,precision:r.precision,scale:r.scale,zerofill:r.zerofill,unsigned:r.unsigned,charset:r.charset,collation:r.collation,enum:r.enum,asExpression:r.asExpression,generatedType:r.generatedType,hstoreType:r.hstoreType,array:r.array,transformer:r.transformer}};if(t.columns.push(a),r.generated){var o={target:n.target||n.name,propertyName:e,strategy:"string"==typeof r.generated?r.generated:"increment"};t.generations.push(o)}}),n.relations&&Object.keys(n.relations).forEach(function(e){var r=n.relations[e],i={target:n.target||n.name,propertyName:e,relationType:r.type,isLazy:r.lazy||!1,type:r.target,inverseSideProperty:r.inverseSide,isTreeParent:r.treeParent,isTreeChildren:r.treeChildren,options:{eager:r.eager||!1,cascade:r.cascade,nullable:r.nullable,onDelete:r.onDelete,onUpdate:r.onUpdate,primary:r.primary,persistence:r.persistence}};if(t.relations.push(i),r.joinColumn)if("boolean"==typeof r.joinColumn){var a={target:n.target||n.name,propertyName:e};t.joinColumns.push(a)}else{a={target:n.target||n.name,propertyName:e,name:r.joinColumn.name,referencedColumnName:r.joinColumn.referencedColumnName};t.joinColumns.push(a)}if(r.joinTable)if("boolean"==typeof r.joinTable){var o={target:n.target||n.name,propertyName:e};t.joinTables.push(o)}else{o={target:n.target||n.name,propertyName:e,name:r.joinTable.name,database:r.joinTable.database,schema:r.joinTable.schema,joinColumns:r.joinTable.joinColumn?[r.joinTable.joinColumn]:r.joinTable.joinColumns,inverseJoinColumns:r.joinTable.inverseJoinColumn?[r.joinTable.inverseJoinColumn]:r.joinTable.inverseJoinColumns};t.joinTables.push(o)}}),n.indices&&n.indices.forEach(function(e){var r={target:n.target||n.name,name:e.name,unique:!0===e.unique,spatial:!0===e.spatial,fulltext:!0===e.fulltext,synchronize:!1!==e.synchronize,where:e.where,sparse:e.sparse,columns:e.columns};t.indices.push(r)}),n.uniques&&n.uniques.forEach(function(e){var r={target:n.target||n.name,name:e.name,columns:e.columns};t.uniques.push(r)}),n.checks&&n.checks.forEach(function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.checks.push(r)}),n.exclusions&&n.exclusions.forEach(function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.exclusions.push(r)})}),t},e}(),ct=function(){return function(e){this.options=e}}(),lt=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=r.e(J.a.splitClassesAndStrings(e),2),n=t[0],i=t[1];return r.f(n,Be(i)).map(function(e){return Ke(e)})},e.prototype.buildSubscribers=function(e){var t=r.e(J.a.splitClassesAndStrings(e||[]),2),n=t[0],i=t[1],a=r.f(n,Be(i));return Hn().filterSubscribers(a).map(function(e){return Ke(e.target)})},e.prototype.buildEntityMetadatas=function(e){var t=r.e(J.a.splitClassesAndStrings(e||[]),2),n=t[0],i=t[1],a=n.filter(function(e){return e instanceof ct==!1}),o=n.filter(function(e){return e instanceof ct}),s=r.f(a,Be(i));s.forEach(function(e){e instanceof ct&&(o.push(e),s.slice(s.indexOf(e),1))});var u=new ot(this.connection,Hn()).build(s),c=(new ut).transform(o),l=new ot(this.connection,c).build();return r.f(u,l)},e}(),ft=n(84),pt=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");console.log("query: "+r)}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query failed: "+i),console.log("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query is slow: "+i),console.log("execution time: "+e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&console.log(e)},e.prototype.logMigration=function(e,t){console.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&console.warn(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),ht=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");qe.a.logInfo("query:",qe.a.highlightSql(r))}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");qe.a.logError("query failed:",qe.a.highlightSql(i)),qe.a.logError("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");qe.a.logWarn("query is slow:",qe.a.highlightSql(i)),qe.a.logWarn("execution time:",e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&qe.a.log(e)},e.prototype.logMigration=function(e,t){qe.a.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&console.warn(qe.a.warn(t))}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),dt=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");this.write("[QUERY]: "+r)}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");this.write(["[FAILED QUERY]: "+i,"[QUERY ERROR]: "+e])}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");this.write("[SLOW QUERY: "+e+" ms]: "+i)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&this.write(e)},e.prototype.logMigration=function(e,t){this.write(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&this.write("[LOG]: "+t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&this.write("[INFO]: "+t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&this.write("[WARN]: "+t)}},e.prototype.write=function(e){e=e instanceof Array?e:[e];var t=qe.a.load("app-root-path").path;e=e.map(function(e){return"["+(new Date).toISOString()+"]"+e}),qe.a.appendFileSync(t+"/ormlogs.log",e.join("\r\n")+"\r\n")},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),mt=function(){function e(){this.debug=qe.a.load("debug"),this.debugQueryLog=this.debug("typeorm:query:log"),this.debugQueryError=this.debug("typeorm:query:error"),this.debugQuerySlow=this.debug("typeorm:query:slow"),this.debugSchemaBuild=this.debug("typeorm:schema"),this.debugMigration=this.debug("typeorm:migration"),this.debugLog=this.debug("typeorm:log"),this.debugInfo=this.debug("typeorm:info"),this.debugWarn=this.debug("typeorm:warn")}return e.prototype.logQuery=function(e,t,n){this.debugQueryLog.enabled&&(this.debugQueryLog(qe.a.highlightSql(e)+";"),t&&t.length&&this.debugQueryLog("parameters:",t))},e.prototype.logQueryError=function(e,t,n,r){this.debugQueryError.enabled&&(this.debugQueryError(qe.a.highlightSql(t)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",e))},e.prototype.logQuerySlow=function(e,t,n,r){this.debugQuerySlow.enabled&&(this.debugQuerySlow(qe.a.highlightSql(t)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",e))},e.prototype.logSchemaBuild=function(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)},e.prototype.logMigration=function(e,t){this.debugMigration.enabled&&this.debugMigration(e)},e.prototype.log=function(e,t,n){switch(e){case"log":this.debugLog.enabled&&this.debugLog(t);break;case"info":this.debugInfo.enabled&&this.debugInfo(t);break;case"warn":this.debugWarn.enabled&&this.debugWarn(t)}},e}(),yt=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case"simple-console":return new pt(t);case"file":return new dt(t);case"advanced-console":return new ht(t);case"debug":return new mt}return new ht(t)},e}(),vt=function(){function e(e,t){this.connection=e,this.clientType=t,this.redis=this.loadRedis()}return e.prototype.connect=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){if(e=this.connection.options.cache,"redis"===this.clientType)e&&e.options?this.client=this.redis.createClient(e.options):this.client=this.redis.createClient();else if("ioredis"===this.clientType)e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if("ioredis/cluster"===this.clientType)if(e&&e.options&&e.options instanceof Array)this.client=new this.redis.Cluster(e.options);else{if(!(e&&e.options&&e.options.startupNodes))throw new Error("options.startupNodes required for "+this.clientType+".");this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options)}return[2]})})},e.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){e.client.quit(function(r,i){if(r)return n(r);t(),e.client=void 0})})]})})},e.prototype.synchronize=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2]})})},e.prototype.getFromCache=function(e,t){var n=this;return new Promise(function(t,r){e.identifier?n.client.get(e.identifier,function(e,n){if(e)return r(e);t(JSON.parse(n))}):e.query?n.client.get(e.query,function(e,n){if(e)return r(e);t(JSON.parse(n))}):t(void 0)})},e.prototype.isExpired=function(e){return e.time+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return r.b(this,void 0,void 0,function(){var t=this;return r.d(this,function(n){return[2,new Promise(function(n,r){e.identifier?t.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,function(e,t){if(e)return r(e);n()}):e.query&&t.client.set(e.query,JSON.stringify(e),"PX",e.duration,function(e,t){if(e)return r(e);n()})})]})})},e.prototype.clear=function(e){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){e.client.flushdb(function(e,r){if(e)return n(e);t()})})]})})},e.prototype.remove=function(e,t){return r.b(this,void 0,void 0,function(){var t=this;return r.d(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(e){return t.deleteKey(e)}))];case 1:return n.sent(),[2]}})})},e.prototype.deleteKey=function(e){var t=this;return new Promise(function(n,r){t.client.del(e,function(e,t){if(e)return r(e);n()})})},e.prototype.loadRedis=function(){try{return qe.a.load(this.clientType)}catch(e){throw new Error("Cannot use cache because "+this.clientType+' is not installed. Please run "npm i '+this.clientType+' --save".')}},e}(),gt=function(){function e(e){this.connection=e;var t=this.connection.driver.options;this.queryResultCacheTable=this.connection.driver.buildTableName("query-result-cache",t.schema,t.database)}return e.prototype.connect=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2]})})},e.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2]})})},e.prototype.synchronize=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return e=this.getQueryRunner(e),t=this.connection.driver,[4,e.hasTable(this.queryResultCacheTable)];case 1:return n.sent()?[2]:[4,e.createTable(new o.a({name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"increment",isGenerated:!0},{name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1}]}))];case 2:return n.sent(),[2]}})})},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var n=this.connection.createQueryBuilder(t).select().from(this.queryResultCacheTable,"cache");return e.identifier?n.where(n.escape("cache")+"."+n.escape("identifier")+" = :identifier").setParameters({identifier:this.connection.driver instanceof h.a?new d.a(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?this.connection.driver instanceof ee.a?n.where("dbms_lob.compare("+n.escape("cache")+"."+n.escape("query")+", :query) = 0",{query:e.query}).getRawOne():n.where(n.escape("cache")+"."+n.escape("query")+" = :query").setParameters({query:this.connection.driver instanceof h.a?new d.a(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){var t="string"==typeof e.duration?parseInt(e.duration):e.duration;return("string"==typeof e.time?parseInt(e.time):e.time)+t<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a;return r.d(this,function(r){switch(r.label){case 0:return n=this.getQueryRunner(n),i=e,this.connection.driver instanceof h.a&&(i={identifier:new d.a(e.identifier,"nvarchar"),time:new d.a(e.time,"bigint"),duration:new d.a(e.duration,"int"),query:new d.a(e.query,"nvarchar"),result:new d.a(e.result,"nvarchar")}),t&&t.identifier?((a=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i)).where(a.escape("identifier")+" = :condition",{condition:i.identifier}),[4,a.execute()]):[3,2];case 1:return r.sent(),[3,6];case 2:return t&&t.query?(a=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i),this.connection.driver instanceof ee.a?a.where('dbms_lob.compare("query", :condition) = 0',{condition:i.query}):a.where(a.escape("query")+" = :condition",{condition:i.query}),[4,a.execute()]):[3,4];case 3:return r.sent(),[3,6];case 4:return[4,n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(i).execute()];case 5:r.sent(),r.label=6;case 6:return[2]}})})},e.prototype.clear=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){return[2,this.getQueryRunner(e).clearTable(this.queryResultCacheTable)]})})},e.prototype.remove=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(e){var r=n.getQueryRunner(t).manager.createQueryBuilder();return r.delete().from(n.queryResultCacheTable).where(r.escape("identifier")+" = :identifier",{identifier:e}).execute()}))];case 1:return r.sent(),[2]}})})},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner("master")},e}(),bt=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw new Error("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");return"redis"===this.connection.options.cache.type?new vt(this.connection,"redis"):"ioredis"===this.connection.options.cache.type?new vt(this.connection,"ioredis"):"ioredis/cluster"===this.connection.options.cache.type?new vt(this.connection,"ioredis/cluster"):new gt(this.connection)},e}(),Et=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n){return n&&n.isReleased&&(n=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t,n):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t,n):e.isManyToManyOwner?this.loadManyToManyOwner(e,t,n):this.loadManyToManyNotOwner(e,t,n)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t,n){var r=t instanceof Array?t:[t],i=e.entityMetadata.primaryColumns,a=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map(function(t){return e.entityMetadata.name+"."+t.propertyName+" = "+e.propertyName+"."+t.referencedColumn.propertyName}).join(" AND "),o=e.entityMetadata.name,s=this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,o,a);if(1===i.length)s.where(o+"."+i[0].propertyPath+" IN (:..."+o+"_"+i[0].propertyName+")"),s.setParameter(o+"_"+i[0].propertyName,r.map(function(e){return i[0].getEntityValue(e)}));else{var u=r.map(function(e,t){return i.map(function(n,r){var i=o+"_entity_"+t+"_"+r;return s.setParameter(i,n.getEntityValue(e)),o+"."+n.propertyPath+" = :"+i}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ");s.where(u)}return s.getMany()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t,n){var r=t instanceof Array?t:[t],i=e.propertyName,a=e.inverseRelation.joinColumns,o=this.connection.createQueryBuilder(n).select(i).from(e.inverseRelation.entityMetadata.target,i);if(1===a.length)o.where(i+"."+a[0].propertyPath+" IN (:..."+i+"_"+a[0].propertyName+")"),o.setParameter(i+"_"+a[0].propertyName,r.map(function(e){return a[0].referencedColumn.getEntityValue(e)}));else{var s=r.map(function(e,t){return a.map(function(n,r){var a=i+"_entity_"+t+"_"+r;return o.setParameter(a,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+a}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ");o.where(s)}return o.getMany()},e.prototype.loadManyToManyOwner=function(e,t,n){var i=t instanceof Array?t:[t],a=e.propertyName,o=e.junctionEntityMetadata.tableName,s=e.joinColumns.map(function(e){return o+"."+e.propertyName+" IN (:..."+e.propertyName+")"}),u=e.inverseJoinColumns.map(function(e){return o+"."+e.propertyName+"="+a+"."+e.referencedColumn.propertyName}),c=e.joinColumns.reduce(function(e,t){return e[t.propertyName]=i.map(function(e){return t.referencedColumn.getEntityValue(e)}),e},{});return this.connection.createQueryBuilder(n).select(a).from(e.type,a).innerJoin(o,o,r.f(s,u).join(" AND ")).setParameters(c).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t,n){var i=t instanceof Array?t:[t],a=e.propertyName,o=e.junctionEntityMetadata.tableName,s=e.inverseRelation.joinColumns.map(function(e){return o+"."+e.propertyName+" = "+a+"."+e.referencedColumn.propertyName}),u=e.inverseRelation.inverseJoinColumns.map(function(e){return o+"."+e.propertyName+" IN (:..."+e.propertyName+")"}),c=e.inverseRelation.inverseJoinColumns.reduce(function(e,t){return e[t.propertyName]=i.map(function(e){return t.referencedColumn.getEntityValue(e)}),e},{});return this.connection.createQueryBuilder(n).select(a).from(e.type,a).innerJoin(o,o,r.f(s,u).join(" AND ")).setParameters(c).getMany()},e.prototype.enableLazyLoad=function(e,t,n){var r=this,i="__"+e.propertyName+"__",a="__promise_"+e.propertyName+"__",o="__has_"+e.propertyName+"__";Object.defineProperty(t,e.propertyName,{get:function(){var t=this;return!0===this[o]||this[i]?Promise.resolve(this[i]):this[a]?this[a]:(this[a]=r.load(e,this,n).then(function(n){return(e.isOneToOne||e.isManyToOne)&&(n=n[0]),t[i]=n,t[o]=!0,delete t[a],t[i]}),this[a])},set:function(e){var t=this;e instanceof Promise?e.then(function(e){t[i]=e,t[o]=!0}):(this[i]=e,this[o]=!0)},configurable:!0})},e}(),Tt=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n,i){return r.b(this,void 0,void 0,function(){var a,o,s,u;return r.d(this,function(r){if(e instanceof Ye)a=e,o=t instanceof Array?t:[t],s=n instanceof Array?n:n?[n]:void 0;else{if(u=this.connection.getMetadata(e),!(a=u.findRelationWithPropertyPath(t)))throw new Error('Relation "'+a+'" was not found in "'+u.name+'".');o=n instanceof Array?n:[n],s=i instanceof Array?i:i?[i]:void 0}return a.isManyToMany?[2,this.loadForManyToMany(a,o,s)]:a.isManyToOne||a.isOneToOneOwner?[2,this.loadForManyToOneAndOneToOneOwner(a,o,s)]:[2,this.loadForOneToManyAndOneToOneNotOwner(a,o,s)]})})},e.prototype.loadManyToManyRelationIdsAndGroup=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,o,s,u,c;return r.d(this,function(r){switch(r.label){case 0:return i=e.isManyToMany||e.isOneToMany,a=t instanceof Array?t:[t],n?[3,2]:[4,this.connection.relationLoader.load(e,t)];case 1:if(!(n=r.sent()).length)return[2,a.map(function(e){return{entity:e,related:i?[]:void 0}})];r.label=2;case 2:return[4,this.load(e,t,n)];case 3:return o=r.sent(),s=n instanceof Array?n:[n],e.isManyToManyOwner?(u=e.junctionEntityMetadata.inverseColumns.map(function(e){return e.referencedColumn}),c=e.junctionEntityMetadata.ownerColumns.map(function(e){return e.referencedColumn})):e.isManyToManyNotOwner?(u=e.junctionEntityMetadata.ownerColumns.map(function(e){return e.referencedColumn}),c=e.junctionEntityMetadata.inverseColumns.map(function(e){return e.referencedColumn})):e.isManyToOne||e.isOneToOneOwner?(u=e.joinColumns.map(function(e){return e.referencedColumn}),c=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(u=e.inverseRelation.entityMetadata.primaryColumns,c=e.inverseRelation.joinColumns.map(function(e){return e.referencedColumn})),[2,a.map(function(t){var n={entity:t,related:i?[]:void 0};return o.forEach(function(r){c.every(function(e){return e.getEntityValue(t)===r[e.entityMetadata.name+"_"+e.propertyPath.replace(".","_")]})&&s.forEach(function(t){u.every(function(n){return n.getEntityValue(t)===r[n.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+n.propertyPath.replace(".","_")]})&&(i?n.related.push(t):n.related=t)})}),n})]}})})},e.prototype.loadForManyToMany=function(e,t,n){var r=e.junctionEntityMetadata,i=r.name,a=e.isOwning?r.ownerColumns:r.inverseColumns,o=e.isOwning?r.inverseColumns:r.ownerColumns,s=this.connection.createQueryBuilder();r.ownerColumns.forEach(function(e){var t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");s.addSelect(i+"."+e.propertyPath,t)}),r.inverseColumns.forEach(function(t){var n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");s.addSelect(i+"."+t.propertyPath,n)});var u="";1===a.length?(s.setParameter("values1",t.map(function(e){return a[0].referencedColumn.getEntityValue(e)})),u=i+"."+a[0].propertyPath+" IN (:...values1)"):u="("+t.map(function(e,t){return a.map(function(n){var r="entity1_"+t+"_"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ")+")";var c="";return n&&(1===o.length?(s.setParameter("values2",n.map(function(e){return o[0].referencedColumn.getEntityValue(e)})),c=i+"."+o[0].propertyPath+" IN (:...values2)"):c="("+n.map(function(e,t){return o.map(function(n){var r="entity2_"+t+"_"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ")+")"),s.from(r.target,i).where(u+(c?" AND "+c:"")).getRawMany()},e.prototype.loadForManyToOneAndOneToOneOwner=function(e,t,n){var r=e.entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach(function(e){var t=e.entityMetadata.name+"_"+e.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)}),e.joinColumns.forEach(function(t){var n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)});var a="";return 1===e.entityMetadata.primaryColumns.length?(i.setParameter("values",t.map(function(t){return e.entityMetadata.primaryColumns[0].getEntityValue(t)})),a=r+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)"):a=t.map(function(t,n){return e.entityMetadata.primaryColumns.map(function(e,a){var o="entity"+n+"_"+a;return i.setParameter(o,e.getEntityValue(t)),r+"."+e.propertyPath+" = :"+o}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "),i.from(e.entityMetadata.target,r).where(a).getRawMany()},e.prototype.loadForOneToManyAndOneToOneNotOwner=function(e,t,n){var r=(e=e.inverseRelation).entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach(function(t){var n=t.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+t.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)}),e.joinColumns.forEach(function(e){var t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)});var a="";return 1===e.joinColumns.length?(i.setParameter("values",t.map(function(t){return e.joinColumns[0].referencedColumn.getEntityValue(t)})),a=r+"."+e.joinColumns[0].propertyPath+" IN (:...values)"):a=t.map(function(t,n){return e.joinColumns.map(function(e,a){var o="entity"+n+"_"+a;return i.setParameter(o,e.referencedColumn.getEntityValue(t)),r+"."+e.propertyPath+" = :"+o}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "),i.from(e.entityMetadata.target,r).where(a).getRawMany()},e}(),wt=function(){function e(e){this.isConnected=!1,this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new yt).create(this.options.logger,this.options.logging),this.driver=(new ke).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new s,this.queryResultCache=e.cache?new bt(this).create():void 0,this.relationLoader=new Et(this),this.relationIdLoader=new Tt(this)}return Object.defineProperty(e.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof m.b))throw new Error("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sqljsManager",{get:function(){if(!(this.manager instanceof ye))throw new Error("SqljsEntityManager is only available for Sqljs databases.");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:if(this.isConnected)throw new c(this.name);return[4,this.driver.connect()];case 1:return t.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:t.sent(),t.label=3;case 3:de.a.assign(this,{isConnected:!0}),t.label=4;case 4:return t.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return t.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:t.sent(),t.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:t.sent(),t.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations()]:[3,11];case 10:t.sent(),t.label=11;case 11:return[3,14];case 12:return e=t.sent(),[4,this.close()];case 13:throw t.sent(),e;case 14:return[2,this]}})})},e.prototype.close=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new u(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:e.sent(),e.label=3;case 3:return de.a.assign(this,{isConnected:!1}),[2]}})})},e.prototype.synchronize=function(e){return void 0===e&&(e=!1),r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new u(this.name);return e?[4,this.dropDatabase()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this.driver.createSchemaBuilder().build()];case 3:return t.sent(),[2]}})})},e.prototype.dropDatabase=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.d(this,function(n){switch(n.label){case 0:return[4,this.createQueryRunner("master")];case 1:e=n.sent(),n.label=2;case 2:return n.trys.push([2,,7,9]),this.driver instanceof h.a||this.driver instanceof m.e?(t=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach(function(e){e.database&&-1===t.indexOf(e.database)&&t.push(e.database)}),[4,p.a.runInSequence(t,function(t){return e.clearDatabase(t)})]):[3,4];case 3:return n.sent(),[3,6];case 4:return[4,e.clearDatabase()];case 5:n.sent(),n.label=6;case 6:return[3,9];case 7:return[4,e.release()];case 8:return n.sent(),[7];case 9:return[2]}})})},e.prototype.runMigrations=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new u(this.name);return t=new y(this),e&&!1===e.transaction&&(t.transaction=!1),[4,t.executePendingMigrations()];case 1:return[2,n.sent()]}})})},e.prototype.undoLastMigration=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new u(this.name);return t=new y(this),e&&!1===e.transaction&&(t.transaction=!1),[4,t.undoLastMigration()];case 1:return n.sent(),[2]}})})},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new l(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof m.a))throw new Error("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(n){return[2,this.manager.transaction(e,t)]})})},e.prototype.query=function(e,t,n){return r.b(this,void 0,void 0,function(){var i;return r.d(this,function(r){switch(r.label){case 0:if(this instanceof m.b)throw new Error("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new S;i=n||this.createQueryRunner("master"),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,i.query(e,t)];case 2:return[2,r.sent()];case 3:return n?[3,5]:[4,i.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof m.b)throw new Error("Query Builder is not supported by MongoDB.");if(t){var r=this.getMetadata(e);return new ft.SelectQueryBuilder(this,n).select(t).from(r.target,t)}return new ft.SelectQueryBuilder(this,e)},e.prototype.createQueryRunner=function(e){void 0===e&&(e="master");var t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t},e.prototype.getManyToManyMetadata=function(e,t){var n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new Error('Relation "'+t+'" was not found in '+e+" entity.");if(!n.isManyToMany)throw new Error('Relation "'+e+"#"+t+'" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return(new ge).create(this,e)},e.prototype.findMetadata=function(e){return this.entityMetadatas.find(function(t){return t.target===e||(e instanceof ct?t.name===e.options.name:"string"==typeof e&&(-1!==e.indexOf(".")?t.tablePath===e:t.name===e||t.tableName===e))})},e.prototype.buildMetadatas=function(){var e=new lt(this),t=new C,n=e.buildSubscribers(this.options.subscribers||[]);de.a.assign(this,{subscribers:n});var r=e.buildEntityMetadatas(this.options.entities||[]);de.a.assign(this,{entityMetadatas:r});var i=e.buildMigrations(this.options.migrations||[]);de.a.assign(this,{migrations:i}),t.validateMany(this.entityMetadatas,this.driver)},e}(),Nt=function(e){function t(n){var r=e.call(this)||this;return r.name="ConnectionNotFoundError",Object.setPrototypeOf(r,t.prototype),r.message='Connection "'+n+'" was not found.',r}return r.c(t,e),t}(Error),Ct=function(e){function t(n){var r=e.call(this)||this;return r.name="AlreadyHasActiveConnectionError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a new connection named "'+n+'", because connection with such name already exist and it now has an active connection session.',r}return r.c(t,e),t}(Error),St=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find(function(t){return t.name===e})},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connections.find(function(t){return t.name===e});if(!t)throw new Nt(e);return t},e.prototype.create=function(e){var t=this.connections.find(function(t){return t.name===(e.name||"default")});if(t){if(t.isConnected)throw new Ct(e.name||"default");this.connections.splice(this.connections.indexOf(t),1)}var n=new wt(e);return this.connections.push(n),n},e}(),At=function(){function e(){}return e.prototype.read=function(){return{type:qe.a.getEnvVariable("TYPEORM_CONNECTION")||(qe.a.getEnvVariable("TYPEORM_URL")?qe.a.getEnvVariable("TYPEORM_URL").split("://")[0]:void 0),url:qe.a.getEnvVariable("TYPEORM_URL"),host:qe.a.getEnvVariable("TYPEORM_HOST"),port:qe.a.getEnvVariable("TYPEORM_PORT"),username:qe.a.getEnvVariable("TYPEORM_USERNAME"),password:qe.a.getEnvVariable("TYPEORM_PASSWORD"),database:qe.a.getEnvVariable("TYPEORM_DATABASE"),sid:qe.a.getEnvVariable("TYPEORM_SID"),schema:qe.a.getEnvVariable("TYPEORM_SCHEMA"),extra:qe.a.getEnvVariable("TYPEORM_DRIVER_EXTRA")?JSON.parse(qe.a.getEnvVariable("TYPEORM_DRIVER_EXTRA")):void 0,synchronize:J.a.toBoolean(qe.a.getEnvVariable("TYPEORM_SYNCHRONIZE")),dropSchema:J.a.toBoolean(qe.a.getEnvVariable("TYPEORM_DROP_SCHEMA")),migrationsRun:J.a.toBoolean(qe.a.getEnvVariable("TYPEORM_MIGRATIONS_RUN")),entities:this.stringToArray(qe.a.getEnvVariable("TYPEORM_ENTITIES")),migrations:this.stringToArray(qe.a.getEnvVariable("TYPEORM_MIGRATIONS")),migrationsTableName:qe.a.getEnvVariable("TYPEORM_MIGRATIONS_TABLE_NAME"),subscribers:this.stringToArray(qe.a.getEnvVariable("TYPEORM_SUBSCRIBERS")),logging:this.transformLogging(qe.a.getEnvVariable("TYPEORM_LOGGING")),logger:qe.a.getEnvVariable("TYPEORM_LOGGER"),entityPrefix:qe.a.getEnvVariable("TYPEORM_ENTITY_PREFIX"),maxQueryExecutionTime:qe.a.getEnvVariable("TYPEORM_MAX_QUERY_EXECUTION_TIME"),debug:qe.a.getEnvVariable("TYPEORM_DEBUG"),cli:{entitiesDir:qe.a.getEnvVariable("TYPEORM_ENTITIES_DIR"),migrationsDir:qe.a.getEnvVariable("TYPEORM_MIGRATIONS_DIR"),subscribersDir:qe.a.getEnvVariable("TYPEORM_SUBSCRIBERS_DIR")},cache:this.transformCaching(),uuidExtension:qe.a.getEnvVariable("TYPEORM_UUID_EXTENSION")}},e.prototype.transformLogging=function(e){return"true"===e||"TRUE"===e||"1"===e||("all"===e?"all":this.stringToArray(e))},e.prototype.transformCaching=function(){var e=qe.a.getEnvVariable("TYPEORM_CACHE");return"true"===e||"TRUE"===e||"1"===e||"false"!==e&&"FALSE"!==e&&"0"!==e&&("redis"===e||"database"===e?{type:e,options:qe.a.getEnvVariable("TYPEORM_CACHE_OPTIONS")?JSON.parse(qe.a.getEnvVariable("TYPEORM_CACHE_OPTIONS")):void 0,alwaysEnabled:qe.a.getEnvVariable("TYPEORM_CACHE_ALWAYS_ENABLED"),duration:parseInt(qe.a.getEnvVariable("TYPEORM_CACHE_DURATION"))}:void 0)},e.prototype.stringToArray=function(e){return e?e.split(",").map(function(e){return e.trim()}):[]},e}(),Ot=function(){function e(){}return e.prototype.read=function(e){var t=qe.a.load("js-yaml").safeLoad(qe.a.readFileSync(e));return Object.keys(t).map(function(e){return Object.assign({name:e},t[e])})},e}(),Rt=function(){function e(){}return e.prototype.read=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.readXml(e)];case 1:return[2,t.sent().connection.map(function(e){return{name:e.$.name,type:e.$.type,url:e.url?e.url[0]:void 0,host:e.host?e.host[0]:void 0,port:e.port&&e.port[0]?parseInt(e.port[0]):void 0,username:e.username?e.username[0]:void 0,password:e.password?e.password[0]:void 0,database:e.database?e.database[0]:void 0,sid:e.sid?e.sid[0]:void 0,extra:e.extra?e.extra[0]:void 0,synchronize:e.synchronize?e.synchronize[0]:void 0,entities:e.entities?e.entities[0].entity:[],subscribers:e.subscribers?e.subscribers[0].entity:[],logging:e.logging[0]?e.logging[0].split(","):void 0}})]}})})},e.prototype.readXml=function(e){var t=qe.a.load("xml2js").parseString,n={trim:!0,explicitRoot:!1};return new Promise(function(r,i){t(qe.a.readFileSync(e),n,function(e,t){return e?i(e):r(t)})})},e}(),Mt=function(){function e(e){this.options=e}return e.prototype.all=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return[4,this.load()];case 1:if(!(e=t.sent()))throw new Error("No connection options were found in any of configurations file.");return[2,e]}})})},e.prototype.get=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.d(this,function(r){switch(r.label){case 0:return[4,this.all()];case 1:if(t=r.sent(),!(n=t.find(function(t){return t.name===e||"default"===e&&!t.name})))throw new Error("Cannot find connection "+e+" because its not defined in any orm configuration files.");return[2,n]}})})},e.prototype.has=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return[4,this.load()];case 1:return(t=n.sent())?[2,!!t.find(function(t){return t.name===e||"default"===e&&!t.name})]:[2,!1]}})})},e.prototype.load=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i,a,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return e=void 0,t=["env","js","ts","json","yml","yaml","xml"],n=this.baseFilePath.substr(this.baseFilePath.lastIndexOf(".")),i=t.find(function(e){return"."+e===n}),"env"===(a=i||t.find(function(e){return qe.a.fileExist(s.baseFilePath+"."+e)}))?qe.a.load("dotenv").config({path:this.baseFilePath}):qe.a.fileExist(".env")&&qe.a.load("dotenv").config({path:".env"}),o=i?this.baseFilePath:this.baseFilePath+"."+a,qe.a.getEnvVariable("TYPEORM_CONNECTION")||qe.a.getEnvVariable("TYPEORM_URL")?(e=(new At).read(),[3,8]):[3,1];case 1:return"js"!==a?[3,2]:(e=qe.a.load(o),[3,8]);case 2:return"ts"!==a?[3,3]:(e=qe.a.load(o),[3,8]);case 3:return"json"!==a?[3,4]:(e=qe.a.load(o),[3,8]);case 4:return"yml"!==a?[3,5]:(e=(new Ot).read(o),[3,8]);case 5:return"yaml"!==a?[3,6]:(e=(new Ot).read(o),[3,8]);case 6:return"xml"!==a?[3,8]:[4,(new Rt).read(o)];case 7:e=r.sent(),r.label=8;case 8:return e?[2,this.normalizeConnectionOptions(e)]:[2,void 0]}})})},e.prototype.normalizeConnectionOptions=function(e){var t=this;return e instanceof Array||(e=[e]),e.forEach(function(n){if(n.entities){var r=n.entities.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?t.baseDirectory+"/"+e:e});Object.assign(e,{entities:r})}if(n.subscribers){var i=n.subscribers.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?t.baseDirectory+"/"+e:e});Object.assign(e,{subscribers:i})}if(n.migrations){var a=n.migrations.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?t.baseDirectory+"/"+e:e});Object.assign(e,{migrations:a})}"sqlite"===n.type&&"string"==typeof n.database&&"/"!==n.database.substr(0,1)&&":\\"!==n.database.substr(1,2)&&":memory:"!==n.database&&Object.assign(n,{database:t.baseDirectory+"/"+n.database})}),e},Object.defineProperty(e.prototype,"baseFilePath",{get:function(){return this.baseDirectory+"/"+this.baseConfigName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseDirectory",{get:function(){return this.options&&this.options.root?this.options.root:qe.a.load("app-root-path").path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseConfigName",{get:function(){return this.options&&this.options.configName?this.options.configName:"ormconfig"},enumerable:!0,configurable:!0}),e}(),_t=function(e){function t(n,r){var i=e.call(this)||this;return i.name="ColumnTypeUndefinedError",Object.setPrototypeOf(i,t.prototype),i.message="Column type for "+n.constructor.name+"#"+r+' is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.',i}return r.c(t,e),t}(Error);function Pt(e,t){return function(n,r){var i;"string"==typeof e||e instanceof Function?i=e:e&&(t=e,i=e.type),t||(t={});var a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,r):void 0;if(!i&&a&&(i=a),!t.type&&i&&(t.type=i),"hstore"!==t.type||t.hstoreType||(t.hstoreType=a===Object?"object":"string"),e instanceof Function)Hn().embeddeds.push({target:n.constructor,propertyName:r,isArray:a===Array||!0===t.array,prefix:void 0!==t.prefix?t.prefix:void 0,type:e});else{if(!t.type)throw new _t(n,r);!0===t.unique&&Hn().uniques.push({target:n.constructor,columns:[r]}),Hn().columns.push({target:n.constructor,propertyName:r,mode:"regular",options:t}),t.generated&&Hn().generations.push({target:n.constructor,propertyName:r,strategy:"string"==typeof t.generated?t.generated:"increment"})}}}function xt(e){return function(t,n){Hn().columns.push({target:t.constructor,propertyName:n,mode:"createDate",options:e||{}})}}function It(e,t){var n,r={};return e?("string"==typeof e&&(n=e),e instanceof Object&&(n="increment",Object.assign(r,e))):n="increment",t instanceof Object&&Object.assign(r,t),function(e,t){r.type||("increment"===n?r.type=Number:"uuid"===n?r.type="uuid":"rowid"===n&&(r.type="int")),r.primary=!0,Hn().columns.push({target:e.constructor,propertyName:t,mode:"regular",options:r}),Hn().generations.push({target:e.constructor,propertyName:t,strategy:n})}}var Lt=function(e){function t(n,r){var i=e.call(this)||this;return i.name="PrimaryColumnCannotBeNullableError",Object.setPrototypeOf(i,t.prototype),i.message="Primary column "+n.constructor.name+"#"+r+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",i}return r.c(t,e),t}(Error);function jt(e,t){return function(n,r){var i;"string"==typeof e?i=e:t=e,t||(t={});var a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,r):void 0;if(!i&&a&&(i=a),!t.type&&i&&(t.type=i),!t.type)throw new _t(n,r);if(t.nullable)throw new Lt(n,r);t.primary=!0,Hn().columns.push({target:n.constructor,propertyName:r,mode:"regular",options:t}),t.generated&&Hn().generations.push({target:n.constructor,propertyName:r,strategy:"string"==typeof t.generated?t.generated:"increment"})}}function Dt(e){return function(t,n){Hn().columns.push({target:t.constructor,propertyName:n,mode:"updateDate",options:e||{}})}}function kt(e){return function(t,n){Hn().columns.push({target:t.constructor,propertyName:n,mode:"version",options:e||{}})}}function qt(e){return function(t,n){e||(e={}),e.primary=!0,e.name||(e.name="_id"),Hn().columns.push({target:t.constructor,propertyName:n,mode:"objectId",options:e})}}var Bt=function(){function e(){}return e.AFTER_LOAD="after-load",e.BEFORE_INSERT="before-insert",e.AFTER_INSERT="after-insert",e.BEFORE_UPDATE="before-update",e.AFTER_UPDATE="after-update",e.BEFORE_REMOVE="before-remove",e.AFTER_REMOVE="after-remove",e}();function Ut(){return function(e,t){Hn().entityListeners.push({target:e.constructor,propertyName:t,type:Bt.AFTER_INSERT})}}function Ft(){return function(e,t){Hn().entityListeners.push({target:e.constructor,propertyName:t,type:Bt.AFTER_LOAD})}}function Vt(){return function(e,t){Hn().entityListeners.push({target:e.constructor,propertyName:t,type:Bt.AFTER_REMOVE})}}function Qt(){return function(e,t){Hn().entityListeners.push({target:e.constructor,propertyName:t,type:Bt.AFTER_UPDATE})}}function Kt(){return function(e,t){Hn().entityListeners.push({target:e.constructor,propertyName:t,type:Bt.BEFORE_INSERT})}}function Wt(){return function(e,t){Hn().entityListeners.push({target:e.constructor,propertyName:t,type:Bt.BEFORE_REMOVE})}}function Ht(){return function(e,t){Hn().entityListeners.push({target:e.constructor,propertyName:t,type:Bt.BEFORE_UPDATE})}}function Yt(){return function(e){Hn().entitySubscribers.push({target:e})}}function zt(e){return function(t,n){(e instanceof Array?e:[e||{}]).forEach(function(e){Hn().joinColumns.push({target:t.constructor,propertyName:n,name:e.name,referencedColumnName:e.referencedColumnName})})}}function Jt(e){return function(t,n){e=e||{},Hn().joinTables.push({target:t.constructor,propertyName:n,name:e.name,joinColumns:e&&e.joinColumn?[e.joinColumn]:e.joinColumns,inverseJoinColumns:e&&e.inverseJoinColumn?[e.inverseJoinColumn]:e.inverseJoinColumns,schema:e&&e.schema?e.schema:void 0,database:e&&e.database?e.database:void 0})}}function Gt(e,t,n){var r;return"object"==typeof t?n=t:r=t,function(t,i){n||(n={});var a=!0===n.lazy;if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}Hn().relations.push({target:t.constructor,propertyName:i,relationType:"many-to-many",isLazy:a,type:e,inverseSideProperty:r,options:n})}}function Xt(e,t,n){var r;return"object"==typeof t?n=t:r=t,function(t,i){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}Hn().relations.push({target:t.constructor,propertyName:i,relationType:"many-to-one",isLazy:a,type:e,inverseSideProperty:r,options:n})}}function Zt(e,t,n){return function(r,i){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",r,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}Hn().relations.push({target:r.constructor,propertyName:i,isLazy:a,relationType:"one-to-many",type:e,inverseSideProperty:t,options:n})}}function $t(e,t,n){var r;return"object"==typeof t?n=t:r=t,function(t,i){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}Hn().relations.push({target:t.constructor,propertyName:i,isLazy:a,relationType:"one-to-one",type:e,inverseSideProperty:r,options:n})}}function en(e,t,n){return function(r,i){Hn().relationCounts.push({target:r.constructor,propertyName:i,relation:e,alias:t,queryBuilderFactory:n})}}function tn(e,t,n){return function(r,i){Hn().relationIds.push({target:r.constructor,propertyName:i,relation:e,alias:t,queryBuilderFactory:n})}}function nn(e,t){var n=("object"==typeof e?e:t)||{},r="string"==typeof e?e:n.name;return function(e){Hn().tables.push({target:e,name:r,type:"regular",orderBy:n.orderBy?n.orderBy:void 0,engine:n.engine?n.engine:void 0,database:n.database?n.database:void 0,schema:n.schema?n.schema:void 0,synchronize:n.synchronize})}}function rn(e){return function(t){Hn().tables.push({target:t,type:"entity-child"}),e&&Hn().discriminatorValues.push({target:t,value:e})}}function an(e){return function(t){Hn().inheritances.push({target:t,pattern:e&&e.pattern?e.pattern:"STI",column:e&&e.column?"string"==typeof e.column?{name:e.column}:e.column:void 0})}}function on(e){return function(t,n,i){var a=i.value;i.value=function(){for(var i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u="default",c=void 0;e&&("string"==typeof e?u=e:(e.connectionName&&(u=e.connectionName),e.isolation&&(c=e.isolation)));var l=function(e){var s,u=Hn().filterTransactionEntityManagers(t.constructor,n).reverse(),c=Hn().filterTransactionRepository(t.constructor,n).reverse();return u.length>0?(s=r.f(o),u.forEach(function(t){s.splice(t.index,0,e)})):s=0===c.length?r.f([e],o):r.f(o),c.forEach(function(t){var n;switch(t.repositoryType){case R:n=e.getRepository(t.entityType);break;case m.d:n=e.getMongoRepository(t.entityType);break;case _:n=e.getTreeRepository(t.entityType);break;default:n=e.getCustomRepository(t.repositoryType)}s.splice(t.index,0,n)}),a.apply(i,s)};return c?Xn(u).manager.transaction(c,l):Xn(u).manager.transaction(l)}}}function sn(){return function(e,t,n){Hn().transactionEntityManagers.push({target:e.constructor,methodName:t,index:n})}}var un=function(e){function t(n,r){var i=e.call(this)||this;return i.name="CannotReflectMethodParameterTypeError",Object.setPrototypeOf(i,t.prototype),i.message='Cannot get reflected type for a "'+r+'" method\'s parameter of "'+n.name+'" class. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.',i}return r.c(t,e),t}(Error);function cn(e){return function(t,n,r){var i;try{i=Reflect.getOwnMetadata("design:paramtypes",t,n)[r]}catch(e){throw new un(t.constructor,n)}Hn().transactionRepositories.push({target:t.constructor,methodName:n,index:r,repositoryType:i,entityType:e})}}function ln(){return function(e,t){Hn().columns.push({target:e.constructor,propertyName:t,mode:"treeLevel",options:{}})}}function fn(){return function(e,t){var n=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,t):void 0,r=n&&"string"==typeof n.name&&"promise"===n.name.toLowerCase()||!1;Hn().relations.push({isTreeParent:!0,target:e.constructor,propertyName:t,isLazy:r,relationType:"many-to-one",type:function(){return e.constructor},options:{}})}}function pn(e){return function(t,n){e||(e={});var r=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",t,n):void 0,i=r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()||!1;Hn().relations.push({isTreeChildren:!0,target:t.constructor,propertyName:n,isLazy:i,relationType:"one-to-many",type:function(){return t.constructor},options:e})}}function hn(e){return function(t){Hn().trees.push({target:t,type:e})}}function dn(e,t,n){var r="string"==typeof e?e:void 0,i="string"==typeof e?t:e,a="object"!=typeof e||Array.isArray(e)?n:e;return a||(a="object"!=typeof t||Array.isArray(t)?n:t),function(e,t){Hn().indices.push({target:t?e.constructor:e,name:r,columns:t?[t]:i,synchronize:!a||!1!==a.synchronize,where:a?a.where:void 0,unique:!(!a||!a.unique),spatial:!(!a||!a.spatial),fulltext:!(!a||!a.fulltext),sparse:!(!a||!a.sparse),background:!(!a||!a.background),expireAfterSeconds:a&&a.expireAfterSeconds?a.expireAfterSeconds:void 0})}}function mn(e,t){var n="string"==typeof e?e:void 0,r="string"==typeof e?t:e;return function(e,t){var i={target:t?e.constructor:e,name:n,columns:t?[t]:r};Hn().uniques.push(i)}}function yn(e,t){var n=t?e:void 0,r=t||e;if(!r)throw new Error("Check expression is required");return function(e,t){Hn().checks.push({target:t?e.constructor:e,name:n,expression:r})}}function vn(e,t){var n=t?e:void 0,r=t||e;if(!r)throw new Error("Exclusion expression is required");return function(e,t){Hn().exclusions.push({target:t?e.constructor:e,name:n,expression:r})}}function gn(e){return void 0===e&&(e="increment"),function(t,n){Hn().generations.push({target:t.constructor,propertyName:n,strategy:e})}}function bn(e){return function(t){Hn().entityRepositories.push({target:t,entity:e})}}var En=n(10);function Tn(e){return new En.a("any",e)}function wn(e,t){return new En.a("between",[e,t],!0,!0)}function Nn(e){return new En.a("equal",e)}var Cn=n(109);function Sn(){return new En.a("isNull",void 0,!1)}function An(e){return new En.a("lessThan",e)}function On(e){return new En.a("lessThanOrEqual",e)}function Rn(e){return new En.a("like",e)}function Mn(e){return new En.a("moreThan",e)}function _n(e){return new En.a("moreThanOrEqual",e)}function Pn(e){return new En.a("not",e)}function xn(e){return new En.a("raw",e,!1)}var In=function(){function e(){}return e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(){return this.constructor.getRepository().save(this)},e.prototype.remove=function(){return this.constructor.getRepository().remove(this)},e.prototype.reload=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.d(this,function(n){switch(n.label){case 0:return[4,(e=this.constructor).getRepository().findOneOrFail(e.getId(this))];case 1:return t=n.sent(),de.a.assign(this,t),[2]}})})},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||Xn()).getRepository(this)},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(e){return this.getRepository().create(e)},e.merge=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this.getRepository()).merge.apply(t,r.f([e],n))},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.insert=function(e,t){return this.getRepository().insert(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.delete=function(e,t){return this.getRepository().delete(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e,t){return this.getRepository().findOne(e,t)},e.findOneOrFail=function(e,t){return this.getRepository().findOneOrFail(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()},e}(),Ln=n(11),jn=n(26),Dn=n(24),kn=n(48),qn=n(142),Bn=n(145),Un=n(143),Fn=n(144),Vn=n(108),Qn=n(110),Kn=n(111),Wn=n(112);
/*!
 */
function Hn(){var e=qe.a.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new st),e.typeormMetadataArgsStorage}function Yn(e){return void 0===e&&(e="default"),r.b(this,void 0,void 0,function(){return r.d(this,function(t){return[2,(new Mt).get(e)]})})}function zn(){return Ke(St)}function Jn(e){return r.b(this,void 0,void 0,function(){var t,n,i;return r.d(this,function(r){switch(r.label){case 0:return t="string"==typeof e?e:"default",e instanceof Object?(i=e,[3,3]):[3,1];case 1:return[4,Yn(t)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,zn().create(n).connect()]}})})}function Gn(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return e?[3,2]:[4,(new Mt).all()];case 1:e=n.sent(),n.label=2;case 2:return t=e.map(function(e){return zn().create(e)}),[2,p.a.runInSequence(t,function(e){return e.connect()})]}})})}function Xn(e){return void 0===e&&(e="default"),zn().get(e)}function Zn(e){return void 0===e&&(e="default"),zn().get(e).manager}function $n(e){return void 0===e&&(e="default"),zn().get(e).manager}function er(e){return void 0===e&&(e="default"),zn().get(e).manager}function tr(e,t){return void 0===t&&(t="default"),zn().get(t).getRepository(e)}function nr(e,t){return void 0===t&&(t="default"),zn().get(t).getTreeRepository(e)}function rr(e,t){return void 0===t&&(t="default"),zn().get(t).getCustomRepository(e)}function ir(e,t){return void 0===t&&(t="default"),zn().get(t).getMongoRepository(e)}function ar(e,t,n){return void 0===n&&(n="default"),e?tr(e,n).createQueryBuilder(t):Xn(n).createQueryBuilder()}n.d(t,"getMetadataArgsStorage",function(){return Hn}),n.d(t,"getConnectionOptions",function(){return Yn}),n.d(t,"getConnectionManager",function(){return zn}),n.d(t,"createConnection",function(){return Jn}),n.d(t,"createConnections",function(){return Gn}),n.d(t,"getConnection",function(){return Xn}),n.d(t,"getManager",function(){return Zn}),n.d(t,"getMongoManager",function(){return $n}),n.d(t,"getSqljsManager",function(){return er}),n.d(t,"getRepository",function(){return tr}),n.d(t,"getTreeRepository",function(){return nr}),n.d(t,"getCustomRepository",function(){return rr}),n.d(t,"getMongoRepository",function(){return ir}),n.d(t,"createQueryBuilder",function(){return ar}),n.d(t,"useContainer",function(){return Qe}),n.d(t,"getFromContainer",function(){return Ke}),n.d(t,"QueryFailedError",function(){return Ne.a}),n.d(t,"Column",function(){return Pt}),n.d(t,"CreateDateColumn",function(){return xt}),n.d(t,"PrimaryGeneratedColumn",function(){return It}),n.d(t,"PrimaryColumn",function(){return jt}),n.d(t,"UpdateDateColumn",function(){return Dt}),n.d(t,"VersionColumn",function(){return kt}),n.d(t,"ObjectIdColumn",function(){return qt}),n.d(t,"AfterInsert",function(){return Ut}),n.d(t,"AfterLoad",function(){return Ft}),n.d(t,"AfterRemove",function(){return Vt}),n.d(t,"AfterUpdate",function(){return Qt}),n.d(t,"BeforeInsert",function(){return Kt}),n.d(t,"BeforeRemove",function(){return Wt}),n.d(t,"BeforeUpdate",function(){return Ht}),n.d(t,"EventSubscriber",function(){return Yt}),n.d(t,"JoinColumn",function(){return zt}),n.d(t,"JoinTable",function(){return Jt}),n.d(t,"ManyToMany",function(){return Gt}),n.d(t,"ManyToOne",function(){return Xt}),n.d(t,"OneToMany",function(){return Zt}),n.d(t,"OneToOne",function(){return $t}),n.d(t,"RelationCount",function(){return en}),n.d(t,"RelationId",function(){return tn}),n.d(t,"Entity",function(){return nn}),n.d(t,"ChildEntity",function(){return rn}),n.d(t,"TableInheritance",function(){return an}),n.d(t,"Transaction",function(){return on}),n.d(t,"TransactionManager",function(){return sn}),n.d(t,"TransactionRepository",function(){return cn}),n.d(t,"TreeLevelColumn",function(){return ln}),n.d(t,"TreeParent",function(){return fn}),n.d(t,"TreeChildren",function(){return pn}),n.d(t,"Tree",function(){return hn}),n.d(t,"Index",function(){return dn}),n.d(t,"Unique",function(){return mn}),n.d(t,"Check",function(){return yn}),n.d(t,"Exclusion",function(){return vn}),n.d(t,"Generated",function(){return gn}),n.d(t,"EntityRepository",function(){return bn}),n.d(t,"Any",function(){return Tn}),n.d(t,"Between",function(){return wn}),n.d(t,"Equal",function(){return Nn}),n.d(t,"In",function(){return Cn.a}),n.d(t,"IsNull",function(){return Sn}),n.d(t,"LessThan",function(){return An}),n.d(t,"LessThanOrEqual",function(){return On}),n.d(t,"Like",function(){return Rn}),n.d(t,"MoreThan",function(){return Mn}),n.d(t,"MoreThanOrEqual",function(){return _n}),n.d(t,"Not",function(){return Pn}),n.d(t,"Raw",function(){return xn}),n.d(t,"FindOperator",function(){return En.a}),n.d(t,"AdvancedConsoleLogger",function(){return ht}),n.d(t,"SimpleConsoleLogger",function(){return pt}),n.d(t,"FileLogger",function(){return dt}),n.d(t,"EntityMetadata",function(){return z.a}),n.d(t,"AbstractRepository",function(){return B}),n.d(t,"MongoDriver",function(){return m.a}),n.d(t,"MongoQueryRunner",function(){return m.c}),n.d(t,"PostgresDriver",function(){return m.g}),n.d(t,"SqlServerDriver",function(){return m.h}),n.d(t,"MysqlDriver",function(){return m.e}),n.d(t,"OracleDriver",function(){return m.f}),n.d(t,"TableColumn",function(){return Ln.a}),n.d(t,"TableForeignKey",function(){return jn.a}),n.d(t,"TableIndex",function(){return Dn.a}),n.d(t,"Table",function(){return o.a}),n.d(t,"MssqlParameter",function(){return d.a}),n.d(t,"ConnectionOptionsReader",function(){return Mt}),n.d(t,"Connection",function(){return wt}),n.d(t,"ConnectionManager",function(){return St}),n.d(t,"QueryBuilder",function(){return kn.a}),n.d(t,"SelectQueryBuilder",function(){return ft.SelectQueryBuilder}),n.d(t,"DeleteQueryBuilder",function(){return qn.DeleteQueryBuilder}),n.d(t,"InsertQueryBuilder",function(){return Bn.InsertQueryBuilder}),n.d(t,"UpdateQueryBuilder",function(){return Un.UpdateQueryBuilder}),n.d(t,"RelationQueryBuilder",function(){return Fn.RelationQueryBuilder}),n.d(t,"Brackets",function(){return Vn.a}),n.d(t,"InsertResult",function(){return Qn.a}),n.d(t,"UpdateResult",function(){return Kn.a}),n.d(t,"DeleteResult",function(){return Wn.a}),n.d(t,"EntityManager",function(){return me}),n.d(t,"MongoEntityManager",function(){return m.b}),n.d(t,"DefaultNamingStrategy",function(){return s}),n.d(t,"Repository",function(){return R}),n.d(t,"TreeRepository",function(){return _}),n.d(t,"MongoRepository",function(){return m.d}),n.d(t,"BaseEntity",function(){return In}),n.d(t,"EntitySchema",function(){return ct}),n.d(t,"PromiseUtils",function(){return p.a})},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(17);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),i=n(6),a=n(66),o=n(5),s=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=[],this.withScaleColumnTypes=[],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.connection=e,this.options=e.options}return e.prototype.connect=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?n(e):t()})})]})})},e.prototype.createSchemaBuilder=function(){return new a.a(this.connection)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean||"boolean"===t.type?!0===e?1:0:"date"===t.type?i.a.mixedDateToDateString(e):"time"===t.type?i.a.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?i.a.mixedDateToUtcDatetimeString(e):"simple-array"===t.type?i.a.simpleArrayToString(e):"simple-json"===t.type?i.a.simpleJsonToString(e):"simple-enum"===t.type?i.a.simpleEnumToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?t.transformer.from(e):e:(t.type===Boolean||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?(e&&"string"==typeof e&&(e=e.replace(" ","T")+"Z"),e=i.a.normalizeHydratedDate(e)):"date"===t.type?e=i.a.mixedDateToDateString(e):"time"===t.type?e=i.a.mixedTimeToString(e):"simple-array"===t.type?e=i.a.stringToSimpleArray(e):"simple-json"===t.type?e=i.a.stringToSimpleJson(e):"simple-enum"===t.type&&(e=i.a.stringToSimpleEnum(e,t)),t.transformer&&(e=t.transformer.from(e)),e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return"boolean"==typeof n[e]?!0===n[e]?1:0:n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(i,"g"),function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map(function(e){return r.push(e),"?"}).join(", "):n instanceof Function?n():(r.push(n),"?")}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t,n){return e},e.prototype.normalizeType=function(e){return e.type===Number||"int"===e.type?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":"simple-array"===e.type?"text":"simple-json"===e.type?"text":"simple-enum"===e.type?"varchar":e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"1":"0":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createGeneratedMap=function(e,t){var n=e.generatedColumns.reduce(function(e,n){var r;return"increment"===n.generationStrategy&&t&&(r=t),r?o.a.mergeDeep(e,n.createValueMap(r)):e},{});return Object.keys(n).length>0?n:void 0},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)})},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.createParameter=function(e,t){return"?"},e.prototype.createDatabaseConnection=function(){throw new Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.loadDependencies=function(){},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(43),a=function(){function e(){}return e.buildDriverOptions=function(e,t){if(e.url){var n=this.parseConnectionUrl(e.url),r={type:n.type,host:n.host,username:n.username,password:n.password,port:n.port,database:n.database};return t&&t.useSid&&(r.sid=n.database),Object.assign({},e,r)}return Object.assign({},e)},e.buildColumnAlias=function(e,t,n){var r=e.maxAliasLength,a=t+"_"+n;return r&&r>0&&a.length>r?t.length>n.length?Object(i.b)(t)+"_"+n:t+"_"+Object(i.b)(n):a},e.parseConnectionUrl=function(e){var t=e.split(":")[0],n=e.indexOf("//"),i=e.substr(n+2),a=i.indexOf("/"),o=-1!==a?i.substr(0,a):i,s=-1!==a?i.substr(a+1):void 0,u=o.lastIndexOf("@"),c=o.substr(0,u),l=o.substr(u+1),f=c,p="",h=c.indexOf(":");-1!==h&&(f=c.substr(0,h),p=c.substr(h+1));var d=r.e(l.split(":"),2),m=d[0],y=d[1];return{type:t,host:m,username:decodeURIComponent(f),password:decodeURIComponent(p),port:y?parseInt(y):void 0,database:s||void 0}},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=e,this.type=t,this.params=[],this.params=n||[]}}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="QueryRunnerAlreadyReleasedError",Object.setPrototypeOf(n,t.prototype),n.message="Query runner already released. Cannot run queries anymore.",n}return r.c(t,e),t}(Error)},function(e,t,n){var r=n(95)("wks"),i=n(69),a=n(14).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){"use strict";var r=n(0),i=n(5),a=n(3),o=n(8),s=function(e){function t(n,r){var i=e.call(this)||this;i.name="CannotCreateEntityIdMapError",Object.setPrototypeOf(i,t.prototype);var a=n.primaryColumns.reduce(function(e,t,n){return t.setEntityValue(e,n+1),e},{});return i.message='Cannot use given entity id "'+r+'" because "'+n.targetName+'" contains multiple primary columns, you must provide object in following form: '+JSON.stringify(a)+" as an id.",i}return r.c(t,e),t}(Error),u=n(43);n.d(t,"a",function(){return c});var c=function(){function e(e){this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.afterRemoveListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type}return e.prototype.create=function(e){var t,n=this;if(this.target instanceof Function)return t=new this.target,this.lazyRelations.forEach(function(r){return n.connection.relationLoader.enableLazyLoad(r,t,e)}),t;var r={};return this.lazyRelations.forEach(function(t){return n.connection.relationLoader.enableLazyLoad(t,r,e)}),r},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!=n&&""!==n})},e.prototype.hasAllPrimaryKeys=function(e){return this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!=n})},e.prototype.ensureEntityIdMap=function(e){if(e instanceof Object)return e;if(this.hasMultiplePrimaryKeys)throw new s(this,e);return this.primaryColumns[0].createValueMap(e)},e.prototype.getEntityIdMap=function(t){if(t)return e.getValueMap(t,this.primaryColumns,{skipNulls:!0})},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?this.primaryColumns[0].getEntityValue(t):t},e.prototype.compareEntities=function(t,n){var r=this.getEntityIdMap(t);if(!r)return!1;var i=this.getEntityIdMap(n);return!!i&&e.compareIds(r,i)},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find(function(t){return t.propertyName===e})},e.prototype.findColumnWithDatabaseName=function(e){return this.columns.find(function(t){return t.databaseName===e})},e.prototype.findColumnWithPropertyPath=function(e){var t=this.columns.find(function(t){return t.propertyPath===e});if(t)return t;var n=this.relations.find(function(t){return t.propertyPath===e});return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0},e.prototype.findColumnsWithPropertyPath=function(e){var t=this.columns.find(function(t){return t.propertyPath===e});if(t)return[t];var n=this.relations.find(function(t){return t.propertyPath===e});return n&&n.joinColumns?n.joinColumns:[]},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find(function(t){return t.propertyPath===e})},e.prototype.hasEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.some(function(t){return t.propertyPath===e})},e.prototype.findEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.find(function(t){return t.propertyPath===e})},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=[];return t.forEach(function(t){var r=t.getEntityValue(e);r instanceof Array?r.forEach(function(e){return n.push([t,e,t.inverseEntityMetadata])}):r&&n.push([t,r,t.inverseEntityMetadata])}),n},e.createPropertyPath=function(e,t,n){var i=this;void 0===n&&(n="");var a=[];return Object.keys(t).forEach(function(o){var s=n?n+"."+o:o;if(e.hasEmbeddedWithPropertyPath(s)){var u=i.createPropertyPath(e,t[o],s);a.push.apply(a,r.f(u))}else{var c=n?n+"."+o:o;a.push(c)}}),a},e.difference=function(e,t){return e.filter(function(e){return!t.find(function(t){return i.a.deepCompare(e,t)})})},e.compareIds=function(e,t){return null!=e&&null!=t&&i.a.deepCompare(e,t)},e.getValueMap=function(e,t,n){return t.reduce(function(t,r){var a=r.getEntityValueMap(e,n);if(void 0!==t&&null!=a)return r.isObjectId?Object.assign(t,a):i.a.mergeDeep(t,a)},{})},e.prototype.build=function(){var e=this.connection.namingStrategy,t=this.connection.options.entityPrefix;this.engine=this.tableMetadataArgs.engine,this.database="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.schema=this.tableMetadataArgs.schema||this.connection.options.schema,this.givenTableName="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName=this.tableMetadataArgs.target instanceof Function?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,"closure-junction"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=e.closureJunctionTableName(this.givenTableName):"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=e.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=e.tableName(this.targetName,this.givenTableName),this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=Object(u.b)(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=t?e.prefixTableName(t,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.tablePath=this.buildTablePath(),this.schemaPath=this.buildSchemaPath(),this.orderBy=this.tableMetadataArgs.orderBy instanceof Function?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,this.isJunction="closure-junction"===this.tableMetadataArgs.type||"junction"===this.tableMetadataArgs.type,this.isClosureJunction="closure-junction"===this.tableMetadataArgs.type},e.prototype.registerColumn=function(e){-1===this.ownColumns.indexOf(e)&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},this.ownColumns),this.primaryColumns=this.columns.filter(function(e){return e.isPrimary}),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter(function(e){return e.isGenerated||"uuid"===e.generationStrategy}).length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach(function(t){return t.registerColumn(e)}))},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach(function(t){return i.a.mergeDeep(e,t.createValueMap(t.propertyPath))}),this.relations.forEach(function(t){return i.a.mergeDeep(e,t.createValueMap(t.propertyPath))}),e},e.prototype.buildTablePath=function(){var e=this.tableName;return this.schema&&(e=this.schema+"."+e),!this.database||this.connection.driver instanceof a.g||(e=!this.schema&&this.connection.driver instanceof o.a?this.database+".."+e:this.database+"."+e),e},e.prototype.buildSchemaPath=function(){if(this.schema)return!this.database||this.connection.driver instanceof a.g?this.schema:this.database+"."+this.schema},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isFulltext=!!e.isFulltext,this.where=e.where?e.where:""}return e.prototype.clone=function(){return new e({name:this.name,columnNames:r.f(this.columnNames),isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,where:this.where})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map(function(e){return e.databaseName}),isUnique:t.isUnique,isSpatial:t.isSpatial,isFulltext:t.isFulltext,where:t.where})},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(){}return e.assign=function(e){for(var t,n,i,a,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];try{for(var u=r.g(o),c=u.next();!c.done;c=u.next()){var l=c.value;try{for(var f=r.g(Object.getOwnPropertyNames(l)),p=f.next();!p.done;p=f.next()){var h=p.value;e[h]=l[h]}}catch(e){i={error:e}}finally{try{p&&!p.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(e){this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate}return e.prototype.clone=function(){return new e({name:this.name,columnNames:r.f(this.columnNames),referencedColumnNames:r.f(this.referencedColumnNames),referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate})},e.create=function(t){return new e({name:t.name,columnNames:t.columnNames,referencedColumnNames:t.referencedColumnNames,referencedTableName:t.referencedTablePath,onDelete:t.onDelete,onUpdate:t.onUpdate})},e}()},function(e,t,n){var r=n(53),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(25),a=function(e){function t(n,a,o){var s=e.call(this)||this;return Object.setPrototypeOf(s,t.prototype),s.message=o.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,""),i.a.assign(s,r.a({},o,{name:"QueryFailedError",query:n,parameters:a||[]})),s}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,columnNames:this.columnNames?r.f(this.columnNames):[],expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},function(e,t,n){var r=n(16),i=n(147),a=n(63),o=Object.defineProperty;t.f=n(34)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(n,r){var i=e.call(this)||this;return i.name="DriverPackageNotInstalledError",Object.setPrototypeOf(i,t.prototype),i.message=n+" package has not been found installed. Try to install it: npm install "+r+" --save",i}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(e){this.queryRunner=e}return e.prototype.broadcastBeforeInsertEvent=function(e,t,n){var r=this;n&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.beforeInsert){var a=i.beforeInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastBeforeUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(s){if(o.isAllowedSubscriber(s,t.target)&&s.beforeUpdate){var u=s.beforeUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}})},e.prototype.broadcastBeforeRemoveEvent=function(e,t,n,r){var i=this;n&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(a){if(i.isAllowedSubscriber(a,t.target)&&a.beforeRemove){var o=a.beforeRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}})},e.prototype.broadcastAfterInsertEvent=function(e,t,n){var r=this;n&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterInsert){var a=i.afterInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastAfterUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(s){if(o.isAllowedSubscriber(s,t.target)&&s.afterUpdate){var u=s.afterUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}})},e.prototype.broadcastAfterRemoveEvent=function(e,t,n,r){var i=this;n&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(a){if(i.isAllowedSubscriber(a,t.target)&&a.afterRemove){var o=a.afterRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}})},e.prototype.broadcastLoadEventsForAll=function(e,t,n){var r=this;n.forEach(function(n){n instanceof Promise||(t.relations.length&&t.relations.forEach(function(t){if(!t.isLazy||n.hasOwnProperty(t.propertyName)){var i=t.getEntityValue(n);i instanceof Object&&r.broadcastLoadEventsForAll(e,t.inverseEntityMetadata,i instanceof Array?i:[i])}}),t.afterLoadListeners.length&&t.afterLoadListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),r.queryRunner.connection.subscribers.length&&r.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterLoad){var a=i.afterLoad(n);a instanceof Promise&&e.promises.push(a),e.count++}}))})},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(0),i=n(5),a=n(3),o=n(7),s=n(10),u=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isReadonly=!1,this.comment="",this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.readonly&&(this.isReadonly=e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),null!==e.args.options.scale&&void 0!==e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),void 0!==e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(e.args.options.enum instanceof Object&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter(function(e){return isNaN(+e)}).map(function(t){return e.args.options.enum[t]}):this.enum=e.args.options.enum),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),e.args.options.srid&&(this.srid=e.args.options.srid),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault}),void 0===this.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault}),void 0===this.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}return e.prototype.createValueMap=function(e,t){var n,i=this;if(void 0===t&&(t=!1),this.embeddedMetadata){var a=r.f(this.embeddedMetadata.parentPropertyNames),o=function(n,r){var a=n.shift();return a?(r[a]={},o(n,r[a]),r):("increment"!==i.generationStrategy&&"rowid"!==i.generationStrategy||"bigint"!==i.type||(e=String(e)),r[t?i.databaseName:i.propertyName]=e,r)};return o(a,{})}return"increment"!==this.generationStrategy&&"rowid"!==this.generationStrategy||"bigint"!==this.type||(e=String(e)),(n={})[t?this.databaseName:this.propertyName]=e,n},e.prototype.getEntityValueMap=function(e,t){var n,a,o=this;if(this.embeddedMetadata){var s=r.f(this.embeddedMetadata.parentPropertyNames),u=function(e,t,n){var r=e.shift();if(void 0===t)return n;if(r){var i={};return u(e,t[r],i),Object.keys(i).length>0&&(n[r]=i),n}return void 0!==t[o.propertyName]&&(n[o.propertyName]=t[o.propertyName]),n};return u(s,e,c={}),Object.keys(c).length>0?c:void 0}if(this.relationMetadata&&e[this.propertyName]&&e[this.propertyName]instanceof Object){var c=this.relationMetadata.joinColumns.reduce(function(t,n){var r=n.referencedColumn.getEntityValueMap(e[o.propertyName]);return void 0===r?t:i.a.mergeDeep(t,r)},{});return Object.keys(c).length>0?((n={})[this.propertyName]=c,n):void 0}return void 0!==e[this.propertyName]?((a={})[this.propertyName]=e[this.propertyName],a):void 0},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){var n=void 0;if(this.embeddedMetadata){var i=r.f(this.embeddedMetadata.parentPropertyNames),a=function(e,t){var n=e.shift();return n&&t?a(e,t[n]):t},u=a(i,e);if(u)if(this.relationMetadata&&this.referencedColumn)n=(c=this.relationMetadata.getEntityValue(u))&&c instanceof Object&&!(c instanceof s.a)?this.referencedColumn.getEntityValue(o.a.extractValue(c)):u[this.propertyName]&&u[this.propertyName]instanceof Object&&!(u[this.propertyName]instanceof s.a)?this.referencedColumn.getEntityValue(o.a.extractValue(u[this.propertyName])):o.a.extractValue(u[this.propertyName]);else n=this.referencedColumn?this.referencedColumn.getEntityValue(o.a.extractValue(u[this.propertyName])):o.a.extractValue(u[this.propertyName])}else{var c;if(this.relationMetadata&&this.referencedColumn)n=!((c=this.relationMetadata.getEntityValue(e))&&c instanceof Object)||c instanceof s.a||c instanceof Function?!(e[this.propertyName]&&e[this.propertyName]instanceof Object)||e[this.propertyName]instanceof s.a||e[this.propertyName]instanceof Function?e[this.propertyName]:this.referencedColumn.getEntityValue(o.a.extractValue(e[this.propertyName])):this.referencedColumn.getEntityValue(o.a.extractValue(c));else n=this.referencedColumn?this.referencedColumn.getEntityValue(o.a.extractValue(e[this.propertyName])):e[this.propertyName]}return t&&this.transformer&&(n=this.transformer.to(n)),n}},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var i=function(e,r){var a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n.propertyName]=t,r)};return i(r.f(this.embeddedMetadata.embeddedMetadataTree),e)}e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e},e.prototype.buildDatabasePath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver instanceof a.a&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}()},function(e,t,n){e.exports=!n(15)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){var n=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";var r=n(0),i=n(85),a=n(31),o=n(19),s=n(6),u=n(1),c=n(66),l=n(5),f=n(57),p=n(37),h=n(11),d=n(2),m=n(24),y=n(26),v=n(21),g=n(28),b=n(32),E=n(9),T=n(67),w=n(13),N=n(29),C=n(77),S=function(e){function t(t,n){void 0===n&&(n="master");var r=e.call(this)||this;return r.driver=t,r.connection=t.connection,r.mode=n,r.broadcaster=new b.a(r),r}return r.c(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){var n=r.e(t,2),i=n[0],a=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=a,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){var n=r.e(t,2),i=n[0],a=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=a,e.databaseConnection}),this.databaseConnectionPromise)},t.prototype.release=function(){this.isReleased=!0,this.releaseCallback&&this.releaseCallback();var e=this.driver.connectedQueryRunners.indexOf(this);return-1!==e&&this.driver.connectedQueryRunners.splice(e),Promise.resolve()},t.prototype.startTransaction=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:if(this.isTransactionActive)throw new f.a;return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return t.sent(),e?[4,this.query("SET TRANSACTION ISOLATION LEVEL "+e)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new p.a;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new p.a;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new v.a;return new Promise(function(i,a){return r.b(n,void 0,void 0,function(){var n,o,s,u=this;return r.d(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.query(e,t,function(n,r){var s=u.driver.connection.options.maxQueryExecutionTime,c=+new Date-o;if(s&&c>s&&u.driver.connection.logger.logQuerySlow(c,e,t,u),n)u.driver.connection.logger.logQueryError(n,e,t,u),a(new g.a(e,t,n));else switch(r.command){case"DELETE":i([r.rows,r.rowCount]);break;default:i(r.rows)}}),[3,3];case 2:return s=r.sent(),a(s),[3,3];case 3:return[2]}})})})},t.prototype.stream=function(e,t,n,i){var a=this,o=this.driver.loadStreamDependency();if(this.isReleased)throw new v.a;return new Promise(function(s,u){return r.b(a,void 0,void 0,function(){var a,c,l;return r.d(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return a=r.sent(),this.driver.connection.logger.logQuery(e,t,this),c=a.query(new o(e,t)),n&&c.on("end",n),i&&c.on("error",i),s(c),[3,3];case 2:return l=r.sent(),u(l),[3,3];case 3:return[2]}})})})},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.query('SELECT * FROM "pg_database" WHERE "datname" = \''+e+"'")];case 1:return[2,!!t.sent().length]}})})},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.query('SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = \''+e+"'")];case 1:return[2,!!t.sent().length]}})})},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.d(this,function(r){switch(r.label){case 0:return t=this.parseTableName(e),n='SELECT * FROM "information_schema"."tables" WHERE "table_schema" = '+t.schema+' AND "table_name" = '+t.tableName,[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n=this.parseTableName(e),i='SELECT * FROM "information_schema"."columns" WHERE "table_schema" = '+n.schema+' AND "table_name" = '+n.tableName+' AND "column_name" = \''+t+"'",[4,this.query(i)];case 1:return[2,!!r.sent().length]}})})},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n="CREATE DATABASE "+(t?"IF NOT EXISTS ":"")+' "'+e+'"',i='DROP DATABASE "'+e+'"',[4,this.executeQueries(n,i)];case 1:return r.sent(),[2]}})})},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n="DROP DATABASE "+(t?"IF EXISTS ":"")+' "'+e+'"',i='CREATE DATABASE "'+e+'"',[4,this.executeQueries(n,i)];case 1:return r.sent(),[2]}})})},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n=t?'CREATE SCHEMA IF NOT EXISTS "'+e+'"':'CREATE SCHEMA "'+e+'"',i='DROP SCHEMA "'+e+'" CASCADE',[4,this.executeQueries(n,i)];case 1:return r.sent(),[2]}})})},t.prototype.dropSchema=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,o;return r.d(this,function(r){switch(r.label){case 0:return i=-1===e.indexOf(".")?e:e.split(".")[0],a=t?'DROP SCHEMA IF EXISTS "'+i+'" '+(n?"CASCADE":""):'DROP SCHEMA "'+i+'" '+(n?"CASCADE":""),o='CREATE SCHEMA "'+i+'"',[4,this.executeQueries(a,o)];case 1:return r.sent(),[2]}})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,function(){var a,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=[],o=[],e.columns.filter(function(e){return e.isGenerated&&"increment"===e.generationStrategy}).forEach(function(t){a.push("CREATE SEQUENCE "+s.buildSequenceName(e,t)),o.push("DROP SEQUENCE "+s.buildSequenceName(e,t))}),a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return o.push(s.dropForeignKeySql(e,t))}),i&&e.indices.filter(function(e){return!e.isUnique}).forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,function(){var a,o,s,u,c,l=this;return r.d(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,o=e instanceof d.a?e.name:e,[4,this.getCachedTable(o)];case 3:return s=r.sent(),u=[],c=[],n&&s.foreignKeys.forEach(function(e){return u.push(l.dropForeignKeySql(s,e))}),i&&s.indices.forEach(function(e){u.push(l.dropIndexSql(s,e)),c.push(l.createIndexSql(s,e))}),u.push(this.dropTableSql(s)),c.push(this.createTableSql(s,a)),s.columns.filter(function(e){return e.isGenerated&&"increment"===e.generationStrategy}).forEach(function(e){u.push("DROP SEQUENCE "+l.buildSequenceName(s,e)),c.push("CREATE SEQUENCE "+l.buildSequenceName(s,e))}),[4,this.executeQueries(u,c)];case 4:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,f,p,h=this;return r.d(this,function(r){switch(r.label){case 0:return n=[],i=[],e instanceof d.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return s=(a=o).clone(),u=-1===a.name.indexOf(".")?a.name:a.name.split(".")[1],c=-1===a.name.indexOf(".")?void 0:a.name.split(".")[0],s.name=c?c+"."+t:t,n.push("ALTER TABLE "+this.escapeTableName(a)+' RENAME TO "'+t+'"'),i.push("ALTER TABLE "+this.escapeTableName(s)+' RENAME TO "'+u+'"'),s.primaryColumns.length>0&&(l=s.primaryColumns.map(function(e){return e.name}),f=this.connection.namingStrategy.primaryKeyName(a,l),p=this.connection.namingStrategy.primaryKeyName(s,l),n.push("ALTER TABLE "+this.escapeTableName(s)+' RENAME CONSTRAINT "'+f+'" TO "'+p+'"'),i.push("ALTER TABLE "+this.escapeTableName(s)+' RENAME CONSTRAINT "'+p+'" TO "'+f+'"')),s.uniques.forEach(function(e){var t=h.connection.namingStrategy.uniqueConstraintName(s,e.columnNames);n.push("ALTER TABLE "+h.escapeTableName(s)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"'),i.push("ALTER TABLE "+h.escapeTableName(s)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"'),e.name=t}),s.indices.forEach(function(e){var t=h.extractSchema(s),r=h.connection.namingStrategy.indexName(s,e.columnNames,e.where),a=t?'ALTER INDEX "'+t+'"."'+e.name+'" RENAME TO "'+r+'"':'ALTER INDEX "'+e.name+'" RENAME TO "'+r+'"',o=t?'ALTER INDEX "'+t+'"."'+r+'" RENAME TO "'+e.name+'"':'ALTER INDEX "'+r+'" RENAME TO "'+e.name+'"';n.push(a),i.push(o),e.name=r}),s.foreignKeys.forEach(function(e){var t=h.connection.namingStrategy.foreignKeyName(s,e.columnNames);n.push("ALTER TABLE "+h.escapeTableName(s)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"'),i.push("ALTER TABLE "+h.escapeTableName(s)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"'),e.name=t}),[4,this.executeQueries(n,i)];case 4:return r.sent(),[2]}})})},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,f,p,h,m,y;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(a=(n=i).clone(),o=[],s=[],"increment"===t.generationStrategy)throw new Error("Adding sequential generated columns into existing table is not supported");return o.push("ALTER TABLE "+this.escapeTableName(n)+" ADD "+this.buildCreateColumnSql(n,t)),s.push("ALTER TABLE "+this.escapeTableName(n)+' DROP COLUMN "'+t.name+'"'),t.isPrimary&&((u=a.primaryColumns).length>0&&(c=this.connection.namingStrategy.primaryKeyName(a.name,u.map(function(e){return e.name})),l=u.map(function(e){return'"'+e.name+'"'}).join(", "),o.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+c+'"'),s.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+c+'" PRIMARY KEY ('+l+")")),u.push(t),f=this.connection.namingStrategy.primaryKeyName(a.name,u.map(function(e){return e.name})),p=u.map(function(e){return'"'+e.name+'"'}).join(", "),o.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+p+")"),s.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+f+'"')),(h=a.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))&&(h.isUnique?(m=new E.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,h.columnNames),columnNames:h.columnNames}),o.push(this.createUniqueConstraintSql(n,m)),s.push(this.dropIndexSql(n,m)),a.uniques.push(m)):(o.push(this.createIndexSql(n,h)),s.push(this.dropIndexSql(n,h)))),t.isUnique&&(y=new E.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(y),o.push(this.createUniqueConstraintSql(n,y)),s.push(this.dropIndexSql(n,y.name))),[4,this.executeQueries(o,s)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}})})},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.addColumn(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof h.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n instanceof h.a?s=n:(s=o.clone()).name=n,[2,this.changeColumn(i,o,s)]}})})},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,o,s,u,c,l,f,p,m,y,v,g,b,T=this;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],u=[],!(c=t instanceof h.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c.type===n.type&&c.length===n.length?[3,6]:[4,this.dropColumn(i,c)];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,7];case 6:if(c.name!==n.name&&(s.push("ALTER TABLE "+this.escapeTableName(i)+' RENAME COLUMN "'+c.name+'" TO "'+n.name+'"'),u.push("ALTER TABLE "+this.escapeTableName(i)+' RENAME COLUMN "'+n.name+'" TO "'+c.name+'"'),!0===c.isPrimary&&(m=o.primaryColumns,g=m.map(function(e){return e.name}),l=this.connection.namingStrategy.primaryKeyName(o,g),g.splice(g.indexOf(c.name),1),g.push(n.name),f=this.connection.namingStrategy.primaryKeyName(o,g),s.push("ALTER TABLE "+this.escapeTableName(i)+' RENAME CONSTRAINT "'+l+'" TO "'+f+'"'),u.push("ALTER TABLE "+this.escapeTableName(i)+' RENAME CONSTRAINT "'+f+'" TO "'+l+'"')),o.findColumnUniques(c).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=T.connection.namingStrategy.uniqueConstraintName(o,e.columnNames);s.push("ALTER TABLE "+T.escapeTableName(i)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"'),u.push("ALTER TABLE "+T.escapeTableName(i)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"'),e.name=t}),o.findColumnIndices(c).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=T.extractSchema(i),r=T.connection.namingStrategy.indexName(o,e.columnNames,e.where),a=t?'ALTER INDEX "'+t+'"."'+e.name+'" RENAME TO "'+r+'"':'ALTER INDEX "'+e.name+'" RENAME TO "'+r+'"',l=t?'ALTER INDEX "'+t+'"."'+r+'" RENAME TO "'+e.name+'"':'ALTER INDEX "'+r+'" RENAME TO "'+e.name+'"';s.push(a),u.push(l),e.name=r}),o.findColumnForeignKeys(c).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=T.connection.namingStrategy.foreignKeyName(o,e.columnNames);s.push("ALTER TABLE "+T.escapeTableName(i)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"'),u.push("ALTER TABLE "+T.escapeTableName(i)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"'),e.name=t}),p=o.columns.find(function(e){return e.name===c.name}),o.columns[o.columns.indexOf(p)].name=n.name,c.name=n.name),n.precision===c.precision&&n.scale===c.scale||(s.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(n)),u.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(c))),c.isNullable!==n.isNullable&&(n.isNullable?(s.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+c.name+'" DROP NOT NULL'),u.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+c.name+'" SET NOT NULL')):(s.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+c.name+'" SET NOT NULL'),u.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+c.name+'" DROP NOT NULL'))),c.comment!==n.comment&&(s.push("COMMENT ON COLUMN "+this.escapeTableName(i)+'."'+c.name+"\" IS '"+n.comment+"'"),u.push("COMMENT ON COLUMN "+this.escapeTableName(i)+'."'+n.name+"\" IS '"+c.comment+"'")),n.isPrimary!==c.isPrimary&&((m=o.primaryColumns).length>0&&(v=this.connection.namingStrategy.primaryKeyName(o.name,m.map(function(e){return e.name})),g=m.map(function(e){return'"'+e.name+'"'}).join(", "),s.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+v+'"'),u.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+g+")")),!0===n.isPrimary?(m.push(n),o.columns.find(function(e){return e.name===n.name}).isPrimary=!0,v=this.connection.namingStrategy.primaryKeyName(o.name,m.map(function(e){return e.name})),g=m.map(function(e){return'"'+e.name+'"'}).join(", "),s.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+g+")"),u.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+v+'"')):(y=m.find(function(e){return e.name===n.name}),m.splice(m.indexOf(y),1),o.columns.find(function(e){return e.name===n.name}).isPrimary=!1,m.length>0&&(v=this.connection.namingStrategy.primaryKeyName(o.name,m.map(function(e){return e.name})),g=m.map(function(e){return'"'+e.name+'"'}).join(", "),s.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+g+")"),u.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+v+'"')))),n.isUnique!==c.isUnique&&(n.isUnique?(b=new E.a({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),o.uniques.push(b),s.push(this.createUniqueConstraintSql(i,b)),u.push(this.dropIndexSql(i,b))):(b=o.uniques.find(function(e){return 1===e.columnNames.length&&!!e.columnNames.find(function(e){return e===n.name})}),o.uniques.splice(o.uniques.indexOf(b),1),s.push(this.dropIndexSql(i,b)),u.push(this.createUniqueConstraintSql(i,b)))),c.isGenerated!==n.isGenerated&&"uuid"!==n.generationStrategy)if(n.isGenerated){if("increment"===n.generationStrategy)throw new Error("Adding sequential generated columns into existing table is not supported");"rowid"===n.generationStrategy&&(s.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT unique_rowid()'),u.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'))}else s.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'),u.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT unique_rowid()');n.default!==c.default&&(null!==n.default&&void 0!==n.default?(s.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+n.default),null!==c.default&&void 0!==c.default?u.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+c.default):u.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')):null!==c.default&&void 0!==c.default&&(s.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'),u.push("ALTER TABLE "+this.escapeTableName(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+c.default))),r.label=7;case 7:return[4,this.executeQueries(s,u)];case 8:return r.sent(),this.replaceCachedTable(i,o),[2]}})})},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.changeColumn(e,t.oldColumn,t.newColumn)})];case 1:return r.sent(),[2]}})})},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,f,p,m,y,v;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof h.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return o=n.clone(),s=[],u=[],a.isPrimary&&(c=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map(function(e){return e.name})),l=o.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),s.push("ALTER TABLE "+this.escapeTableName(o)+' DROP CONSTRAINT "'+c+'"'),u.push("ALTER TABLE "+this.escapeTableName(o)+' ADD CONSTRAINT "'+c+'" PRIMARY KEY ('+l+")"),o.findColumnByName(a.name).isPrimary=!1,o.primaryColumns.length>0&&(f=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map(function(e){return e.name})),p=o.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),s.push("ALTER TABLE "+this.escapeTableName(o)+' ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+p+")"),u.push("ALTER TABLE "+this.escapeTableName(o)+' DROP CONSTRAINT "'+f+'"'))),(m=o.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(o.indices.splice(o.indices.indexOf(m),1),s.push(this.dropIndexSql(n,m)),u.push(this.createIndexSql(n,m))),(y=o.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(o.checks.splice(o.checks.indexOf(y),1),s.push(this.dropCheckConstraintSql(n,y)),u.push(this.createCheckConstraintSql(n,y))),(v=o.uniques.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(o.uniques.splice(o.uniques.indexOf(v),1),s.push(this.dropIndexSql(n,v.name)),u.push(this.createUniqueConstraintSql(n,v))),s.push("ALTER TABLE "+this.escapeTableName(n)+' DROP COLUMN "'+a.name+'"'),u.push("ALTER TABLE "+this.escapeTableName(n)+" ADD "+this.buildCreateColumnSql(n,a)),"increment"===a.generationStrategy&&(s.push("DROP SEQUENCE "+this.buildSequenceName(n,a)),u.push("CREATE SEQUENCE "+this.buildSequenceName(n,a))),[4,this.executeQueries(s,u)];case 4:return r.sent(),o.removeColumn(a),this.replaceCachedTable(n,o),[2]}})})},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.dropColumn(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,f,p,h;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=t.map(function(e){return e.name}),s=[],u=[],(c=a.primaryColumns).length>0&&(l=this.connection.namingStrategy.primaryKeyName(a.name,c.map(function(e){return e.name})),f=c.map(function(e){return'"'+e.name+'"'}).join(", "),s.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+l+'"'),u.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+l+'" PRIMARY KEY ('+f+")")),a.columns.filter(function(e){return-1!==o.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),p=this.connection.namingStrategy.primaryKeyName(a.name,o),h=o.map(function(e){return'"'+e+'"'}).join(", "),s.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+h+")"),u.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+p+'"'),[4,this.executeQueries(s,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name})),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.createUniqueConstraint(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof E.a?t:n.uniques.find(function(e){return e.name===t})))throw new Error("Supplied unique constraint was not found in table "+n.name);return o=this.dropIndexSql(n,a),s=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.dropUniqueConstraint(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof N.a?t:n.checks.find(function(e){return e.name===t})))throw new Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("CockroachDB does not support exclusion constraints.")})})},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("CockroachDB does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("CockroachDB does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("CockroachDB does not support exclusion constraints.")})})},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.createForeignKey(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof y.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.dropForeignKey(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),t.isUnique?(a=new E.a({name:t.name,columnNames:t.columnNames}),o=this.createUniqueConstraintSql(n,a),s=this.dropIndexSql(n,a),[4,this.executeQueries(o,s)]):[3,5];case 4:return r.sent(),n.addUniqueConstraint(a),[3,7];case 5:return o=this.createIndexSql(n,t),s=this.dropIndexSql(n,t),[4,this.executeQueries(o,s)];case 6:r.sent(),n.addIndex(t),r.label=7;case 7:return[2]}})})},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.createIndex(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof m.a?t:n.indices.find(function(e){return e.name===t})))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(n,a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,w.PromiseUtils.runInSequence(t,function(t){return n.dropIndex(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapeTableName(e))];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u=this;return r.d(this,function(r){switch(r.label){case 0:return e=[],this.connection.entityMetadatas.filter(function(e){return e.schema}).forEach(function(t){!!e.find(function(e){return e===t.schema})||e.push(t.schema)}),e.push(this.driver.options.schema||"current_schema()"),t=e.map(function(e){return"current_schema()"===e?e:"'"+e+"'"}).join(", "),[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,8,,13]),n='SELECT \'DROP TABLE IF EXISTS "\' || table_schema || \'"."\' || table_name || \'" CASCADE;\' as "query" FROM "information_schema"."tables" WHERE "table_schema" IN ('+t+")",[4,this.query(n)];case 3:return i=r.sent(),[4,Promise.all(i.map(function(e){return u.query(e.query)}))];case 4:return r.sent(),a='SELECT \'DROP SEQUENCE "\' || sequence_schema || \'"."\' || sequence_name || \'";\' as "query" FROM "information_schema"."sequences" WHERE "sequence_schema" IN ('+t+")",[4,this.query(a)];case 5:return o=r.sent(),[4,Promise.all(o.map(function(e){return u.query(e.query)}))];case 6:return r.sent(),[4,this.commitTransaction()];case 7:return r.sent(),[3,13];case 8:s=r.sent(),r.label=9;case 9:return r.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return r.sent(),[3,12];case 11:return r.sent(),[3,12];case 12:throw s;case 13:return[2]}})})},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c,f,p,v,g,b,T,w,S,A=this;return r.d(this,function(O){switch(O.label){case 0:return e&&e.length?[4,this.query("SELECT * FROM current_schema()")]:[2,[]];case 1:return t=O.sent(),n=t[0].current_schema,i=e.map(function(e){var t=r.e(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=A.driver.options.schema||n),'("table_schema" = \''+i+"' AND \"table_name\" = '"+a+"')"}).join(" OR "),a='SELECT * FROM "information_schema"."tables" WHERE '+i,o='SELECT * FROM "information_schema"."columns" WHERE "is_hidden" = \'NO\' AND '+i,s=e.map(function(e){var t=r.e(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=A.driver.options.schema||n),'("ns"."nspname" = \''+i+'\' AND "t"."relname" = \''+a+"')"}).join(" OR "),u='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", CASE "cnst"."contype" WHEN \'x\' THEN pg_get_constraintdef("cnst"."oid", true) ELSE "cnst"."consrc" END AS "expression", CASE "cnst"."contype" WHEN \'p\' THEN \'PRIMARY\' WHEN \'u\' THEN \'UNIQUE\' WHEN \'c\' THEN \'CHECK\' WHEN \'x\' THEN \'EXCLUDE\' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" = \'r\' AND ('+s+")",c='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN \'t\' THEN \'TRUE\' ELSE\'FALSE\' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" = \'r\' AND "cnst"."contype" IS NULL AND ('+s+")",f=e.map(function(e){var t=r.e(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=A.driver.options.schema||n),'("ns"."nspname" = \''+i+'\' AND "cl"."relname" = \''+a+"')"}).join(" OR "),p='SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", CASE "con1"."confdeltype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confdeltype", CASE "con1"."confupdtype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = \'f\' AND ('+f+') ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"',[4,Promise.all([this.query(a),this.query(o),this.query(u),this.query(c),this.query(p)])];case 2:return v=r.e.apply(void 0,[O.sent(),5]),g=v[0],b=v[1],T=v[2],w=v[3],S=v[4],g.length?[2,Promise.all(g.map(function(e){return r.b(A,void 0,void 0,function(){var t,i,a,o,s,u,c,f,p,v=this;return r.d(this,function(g){switch(g.label){case 0:return t=new d.a,i=e.table_schema!==n||this.driver.options.schema?e.table_schema:void 0,t.name=this.driver.buildTableName(e.table_name,i),a=this.driver.buildTableName(e.table_name,e.table_schema),o=t,[4,Promise.all(b.filter(function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a}).map(function(e){return r.b(v,void 0,void 0,function(){var n,i,o,s,u,c,l=this;return r.d(this,function(r){return n=T.filter(function(t){return l.driver.buildTableName(t.table_name,t.table_schema)===a&&t.column_name===e.column_name}),(i=new h.a).name=e.column_name,i.type=e.crdb_sql_type.toLowerCase(),-1!==e.crdb_sql_type.indexOf("COLLATE")&&(i.collation=e.crdb_sql_type.substr(e.crdb_sql_type.indexOf("COLLATE")+"COLLATE".length+1,e.crdb_sql_type.length),i.type=i.type.substr(0,e.crdb_sql_type.indexOf("COLLATE")-1)),-1!==i.type.indexOf("(")&&(i.type=i.type.substr(0,i.type.indexOf("("))),"numeric"!==i.type&&"decimal"!==i.type||(null===e.numeric_precision||this.isDefaultColumnPrecision(t,i,e.numeric_precision)?null===e.numeric_scale||this.isDefaultColumnScale(t,i,e.numeric_scale)||(i.precision=void 0):i.precision=parseInt(e.numeric_precision),null===e.numeric_scale||this.isDefaultColumnScale(t,i,e.numeric_scale)?null===e.numeric_precision||this.isDefaultColumnPrecision(t,i,e.numeric_precision)||(i.scale=void 0):i.scale=parseInt(e.numeric_scale)),"array"===e.data_type.toLowerCase()&&(i.isArray=!0,o=e.crdb_sql_type.replace("[]","").toLowerCase(),i.type=this.connection.driver.normalizeType({type:o})),-1!==this.driver.withLengthColumnTypes.indexOf(i.type)&&e.character_maximum_length&&(s=e.character_maximum_length.toString(),i.length=this.isDefaultColumnLength(t,i,s)?"":s),i.isNullable="YES"===e.is_nullable,i.isPrimary=!!n.find(function(e){return"PRIMARY"===e.constraint_type}),u=n.find(function(e){return"UNIQUE"===e.constraint_type}),c=!!u&&!!T.find(function(t){return"UNIQUE"===t.constraint_type&&t.constraint_name===u.constraint_name&&t.column_name!==e.column_name}),i.isUnique=!!u&&!c,null!==e.column_default&&void 0!==e.column_default&&("unique_rowid()"===e.column_default?(i.isGenerated=!0,i.generationStrategy="rowid"):-1!==e.column_default.indexOf("nextval")?(i.isGenerated=!0,i.generationStrategy="increment"):"gen_random_uuid()"===e.column_default?(i.isGenerated=!0,i.generationStrategy="uuid"):i.default=e.column_default.replace(/:::.*/,"")),i.comment="",e.character_set_name&&(i.charset=e.character_set_name),[2,i]})})}))];case 1:return o.columns=g.sent(),s=l.a.uniq(T.filter(function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a&&"UNIQUE"===e.constraint_type}),function(e){return e.constraint_name}),t.uniques=s.map(function(e){var t=T.filter(function(t){return t.constraint_name===e.constraint_name});return new E.a({name:e.constraint_name,columnNames:t.map(function(e){return e.column_name})})}),u=l.a.uniq(T.filter(function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a&&"CHECK"===e.constraint_type}),function(e){return e.constraint_name}),t.checks=u.map(function(e){var t=T.filter(function(t){return t.constraint_name===e.constraint_name});return new N.a({name:e.constraint_name,columnNames:t.map(function(e){return e.column_name}),expression:e.expression})}),c=l.a.uniq(T.filter(function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a&&"EXCLUDE"===e.constraint_type}),function(e){return e.constraint_name}),t.exclusions=c.map(function(e){return new C.a({name:e.constraint_name,expression:e.expression.substring(8)})}),f=l.a.uniq(S.filter(function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a}),function(e){return e.constraint_name}),t.foreignKeys=f.map(function(t){var r=S.filter(function(e){return e.constraint_name===t.constraint_name}),i=t.referenced_table_schema===n?void 0:e.referenced_table_schema,a=v.driver.buildTableName(t.referenced_table_name,i);return new y.a({name:t.constraint_name,columnNames:r.map(function(e){return e.column_name}),referencedTableName:a,referencedColumnNames:r.map(function(e){return e.referenced_column_name}),onDelete:t.on_delete,onUpdate:t.on_update})}),p=l.a.uniq(w.filter(function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a}),function(e){return e.constraint_name}),t.indices=p.map(function(e){var n=w.filter(function(t){return t.constraint_name===e.constraint_name});return new m.a({table:t,name:e.constraint_name,columnNames:n.map(function(e){return e.column_name}),isUnique:"TRUE"===e.is_unique,where:e.condition,isSpatial:n.every(function(e){return v.driver.spatialTypes.indexOf(e.type_name)>=0}),isFulltext:!1})}),[2,t]}})})}))]:[2,[]]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(t){return n.buildCreateColumnSql(e,t)}).join(", "),i="CREATE TABLE "+this.escapeTableName(e)+" ("+r;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new E.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),e.indices.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.push(new E.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames),columnNames:t.columnNames}))}),e.uniques.length>0)&&(i+=", "+e.uniques.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map(function(e){return'"'+e+'"'}).join(", ")+")"}).join(", "));e.checks.length>0&&(i+=", "+e.checks.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"}).join(", "));e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames));var i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+n.escapeTableName(t.referencedTableName)+" ("+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a}).join(", "));var a=e.columns.filter(function(e){return e.isPrimary});a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'" PRIMARY KEY ('+a.map(function(e){return'"'+e.name+'"'}).join(", ")+")");return i+=")"},t.prototype.extractSchema=function(e){var t=e instanceof d.a?e.name:e;return-1===t.indexOf(".")?this.driver.options.schema:t.split(".")[0]},t.prototype.dropTableSql=function(e){return"DROP TABLE "+this.escapeTableName(e)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return'CREATE INDEX "'+t.name+'" ON '+this.escapeTableName(e)+" ("+n+") "+(t.where?"WHERE "+t.where:"")},t.prototype.dropIndexSql=function(e,t){var n=t instanceof m.a||t instanceof E.a?t.name:t;return"DROP INDEX "+this.escapeTableName(e)+'@"'+n+'" CASCADE'},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'"'+e+'"'}).join(", ");return"ALTER TABLE "+this.escapeTableName(e)+' ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")"},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return"ALTER TABLE "+this.escapeTableName(e)+' DROP CONSTRAINT "'+n+'"'},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return"ALTER TABLE "+this.escapeTableName(e)+' ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")"},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof E.a?t.name:t;return"ALTER TABLE "+this.escapeTableName(e)+' DROP CONSTRAINT "'+n+'"'},t.prototype.createCheckConstraintSql=function(e,t){return"ALTER TABLE "+this.escapeTableName(e)+' ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")"},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof N.a?t.name:t;return"ALTER TABLE "+this.escapeTableName(e)+' DROP CONSTRAINT "'+n+'"'},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),i="ALTER TABLE "+this.escapeTableName(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") REFERENCES "+this.escapeTableName(t.referencedTableName)+"("+r+")";return t.onDelete&&(i+=" ON DELETE "+t.onDelete),t.onUpdate&&(i+=" ON UPDATE "+t.onUpdate),i},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof y.a?t.name:t;return"ALTER TABLE "+this.escapeTableName(e)+' DROP CONSTRAINT "'+n+'"'},t.prototype.buildSequenceName=function(e,t,n){var r=t instanceof h.a?t.name:t;return n?e.name+"_"+r+"_seq":'"'+e.name+"_"+r+'_seq"'},t.prototype.escapeTableName=function(e,t){var n=e instanceof d.a?e.name:e;return(n=-1===n.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+n:n).split(".").map(function(e){return t?e:'"'+e+'"'}).join(".")},t.prototype.parseTableName=function(e){var t=e instanceof d.a?e.name:e;return-1===t.indexOf(".")?{schema:this.driver.options.schema?"'"+this.driver.options.schema+"'":"current_schema()",tableName:"'"+t+"'"}:{schema:"'"+t.split(".")[0]+"'",tableName:"'"+t.split(".")[1]+"'"}},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+t.name+'"';return t.isGenerated&&("increment"===t.generationStrategy?n+=" INT DEFAULT nextval('"+this.buildSequenceName(e,t)+"')":"rowid"===t.generationStrategy?n+=" INT DEFAULT unique_rowid()":"uuid"===t.generationStrategy&&(n+=" UUID DEFAULT gen_random_uuid()")),t.isGenerated||(n+=" "+this.connection.driver.createFullType(t)),t.charset&&(n+=' CHARACTER SET "'+t.charset+'"'),t.collation&&(n+=' COLLATE "'+t.collation+'"'),t.isNullable||(n+=" NOT NULL"),t.isGenerated||void 0===t.default||null===t.default||(n+=" DEFAULT "+t.default),n},t}(T.a);n.d(t,"a",function(){return A});var A=function(){function e(e){this.slaves=[],this.connectedQueryRunners=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["array","bool","boolean","bytes","bytea","blob","date","numeric","decimal","dec","float","float4","float8","double precision","real","inet","int","int4","integer","int2","int8","int64","smallint","bigint","interval","string","character varying","character","char","char varying","varchar","text","time","time without time zone","timestamp","timestamptz","timestamp without time zone","timestamp with time zone","json","jsonb","uuid"],this.spatialTypes=[],this.withLengthColumnTypes=["character varying","char varying","varchar","character","char","string"],this.withPrecisionColumnTypes=["numeric","decimal","dec"],this.withScaleColumnTypes=["numeric","decimal","dec"],this.mappedDataTypes={createDate:"timestamptz",createDateDefault:"now()",updateDate:"timestamptz",updateDateDefault:"now()",version:Number,treeLevel:Number,migrationId:Number,migrationName:"varchar",migrationTimestamp:"int8",cacheId:Number,cacheIdentifier:"varchar",cacheTime:"int8",cacheDuration:Number,cacheQuery:"string",cacheResult:"string"},this.dataTypeDefaults={char:{length:1}},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i=this;return r.d(this,function(r){switch(r.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))]):[3,3];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve()]})})},e.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new i.a("cockroachdb"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.createSchemaBuilder=function(){return new c.a(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new S(this,e)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?s.a.mixedDateToDateString(e):"time"===t.type?s.a.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date||"timestamp"===t.type||"timestamptz"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?s.a.mixedDateToDate(e):r.f(["json","jsonb"],this.spatialTypes).indexOf(t.type)>=0?JSON.stringify(e):"simple-array"===t.type?s.a.simpleArrayToString(e):"simple-json"===t.type?s.a.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?t.transformer.from(e):e:(t.type===Number&&!t.isArray||"increment"===t.generationStrategy?e=parseInt(e):t.type===Boolean?e=!!e:"datetime"===t.type||t.type===Date||"timestamp"===t.type||"timestamptz"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?e=s.a.normalizeHydratedDate(e):"date"===t.type?e=s.a.mixedDateToDateString(e):"time"===t.type?e=s.a.mixedTimeToString(e):"simple-array"===t.type?e=s.a.stringToSimpleArray(e):"simple-json"===t.type&&(e=s.a.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e)),e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(i,"g"),function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map(function(e){return r.push(e),"$"+r.length}).join(", "):n instanceof Function?n():(r.push(n),"$"+r.length)}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t){return t?t+"."+e:e},e.prototype.normalizeType=function(e){return e.type===Number||"integer"===e.type||"int"===e.type||"bigint"===e.type||"int64"===e.type?"int8":e.type===String||"character varying"===e.type||"char varying"===e.type?"varchar":e.type===Date||"timestamp without time zone"===e.type?"timestamp":"timestamp with time zone"===e.type?"timestamptz":"time without time zone"===e.type?"time":e.type===Boolean||"boolean"===e.type?"bool":"simple-array"===e.type||"simple-json"===e.type||"text"===e.type?"string":"bytea"===e.type||"blob"===e.type?"bytes":"smallint"===e.type?"int2":"numeric"===e.type||"dec"===e.type?"decimal":"double precision"===e.type||"float"===e.type?"float8":"real"===e.type?"float4":"character"===e.type?"char":"json"===e.type?"jsonb":e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default,n=e.isArray?"::"+e.type+"[]":"";return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"true":"false":"function"==typeof t?t():"string"==typeof t?"'"+t+"'"+n:null===t?"null":"object"==typeof t?"'"+JSON.stringify(t)+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,n){e.master.connect(function(e,r,i){e?n(e):t([r,i])})})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise(function(t,n){var r=Math.floor(Math.random()*e.slaves.length);e.slaves[r].connect(function(e,r,i){e?n(e):t([r,i])})}):this.obtainMasterConnection()},e.prototype.createGeneratedMap=function(e,t){var n=this;if(t)return Object.keys(t).reduce(function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&l.a.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r},{})},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&n.lowerDefaultValueIfNecessary(n.normalizeDefault(t))!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||r.isGenerated!==t.isGenerated)})},e.prototype.lowerDefaultValueIfNecessary=function(e){return e?e.split("'").map(function(e,t){return t%2==1?e:e.toLowerCase()}).join("'"):e},e.prototype.isReturningSqlSupported=function(){return!0},e.prototype.isUUIDGenerationSupported=function(){return!0},e.prototype.createParameter=function(e,t){return"$"+(t+1)},e.prototype.loadStreamDependency=function(){try{return u.a.load("pg-query-stream")}catch(e){throw new Error("To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.")}},e.prototype.loadDependencies=function(){try{this.postgres=u.a.load("pg");try{u.a.load("pg-native")&&this.postgres.native&&(this.postgres=this.postgres.native)}catch(e){}}catch(e){throw new a.a("Postgres","pg")}},e.prototype.createPool=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){return t=Object.assign(t,o.a.buildDriverOptions(t)),n=Object.assign({},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:t.ssl},e.extra||{}),i=new this.postgres.Pool(n),a=this.connection.logger,i.on("error",function(e){return a.log("warn","Postgres pool raised an error. "+e)}),[2,new Promise(function(e,t){i.connect(function(n,r,a){if(n)return t(n);a(),e(i)})})]})})},e.prototype.closePool=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.connectedQueryRunners.map(function(e){return e.release()}))];case 1:return t.sent(),[2,new Promise(function(t,n){e.end(function(e){return e?n(e):t()})})]}})})},e.prototype.executeQuery=function(e,t){return new Promise(function(n,r){e.query(t,function(e,t){if(e)return r(e);n(t)})})},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="TransactionNotStartedError",Object.setPrototypeOf(n,t.prototype),n.message="Transaction is not started yet, start transaction before committing or rolling it back.",n}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(n){var r=e.call(this)||this;return r.name="DriverOptionNotSetError",Object.setPrototypeOf(r,t.prototype),r.message="Driver option ("+n+") is not set. Please set it to perform connection to the database.",r}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return function(){this.count=0,this.promises=[]}}()},function(e,t,n){var r=n(14),i=n(46),a=n(45),o=n(69)("src"),s=n(209),u=(""+s).split("toString");n(35).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,n,s){var c="function"==typeof n;c&&(a(n,"name")||i(n,"name",t)),e[t]!==n&&(c&&(a(n,o)||i(n,o,e[t]?""+e[t]:u.join(String(t)))),e===r?e[t]=n:s?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||s.call(this)})},function(e,t,n){var r=n(61);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(4),i=n(15),a=n(61),o=/"/g,s=function(e,t,n,r){var i=String(a(e)),s="<"+t;return""!==n&&(s+=" "+n+'="'+String(r).replace(o,"&quot;")+'"'),s+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(s),r(r.P+r.F*i(function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}),"String",n)}},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=!1),e.replace(/^([A-Z])|[\s-_](\w)/g,function(e,n,r,i){return!0===t&&0===i?n:r?r.toUpperCase():n.toLowerCase()})}function i(e){return e.replace(/(?:([a-z])([A-Z]))|(?:((?!^)[A-Z])([a-z]))/g,"$1_$3$2$4").toLowerCase()}function a(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function o(e,t){void 0===t&&(t={});var n=t.segmentLength,r=void 0===n?4:n,i=t.separator,a=void 0===i?"__":i,o=t.termLength,s=void 0===o?2:o;return e.split(a).reduce(function(e,t){var n=t.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),i=n.length>1?s:r,a=n.map(function(e){return e.substr(0,i)}).join("");return e.push(a),e},[]).join(a)}n.d(t,"a",function(){return r}),n.d(t,"c",function(){return i}),n.d(t,"d",function(){return a}),n.d(t,"b",function(){return o})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(){}return e.isAliasProperty=function(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;var t=r.e(e.split("."),2),n=t[0],i=t[1];return!(!n||!i)&&(-1===e.indexOf("(")&&-1===e.indexOf(")"))},e}()},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(30),i=n(68);e.exports=n(34)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(90),i=n(61);e.exports=function(e){return r(i(e))}},function(e,t,n){"use strict";var r=n(0),i=n(25),a=function(){function e(e){i.a.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw new Error('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),o=n(113),s=n(86),u=n(87),c=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={}}return Object.defineProperty(e.prototype,"allOrderBys",{get:function(){var e=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf("disable-global-order")){var t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce(function(n,r){return n[e.mainAlias.name+"."+r]=t[r],n},{})}return this.orderBys},enumerable:!0,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias=e,e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tablePath&&(t=e.tablePath),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);var n=new a;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n},e.prototype.findAliasByName=function(e){var t=this.aliases.find(function(t){return t.name===e});if(!t)throw new Error('"'+e+'" alias was not found. Maybe you forgot to join it?');return t},e.prototype.findColumnByAliasExpression=function(e){var t=r.e(e.split("."),2),n=t[0],i=t[1];return this.findAliasByName(n).metadata.findColumnWithPropertyName(i)},Object.defineProperty(e.prototype,"relationMetadata",{get:function(){if(!this.mainAlias)throw new Error("Entity to work with is not specified!");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation "+this.relationPropertyPath+" was not found in entity "+this.mainAlias.name);return e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this,n=new e(this.connection);return n.queryType=this.queryType,n.selects=this.selects.map(function(e){return e}),this.aliases.forEach(function(e){return n.aliases.push(new a(e))}),n.mainAlias=this.mainAlias,n.valuesSet=this.valuesSet,n.returning=this.returning,n.onConflict=this.onConflict,n.onIgnore=this.onIgnore,n.onUpdate=this.onUpdate,n.joinAttributes=this.joinAttributes.map(function(e){return new o.a(t.connection,t,e)}),n.relationIdAttributes=this.relationIdAttributes.map(function(e){return new s.a(t,e)}),n.relationCountAttributes=this.relationCountAttributes.map(function(e){return new u.a(t,e)}),n.wheres=this.wheres.map(function(e){return r.a({},e)}),n.havings=this.havings.map(function(e){return r.a({},e)}),n.orderBys=Object.assign({},this.orderBys),n.groupBys=this.groupBys.map(function(e){return e}),n.limit=this.limit,n.offset=this.offset,n.skip=this.skip,n.take=this.take,n.lockMode=this.lockMode,n.lockVersion=this.lockVersion,n.parameters=Object.assign({},this.parameters),n.disableEscaping=this.disableEscaping,n.enableRelationIdValues=this.enableRelationIdValues,n.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,n.subQuery=this.subQuery,n.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,n.cache=this.cache,n.cacheId=this.cacheId,n.cacheDuration=this.cacheDuration,n.relationPropertyPath=this.relationPropertyPath,n.of=this.of,n.insertColumns=this.insertColumns,n.whereEntities=this.whereEntities,n.updateEntity=this.updateEntity,n.callListeners=this.callListeners,n.useTransaction=this.useTransaction,n.nativeParameters=this.nativeParameters,n},e}(),l=n(108),f=n(23),p=n(49),h=n(8),d=n(12),m=n(13),y=n(10),v=n(109);n.d(t,"a",function(){return g});var g=function(){function e(t,n){t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=n,this.expressionMap=new c(this.connection))}return Object.defineProperty(e.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new Error("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType="select",e instanceof Array?this.expressionMap.selects=e.map(function(e){return{selection:e}}):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var r=n(84).SelectQueryBuilder;return this instanceof r?this:new r(this)},e.prototype.insert=function(){this.expressionMap.queryType="insert";var e=n(145).InsertQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var r=t||e;if((e=e instanceof m.EntitySchema?e.options.name:e)instanceof Function||"string"==typeof e){var i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=r;var a=n(143).UpdateQueryBuilder;return this instanceof a?this:new a(this)},e.prototype.delete=function(){this.expressionMap.queryType="delete";var e=n(142).DeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){var r=2===arguments.length?e:void 0,i=2===arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){var a=this.createFromAlias(r);this.expressionMap.setMainAlias(a)}var o=n(144).RelationQueryBuilder;return this instanceof o?this:new o(this)},e.prototype.hasRelation=function(e,t){var n=this.connection.getMetadata(e);return(t instanceof Array?t:[t]).every(function(e){return!!n.findRelationWithPropertyPath(e)})},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return Object.keys(e).forEach(function(t){if(e[t]instanceof Function)throw new Error("Function parameter isn't supported in the parameters. Please check \""+t+'" parameter.')}),this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setParameters(e),Object.keys(e).forEach(function(n){return t.setParameter(n,e[n])}),this},e.prototype.setNativeParameters=function(e){var t=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(function(n){t.expressionMap.nativeParameters[n]=e[n]}),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter(function(e){return e.discriminatorColumn}).map(function(e){return e.discriminatorValue});n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.printSql=function(){var e=r.e(this.getQueryAndParameters(),2),t=e[0],n=e[1];return this.connection.logger.logQuery(t,n),this},e.prototype.getSql=function(){return this.getQueryAndParameters()[0]},e.prototype.getQueryAndParameters=function(){var e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)},e.prototype.execute=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i;return r.d(this,function(a){switch(a.label){case 0:e=r.e(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a.label=1;case 1:return a.trys.push([1,,3,8]),[4,i.query(t,n)];case 2:return[2,a.sent()];case 3:return i===this.queryRunner?[3,5]:[4,i.release()];case 4:a.sent(),a.label=5;case 5:return this.connection.driver instanceof p.a?[4,this.connection.driver.autoSave()]:[3,7];case 6:a.sent(),a.label=7;case 7:return[7];case 8:return[2]}})})},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},e.prototype.clone=function(){return new this.constructor(this)},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},e.prototype.callListeners=function(e){return this.expressionMap.callListeners=e,this},e.prototype.useTransaction=function(e){return this.expressionMap.useTransaction=e,this},e.prototype.getTableName=function(e){var t=this;return e.split(".").map(function(e){return""===e?e:t.escape(e)}).join(".")},e.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new Error('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},e.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}var r="";if(e instanceof Function){var i=e(this.subQuery());this.setParameters(i.getParameters()),r=i.getQuery()}else r=e;var a=e instanceof Function||"("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tablePath:!1===a?e:void 0,subQuery:!0===a?r:void 0})},e.prototype.replacePropertyNames=function(e){var t=this;return this.expressionMap.aliases.forEach(function(n){if(n.hasMetadata){var i=t.expressionMap.aliasNamePrefixingEnabled?n.name+"\\.":"",a=t.expressionMap.aliasNamePrefixingEnabled?t.escape(n.name)+".":"";n.metadata.columns.forEach(function(n){var r="([ =(]|^.{0})"+i+n.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(r,"gm"),"$1"+a+t.escape(n.databaseName)+"$2");var o="([ =(]|^.{0})"+i+n.propertyName+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+a+t.escape(n.databaseName)+"$2")}),n.metadata.relations.forEach(function(n){if(r.f(n.joinColumns,n.inverseJoinColumns).forEach(function(r){var o="([ =(]|^.{0})"+i+n.propertyPath+"\\."+r.referencedColumn.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+a+t.escape(r.databaseName)+"$2")}),n.joinColumns.length>0){var o="([ =(]|^.{0})"+i+n.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+a+t.escape(n.joinColumns[0].databaseName)+"$2")}})}}),e},e.prototype.createWhereExpression=function(){var e=this.createWhereExpressionString();if(this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.discriminatorColumn.databaseName:t.discriminatorColumn.databaseName,r=this.replacePropertyNames(n)+" IN (:...discriminatorColumnValues)";return" WHERE "+(e.length?"("+e+") AND":"")+" "+r}}return e.length?this.expressionMap.extraAppendedAndWhereCondition?" WHERE ("+e+") AND "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):" WHERE "+e:this.expressionMap.extraAppendedAndWhereCondition?" WHERE "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):""},e.prototype.createReturningExpression=function(){var e=this,t=this.getReturningColumns(),n=this.connection.driver;if("string"!=typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&n.isReturningSqlSupported()&&t.push.apply(t,r.f(this.expressionMap.extraReturningColumns.filter(function(e){return-1===t.indexOf(e)}))),t.length){var i=t.map(function(t){var r=e.escape(t.databaseName);return n instanceof h.a?"insert"===e.expressionMap.queryType||"update"===e.expressionMap.queryType?"INSERTED."+r:e.escape(e.getMainTableName())+"."+r:r}).join(", ");return n instanceof d.a&&(i+=" INTO "+t.map(function(t){var r="output_"+t.databaseName;return e.expressionMap.nativeParameters[r]={type:n.columnTypeToNativeParameter(t.type),dir:n.oracle.BIND_OUT},e.connection.driver.createParameter(r,Object.keys(e.expressionMap.nativeParameters).length)}).join(", ")),i}return"string"==typeof this.expressionMap.returning?this.expressionMap.returning:""},e.prototype.getReturningColumns=function(){var e=this,t=[];return this.expressionMap.returning instanceof Array&&this.expressionMap.returning.forEach(function(n){e.expressionMap.mainAlias.hasMetadata&&t.push.apply(t,r.f(e.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n)))}),t},e.prototype.createWhereExpressionString=function(){var e=this;return this.expressionMap.wheres.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ")},e.prototype.createWhereIdsExpression=function(e){var t,n=this,r=this.expressionMap.mainAlias.metadata,i=(Array.isArray(e)?e:[e]).map(function(e){return r.ensureEntityIdMap(e)});if(!r.hasMultiplePrimaryKeys&&0===r.embeddeds.length){var a=r.primaryColumns[0];if(!a.transformer)return this.computeWhereParameter(((t={})[a.propertyName]=Object(v.a)(i.map(function(e){return a.getEntityValue(e,!1)})),t))}var o=this.expressionMap.aliasNamePrefixingEnabled?this.escape(this.expressionMap.mainAlias.name)+".":"",s=Object.keys(this.expressionMap.nativeParameters).length,u=i.map(function(e,t){var i=[];return r.primaryColumns.forEach(function(r,a){var u="id_"+t+"_"+a;i.push(o+n.escape(r.databaseName)+" = "+n.connection.driver.createParameter(u,s)),n.expressionMap.nativeParameters[u]=r.getEntityValue(e,!0),s++}),i.join(" AND ")});return u.length>1?"("+u.map(function(e){return"("+e+")"}).join(" OR ")+")":u[0]},e.prototype.computeWhereParameter=function(e){var t=this;if("string"==typeof e)return e;if(e instanceof l.a){var n=this.createQueryBuilder();e.whereFactory(n);var r=n.createWhereExpressionString();return this.setParameters(n.getParameters()),r?"("+r+")":""}if(e instanceof Function)return e(this);if(e instanceof Object){var i=e instanceof Array?e:[e],a=void 0,o=Object.keys(this.expressionMap.nativeParameters).length;return(a=this.expressionMap.mainAlias.hasMetadata?i.map(function(e,n){return f.a.createPropertyPath(t.expressionMap.mainAlias.metadata,e).map(function(r,i){return t.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(r).map(function(a,s){var u=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+r:a.propertyPath,c=a.getEntityValue(e,!0),l="where_"+n+"_"+i+"_"+s;if(null===c)return u+" IS NULL";if(c instanceof y.a){var f=[];if(c.useParameter)(c.multipleParameters?c.value:[c.value]).forEach(function(e,n){t.expressionMap.nativeParameters[l+n]=e,o++,f.push(t.connection.driver.createParameter(l+n,o-1))});return c.toSql(t.connection,u,f)}return t.expressionMap.nativeParameters[l]=c,o++,u+" = "+t.connection.driver.createParameter(l,o-1)}).filter(function(e){return!!e}).join(" AND ")}).filter(function(e){return!!e}).join(" AND ")}):i.map(function(e,n){return Object.keys(e).map(function(r,i){var a=e[r],o=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+r:r;if(null===a)return o+" IS NULL";var s="where_"+n+"_"+i;return t.expressionMap.nativeParameters[s]=a,i++,o+" = "+t.connection.driver.createParameter(s,i-1)}).join(" AND ")})).length>1?a.map(function(e){return"("+e+")"}).join(" OR "):a.join("")}return""},e.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("master")},e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return l});var r=n(0),i=n(18),a=n(188),o=n(31),s=n(38),u=n(1),c=n(5),l=function(t){function n(e){var n=t.call(this,e)||this;if(n.options.autoSave&&!n.options.location&&!n.options.autoSaveCallback)throw new s.a("location or autoSaveCallback");return n.loadDependencies(),n}return r.c(n,t),n.prototype.connect=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},n.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){try{e.queryRunner=void 0,e.databaseConnection.close(),t()}catch(e){n(e)}})]})})},n.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new a.a(this)),this.queryRunner},n.prototype.load=function(e,t){return void 0===t&&(t=!0),r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:if("string"!=typeof e)return[3,8];if("node"!==u.a.type)return[3,1];if(u.a.fileExist(e))return n=u.a.readFileSync(e),[2,this.createDatabaseConnectionWithImport(n)];if(t)throw new Error("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 1:return i=null,this.options.useLocalForage?window.localforage?[4,window.localforage.getItem(e)]:[3,3]:[3,5];case 2:return i=r.sent(),[3,4];case 3:throw new Error("localforage is not defined - please import localforage.js into your site");case 4:return[3,6];case 5:i=u.a.getGlobalVariable().localStorage.getItem(e),r.label=6;case 6:if(null!=i)return[2,this.createDatabaseConnectionWithImport(JSON.parse(i))];if(t)throw new Error("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 7:return[3,9];case 8:return[2,this.createDatabaseConnectionWithImport(e)];case 9:return[2]}})})},n.prototype.save=function(t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:if(!t&&!this.options.location)throw new Error("No location is set, specify a location parameter or add the location option to your configuration");if(n="",t?n=t:this.options.location&&(n=this.options.location),"node"!==u.a.type)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),i=new e(this.databaseConnection.export()),[4,u.a.writeFile(n,i)];case 2:return r.sent(),[3,4];case 3:throw a=r.sent(),new Error("Could not save database, error: "+a);case 4:return[3,10];case 5:return o=this.databaseConnection.export(),s=[].slice.call(o),this.options.useLocalForage?window.localforage?[4,window.localforage.setItem(n,JSON.stringify(s))]:[3,7]:[3,9];case 6:return r.sent(),[3,8];case 7:throw new Error("localforage is not defined - please import localforage.js into your site");case 8:return[3,10];case 9:u.a.getGlobalVariable().localStorage.setItem(n,JSON.stringify(s)),r.label=10;case 10:return[2]}})})},n.prototype.autoSave=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.prototype.export=function(){return this.databaseConnection.export()},n.prototype.createGeneratedMap=function(e,t){var n=this,r=e.generatedColumns.reduce(function(e,t){if(t.isPrimary&&"increment"===t.generationStrategy){var r="SELECT last_insert_rowid()";try{var i=n.databaseConnection.exec(r);return n.connection.logger.logQuery(r),c.a.mergeDeep(e,t.createValueMap(i[0].values[0][0]))}catch(e){n.connection.logger.logQueryError(e,r,[])}}return e},{});return Object.keys(r).length>0?r:void 0},n.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)},n.prototype.createDatabaseConnectionWithImport=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.d(this,function(n){return e&&e.length>0?this.databaseConnection=new this.sqlite.Database(e):this.databaseConnection=new this.sqlite.Database,[2,new Promise(function(e,n){try{t.databaseConnection.exec("PRAGMA foreign_keys = ON;"),e(t.databaseConnection)}catch(e){n(e)}})]})})},n.prototype.loadDependencies=function(){if("browser"===u.a.type)this.sqlite=window.SQL;else try{this.sqlite=u.a.load("sql.js")}catch(e){throw new o.a("sql.js","sql.js")}},n}(i.a)}).call(this,n(65).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(0),i=n(57),a=n(37),o=n(11),s=n(33),u=n(2),c=n(24),l=n(26),f=n(9),p=n(67),h=n(5),d=n(29),m=function(e){function t(){return e.call(this)||this}return r.c(t,e),t.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},t.prototype.release=function(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()},t.prototype.startTransaction=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:if(this.isTransactionActive)throw new i.a;if(this.isTransactionActive=!0,!e)return[3,4];if("READ UNCOMMITTED"!==e&&"SERIALIZABLE"!==e)throw new Error("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");return"READ UNCOMMITTED"!==e?[3,2]:[4,this.query("PRAGMA read_uncommitted = true")];case 1:return t.sent(),[3,4];case 2:return[4,this.query("PRAGMA read_uncommitted = false")];case 3:t.sent(),t.label=4;case 4:return[4,this.query("BEGIN TRANSACTION")];case 5:return t.sent(),[2]}})})},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by sqlite driver.")},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve(!1)]})})},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("This driver does not support table schemas")})})},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.d(this,function(r){switch(r.label){case 0:return t=e instanceof u.a?e.name:e,n='SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" = \''+t+"'",[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n=e instanceof u.a?e.name:e,i='PRAGMA table_info("'+n+'")',[4,this.query(i)];case 1:return[2,!!r.sent().find(function(e){return e.name===t})]}})})},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve()]})})},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve()]})})},t.prototype.dropSchema=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve()]})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,function(){var a,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return a=[],o=[],t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,function(){var a,o,s,c,l,f=this;return r.d(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof u.a?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,c=[],l=[],i&&o.indices.forEach(function(e){c.push(f.dropIndexSql(e)),l.push(f.createIndexSql(o,e))}),c.push(this.dropTableSql(o,t)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s,c=this;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).name=t,o='ALTER TABLE "'+n.name+'" RENAME TO "'+t+'"',s='ALTER TABLE "'+t+'" RENAME TO "'+n.name+'"',[4,this.executeQueries(o,s)];case 4:return r.sent(),n.name=a.name,a.uniques.forEach(function(e){e.name=c.connection.namingStrategy.uniqueConstraintName(a,e.columnNames)}),a.foreignKeys.forEach(function(e){e.name=c.connection.namingStrategy.foreignKeyName(a,e.columnNames)}),a.indices.forEach(function(e){e.name=c.connection.namingStrategy.indexName(a,e.columnNames,e.where)}),[4,this.recreateTable(a,n)];case 5:return r.sent(),[2]}})})},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,this.addColumns(n,[t])]}})})},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addColumn(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,s,c;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c=void 0,n instanceof o.a?c=n:(c=s.clone()).name=n,[2,this.changeColumn(i,s,c)]}})})},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return[4,this.changeColumns(i,[{oldColumn:s,newColumn:n}])];case 4:return r.sent(),[2]}})})},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o=this;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){e.newColumn.name!==e.oldColumn.name&&(a.findColumnUniques(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.uniqueConstraintName(a,t.columnNames)}),a.findColumnForeignKeys(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.foreignKeyName(a,t.columnNames)}),a.findColumnIndices(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.indexName(a,t.columnNames,t.where)}));var t=a.columns.find(function(t){return t.name===e.oldColumn.name});t&&(a.columns[a.columns.indexOf(t)]=e.newColumn)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return[4,this.dropColumns(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){a.removeColumn(e),a.findColumnUniques(e).forEach(function(e){return a.removeUniqueConstraint(e)}),a.findColumnIndices(e).forEach(function(e){return a.removeIndex(e)}),a.findColumnForeignKeys(e).forEach(function(e){return a.removeForeignKey(e)})}),[4,this.recreateTable(a,n)];case 4:return r.sent(),t.forEach(function(e){n.removeColumn(e),n.findColumnUniques(e).forEach(function(e){return n.removeUniqueConstraint(e)}),n.findColumnIndices(e).forEach(function(e){return n.removeIndex(e)}),n.findColumnForeignKeys(e).forEach(function(e){return n.removeForeignKey(e)})}),[2]}})})},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),n.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return e.sent(),[2]}})})},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,function(){var t,n,i;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return(i=(t=n).clone()).primaryColumns.forEach(function(e){e.isPrimary=!1}),[4,this.recreateTable(i,t)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(n){switch(n.label){case 0:return[4,this.createUniqueConstraints(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addUniqueConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof f.a?t:n.uniques.find(function(e){return e.name===t})))throw new Error("Supplied unique constraint was not found in table "+n.name);return[4,this.dropUniqueConstraints(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeUniqueConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(n){switch(n.label){case 0:return[4,this.createCheckConstraints(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addCheckConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.a?t:n.checks.find(function(e){return e.name===t})))throw new Error("Supplied check constraint was not found in table "+n.name);return[4,this.dropCheckConstraints(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeCheckConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Sqlite does not support exclusion constraints.")})})},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Sqlite does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Sqlite does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Sqlite does not support exclusion constraints.")})})},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(n){switch(n.label){case 0:return[4,this.createForeignKeys(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addForeignKey(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error("Supplied foreign key was not found in table "+n.name);return[4,this.dropForeignKeys(e,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeForeignKey(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s;return r.d(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.a?t:n.indices.find(function(e){return e.name===t})))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return r.b(this,void 0,void 0,function(){var e,t,n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return r.sent(),[4,this.startTransaction()];case 2:r.sent(),r.label=3;case 3:return r.trys.push([3,7,12,14]),"SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'",[4,this.query("SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'")];case 4:return e=r.sent(),[4,Promise.all(e.map(function(e){return n.query(e.query)}))];case 5:return r.sent(),[4,this.commitTransaction()];case 6:return r.sent(),[3,14];case 7:t=r.sent(),r.label=8;case 8:return r.trys.push([8,10,,11]),[4,this.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw t;case 12:return[4,this.query("PRAGMA foreign_keys = ON;")];case 13:return r.sent(),[7];case 14:return[2]}})})},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a=this;return r.d(this,function(s){switch(s.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" IN ('+t+")")]):[2,[]];case 1:return n=s.sent(),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'index\' AND "tbl_name" IN ('+t+")")];case 2:return i=s.sent(),n&&n.length?[2,Promise.all(n.map(function(e){return r.b(a,void 0,void 0,function(){var t,n,a,s,p,m,y,v,g,b,E,T,w,N,C,S,A,O,R=this;return r.d(this,function(M){switch(M.label){case 0:return t=new u.a({name:e.name}),n=e.sql,[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:return a=r.e.apply(void 0,[M.sent(),3]),s=a[0],p=a[1],m=a[2],y=void 0,v=e.sql,-1!==(g=v.toUpperCase().indexOf("AUTOINCREMENT"))&&(y=v.substr(0,g),b=y.lastIndexOf(","),E=y.lastIndexOf("("),-1!==b?y=(y=(y=y.substr(b)).substr(0,y.lastIndexOf('"'))).substr(y.indexOf('"')+1):-1!==E&&(y=(y=(y=y.substr(E)).substr(0,y.lastIndexOf('"'))).substr(y.indexOf('"')+1))),t.columns=s.map(function(e){var t=new o.a;if(t.name=e.name,t.type=e.type.toLowerCase(),t.default=null!==e.dflt_value&&void 0!==e.dflt_value?e.dflt_value:void 0,t.isNullable=0===e.notnull,t.isPrimary=e.pk>0,t.comment="",t.isGenerated=y===e.name,t.isGenerated&&(t.generationStrategy="increment"),"varchar"===t.type){var r=n.match(new RegExp('"('+t.name+")\" varchar CHECK\\s*\\(\\s*\\1\\s+IN\\s*\\(('[^']+'(?:\\s*,\\s*'[^']+')+)\\s*\\)\\s*\\)"));r&&(t.type="simple-enum",t.enum=r[2].substr(1,r[2].length-2).split("','"))}var i=t.type.indexOf("(");if(-1!==i){var a=t.type.substr(0,i);if(R.driver.withLengthColumnTypes.find(function(e){return e===a})){var s=parseInt(t.type.substring(i+1,t.type.length-1));s&&(t.length=s.toString(),t.type=a)}}return t}),T=h.a.uniq(m,function(e){return e.id}),t.foreignKeys=T.map(function(e){var n=m.filter(function(t){return t.id===e.id&&t.table===e.table}),r=n.map(function(e){return e.from}),i=n.map(function(e){return e.to}),a=R.connection.namingStrategy.foreignKeyName(t,r);return new l.a({name:a,columnNames:r,referencedTableName:e.table,referencedColumnNames:i,onDelete:e.on_delete,onUpdate:e.on_update})}),w=p.filter(function(e){return"u"===e.origin}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){return r.b(R,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return n=p.find(function(t){return t.name===e}),[4,this.query('PRAGMA index_info("'+n.name+'")')];case 1:return i=r.sent(),1===(a=i.sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name})).length&&(o=t.columns.find(function(e){return!!a.find(function(t){return t===e.name})}))&&(o.isUnique=!0),[2,new f.a({name:this.connection.namingStrategy.uniqueConstraintName(t,a),columnNames:a})]}})})}),N=t,[4,Promise.all(w)];case 2:for(N.uniques=M.sent(),S=/CONSTRAINT "([^"]*)" CHECK (\(.*?\))([,]|[)]$)/g;null!==(C=S.exec(n));)t.checks.push(new d.a({name:C[1],expression:C[2]}));return A=p.filter(function(e){return"c"===e.origin}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){return r.b(R,void 0,void 0,function(){var n,a,o,s,u,l;return r.d(this,function(r){switch(r.label){case 0:return n=i.find(function(t){return t.name===e}),a=/WHERE (.*)/.exec(n.sql),o=p.find(function(t){return t.name===e}),[4,this.query('PRAGMA index_info("'+o.name+'")')];case 1:return s=r.sent(),u=s.sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name}),l="1"===o.unique||1===o.unique,[2,new c.a({table:t,name:o.name,columnNames:u,isUnique:l,where:a?a[1]:void 0})]}})})}),[4,Promise.all(A)];case 3:return O=M.sent(),t.indices=O.filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.filter(function(e){return e.isPrimary}),i=r.find(function(e){return e.isGenerated&&"increment"===e.generationStrategy}),a=r.length>1;if(a&&i)throw new Error("Sqlite does not support AUTOINCREMENT on composite primary key");var o=e.columns.map(function(e){return n.buildCreateColumnSql(e,a)}).join(", "),s='CREATE TABLE "'+e.name+'" ('+o;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new f.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),e.uniques.length>0)&&(s+=", "+e.uniques.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map(function(e){return'"'+e+'"'}).join(", ")+")"}).join(", "));e.checks.length>0&&(s+=", "+e.checks.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"}).join(", "));e.foreignKeys.length>0&&t&&(s+=", "+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames));var i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'" ('+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a}).join(", "));r.length>1&&(s+=", PRIMARY KEY ("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")");return s+=")"},t.prototype.dropTableSql=function(e,t){var n=e instanceof u.a?e.name:e;return t?'DROP TABLE IF EXISTS "'+n+'"':'DROP TABLE "'+n+'"'},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return"CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e.name+'" ('+n+") "+(t.where?"WHERE "+t.where:"")},t.prototype.dropIndexSql=function(e){return'DROP INDEX "'+(e instanceof c.a?e.name:e)+'"'},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return e instanceof s.a?n+=" "+this.driver.normalizeType(e):n+=" "+this.connection.driver.createFullType(e),e.enum&&(n+=" CHECK( "+e.name+" IN ("+e.enum.map(function(e){return"'"+e+"'"}).join(",")+") )"),e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(n+=" AUTOINCREMENT"),e.collation&&(n+=" COLLATE "+e.collation),!0!==e.isNullable&&(n+=" NOT NULL"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT ("+e.default+")"),n},t.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),r.b(this,void 0,void 0,function(){var i,a,o,s,u=this;return r.d(this,function(r){switch(r.label){case 0:return i=[],a=[],t.indices.forEach(function(e){i.push(u.dropIndexSql(e)),a.push(u.createIndexSql(t,e))}),e.name="temporary_"+e.name,i.push(this.createTableSql(e,!0)),a.push(this.dropTableSql(e)),n&&(o=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),s=t.columns.map(function(e){return'"'+e.name+'"'}).join(", "),t.columns.length<e.columns.length?o=e.columns.filter(function(e){return t.columns.find(function(t){return t.name===e.name})}).map(function(e){return'"'+e.name+'"'}).join(", "):t.columns.length>e.columns.length&&(s=t.columns.filter(function(t){return e.columns.find(function(e){return e.name===t.name})}).map(function(e){return'"'+e.name+'"'}).join(", ")),i.push('INSERT INTO "'+e.name+'"('+o+") SELECT "+s+' FROM "'+t.name+'"'),a.push('INSERT INTO "'+t.name+'"('+s+") SELECT "+o+' FROM "'+e.name+'"')),i.push(this.dropTableSql(t)),a.push(this.createTableSql(t,!0)),i.push('ALTER TABLE "'+e.name+'" RENAME TO "'+t.name+'"'),a.push('ALTER TABLE "'+t.name+'" RENAME TO "'+e.name+'"'),e.name=t.name,e.indices.forEach(function(t){t.name||(t.name=u.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),i.push(u.createIndexSql(e,t)),a.push(u.dropIndexSql(t))}),[4,this.executeQueries(i,a)];case 1:return r.sent(),this.replaceCachedTable(t,e),[2]}})})},t}(p.a)},function(e,t,n){"use strict";var r=n(15);e.exports=function(e,t){return!!e&&r(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.sha1=function(e){var t,n,r,i,a,o,s,u,c,l=function(e,t){return e<<t|e>>>32-t},f=function(e){var t,n="";for(t=7;t>=0;t--)n+=(e>>>4*t&15).toString(16);return n},p=new Array(80),h=1732584193,d=4023233417,m=2562383102,y=271733878,v=3285377520,g=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<g-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(g%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(g-1)<<24|8388608;break;case 2:n=e.charCodeAt(g-2)<<24|e.charCodeAt(g-1)<<16|32768;break;case 3:n=e.charCodeAt(g-3)<<24|e.charCodeAt(g-2)<<16|e.charCodeAt(g-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(g>>>29),b.push(g<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)p[n]=b[t+n];for(n=16;n<=79;n++)p[n]=l(p[n-3]^p[n-8]^p[n-14]^p[n-16],1);for(i=h,a=d,o=m,s=y,u=v,n=0;n<=19;n++)c=l(i,5)+(a&o|~a&s)+u+p[n]+1518500249&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(a^o^s)+u+p[n]+1859775393&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(a&o|a&s|o&s)+u+p[n]+2400959708&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(a^o^s)+u+p[n]+3395469782&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;h=h+i&4294967295,d=d+a&4294967295,m=m+o&4294967295,y=y+s&4294967295,v=v+u&4294967295}return(c=f(h)+f(d)+f(m)+f(y)+f(v)).toLowerCase()},e.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e}()},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(91),i=n(68),a=n(47),o=n(63),s=n(45),u=n(147),c=Object.getOwnPropertyDescriptor;t.f=n(34)?c:function(e,t){if(e=a(e),t=o(t,!0),u)try{return c(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(4),i=n(35),a=n(15);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(e,t,n){var r=n(58),i=n(90),a=n(41),o=n(27),s=n(299);e.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,f=6==e,p=5==e||f,h=t||s;return function(t,s,d){for(var m,y,v=a(t),g=i(v),b=r(s,d,3),E=o(g.length),T=0,w=n?h(t,E):u?h(t,0):void 0;E>T;T++)if((p||T in g)&&(y=b(m=g[T],T,v),e))if(n)w[T]=y;else if(y)switch(e){case 3:return!0;case 5:return m;case 6:return T;case 2:w.push(m)}else if(l)return!1;return f?-1:c||l?l:w}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="TransactionAlreadyStartedError",Object.setPrototypeOf(n,t.prototype),n.message="Transaction already started for the given connection, commit current transaction before starting a new one.",n}return r.c(t,e),t}(Error)},function(e,t,n){var r=n(59);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";if(n(34)){var r=n(70),i=n(14),a=n(15),o=n(4),s=n(106),u=n(141),c=n(58),l=n(82),f=n(68),p=n(46),h=n(83),d=n(53),m=n(27),y=n(173),v=n(72),g=n(63),b=n(45),E=n(92),T=n(17),w=n(41),N=n(133),C=n(73),S=n(75),A=n(74).f,O=n(135),R=n(69),M=n(22),_=n(56),P=n(96),x=n(93),I=n(137),L=n(79),j=n(99),D=n(81),k=n(136),q=n(164),B=n(30),U=n(54),F=B.f,V=U.f,Q=i.RangeError,K=i.TypeError,W=i.Uint8Array,H=Array.prototype,Y=u.ArrayBuffer,z=u.DataView,J=_(0),G=_(2),X=_(3),Z=_(4),$=_(5),ee=_(6),te=P(!0),ne=P(!1),re=I.values,ie=I.keys,ae=I.entries,oe=H.lastIndexOf,se=H.reduce,ue=H.reduceRight,ce=H.join,le=H.sort,fe=H.slice,pe=H.toString,he=H.toLocaleString,de=M("iterator"),me=M("toStringTag"),ye=R("typed_constructor"),ve=R("def_constructor"),ge=s.CONSTR,be=s.TYPED,Ee=s.VIEW,Te=_(1,function(e,t){return Ae(x(e,e[ve]),t)}),we=a(function(){return 1===new W(new Uint16Array([1]).buffer)[0]}),Ne=!!W&&!!W.prototype.set&&a(function(){new W(1).set({})}),Ce=function(e,t){var n=d(e);if(n<0||n%t)throw Q("Wrong offset!");return n},Se=function(e){if(T(e)&&be in e)return e;throw K(e+" is not a typed array!")},Ae=function(e,t){if(!(T(e)&&ye in e))throw K("It is not a typed array constructor!");return new e(t)},Oe=function(e,t){return Re(x(e,e[ve]),t)},Re=function(e,t){for(var n=0,r=t.length,i=Ae(e,r);r>n;)i[n]=t[n++];return i},Me=function(e,t,n){F(e,t,{get:function(){return this._d[n]}})},_e=function(e){var t,n,r,i,a,o,s=w(e),u=arguments.length,l=u>1?arguments[1]:void 0,f=void 0!==l,p=O(s);if(null!=p&&!N(p)){for(o=p.call(s),r=[],t=0;!(a=o.next()).done;t++)r.push(a.value);s=r}for(f&&u>2&&(l=c(l,arguments[2],2)),t=0,n=m(s.length),i=Ae(this,n);n>t;t++)i[t]=f?l(s[t],t):s[t];return i},Pe=function(){for(var e=0,t=arguments.length,n=Ae(this,t);t>e;)n[e]=arguments[e++];return n},xe=!!W&&a(function(){he.call(new W(1))}),Ie=function(){return he.apply(xe?fe.call(Se(this)):Se(this),arguments)},Le={copyWithin:function(e,t){return q.call(Se(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return Z(Se(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return k.apply(Se(this),arguments)},filter:function(e){return Oe(this,G(Se(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return $(Se(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Se(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){J(Se(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(Se(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Se(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ce.apply(Se(this),arguments)},lastIndexOf:function(e){return oe.apply(Se(this),arguments)},map:function(e){return Te(Se(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return se.apply(Se(this),arguments)},reduceRight:function(e){return ue.apply(Se(this),arguments)},reverse:function(){for(var e,t=Se(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return X(Se(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return le.call(Se(this),e)},subarray:function(e,t){var n=Se(this),r=n.length,i=v(e,r);return new(x(n,n[ve]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,m((void 0===t?r:v(t,r))-i))}},je=function(e,t){return Oe(this,fe.call(Se(this),e,t))},De=function(e){Se(this);var t=Ce(arguments[1],1),n=this.length,r=w(e),i=m(r.length),a=0;if(i+t>n)throw Q("Wrong length!");for(;a<i;)this[t+a]=r[a++]},ke={entries:function(){return ae.call(Se(this))},keys:function(){return ie.call(Se(this))},values:function(){return re.call(Se(this))}},qe=function(e,t){return T(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Be=function(e,t){return qe(e,t=g(t,!0))?f(2,e[t]):V(e,t)},Ue=function(e,t,n){return!(qe(e,t=g(t,!0))&&T(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?F(e,t,n):(e[t]=n.value,e)};ge||(U.f=Be,B.f=Ue),o(o.S+o.F*!ge,"Object",{getOwnPropertyDescriptor:Be,defineProperty:Ue}),a(function(){pe.call({})})&&(pe=he=function(){return ce.call(this)});var Fe=h({},Le);h(Fe,ke),p(Fe,de,ke.values),h(Fe,{slice:je,set:De,constructor:function(){},toString:pe,toLocaleString:Ie}),Me(Fe,"buffer","b"),Me(Fe,"byteOffset","o"),Me(Fe,"byteLength","l"),Me(Fe,"length","e"),F(Fe,me,{get:function(){return this[be]}}),e.exports=function(e,t,n,u){var c=e+((u=!!u)?"Clamped":"")+"Array",f="get"+e,h="set"+e,d=i[c],v=d||{},g=d&&S(d),b=!d||!s.ABV,w={},N=d&&d.prototype,O=function(e,n){F(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[f](n*t+r.o,we)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;u&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[h](n*t+i.o,r,we)}(this,n,e)},enumerable:!0})};b?(d=n(function(e,n,r,i){l(e,d,c,"_d");var a,o,s,u,f=0,h=0;if(T(n)){if(!(n instanceof Y||"ArrayBuffer"==(u=E(n))||"SharedArrayBuffer"==u))return be in n?Re(d,n):_e.call(d,n);a=n,h=Ce(r,t);var v=n.byteLength;if(void 0===i){if(v%t)throw Q("Wrong length!");if((o=v-h)<0)throw Q("Wrong length!")}else if((o=m(i)*t)+h>v)throw Q("Wrong length!");s=o/t}else s=y(n),a=new Y(o=s*t);for(p(e,"_d",{b:a,o:h,l:o,e:s,v:new z(a)});f<s;)O(e,f++)}),N=d.prototype=C(Fe),p(N,"constructor",d)):a(function(){d(1)})&&a(function(){new d(-1)})&&j(function(e){new d,new d(null),new d(1.5),new d(e)},!0)||(d=n(function(e,n,r,i){var a;return l(e,d,c),T(n)?n instanceof Y||"ArrayBuffer"==(a=E(n))||"SharedArrayBuffer"==a?void 0!==i?new v(n,Ce(r,t),i):void 0!==r?new v(n,Ce(r,t)):new v(n):be in n?Re(d,n):_e.call(d,n):new v(y(n))}),J(g!==Function.prototype?A(v).concat(A(g)):A(v),function(e){e in d||p(d,e,v[e])}),d.prototype=N,r||(N.constructor=d));var R=N[de],M=!!R&&("values"==R.name||null==R.name),_=ke.values;p(d,ye,!0),p(N,be,c),p(N,Ee,!0),p(N,ve,d),(u?new d(1)[me]==c:me in N)||F(N,me,{get:function(){return c}}),w[c]=d,o(o.G+o.W+o.F*(d!=v),w),o(o.S,c,{BYTES_PER_ELEMENT:t}),o(o.S+o.F*a(function(){v.of.call(d,1)}),c,{from:_e,of:Pe}),"BYTES_PER_ELEMENT"in N||p(N,"BYTES_PER_ELEMENT",t),o(o.P,c,Le),D(c),o(o.P+o.F*Ne,c,{set:De}),o(o.P+o.F*!M,c,ke),r||N.toString==pe||(N.toString=pe),o(o.P+o.F*a(function(){new d(1).slice()}),c,{slice:je}),o(o.P+o.F*(a(function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()})||!a(function(){N.toLocaleString.call([1,2])})),c,{toLocaleString:Ie}),L[c]=M?R:_,r||M||p(N,de,_)}}else e.exports=function(){}},function(e,t,n){var r=n(17);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(69)("meta"),i=n(17),a=n(45),o=n(30).f,s=0,u=Object.isExtensible||function(){return!0},c=!n(15)(function(){return u(Object.preventExtensions({}))}),l=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},f=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!a(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&f.NEED&&u(e)&&!a(e,r)&&l(e),e}}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(374),i=n(375),a=n(376);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=p(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|h(t.length);return 0===(e=s(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):p(e,t);if("Buffer"===t.type&&a(t.data))return p(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=s(e,t<0?0:0|h(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|h(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function d(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return U(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var f=!0,p=0;p<u;p++)if(c(e,a+p)!==c(t,p)){f=!1;break}if(f)return a}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,r){return V(U(t,e.length-n),e,n,r)}function E(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function T(e,t,n,r){return E(e,t,n,r)}function w(e,t,n,r){return V(F(t),e,n,r)}function N(e,t,n,r){return V(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[i+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=A));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return f(null,e)},u.allocUnsafeSlow=function(e){return f(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),f=0;f<s;++f)if(c[f]!==l[f]){a=c[f],o=l[f];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return T(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function R(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function M(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=B(e[a]);return i}function _(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function I(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function L(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function j(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(e,t,n,r,a){return a||j(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function k(e,t,n,r,a){return a||j(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||x(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||x(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return D(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return D(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return k(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return k(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:U(new u(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var q=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(94))},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(0),i=n(36),a=n(2),o=n(11),s=n(26),u=n(24),c=n(7),l=n(89),f=n(3),p=n(9),h=n(29),d=n(77),m=function(){function e(e){this.connection=e}return e.prototype.build=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.d(this,function(n){switch(n.label){case 0:return this.queryRunner=this.connection.createQueryRunner("master"),this.connection.driver instanceof i.a?[3,2]:[4,this.queryRunner.startTransaction()];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,9,15,17]),e=this.entityToSyncMetadatas.map(function(e){return e.tablePath}),[4,this.queryRunner.getTables(e)];case 3:return n.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 4:return n.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,6];case 5:n.sent(),n.label=6;case 6:return this.connection.driver instanceof i.a?[3,8]:[4,this.queryRunner.commitTransaction()];case 7:n.sent(),n.label=8;case 8:return[3,17];case 9:t=n.sent(),n.label=10;case 10:return n.trys.push([10,13,,14]),this.connection.driver instanceof i.a?[3,12]:[4,this.queryRunner.rollbackTransaction()];case 11:n.sent(),n.label=12;case 12:return[3,14];case 13:return n.sent(),[3,14];case 14:throw t;case 15:return[4,this.queryRunner.release()];case 16:return n.sent(),[7];case 17:return[2]}})})},e.prototype.log=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:this.queryRunner=this.connection.createQueryRunner("master"),t.label=1;case 1:return t.trys.push([1,,6,8]),e=this.entityToSyncMetadatas.map(function(e){return e.tablePath}),[4,this.queryRunner.getTables(e)];case 2:return t.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 3:return t.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,5];case 4:t.sent(),t.label=5;case 5:return[2,this.queryRunner.getMemorySql()];case 6:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 7:return t.sent(),[7];case 8:return[2]}})})},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter(function(e){return e.synchronize&&"entity-child"!==e.tableType})},enumerable:!0,configurable:!0}),e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return[4,this.dropOldForeignKeys()];case 1:return e.sent(),[4,this.dropOldIndices()];case 2:return e.sent(),[4,this.dropOldChecks()];case 3:return e.sent(),[4,this.dropOldExclusions()];case 4:return e.sent(),[4,this.dropCompositeUniqueConstraints()];case 5:return e.sent(),[4,this.renameColumns()];case 6:return e.sent(),[4,this.createNewTables()];case 7:return e.sent(),[4,this.dropRemovedColumns()];case 8:return e.sent(),[4,this.addNewColumns()];case 9:return e.sent(),[4,this.updatePrimaryKeys()];case 10:return e.sent(),[4,this.updateExistColumns()];case 11:return e.sent(),[4,this.createNewIndices()];case 12:return e.sent(),[4,this.createNewChecks()];case 13:return e.sent(),[4,this.createNewExclusions()];case 14:return e.sent(),[4,this.createCompositeUniqueConstraints()];case 15:return e.sent(),[4,this.createForeignKeys()];case 16:return e.sent(),[2]}})})},e.prototype.dropOldForeignKeys=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=e.foreignKeys.filter(function(e){var n=t.foreignKeys.find(function(t){return t.name===e.name});return!n||n.onDelete&&n.onDelete!==e.onDelete||n.onUpdate&&n.onUpdate!==e.onUpdate})).length?[2]:(this.connection.logger.logSchemaBuild("dropping old foreign keys of "+e.name+": "+n.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.dropForeignKeys(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.renameTables=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){return r.d(this,function(e){return[2]})})})];case 1:return t.sent(),[2]}})})},e.prototype.renameColumns=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n,i,a,o=this;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?t.columns.length!==e.columns.length?[2]:0===(n=t.columns.filter(function(t){return!e.columns.find(function(e){return e.name===t.databaseName&&e.type===o.connection.driver.normalizeType(t)&&e.isNullable===t.isNullable&&e.isUnique===o.connection.driver.normalizeIsUnique(t)})})).length||n.length>1?[2]:0===(i=e.columns.filter(function(e){return!t.columns.find(function(t){return t.databaseName===e.name&&o.connection.driver.normalizeType(t)===e.type&&t.isNullable===e.isNullable&&o.connection.driver.normalizeIsUnique(t)===e.isUnique})})).length||i.length>1?[2]:((a=i[0].clone()).name=n[0].databaseName,this.connection.logger.logSchemaBuild('renaming column "'+i[0].name+'" in to "'+a.name+'"'),[4,this.queryRunner.renameColumn(e,i[0],a)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropOldIndices=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n,i=this;return r.d(this,function(a){switch(a.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?(n=e.indices.filter(function(e){var n=t.indices.find(function(t){return t.name===e.name});return!n||!1!==n.synchronize&&(n.isUnique!==e.isUnique||(n.isSpatial!==e.isSpatial||(n.isFulltext!==e.isFulltext||(n.columns.length!==e.columnNames.length||!n.columns.every(function(t){return-1!==e.columnNames.indexOf(t.databaseName)})))))}).map(function(t){return r.b(i,void 0,void 0,function(){return r.d(this,function(n){switch(n.label){case 0:return this.connection.logger.logSchemaBuild('dropping an index: "'+t.name+'" from table '+e.name),[4,this.queryRunner.dropIndex(e,t)];case 1:return n.sent(),[2]}})})}),[4,Promise.all(n)]):[2];case 1:return a.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropOldChecks=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return this.connection.driver instanceof f.e?[2]:[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=e.checks.filter(function(e){return!t.checks.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping old check constraint: "+n.map(function(e){return'"'+e.name+'"'}).join(", ")+' from table "'+e.name+'"'),[4,this.queryRunner.dropCheckConstraints(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropCompositeUniqueConstraints=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=e.uniques.filter(function(e){return e.columnNames.length>1&&!t.uniques.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping old unique constraint: "+n.map(function(e){return'"'+e.name+'"'}).join(", ")+' from table "'+e.name+'"'),[4,this.queryRunner.dropUniqueConstraints(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropOldExclusions=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return this.connection.driver instanceof f.g?[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=e.exclusions.filter(function(e){return!t.exclusions.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping old exclusion constraint: "+n.map(function(e){return'"'+e.name+'"'}).join(", ")+' from table "'+e.name+'"'),[4,this.queryRunner.dropExclusionConstraints(e,n)]):[2];case 1:return r.sent(),[2]}})})})]:[2];case 1:return t.sent(),[2]}})})},e.prototype.createNewTables=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n=this;return r.d(this,function(r){switch(r.label){case 0:return this.queryRunner.loadedTables.find(function(e){var r=t.database&&t.database!==n.connection.driver.database?t.database:void 0,i=t.schema||n.connection.driver.options.schema,a=n.connection.driver.buildTableName(t.tableName,i,r);return e.name===a})?[2]:(this.connection.logger.logSchemaBuild("creating a new table: "+t.tablePath),e=a.a.create(t,this.connection.driver),[4,this.queryRunner.createTable(e,!1,!1)]);case 1:return r.sent(),this.queryRunner.loadedTables.push(e),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropRemovedColumns=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=e.columns.filter(function(e){return!t.columns.find(function(t){return t.databaseName===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild("columns dropped in "+e.name+": "+n.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.dropColumns(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.addNewColumns=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n,i,a;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=t.columns.filter(function(t){return!e.columns.find(function(e){return e.name===t.databaseName})})).length?[2]:(i=this.metadataColumnsToTableColumnOptions(n),0===(a=i.map(function(e){return new o.a(e)})).length?[2]:(this.connection.logger.logSchemaBuild("new columns added: "+n.map(function(e){return e.databaseName}).join(", ")),[4,this.queryRunner.addColumns(e,a)])):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n,i,a=this;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?(n=t.columns.filter(function(e){return e.isPrimary}),e.columns.filter(function(e){return e.isPrimary}).length!==n.length&&n.length>1?(i=n.map(function(e){return new o.a(l.a.createTableColumnOptions(e,a.connection.driver))}),[4,this.queryRunner.updatePrimaryKeys(e,i)]):[3,2]):[2];case 1:r.sent(),r.label=2;case 2:return[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.updateExistColumns=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n,i,a=this;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=this.connection.driver.findChangedColumns(e.columns,t.columns)).length?[2]:[4,c.a.runInSequence(n,function(e){return a.dropColumnReferencedForeignKeys(t.tablePath,e.databaseName)})]:[2];case 1:return r.sent(),[4,c.a.runInSequence(n,function(e){return a.dropColumnCompositeIndices(t.tablePath,e.databaseName)})];case 2:return r.sent(),this.connection.driver instanceof f.e?[3,4]:[4,c.a.runInSequence(n,function(e){return a.dropColumnCompositeUniques(t.tablePath,e.databaseName)})];case 3:r.sent(),r.label=4;case 4:return 0===(i=n.map(function(t){var n=e.columns.find(function(e){return e.name===t.databaseName}),r=l.a.createTableColumnOptions(t,a.connection.driver);return{oldColumn:n,newColumn:new o.a(r)}})).length?[2]:(this.connection.logger.logSchemaBuild('columns changed in "'+e.name+'". updating: '+n.map(function(e){return e.databaseName}).join(", ")),[4,this.queryRunner.changeColumns(e,i)]);case 5:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createNewIndices=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=t.indices.filter(function(t){return!e.indices.find(function(e){return e.name===t.name})&&!0===t.synchronize}).map(function(e){return u.a.create(e)})).length?[2]:(this.connection.logger.logSchemaBuild("adding new indices "+n.map(function(e){return'"'+e.name+'"'}).join(", ")+' in table "'+e.name+'"'),[4,this.queryRunner.createIndices(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createNewChecks=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return this.connection.driver instanceof f.e?[2]:[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=t.checks.filter(function(t){return!e.checks.find(function(e){return e.name===t.name})}).map(function(e){return h.a.create(e)})).length?[2]:(this.connection.logger.logSchemaBuild("adding new check constraints: "+n.map(function(e){return'"'+e.name+'"'}).join(", ")+' in table "'+e.name+'"'),[4,this.queryRunner.createCheckConstraints(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createCompositeUniqueConstraints=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=t.uniques.filter(function(t){return t.columns.length>1&&!e.uniques.find(function(e){return e.name===t.name})}).map(function(e){return p.a.create(e)})).length?[2]:(this.connection.logger.logSchemaBuild("adding new unique constraints: "+n.map(function(e){return'"'+e.name+'"'}).join(", ")+' in table "'+e.name+'"'),[4,this.queryRunner.createUniqueConstraints(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createNewExclusions=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return this.connection.driver instanceof f.g?[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=t.exclusions.filter(function(t){return!e.exclusions.find(function(e){return e.name===t.name})}).map(function(e){return d.a.create(e)})).length?[2]:(this.connection.logger.logSchemaBuild("adding new exclusion constraints: "+n.map(function(e){return'"'+e.name+'"'}).join(", ")+' in table "'+e.name+'"'),[4,this.queryRunner.createExclusionConstraints(e,n)]):[2];case 1:return r.sent(),[2]}})})})]:[2];case 1:return t.sent(),[2]}})})},e.prototype.createForeignKeys=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,function(t){return r.b(e,void 0,void 0,function(){var e,n,i;return r.d(this,function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find(function(e){return e.name===t.tablePath}))?0===(n=t.foreignKeys.filter(function(t){return!e.foreignKeys.find(function(e){return e.name===t.name})})).length?[2]:(i=n.map(function(e){return s.a.create(e)}),this.connection.logger.logSchemaBuild("creating a foreign keys: "+n.map(function(e){return e.name}).join(", ")+' on table "'+e.name+'"'),[4,this.queryRunner.createForeignKeys(e,i)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find(function(t){return t.name===e}))?(i=[],(a=n.foreignKeys.find(function(e){return-1!==e.columnNames.indexOf(t)}))&&((o=n.clone()).foreignKeys=[a],i.push(o),n.removeForeignKey(a)),this.queryRunner.loadedTables.forEach(function(n){var r=n.foreignKeys.filter(function(n){return n.referencedTableName===e&&-1!==n.referencedColumnNames.indexOf(t)});if(r.length>0){var a=n.clone();a.foreignKeys=r,i.push(a),r.forEach(function(e){return n.removeForeignKey(e)})}}),i.length>0?[4,c.a.runInSequence(i,function(e){return s.connection.logger.logSchemaBuild("dropping related foreign keys of "+e.name+": "+e.foreignKeys.map(function(e){return e.name}).join(", ")),s.queryRunner.dropForeignKeys(e,e.foreignKeys)})]:[3,2]):[2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},e.prototype.dropColumnCompositeIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find(function(t){return t.name===e}))?0===(i=n.indices.filter(function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)})).length?[2]:(this.connection.logger.logSchemaBuild('dropping related indices of "'+e+'"."'+t+'": '+i.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.dropIndices(n,i)]):[2];case 1:return r.sent(),[2]}})})},e.prototype.dropColumnCompositeUniques=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find(function(t){return t.name===e}))?0===(i=n.uniques.filter(function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)})).length?[2]:(this.connection.logger.logSchemaBuild('dropping related unique constraints of "'+e+'"."'+t+'": '+i.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.dropUniqueConstraints(n,i)]):[2];case 1:return r.sent(),[2]}})})},e.prototype.metadataColumnsToTableColumnOptions=function(e){var t=this;return e.map(function(e){return l.a.createTableColumnOptions(e,t.connection.driver)})},e}()},function(e,t,n){"use strict";var r=n(0),i=function(){return function(){this.upQueries=[],this.downQueries=[]}}(),a=n(7);n.d(t,"a",function(){return o});var o=function(){function e(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.sqlMemoryMode=!1,this.sqlInMemory=new i}return e.prototype.getTable=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadTables([e])];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables.length>0?this.loadedTables[0]:void 0]}})})},e.prototype.getTables=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadTables(e)];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables]}})})},e.prototype.enableSqlMemory=function(){this.sqlInMemory=new i,this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlInMemory=new i,this.sqlMemoryMode=!1},e.prototype.clearSqlMemory=function(){this.sqlInMemory=new i},e.prototype.getMemorySql=function(){return this.sqlInMemory},e.prototype.executeMemoryUpSql=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,a.a.runInSequence(this.sqlInMemory.upQueries,function(t){return e.query(t)})];case 1:return t.sent(),[2]}})})},e.prototype.executeMemoryDownSql=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){switch(t.label){case 0:return[4,a.a.runInSequence(this.sqlInMemory.downQueries.reverse(),function(t){return e.query(t)})];case 1:return t.sent(),[2]}})})},e.prototype.getCachedTable=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.d(this,function(r){switch(r.label){case 0:return(t=this.loadedTables.find(function(t){return t.name===e}))?[2,t]:[4,this.loadTables([e])];case 1:if((n=r.sent()).length>0)return this.loadedTables.push(n[0]),[2,n[0]];throw new Error('Table "'+e+'" does not exist.')}})})},e.prototype.replaceCachedTable=function(e,t){var n=this.loadedTables.find(function(t){return t.name===e.name});n&&(n.name=t.name,n.columns=t.columns,n.indices=t.indices,n.foreignKeys=t.foreignKeys,n.uniques=t.uniques,n.checks=t.checks,n.justCreated=t.justCreated,n.engine=t.engine)},e.prototype.isColumnChanged=function(e,t,n,r){return e.charset!==t.charset||e.collation!==t.collation||e.precision!==t.precision||e.scale!==t.scale||e.width!==t.width||e.zerofill!==t.zerofill||e.unsigned!==t.unsigned||e.asExpression!==t.asExpression||n&&e.default!==t.default||e.onUpdate!==t.onUpdate||e.isNullable!==t.isNullable||r&&e.comment!==t.comment||e.enum!==t.enum},e.prototype.isDefaultColumnLength=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&r.length)return!1}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].length)&&this.connection.driver.dataTypeDefaults[t.type].length.toString()===n.toString()},e.prototype.isDefaultColumnWidth=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&r.width)return!1}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].width)&&this.connection.driver.dataTypeDefaults[t.type].width===n},e.prototype.isDefaultColumnPrecision=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.precision&&void 0!==r.precision)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].precision||void 0===this.connection.driver.dataTypeDefaults[t.type].precision)&&this.connection.driver.dataTypeDefaults[t.type].precision===n},e.prototype.isDefaultColumnScale=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.scale&&void 0!==r.scale)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].scale||void 0===this.connection.driver.dataTypeDefaults[t.type].scale)&&this.connection.driver.dataTypeDefaults[t.type].scale===n},e.prototype.executeQueries=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,o=this;return r.d(this,function(s){switch(s.label){case 0:return"string"==typeof e&&(e=[e]),"string"==typeof t&&(t=[t]),(n=this.sqlInMemory.upQueries).push.apply(n,r.f(e)),(i=this.sqlInMemory.downQueries).push.apply(i,r.f(t)),!0===this.sqlMemoryMode?[2,Promise.resolve()]:[4,a.a.runInSequence(e,function(e){return o.query(e)})];case 1:return s.sent(),[2]}})})},e}()},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports=!1},function(e,t,n){var r=n(149),i=n(119);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(53),i=Math.max,a=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):a(e,t)}},function(e,t,n){var r=n(16),i=n(150),a=n(119),o=n(118)("IE_PROTO"),s=function(){},u=function(){var e,t=n(116)("iframe"),r=a.length;for(t.style.display="none",n(121).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(149),i=n(119).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(45),i=n(41),a=n(118)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){var r=n(17);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(e){this.name=e.name,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},function(e,t,n){var r=n(30).f,i=n(45),a=n(22)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t){e.exports={}},function(e,t,n){var r=n(22)("unscopables"),i=Array.prototype;null==i[r]&&n(46)(i,r,{}),e.exports=function(e){i[r][e]=!0}},function(e,t,n){"use strict";var r=n(14),i=n(30),a=n(34),o=n(22)("species");e.exports=function(e){var t=r[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(40);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(5),a=n(23),o=n(19),s=function(){function e(e,t,n,r,i){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r,this.queryRunner=i}return e.prototype.transform=function(e,t){var n=this,r=this.group(e,t),i=[];return r.forEach(function(e){var r=n.transformRawResultsGroup(e,t);void 0!==r&&i.push(r)}),i},e.prototype.group=function(e,t){var n=this,r=new Map,i=t.metadata.primaryColumns.map(function(e){return o.a.buildColumnAlias(n.driver,t.name,e.databaseName)});return e.forEach(function(e){var t=i.map(function(t){return e[t]}).join("_");if(t){var n=r.get(t);n?n.push(e):r.set(t,[e])}}),r},e.prototype.transformRawResultsGroup=function(e,t){var n=this,r=t.metadata;if(r.discriminatorColumn){var i=e.map(function(e){return e[o.a.buildColumnAlias(n.driver,t.name,t.metadata.discriminatorColumn.databaseName)]}),a=r.childEntityMetadatas.find(function(e){return!!i.find(function(t){return t===e.discriminatorValue})});a&&(r=a)}var s=-1!==this.expressionMap.options.indexOf("create-pojo")?{}:r.create(this.queryRunner),u=this.transformColumns(e,t,s,r),c=this.transformJoins(e,s,t,r),l=this.transformRelationIds(e,t,s,r),f=this.transformRelationCounts(e,t,s);return u?s:0===r.primaryColumns.filter(function(e){return!1===e.isVirtual}).length&&(c||l||f)?s:void 0},e.prototype.transformColumns=function(e,t,n,r){var i=this,a=!1;return r.columns.forEach(function(s){if(!(r.childEntityMetadatas.length>0&&-1!==r.childEntityMetadatas.map(function(e){return e.target}).indexOf(s.target))){var u=e[0][o.a.buildColumnAlias(i.driver,t.name,s.databaseName)];void 0===u||s.isVirtual||i.expressionMap.selects.find(function(e){return e.selection===t.name||e.selection===t.name+"."+s.propertyPath})&&(s.setEntityValue(n,i.driver.prepareHydratedValue(u,s)),null!==u&&(a=!0))}}),a},e.prototype.transformJoins=function(e,t,n,r){var i=this,a=!1;return this.expressionMap.joinAttributes.forEach(function(o){if(o.metadata&&o.isSelected&&(!o.relation||r.relations.find(function(e){return e===o.relation}))){if(o.mapToProperty){if(o.mapToPropertyParentAlias!==n.name)return}else if(!o.relation||o.parentAlias!==n.name||o.relationPropertyPath!==o.relation.propertyPath)return;var s=i.transform(e,o.alias);s=o.isMany?s:s[0],void 0!==(s=o.isMany||void 0!==s?s:null)&&(o.mapToPropertyPropertyName?t[o.mapToPropertyPropertyName]=s:o.relation.setEntityValue(t,s),a=!0)}}),a},e.prototype.transformRelationIds=function(e,t,n,r){var o=this,s=!1;return this.rawRelationIdResults.forEach(function(r){if(r.relationIdAttribute.parentAlias===t.name){var u=r.relationIdAttribute.relation,c=o.createValueMapFromJoinColumns(u,r.relationIdAttribute.parentAlias,e);if(null!=c){var l=r.results.map(function(e){var t=o.extractEntityPrimaryIds(u,e);if(!1!==a.a.compareIds(t,c)){var n,s=(n=u.isManyToOne||u.isOneToOneOwner?u.joinColumns.map(function(e){return e}):u.isOneToMany||u.isOneToOneNotOwner?u.inverseEntityMetadata.primaryColumns.map(function(e){return e}):u.isOwning?u.inverseJoinColumns.map(function(e){return e}):u.inverseRelation.joinColumns.map(function(e){return e})).reduce(function(t,n){var r=e[n.databaseName];return u.isOneToMany||u.isOneToOneNotOwner?(n.referencedColumn&&(r=n.referencedColumn.createValueMap(r)),i.a.mergeDeep(t,n.createValueMap(r))):(n.referencedColumn.referencedColumn&&(r=n.referencedColumn.referencedColumn.createValueMap(r)),i.a.mergeDeep(t,n.referencedColumn.createValueMap(r)))},{});return 1===n.length&&!1===r.relationIdAttribute.disableMixedMap?u.isOneToMany||u.isOneToOneNotOwner?n[0].getEntityValue(s):n[0].referencedColumn.getEntityValue(s):s}}).filter(function(e){return e}),f=r.relationIdAttribute.mapToPropertyPropertyPath.split("."),p=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&e.length>0?void p(e,t[r],n):t};u.isOneToOne||u.isManyToOne?void 0!==l[0]&&(p(f,n,l[0]),s=!0):(p(f,n,l),l.length>0&&(s=!0))}}}),s},e.prototype.transformRelationCounts=function(e,t,n){var r=this,i=!1;return this.rawRelationCountResults.filter(function(e){return e.relationCountAttribute.parentAlias===t.name}).forEach(function(a){var s,u=a.relationCountAttribute.relation;s=u.isOneToMany?u.inverseRelation.joinColumns[0].referencedColumn.databaseName:u.isOwning?u.joinColumns[0].referencedColumn.databaseName:u.inverseRelation.joinColumns[0].referencedColumn.databaseName;var c=e[0][o.a.buildColumnAlias(r.driver,t.name,s)];null!=c&&(n[a.relationCountAttribute.mapToPropertyPropertyName]=0,a.results.filter(function(e){return e.parentId===c}).forEach(function(e){n[a.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),i=!0}))}),i},e.prototype.createValueMapFromJoinColumns=function(e,t,n){var r=this;return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(i,a){return n.forEach(function(n){e.isManyToOne||e.isOneToOneOwner?i[a.databaseName]=r.driver.prepareHydratedValue(n[o.a.buildColumnAlias(r.driver,t,a.databaseName)],a):i[a.databaseName]=r.driver.prepareHydratedValue(n[o.a.buildColumnAlias(r.driver,t,a.referencedColumn.databaseName)],a)}),i},{})},e.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(e,n){return e[n.databaseName]=t[n.databaseName],e},{})},e}(),u=n(8),c=function(e){function t(){var n=e.call(this)||this;return n.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(n,t.prototype),n.message="An open transaction is required for pessimistic lock.",n}return r.c(t,e),t}(Error),l=function(e){function t(n){var r=e.call(this)||this;return r.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message="Entity "+n+" does not have version or update date columns.",r}return r.c(t,e),t}(Error),f=function(e){function t(n,r,i){var a=e.call(this)||this;return a.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(a,t.prototype),a.message="The optimistic lock on entity "+n+" failed, version "+r+" was expected, but is actually "+i+".",a}return r.c(t,e),t}(Error),p=function(e){function t(){var n=e.call(this)||this;return n.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(n,t.prototype),n.message="The optimistic lock can be used only with getOne() method.",n}return r.c(t,e),t}(Error),h=n(113),d=n(86),m=n(87),y=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return r.b(this,void 0,void 0,function(){var t,n=this;return r.d(this,function(i){return t=this.relationIdAttributes.map(function(t){return r.b(n,void 0,void 0,function(){var n,i,a,s,u,c,l,f,p,h,d,m,y,v,g,b,E,T,w,N,C,S=this;return r.d(this,function(A){switch(A.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new Error("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return C=e.map(function(e){var n={};return t.relation.joinColumns.forEach(function(r){n[r.databaseName]=S.connection.driver.prepareHydratedValue(e[o.a.buildColumnAlias(S.connection.driver,t.parentAlias,r.databaseName)],r.referencedColumn)}),t.relation.entityMetadata.primaryColumns.forEach(function(r){n[r.databaseName]=S.connection.driver.prepareHydratedValue(e[o.a.buildColumnAlias(S.connection.driver,t.parentAlias,r.databaseName)],r)}),n}),[2,{relationIdAttribute:t,results:C}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(n=t.relation,i=n.isOwning?n.joinColumns:n.inverseRelation.joinColumns,a=n.inverseEntityMetadata.target,s=n.inverseEntityMetadata.tableName,u=t.alias||s,c={},(w=e.map(function(e,n){return i.map(function(r){var i=r.databaseName+n;return c[i]=e[o.a.buildColumnAlias(S.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],u+"."+r.propertyPath+" = :"+i}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "))?(l=this.connection.createQueryBuilder(this.queryRunner),i.forEach(function(e){l.addSelect(u+"."+e.propertyPath,e.databaseName)}),n.inverseRelation.entityMetadata.primaryColumns.forEach(function(e){l.addSelect(u+"."+e.propertyPath,e.databaseName)}),l.from(a,u).where("("+w+")").setParameters(c),t.queryBuilderFactory&&t.queryBuilderFactory(l),[4,l.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return(C=A.sent()).forEach(function(e){i.forEach(function(t){e[t.databaseName]=S.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)}),n.inverseRelation.entityMetadata.primaryColumns.forEach(function(t){e[t.databaseName]=S.connection.driver.prepareHydratedValue(e[t.databaseName],t)})}),[2,{relationIdAttribute:t,results:C}];case 3:return f=t.relation,p=f.isOwning?f.joinColumns:f.inverseRelation.inverseJoinColumns,h=f.isOwning?f.inverseJoinColumns:f.inverseRelation.joinColumns,d=t.junctionAlias,m=t.joinInverseSideMetadata.tableName,y=t.alias||m,v=f.isOwning?f.junctionEntityMetadata.tableName:f.inverseRelation.junctionEntityMetadata.tableName,0===(g=e.map(function(e){return p.reduce(function(n,r){return n[r.propertyPath]=e[o.a.buildColumnAlias(S.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],n},{})})).length?[2,{relationIdAttribute:t,results:[]}]:(b={},E=g.map(function(e,t){return Object.keys(e).map(function(n){var r=n+t;return b[r]=e[n],d+"."+n+" = :"+r}).join(" AND ")}),T=h.map(function(e){return d+"."+e.propertyPath+" = "+y+"."+e.referencedColumn.propertyPath}).join(" AND "),w=E.map(function(e){return"("+e+" AND "+T+")"}).join(" OR "),N=this.connection.createQueryBuilder(this.queryRunner),h.forEach(function(e){N.addSelect(d+"."+e.propertyPath,e.databaseName).addOrderBy(d+"."+e.propertyPath)}),p.forEach(function(e){N.addSelect(d+"."+e.propertyPath,e.databaseName).addOrderBy(d+"."+e.propertyPath)}),N.from(m,y).innerJoin(v,d,w).setParameters(b),t.queryBuilderFactory&&t.queryBuilderFactory(N),[4,N.getRawMany()]);case 4:return(C=A.sent()).forEach(function(e){r.f(p,h).forEach(function(t){e[t.databaseName]=S.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)})}),[2,{relationIdAttribute:t,results:C}]}})})}),[2,Promise.all(t)]})})},e}(),v=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new d.a(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),g=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return r.b(this,void 0,void 0,function(){var t,n,i=this;return r.d(this,function(a){return t=function(e,t,n){return n.indexOf(e)===t},n=this.relationCountAttributes.map(function(n){return r.b(i,void 0,void 0,function(){var i,a,o,s,u,c,l,f,p,h,d,m,y,v,g,b,E,T;return r.d(this,function(r){switch(r.label){case 0:return n.relation.isOneToMany?(i=n.relation,a=i.inverseRelation,o=a.joinColumns[0].referencedColumn.propertyName,s=i.inverseEntityMetadata.target,y=i.inverseEntityMetadata.tableName,v=n.alias||y,u=a.propertyName,0===(d=(d=e.map(function(e){return e[n.parentAlias+"_"+o]}).filter(function(e){return!!e})).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:((E=this.connection.createQueryBuilder(this.queryRunner)).select(v+"."+u,"parentId").addSelect("COUNT(*)","cnt").from(s,v).where(v+"."+u+" IN (:...ids)").addGroupBy(v+"."+u).setParameter("ids",d),n.queryBuilderFactory&&n.queryBuilderFactory(E),c={relationCountAttribute:n},[4,E.getRawMany()])):[3,2];case 1:return[2,(c.results=r.sent(),c)];case 2:return f=void 0,p=void 0,h=void 0,n.relation.isOwning?(l=n.relation.joinColumns[0].referencedColumn.databaseName,f=n.relation.inverseJoinColumns[0].referencedColumn.databaseName,p=n.relation.junctionEntityMetadata.columns[0],h=n.relation.junctionEntityMetadata.columns[1]):(l=n.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,f=n.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,p=n.relation.junctionEntityMetadata.columns[1],h=n.relation.junctionEntityMetadata.columns[0]),0===(d=(d=e.map(function(e){return e[n.parentAlias+"_"+l]}).filter(function(e){return!!e})).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:(m=n.junctionAlias,y=n.joinInverseSideMetadata.tableName,v=n.alias||y,g=n.relation.junctionEntityMetadata.tableName,b=m+"."+p.propertyName+" IN ("+d+") AND "+m+"."+h.propertyName+" = "+v+"."+f,(E=this.connection.createQueryBuilder(this.queryRunner)).select(m+"."+p.propertyName,"parentId").addSelect("COUNT("+E.escape(v)+"."+E.escape(f)+")","cnt").from(y,v).innerJoin(g,m,b).addGroupBy(m+"."+p.propertyName),n.queryBuilderFactory&&n.queryBuilderFactory(E),T={relationCountAttribute:n},[4,E.getRawMany()]);case 3:return[2,(T.results=r.sent(),T)]}})})}),[2,Promise.all(n)]})})},e}(),b=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new m.a(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),E=n(48),T=function(e){function t(){var n=e.call(this)||this;return n.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(n,t.prototype),n.message="Locking not supported on given driver.",n}return r.c(t,e),t}(Error),w=n(3),N=n(12),C=n(18),S=function(e){function t(n){var r=e.call(this)||this;return r.name="OffsetWithoutLimitNotSupportedError",Object.setPrototypeOf(r,t.prototype),r.message=n+" does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).",r}return r.c(t,e),t}(Error),A=n(39),O=n(25);n.d(t,"SelectQueryBuilder",function(){return R});var R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.c(t,e),t.prototype.getQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e=(e+=this.createLockExpression()).trim(),this.expressionMap.subQuery&&(e="("+e+")"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.expressionMap.parentQueryBuilder=this,e},t.prototype.select=function(e,t){if(this.expressionMap.queryType="select",e instanceof Array)this.expressionMap.selects=e.map(function(e){return{selection:e}});else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},t.prototype.addSelect=function(e,t){if(!e)return this;if(e instanceof Array)this.expressionMap.selects=this.expressionMap.selects.concat(e.map(function(e){return{selection:e}}));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},t.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.addFrom=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this},t.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("INNER",e,t,n,r),this},t.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("LEFT",e,t,n,r),this},t.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.innerJoin(e,t,n,r),this},t.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.leftJoin(e,t,n,r),this},t.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new d.a(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new m.a(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:"other",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(e){var t=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(n){void 0!==e&&void 0!==e.relations&&-1===e.relations.indexOf(n.propertyPath)||t.loadRelationIdAndMap(t.expressionMap.mainAlias.name+"."+n.propertyPath,t.expressionMap.mainAlias.name+"."+n.propertyPath,e)}),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return this.expressionMap.groupBys=e?[e]:[],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t,n){var r,i;if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?e instanceof Object?this.expressionMap.orderBys=e:this.expressionMap.orderBys=n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):this.expressionMap.orderBys={},this},t.prototype.addOrderBy=function(e,t,n){if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new Error('Provided "limit" value is not a number. Please provide a numeric value.');return this},t.prototype.offset=function(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new Error('Provided "offset" value is not a number. Please provide a numeric value.');return this},t.prototype.take=function(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new Error('Provided "take" value is not a number. Please provide a numeric value.');return this},t.prototype.skip=function(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new Error('Provided "skip" value is not a number. Please provide a numeric value.');return this},t.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},t.prototype.getRawOne=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}})})},t.prototype.getRawMany=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i;return r.d(this,function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new p;this.expressionMap.queryEntity=!1,e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return[4,this.loadRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getRawAndEntities=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i;return r.d(this,function(r){switch(r.label){case 0:e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getOne=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i;return r.d(this,function(r){switch(r.label){case 0:return[4,this.getRawAndEntities()];case 1:if(e=r.sent(),(t=e.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(n=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((i=n.updateDateColumn.getEntityValue(t)).getTime()!==this.expressionMap.lockVersion.getTime())throw new f(n.name,this.expressionMap.lockVersion,i)}else if((i=n.versionColumn.getEntityValue(t))!==this.expressionMap.lockVersion)throw new f(n.name,this.expressionMap.lockVersion,i);return[2,t]}})})},t.prototype.getMany=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new p;return[4,this.getRawAndEntities()];case 1:return[2,e.sent().entities]}})})},t.prototype.getCount=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i;return r.d(this,function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new p;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getManyAndCount=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new p;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,8,13,16]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 5:return i=r.sent(),a=[n.entities,i],t?[4,e.commitTransaction()]:[3,7];case 6:r.sent(),r.label=7;case 7:return[2,a];case 8:if(o=r.sent(),!t)return[3,12];r.label=9;case 9:return r.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:return r.sent(),[3,12];case 11:return r.sent(),[3,12];case 12:throw o;case 13:return e===this.queryRunner?[3,15]:[4,e.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}})})},t.prototype.stream=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u,c=this;return r.d(this,function(l){switch(l.label){case 0:this.expressionMap.queryEntity=!1,e=r.e(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a=!1,l.label=1;case 1:return l.trys.push([1,6,11,14]),!0!==this.expressionMap.useTransaction||!1!==i.isTransactionActive?[3,3]:[4,i.startTransaction()];case 2:l.sent(),a=!0,l.label=3;case 3:return o=function(){if(i!==c.queryRunner)return i.release()},s=i.stream(t,n,o,o),a?[4,i.commitTransaction()]:[3,5];case 4:l.sent(),l.label=5;case 5:return[2,s];case 6:if(u=l.sent(),!a)return[3,10];l.label=7;case 7:return l.trys.push([7,9,,10]),[4,i.rollbackTransaction()];case 8:return l.sent(),[3,10];case 9:return l.sent(),[3,10];case 10:throw u;case 11:return i===this.queryRunner?[3,13]:[4,i.release()];case 12:l.sent(),l.label=13;case 13:return[7];case 14:return[2]}})})},t.prototype.cache=function(e,t){return"boolean"==typeof e?this.expressionMap.cache=e:"number"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):"string"!=typeof e&&"number"!=typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},t.prototype.setOption=function(e){return this.expressionMap.options.push(e),this},t.prototype.join=function(e,t,n,r,i,a,o){this.setParameters(i||{});var s=new h.a(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=a,s.isMappingMany=o,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.metadata)s.alias=this.expressionMap.createAlias({type:"join",name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata});else{var u="";if(t instanceof Function){var c=t(this.subQuery());this.setParameters(c.getParameters()),u=c.getQuery()}else u=t;var l=t instanceof Function||"("===t.substr(0,1)&&")"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:"join",name:n,tablePath:!1===l?t:void 0,subQuery:!0===l?u:void 0})}},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new Error("Cannot build query because main alias is not set (call qb#from method)");var t=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){var i=this.expressionMap.mainAlias.metadata;t.push.apply(t,r.f(this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,i))),n.push.apply(n,r.f(this.findEntityColumnSelects(this.expressionMap.mainAlias.name,i)))}this.expressionMap.joinAttributes.forEach(function(i){if(i.metadata)t.push.apply(t,r.f(e.buildEscapedEntityColumnSelects(i.alias.name,i.metadata))),n.push.apply(n,r.f(e.findEntityColumnSelects(i.alias.name,i.metadata)));else if(e.expressionMap.selects.some(function(e){return e.selection===i.alias.name})){t.push({selection:e.escape(i.alias.name)+".*"});var a=e.expressionMap.selects.find(function(e){return e.selection===i.alias.name});n.push(a)}}),this.expressionMap.selects.filter(function(e){return-1===n.indexOf(e)}).forEach(function(n){return t.push({selection:e.replacePropertyNames(n.selection),aliasName:n.aliasName})}),0===t.length&&t.push({selection:"*"});var a="";if(this.connection.driver instanceof u.a)switch(this.expressionMap.lockMode){case"pessimistic_read":a=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":a=" WITH (UPDLOCK, ROWLOCK)"}var o=this.expressionMap.aliases.filter(function(e){return"from"===e.type&&(e.tablePath||e.subQuery)}).map(function(t){return t.subQuery?t.subQuery+" "+e.escape(t.name):e.getTableName(t.tablePath)+" "+e.escape(t.name)});return"SELECT "+t.map(function(t){return t.selection+(t.aliasName?" AS "+e.escape(t.aliasName):"")}).join(", ")+" FROM "+o.join(", ")+a},t.prototype.createJoinExpression=function(){var e=this;return this.expressionMap.joinAttributes.map(function(t){var n=t.relation,r=t.tablePath,i=t.alias.name,a=t.condition?" AND ("+t.condition+")":"",o=t.parentAlias;if(!o||!n){var s=t.alias.subQuery?t.alias.subQuery:e.getTableName(r);return" "+t.direction+" JOIN "+s+" "+e.escape(i)+(t.condition?" ON "+e.replacePropertyNames(t.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){var u=n.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+o+"."+n.propertyPath+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a)}if(n.isOneToMany||n.isOneToOneNotOwner){u=n.inverseRelation.joinColumns.map(function(e){return i+"."+n.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a)}var c=n.junctionEntityMetadata.tablePath,l=t.junctionAlias,f="",p="";return n.isOwning?(f=n.joinColumns.map(function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND "),p=n.inverseJoinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath}).join(" AND ")):(f=n.inverseRelation.inverseJoinColumns.map(function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND "),p=n.inverseRelation.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath}).join(" AND "))," "+t.direction+" JOIN "+e.getTableName(c)+" "+e.escape(l)+" ON "+e.replacePropertyNames(f)+" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(p+a)}).join(" ")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls}).join(", "):""},t.prototype.createLimitOffsetExpression=function(){var e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),this.connection.driver instanceof u.a){var n="";if((t||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(n=" ORDER BY (SELECT NULL)"),t&&e)return n+" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return n+" OFFSET 0 ROWS FETCH NEXT "+t+" ROWS ONLY";if(e)return n+" OFFSET "+e+" ROWS"}else if(this.connection.driver instanceof w.e){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)throw new S("MySQL")}else if(this.connection.driver instanceof C.a){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver instanceof N.a){if(t&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return" FETCH NEXT "+t+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" OFFSET "+e}return""},t.prototype.createLockExpression=function(){var e=this.connection.driver;switch(this.expressionMap.lockMode){case"pessimistic_read":if(e instanceof w.e)return" LOCK IN SHARE MODE";if(e instanceof w.g)return" FOR SHARE";if(e instanceof N.a)return" FOR UPDATE";if(e instanceof u.a)return"";throw new T;case"pessimistic_write":if(e instanceof w.e||e instanceof w.g||e instanceof N.a)return" FOR UPDATE";if(e instanceof u.a)return"";throw new T;default:return""}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var t=this.expressionMap.havings.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");return t.length?" HAVING "+t:""},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this,i=this.expressionMap.selects.some(function(t){return t.selection===e}),a=[];if(i&&a.push.apply(a,r.f(t.columns.filter(function(e){return!0===e.isSelect}))),a.push.apply(a,r.f(t.columns.filter(function(t){return n.expressionMap.selects.some(function(n){return n.selection===e+"."+t.propertyPath})}))),0===a.length)return[];var s=this.expressionMap.queryEntity?t.primaryColumns.filter(function(e){return-1===a.indexOf(e)}):[];return r.f(a,s).map(function(t){var r=n.expressionMap.selects.find(function(n){return n.selection===e+"."+t.propertyPath}),a=n.escape(e)+"."+n.escape(t.databaseName);return-1!==n.connection.driver.spatialTypes.indexOf(t.type)&&(n.connection.driver instanceof w.e&&(a="AsText("+a+")"),n.connection.driver instanceof w.g&&(a="ST_AsGeoJSON("+a+")::json"),n.connection.driver instanceof u.a&&(a+=".ToString()")),{selection:a,aliasName:r&&r.aliasName?r.aliasName:o.a.buildColumnAlias(n.connection.driver,e,t.databaseName),virtual:r?!0===r.virtual:!i}})},t.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find(function(t){return t.selection===e});return n?[n]:this.expressionMap.selects.filter(function(n){return t.columns.some(function(t){return n.selection===e+"."+t.propertyPath})})},t.prototype.executeCountQuery=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata,i=this.escape(t),a="",a=n.hasMultiplePrimaryKeys?this.connection.driver instanceof C.a?"COUNT(DISTINCT("+n.primaryColumns.map(function(e,t){var n=s.escape(e.databaseName);return i+"."+n}).join(" || ")+')) as "cnt"':"COUNT(DISTINCT(CONCAT("+n.primaryColumns.map(function(e,t){var n=s.escape(e.databaseName);return i+"."+n}).join(", ")+'))) as "cnt"':"COUNT(DISTINCT("+n.primaryColumns.map(function(e,t){var n=s.escape(e.databaseName);return i+"."+n}).join(", ")+')) as "cnt"',[4,this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(a).setOption("disable-global-order").loadRawResults(e)];case 1:return(o=r.sent())&&o[0]&&o[0].cnt?[2,parseInt(o[0].cnt)]:[2,0]}})})},t.prototype.executeEntitiesAndRawResults=function(e){return r.b(this,void 0,void 0,function(){var n,i,a,u,f,p,h,d,m,E,T,w,N,C,S,O,R,M,_=this;return r.d(this,function(P){switch(P.label){case 0:if(!this.expressionMap.mainAlias)throw new Error('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new c;if("optimistic"===this.expressionMap.lockMode&&!(n=this.expressionMap.mainAlias.metadata).versionColumn&&!n.updateDateColumn)throw new l(n.name);return i=new y(this.connection,e,this.expressionMap.relationIdAttributes),a=new g(this.connection,e,this.expressionMap.relationCountAttributes),new v(this.expressionMap).transform(),new b(this.expressionMap).transform(),u=[],f=[],(this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0?(p=r.e(this.createOrderByCombinedWithSelectExpression("distinctAlias"),2),h=p[0],d=p[1],m=this.expressionMap.mainAlias.metadata,E=this.expressionMap.mainAlias.name,T=m.primaryColumns.map(function(e){var t=_.escape("distinctAlias"),n=_.escape(o.a.buildColumnAlias(_.connection.driver,E,e.databaseName));return d[n]||(d[n]="ASC"),t+"."+n+' as "ids_'+o.a.buildColumnAlias(_.connection.driver,E,e.databaseName)+'"'}),[4,new t(this.connection,e).select("DISTINCT "+T.join(", ")).addSelect(h).from("("+this.clone().orderBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(d).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany()]):[3,4];case 1:return(u=P.sent()).length>0?(w="",N={},m.hasMultiplePrimaryKeys?w=u.map(function(e,t){return m.primaryColumns.map(function(n){return N["ids_"+t+"_"+n.databaseName]=e["ids_"+E+"_"+n.databaseName],E+"."+n.propertyPath+"=:ids_"+t+"_"+n.databaseName}).join(" AND ")}).join(" OR "):(C=u.map(function(e){return e["ids_"+o.a.buildColumnAlias(_.connection.driver,E,m.primaryColumns[0].databaseName)]}),C.every(function(e){return"number"==typeof e})?w=E+"."+m.primaryColumns[0].propertyPath+" IN ("+C.join(", ")+")":(N.ids=C,w=E+"."+m.primaryColumns[0].propertyPath+" IN (:...ids)")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:w}).setParameters(N).loadRawResults(e)]):[3,3];case 2:u=P.sent(),P.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(e)];case 5:u=P.sent(),P.label=6;case 6:return u.length>0?[4,i.load(u)]:[3,10];case 7:return S=P.sent(),[4,a.load(u)];case 8:return O=P.sent(),R=new s(this.expressionMap,this.connection.driver,S,O,this.queryRunner),f=R.transform(u,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(M=new A.a,e.broadcaster.broadcastLoadEventsForAll(M,this.expressionMap.mainAlias.metadata,f),M.promises.length>0?[4,Promise.all(M.promises)]:[3,10]):[3,10];case 9:P.sent(),P.label=10;case 10:return[2,{raw:u,entities:f}]}})})},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.allOrderBys,i=Object.keys(n).map(function(n){if(-1!==n.indexOf(".")){var i=r.e(n.split("."),2),a=i[0],s=i[1],u=t.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyName(s);return t.escape(e)+"."+t.escape(o.a.buildColumnAlias(t.connection.driver,a,u.databaseName))}return t.expressionMap.selects.find(function(e){return e.selection===n||e.aliasName===n})?t.escape(e)+"."+n:""}).join(", "),a={};return Object.keys(n).forEach(function(i){if(-1!==i.indexOf(".")){var s=r.e(i.split("."),2),u=s[0],c=s[1],l=t.expressionMap.findAliasByName(u).metadata.findColumnWithPropertyName(c);a[t.escape(e)+"."+t.escape(o.a.buildColumnAlias(t.connection.driver,u,l.databaseName))]=n[i]}else t.expressionMap.selects.find(function(e){return e.selection===i||e.aliasName===i})?a[t.escape(e)+"."+i]=n[i]:a[i]=n[i]}),[i,a]},t.prototype.loadRawResults=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,o,s,u;return r.d(this,function(c){switch(c.label){case 0:return t=r.e(this.getQueryAndParameters(),2),n=t[0],i=t[1],a=n+" -- PARAMETERS: "+JSON.stringify(i),o="object"==typeof this.connection.options.cache?this.connection.options.cache:{},s=void 0,this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)?[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:a,duration:this.expressionMap.cacheDuration||o.duration||1e3},e)]:[3,2];case 1:if((s=c.sent())&&!this.connection.queryResultCache.isExpired(s))return[2,JSON.parse(s.result)];c.label=2;case 2:return[4,e.query(n,i)];case 3:return u=c.sent(),this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)?[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:a,time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(u)},s,e)]:[3,5];case 4:c.sent(),c.label=5;case 5:return[2,u]}})})},t.prototype.mergeExpressionMap=function(e){return O.a.assign(this.expressionMap,e),this},t.prototype.normalizeNumber=function(e){return"number"==typeof e||null==e?e:Number(e)},t.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("slave")},t}(E.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(n){var r=e.call(this)||this;return r.name="ConnectionIsNotSetError",Object.setPrototypeOf(r,t.prototype),r.message="Connection with "+n+" database is not established. Check connection configuration.",r}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),i=n(44),a=n(25),o=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,a.a.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=r.e(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rid"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),i=n(44),a=n(25),o=function(){function e(e,t){this.expressionMap=e,a.a.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=r.e(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rc"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=r.e(this.relationName.split("."),2),t=e[0],n=e[1],a=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!a)throw new Error("Relation with property path "+n+" in entity was not found.");return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="ReturningStatementNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL databases.",n}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.createTableColumnOptions=function(e,t){return{name:e.databaseName,length:e.length,width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:t.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,isNullable:e.isNullable,type:t.normalizeType(e),isPrimary:e.isPrimary,isUnique:t.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map(function(e){return e+""}):e.enum,spatialFeatureType:e.spatialFeatureType,srid:e.srid}},e}()},function(e,t,n){var r=n(60);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(60),i=n(22)("toStringTag"),a="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:a?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,n){var r=n(16),i=n(59),a=n(22)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[a])?t:i(n)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(35),i=n(14),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(70)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var r=n(47),i=n(27),a=n(72);e.exports=function(e){return function(t,n,o){var s,u=r(t),c=i(u.length),l=a(o,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(4),i=n(61),a=n(15),o=n(123),s="["+o+"]",u=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),l=function(e,t,n){var i={},s=a(function(){return!!o[e]()||"​"!="​"[e]()}),u=i[e]=s?t(f):o[e];n&&(i[n]=u),r(r.P+r.F*s,"String",i)},f=l.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(c,"")),e};e.exports=l},function(e,t,n){var r=n(22)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},e(a)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(16);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){"use strict";var r=n(92),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var a=n.call(e,t);if("object"!=typeof a)throw new TypeError("RegExp exec method returned something other than an Object or null");return a}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},function(e,t,n){"use strict";n(166);var r=n(40),i=n(46),a=n(15),o=n(61),s=n(22),u=n(138),c=s("species"),l=!a(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),f=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var p=s(e),h=!a(function(){var t={};return t[p]=function(){return 7},7!=""[e](t)}),d=h?!a(function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[c]=function(){return n}),n[p](""),!t}):void 0;if(!h||!d||"replace"===e&&!l||"split"===e&&!f){var m=/./[p],y=n(o,p,""[e],function(e,t,n,r,i){return t.exec===u?h&&!i?{done:!0,value:m.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),v=y[0],g=y[1];r(String.prototype,e,v),i(RegExp.prototype,p,2==t?function(e,t){return g.call(e,this,t)}:function(e){return g.call(e,this)})}}},function(e,t,n){var r=n(58),i=n(162),a=n(133),o=n(16),s=n(27),u=n(135),c={},l={};(t=e.exports=function(e,t,n,f,p){var h,d,m,y,v=p?function(){return e}:u(e),g=r(n,f,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(a(v)){for(h=s(e.length);h>b;b++)if((y=t?g(o(d=e[b])[0],d[1]):g(e[b]))===c||y===l)return y}else for(m=v.call(e);!(d=m.next()).done;)if((y=i(m,g,d.value,t))===c||y===l)return y}).BREAK=c,t.RETURN=l},function(e,t,n){var r=n(14).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(14),i=n(4),a=n(40),o=n(83),s=n(64),u=n(103),c=n(82),l=n(17),f=n(15),p=n(99),h=n(78),d=n(124);e.exports=function(e,t,n,m,y,v){var g=r[e],b=g,E=y?"set":"add",T=b&&b.prototype,w={},N=function(e){var t=T[e];a(T,e,"delete"==e?function(e){return!(v&&!l(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(v&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return v&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof b&&(v||T.forEach&&!f(function(){(new b).entries().next()}))){var C=new b,S=C[E](v?{}:-0,1)!=C,A=f(function(){C.has(1)}),O=p(function(e){new b(e)}),R=!v&&f(function(){for(var e=new b,t=5;t--;)e[E](t,t);return!e.has(-0)});O||((b=t(function(t,n){c(t,b,e);var r=d(new g,t,b);return null!=n&&u(n,y,r[E],r),r})).prototype=T,T.constructor=b),(A||R)&&(N("delete"),N("has"),y&&N("get")),(R||S)&&N(E),v&&T.clear&&delete T.clear}else b=m.getConstructor(t,e,y,E),o(b.prototype,n),s.NEED=!0;return h(b,e),w[e]=b,i(i.G+i.W+i.F*(b!=g),w),v||m.setStrong(b,e,y),b}},function(e,t,n){for(var r,i=n(14),a=n(46),o=n(69),s=o("typed_array"),u=o("view"),c=!(!i.ArrayBuffer||!i.DataView),l=c,f=0,p="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<9;)(r=i[p[f++]])?(a(r.prototype,s,!0),a(r.prototype,u,!0)):l=!1;e.exports={ABV:c,CONSTR:l,TYPED:s,VIEW:u}},function(e,t,n){e.exports=n.p+"html/container.html"},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return function(e){this.whereFactory=e}}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(10);function i(e){return new r.a("in",e,!0,!0)}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return function(){this.identifiers=[],this.generatedMaps=[]}}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return function(){this.generatedMaps=[]}}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return function(){}}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),i=n(44),a=n(25),o=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,this.isSelectedEvalueated=!1,this.relationEvalueated=!1,a.a.assign(this,n||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){var e=this;if(!this.isSelectedEvalueated){this.isSelectedCache=function(){var t,n,i=function(t){return t.selection===e.alias.name?{value:!0}:e.metadata&&e.metadata.columns.find(function(n){return t.selection===e.alias.name+"."+n.propertyPath})?{value:!0}:void 0};try{for(var a=r.g(e.queryExpressionMap.selects),o=a.next();!o.done;o=a.next()){var s=i(o.value);if("object"==typeof s)return s.value}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1}(),this.isSelectedEvalueated=!0}return this.isSelectedCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tablePath",{get:function(){return this.metadata?this.metadata.tablePath:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(i.a.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(i.a.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){var e=this;if(!this.relationEvalueated){this.relationCache=function(){if(i.a.isAliasProperty(e.entityOrProperty)){var t=e.queryExpressionMap.findAliasByName(e.parentAlias),n=t.metadata.findRelationWithPropertyPath(e.relationPropertyPath);if(n)return n;if(t.metadata.parentEntityMetadata&&(n=t.metadata.parentEntityMetadata.findRelationWithPropertyPath(e.relationPropertyPath)))return n;throw new Error("Relation with property path "+e.relationPropertyPath+" in entity was not found.")}}.bind(this)(),this.relationEvalueated=!0}return this.relationCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new Error("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),i=n(5),a=n(12),o=function(){function e(e,t){this.queryRunner=e,this.expressionMap=t}return e.prototype.update=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(o){switch(o.label){case 0:return n=this.expressionMap.mainAlias.metadata,[4,Promise.all(t.map(function(t,o){return r.b(i,void 0,void 0,function(){var i,s,u,c,l=this;return r.d(this,function(r){switch(r.label){case 0:return this.queryRunner.connection.driver.isReturningSqlSupported()?(this.queryRunner.connection.driver instanceof a.a&&e.raw instanceof Array&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce(function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e},{})),i=e.raw instanceof Array?e.raw[o]:e.raw,(s=this.queryRunner.connection.driver.createGeneratedMap(n,i))&&(this.queryRunner.manager.merge(n.target,t,s),e.generatedMaps.push(s)),[3,3]):[3,1];case 1:if(!(this.getUpdationReturningColumns().length>0))return[3,3];if(!(u=this.expressionMap.mainAlias.metadata.getEntityIdMap(t)))throw new Error("Cannot update entity because entity id is not set in the entity.");return[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map(function(e){return n.targetName+"."+e.propertyPath})).addSelect(this.getUpdationReturningColumns().map(function(e){return n.targetName+"."+e.propertyPath})).from(n.target,n.targetName).where(u).setOption("create-pojo").getOne()];case 2:(c=r.sent())&&(this.queryRunner.manager.merge(n.target,t,c),e.generatedMaps.push(c)),r.label=3;case 3:return[2]}})})}))];case 1:return o.sent(),[2]}})})},e.prototype.insert=function(e,t){return r.b(this,void 0,void 0,function(){var n,o,s,u=this;return r.d(this,function(c){switch(c.label){case 0:return n=this.expressionMap.mainAlias.metadata,o=this.getInsertionReturningColumns(),s=t.map(function(t,r){u.queryRunner.connection.driver instanceof a.a&&e.raw instanceof Array&&u.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce(function(e,t,n){return e[u.expressionMap.extraReturningColumns[n].databaseName]=t[0],e},{}));var o=e.raw instanceof Array?e.raw[r]:e.raw,s=u.queryRunner.connection.driver.createGeneratedMap(n,o)||{};return!1===u.queryRunner.connection.driver.isUUIDGenerationSupported()&&n.generatedColumns.forEach(function(e){if("uuid"===e.generationStrategy){var n=e.getEntityValue(t);n||(n=u.expressionMap.nativeParameters["uuid_"+e.databaseName+r]),i.a.mergeDeep(s,e.createValueMap(n))}}),u.queryRunner.manager.merge(n.target,t,s),s}),!1===this.queryRunner.connection.driver.isReturningSqlSupported()&&o.length>0?[4,Promise.all(t.map(function(e,t){return r.b(u,void 0,void 0,function(){var i,a;return r.d(this,function(r){switch(r.label){case 0:return i=n.getEntityIdMap(e),[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map(function(e){return n.targetName+"."+e.propertyPath})).addSelect(o.map(function(e){return n.targetName+"."+e.propertyPath})).from(n.target,n.targetName).where(i).setOption("create-pojo").getOne()];case 1:return a=r.sent(),this.queryRunner.manager.merge(n.target,s[t],a),[2]}})})}))]:[3,2];case 1:c.sent(),c.label=2;case 2:return t.forEach(function(t,r){var i=n.getEntityIdMap(t);e.identifiers.push(i),e.generatedMaps.push(s[r]),u.queryRunner.manager.merge(u.expressionMap.mainAlias.metadata.target,t,s[r],s[r])}),[2]}})})},e.prototype.getInsertionReturningColumns=function(){var e=this.queryRunner.connection.driver.isReturningSqlSupported();return this.expressionMap.mainAlias.metadata.columns.filter(function(t){return void 0!==t.default||e&&t.isGenerated||t.isCreateDate||t.isUpdateDate||t.isVersion})},e.prototype.getUpdationReturningColumns=function(){return this.expressionMap.mainAlias.metadata.columns.filter(function(e){return e.isUpdateDate||e.isVersion})},e}()},,function(e,t,n){var r=n(17),i=n(14).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,n){t.f=n(22)},function(e,t,n){var r=n(95)("keys"),i=n(69);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(60);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(14).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(17),i=n(16),a=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(58)(Function.call,n(54).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:a}},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,n){var r=n(17),i=n(122).set;e.exports=function(e,t,n){var a,o=t.constructor;return o!==n&&"function"==typeof o&&(a=o.prototype)!==n.prototype&&r(a)&&i&&i(e,a),e}},function(e,t,n){"use strict";var r=n(53),i=n(61);e.exports=function(e){var t=String(i(this)),n="",a=r(e);if(a<0||a==1/0)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(n+=t);return n}},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t){var n=Math.expm1;e.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},function(e,t,n){var r=n(53),i=n(61);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),u=r(n),c=s.length;return u<0||u>=c?e?"":void 0:(a=s.charCodeAt(u))<55296||a>56319||u+1===c||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):a:e?s.slice(u,u+2):o-56320+(a-55296<<10)+65536}}},function(e,t,n){"use strict";var r=n(70),i=n(4),a=n(40),o=n(46),s=n(79),u=n(161),c=n(78),l=n(75),f=n(22)("iterator"),p=!([].keys&&"next"in[].keys()),h=function(){return this};e.exports=function(e,t,n,d,m,y,v){u(n,t,d);var g,b,E,T=function(e){if(!p&&e in S)return S[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},w=t+" Iterator",N="values"==m,C=!1,S=e.prototype,A=S[f]||S["@@iterator"]||m&&S[m],O=A||T(m),R=m?N?T("entries"):O:void 0,M="Array"==t&&S.entries||A;if(M&&(E=l(M.call(new e)))!==Object.prototype&&E.next&&(c(E,w,!0),r||"function"==typeof E[f]||o(E,f,h)),N&&A&&"values"!==A.name&&(C=!0,O=function(){return A.call(this)}),r&&!v||!p&&!C&&S[f]||o(S,f,O),s[t]=O,s[w]=h,m)if(g={values:N?O:T("values"),keys:y?O:T("keys"),entries:R},v)for(b in g)b in S||a(S,b,g[b]);else i(i.P+i.F*(p||C),t,g);return g}},function(e,t,n){var r=n(131),i=n(61);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},function(e,t,n){var r=n(17),i=n(60),a=n(22)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==i(e))}},function(e,t,n){var r=n(22)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){var r=n(79),i=n(22)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},function(e,t,n){"use strict";var r=n(30),i=n(68);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(92),i=n(22)("iterator"),a=n(79);e.exports=n(35).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){"use strict";var r=n(41),i=n(72),a=n(27);e.exports=function(e){for(var t=r(this),n=a(t.length),o=arguments.length,s=i(o>1?arguments[1]:void 0,n),u=o>2?arguments[2]:void 0,c=void 0===u?n:i(u,n);c>s;)t[s++]=e;return t}},function(e,t,n){"use strict";var r=n(80),i=n(165),a=n(79),o=n(47);e.exports=n(129)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r,i,a=n(100),o=RegExp.prototype.exec,s=String.prototype.replace,u=o,c=(r=/a/,i=/b*/g,o.call(r,"a"),o.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),l=void 0!==/()??/.exec("")[1];(c||l)&&(u=function(e){var t,n,r,i,u=this;return l&&(n=new RegExp("^"+u.source+"$(?!\\s)",a.call(u))),c&&(t=u.lastIndex),r=o.call(u,e),c&&r&&(u.lastIndex=u.global?r.index+r[0].length:t),l&&r&&r.length>1&&s.call(r[0],n,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r}),e.exports=u},function(e,t,n){"use strict";var r=n(128)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){var r,i,a,o=n(58),s=n(155),u=n(121),c=n(116),l=n(14),f=l.process,p=l.setImmediate,h=l.clearImmediate,d=l.MessageChannel,m=l.Dispatch,y=0,v={},g=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){g.call(e.data)};p&&h||(p=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++y]=function(){s("function"==typeof e?e:Function(e),t)},r(y),y},h=function(e){delete v[e]},"process"==n(60)(f)?r=function(e){f.nextTick(o(g,e,1))}:m&&m.now?r=function(e){m.now(o(g,e,1))}:d?(a=(i=new d).port2,i.port1.onmessage=b,r=o(a.postMessage,a,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),g.call(e)}}:function(e){setTimeout(o(g,e,1),0)}),e.exports={set:p,clear:h}},function(e,t,n){"use strict";var r=n(14),i=n(34),a=n(70),o=n(106),s=n(46),u=n(83),c=n(15),l=n(82),f=n(53),p=n(27),h=n(173),d=n(74).f,m=n(30).f,y=n(136),v=n(78),g="prototype",b="Wrong index!",E=r.ArrayBuffer,T=r.DataView,w=r.Math,N=r.RangeError,C=r.Infinity,S=E,A=w.abs,O=w.pow,R=w.floor,M=w.log,_=w.LN2,P=i?"_b":"buffer",x=i?"_l":"byteLength",I=i?"_o":"byteOffset";function L(e,t,n){var r,i,a,o=new Array(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?O(2,-24)-O(2,-77):0,f=0,p=e<0||0===e&&1/e<0?1:0;for((e=A(e))!=e||e===C?(i=e!=e?1:0,r=u):(r=R(M(e)/_),e*(a=O(2,-r))<1&&(r--,a*=2),(e+=r+c>=1?l/a:l*O(2,1-c))*a>=2&&(r++,a/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*a-1)*O(2,t),r+=c):(i=e*O(2,c-1)*O(2,t),r=0));t>=8;o[f++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;o[f++]=255&r,r/=256,s-=8);return o[--f]|=128*p,o}function j(e,t,n){var r,i=8*n-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=n-1,c=e[u--],l=127&c;for(c>>=7;s>0;l=256*l+e[u],u--,s-=8);for(r=l&(1<<-s)-1,l>>=-s,s+=t;s>0;r=256*r+e[u],u--,s-=8);if(0===l)l=1-o;else{if(l===a)return r?NaN:c?-C:C;r+=O(2,t),l-=o}return(c?-1:1)*r*O(2,l-t)}function D(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function k(e){return[255&e]}function q(e){return[255&e,e>>8&255]}function B(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function U(e){return L(e,52,8)}function F(e){return L(e,23,4)}function V(e,t,n){m(e[g],t,{get:function(){return this[n]}})}function Q(e,t,n,r){var i=h(+n);if(i+t>e[x])throw N(b);var a=e[P]._b,o=i+e[I],s=a.slice(o,o+t);return r?s:s.reverse()}function K(e,t,n,r,i,a){var o=h(+n);if(o+t>e[x])throw N(b);for(var s=e[P]._b,u=o+e[I],c=r(+i),l=0;l<t;l++)s[u+l]=c[a?l:t-l-1]}if(o.ABV){if(!c(function(){E(1)})||!c(function(){new E(-1)})||c(function(){return new E,new E(1.5),new E(NaN),"ArrayBuffer"!=E.name})){for(var W,H=(E=function(e){return l(this,E),new S(h(e))})[g]=S[g],Y=d(S),z=0;Y.length>z;)(W=Y[z++])in E||s(E,W,S[W]);a||(H.constructor=E)}var J=new T(new E(2)),G=T[g].setInt8;J.setInt8(0,2147483648),J.setInt8(1,2147483649),!J.getInt8(0)&&J.getInt8(1)||u(T[g],{setInt8:function(e,t){G.call(this,e,t<<24>>24)},setUint8:function(e,t){G.call(this,e,t<<24>>24)}},!0)}else E=function(e){l(this,E,"ArrayBuffer");var t=h(e);this._b=y.call(new Array(t),0),this[x]=t},T=function(e,t,n){l(this,T,"DataView"),l(e,E,"DataView");var r=e[x],i=f(t);if(i<0||i>r)throw N("Wrong offset!");if(i+(n=void 0===n?r-i:p(n))>r)throw N("Wrong length!");this[P]=e,this[I]=i,this[x]=n},i&&(V(E,"byteLength","_l"),V(T,"buffer","_b"),V(T,"byteLength","_l"),V(T,"byteOffset","_o")),u(T[g],{getInt8:function(e){return Q(this,1,e)[0]<<24>>24},getUint8:function(e){return Q(this,1,e)[0]},getInt16:function(e){var t=Q(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Q(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return D(Q(this,4,e,arguments[1]))},getUint32:function(e){return D(Q(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return j(Q(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return j(Q(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){K(this,1,e,k,t)},setUint8:function(e,t){K(this,1,e,k,t)},setInt16:function(e,t){K(this,2,e,q,t,arguments[2])},setUint16:function(e,t){K(this,2,e,q,t,arguments[2])},setInt32:function(e,t){K(this,4,e,B,t,arguments[2])},setUint32:function(e,t){K(this,4,e,B,t,arguments[2])},setFloat32:function(e,t){K(this,4,e,F,t,arguments[2])},setFloat64:function(e,t){K(this,8,e,U,t,arguments[2])}});v(E,"ArrayBuffer"),v(T,"DataView"),s(T[g],o.VIEW,!0),t.ArrayBuffer=E,t.DataView=T},function(e,t,n){"use strict";n.r(t),n.d(t,"DeleteQueryBuilder",function(){return h});var r=n(0),i=n(36),a=n(48),o=n(8),s=n(3),u=n(112),c=n(88),l=n(49),f=n(39),p=n(13),h=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return r.c(t,e),t.prototype.getQuery=function(){return this.createDeleteExpression().trim()},t.prototype.execute=function(){return r.b(this,void 0,void 0,function(){var e,t,n,a,c,p,h,d,m,y;return r.d(this,function(v){switch(v.label){case 0:e=r.e(this.getQueryAndParameters(),2),t=e[0],n=e[1],a=this.obtainQueryRunner(),c=!1,v.label=1;case 1:return v.trys.push([1,11,16,21]),!0!==this.expressionMap.useTransaction||!1!==a.isTransactionActive?[3,3]:[4,a.startTransaction()];case 2:v.sent(),c=!0,v.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(m=new f.a,a.broadcaster.broadcastBeforeRemoveEvent(m,this.expressionMap.mainAlias.metadata),m.promises.length>0?[4,Promise.all(m.promises)]:[3,5]):[3,5];case 4:v.sent(),v.label=5;case 5:return p=new u.a,[4,a.query(t,n)];case 6:return h=v.sent(),(d=a.connection.driver)instanceof s.e?(p.raw=h,p.affected=h.affectedRows):d instanceof o.a||d instanceof s.g||d instanceof i.a?(p.raw=h[0]?h[0]:null,p.affected="number"==typeof h[1]?h[1]:null):p.raw=h,!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(m=new f.a,a.broadcaster.broadcastAfterRemoveEvent(m,this.expressionMap.mainAlias.metadata),m.promises.length>0?[4,Promise.all(m.promises)]:[3,8]):[3,8];case 7:v.sent(),v.label=8;case 8:return c?[4,a.commitTransaction()]:[3,10];case 9:v.sent(),v.label=10;case 10:return[2,p];case 11:if(y=v.sent(),!c)return[3,15];v.label=12;case 12:return v.trys.push([12,14,,15]),[4,a.rollbackTransaction()];case 13:return v.sent(),[3,15];case 14:return v.sent(),[3,15];case 15:throw y;case 16:return a===this.queryRunner?[3,18]:[4,a.release()];case 17:v.sent(),v.label=18;case 18:return this.connection.driver instanceof l.a&&!a.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,20];case 19:v.sent(),v.label=20;case 20:return[7];case 21:return[2]}})})},t.prototype.from=function(e,t){e=e instanceof p.EntitySchema?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new c.a;return this.expressionMap.returning=e,this},t.prototype.createDeleteExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),n=this.createReturningExpression();return n&&(this.connection.driver instanceof s.g||this.connection.driver instanceof i.a)?"DELETE FROM "+e+t+" RETURNING "+n:""!==n&&this.connection.driver instanceof o.a?"DELETE FROM "+e+" OUTPUT "+n+t:"DELETE FROM "+e+t},t}(a.a)},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(36),a=n(48),o=n(8),s=n(3),u=n(23),c=n(111),l=n(88),f=n(114),p=n(49),h=n(39),d=n(18),m=function(e){function t(){var n=e.call(this)||this;return n.name="LimitOnUpdateNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="Your database does not support LIMIT on UPDATE statements.",n}return r.c(t,e),t}(Error),y=n(12),v=function(e){function t(){var n=e.call(this)||this;return n.name="UpdateValuesMissingError",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.',n}return r.c(t,e),t}(Error),g=function(e){function t(n){var r=e.call(this)||this;return r.name="EntityColumnNotFound",Object.setPrototypeOf(r,t.prototype),r.message='No entity column "'+n+'" was found.',r}return r.c(t,e),t}(Error);n.d(t,"UpdateQueryBuilder",function(){return b});var b=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return r.c(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u,l,d;return r.d(this,function(m){switch(m.label){case 0:e=this.obtainQueryRunner(),t=!1,m.label=1;case 1:return m.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:m.sent(),t=!0,m.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(l=new h.a,e.broadcaster.broadcastBeforeUpdateEvent(l,this.expressionMap.mainAlias.metadata),l.promises.length>0?[4,Promise.all(l.promises)]:[3,5]):[3,5];case 4:m.sent(),m.label=5;case 5:return n=new f.a(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=n.getUpdationReturningColumns()),i=r.e(this.getQueryAndParameters(),2),a=i[0],o=i[1],s=new c.a,u=s,[4,e.query(a,o)];case 6:return u.raw=m.sent(),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,n.update(s,this.expressionMap.whereEntities)]:[3,8];case 7:m.sent(),m.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(l=new h.a,e.broadcaster.broadcastAfterUpdateEvent(l,this.expressionMap.mainAlias.metadata),l.promises.length>0?[4,Promise.all(l.promises)]:[3,10]):[3,10];case 9:m.sent(),m.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:m.sent(),m.label=12;case 12:return[2,s];case 13:if(d=m.sent(),!t)return[3,17];m.label=14;case 14:return m.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return m.sent(),[3,17];case 16:return m.sent(),[3,17];case 17:throw d;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:m.sent(),m.label=20;case 20:return this.connection.driver instanceof p.a&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:m.sent(),m.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new l.a;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),e?e instanceof Object?this.expressionMap.orderBys=e:this.expressionMap.orderBys=n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):this.expressionMap.orderBys={},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new Error(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=e instanceof Array?e:[e];return n.forEach(function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new Error("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)}),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r=[],a={},c=this.connection.driver instanceof s.e||this.connection.driver instanceof y.a||this.connection.driver instanceof d.a?0:Object.keys(this.expressionMap.nativeParameters).length;if(n?(u.a.createPropertyPath(n,t).forEach(function(i){var u=n.findColumnsWithPropertyPath(i);if(u.length<=0)throw new g(i);u.forEach(function(n){var i="upd_"+n.databaseName,u=n.getEntityValue(t);if(n.referencedColumn&&u instanceof Object?u=n.referencedColumn.getEntityValue(u):u instanceof Function||(u=e.connection.driver.preparePersistentValue(u,n)),u instanceof Function)r.push(e.escape(n.databaseName)+" = "+u());else{e.connection.driver instanceof o.a&&(u=e.connection.driver.parametrizeValue(n,u)),e.connection.driver instanceof s.e||e.connection.driver instanceof y.a||e.connection.driver instanceof d.a?a[i]=u:e.expressionMap.nativeParameters[i]=u;var l=null;l=e.connection.driver instanceof s.e&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?"GeomFromText("+e.connection.driver.createParameter(i,c)+")":e.connection.driver instanceof s.g&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?null!=n.srid?"ST_SetSRID(ST_GeomFromGeoJSON("+e.connection.driver.createParameter(i,c)+"), "+n.srid+")::"+n.type:"ST_GeomFromGeoJSON("+e.connection.driver.createParameter(i,c)+")::"+n.type:e.connection.driver.createParameter(i,c),r.push(e.escape(n.databaseName)+" = "+l),c++}})}),n.versionColumn&&r.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&r.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP")):Object.keys(t).map(function(n){var i=t[n];i instanceof Function?r.push(e.escape(n)+" = "+i()):(e.connection.driver instanceof s.e||e.connection.driver instanceof y.a||e.connection.driver instanceof d.a?a[n]=i:e.expressionMap.nativeParameters[n]=i,r.push(e.escape(n)+" = "+e.connection.driver.createParameter(n,c)),c++)}),r.length<=0)throw new v;(this.connection.driver instanceof s.e||this.connection.driver instanceof y.a||this.connection.driver instanceof d.a)&&(this.expressionMap.nativeParameters=Object.assign(a,this.expressionMap.nativeParameters));var l=this.createWhereExpression(),f=this.createReturningExpression();return f&&(this.connection.driver instanceof s.g||this.connection.driver instanceof y.a||this.connection.driver instanceof i.a)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+l+" RETURNING "+f:f&&this.connection.driver instanceof o.a?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+" OUTPUT "+f+l:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+l},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls}).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof s.e)return" LIMIT "+e;throw new m}return""},t.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new v},t}(a.a)},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(48),a=n(12),o=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,o,s,u,c,l,f,p,h,d,m,y=this;return r.d(this,function(r){switch(r.label){case 0:return(t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner?(c=t.joinColumns.reduce(function(t,n){var r=e instanceof Object?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,r),t},{}),!this.expressionMap.of||this.expressionMap.of instanceof Array&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(c).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return r.sent(),[3,10];case 2:return!t.isOneToOneNotOwner&&!t.isOneToMany||null!==e?[3,4]:(n={},t.inverseRelation.joinColumns.forEach(function(e){n[e.propertyName]=null}),f=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],i={},o=[],f.forEach(function(e,n){t.inverseRelation.joinColumns.map(function(t,r){var a="joinColumn_"+n+"_"+r;i[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,o.push(t.propertyPath+" = :"+a)})}),(s=o.map(function(e){return"("+e+")"}).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).where(s).setParameters(i).execute()]:[2]);case 3:return r.sent(),[3,10];case 4:if(!t.isOneToOneNotOwner&&!t.isOneToMany)return[3,6];if(this.expressionMap.of instanceof Array)throw new Error("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");return u=this.expressionMap.of,c=t.inverseRelation.joinColumns.reduce(function(e,t){var n=u instanceof Object?t.referencedColumn.getEntityValue(u):u;return t.setEntityValue(e,n),e},{}),!e||e instanceof Array&&!e.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(c).whereInIds(e).execute()];case 5:return r.sent(),[3,10];case 6:return l=t.junctionEntityMetadata,f=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],p=e instanceof Array?e:[e],h=t.isManyToManyOwner?f:p,d=t.isManyToManyOwner?p:f,m=[],h.forEach(function(e){d.forEach(function(t){var n={};l.ownerColumns.forEach(function(t){n[t.databaseName]=e instanceof Object?t.referencedColumn.getEntityValue(e):e}),l.inverseColumns.forEach(function(e){n[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t}),m.push(n)})}),m.length?this.queryBuilder.connection.driver instanceof a.a?[4,Promise.all(m.map(function(e){return y.queryBuilder.createQueryBuilder().insert().into(l.tableName).values(e).execute()}))]:[3,8]:[2];case 7:return r.sent(),[3,10];case 8:return[4,this.queryBuilder.createQueryBuilder().insert().into(l.tableName).values(m).execute()];case 9:r.sent(),r.label=10;case 10:return[2]}})})},e}(),s=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c,l,f,p,h,d;return r.d(this,function(m){switch(m.label){case 0:return(t=this.expressionMap.relationMetadata).isOneToMany?(u=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],n=e instanceof Array?e:[e],i={},t.inverseRelation.joinColumns.forEach(function(e){i[e.propertyName]=null}),a={},o=[],u.forEach(function(e,i){o.push.apply(o,r.f(n.map(function(n,o){return r.f(t.inverseRelation.joinColumns.map(function(t,n){var r="joinColumn_"+i+"_"+o+"_"+n;return a[r]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,t.propertyPath+" = :"+r}),t.inverseRelation.entityMetadata.primaryColumns.map(function(e,t){var r="primaryColumn_"+o+"_"+o+"_"+t;return a[r]=n instanceof Object?e.getEntityValue(n):n,e.propertyPath+" = :"+r})).join(" AND ")})))}),(d=o.map(function(e){return"("+e+")"}).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(i).where(d).setParameters(a).execute()]:[2]):[3,2];case 1:return m.sent(),[3,4];case 2:return s=t.junctionEntityMetadata,u=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],c=e instanceof Array?e:[e],l=t.isManyToManyOwner?u:c,f=t.isManyToManyOwner?c:u,p={},h=[],l.forEach(function(e,t){h.push.apply(h,r.f(f.map(function(n,i){return r.f(s.ownerColumns.map(function(n,r){var a="firstValue_"+t+"_"+i+"_"+r;return p[a]=e instanceof Object?n.referencedColumn.getEntityValue(e):e,n.databaseName+" = :"+a}),s.inverseColumns.map(function(r,a){var o="secondValue_"+t+"_"+i+"_"+a;return p[o]=e instanceof Object?r.referencedColumn.getEntityValue(n):n,r.databaseName+" = :"+o})).join(" AND ")})))}),d=h.map(function(e){return"("+e+")"}).join(" OR "),[4,this.queryBuilder.createQueryBuilder().delete().from(s.tableName).where(d).setParameters(p).execute()];case 3:m.sent(),m.label=4;case 4:return[2]}})})},e}();n.d(t,"RelationQueryBuilder",function(){return u});var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.c(t,e),t.prototype.getQuery=function(){return""},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw new Error('Set operation is only supported for many-to-one and one-to-one relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .add() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new o(this,this.expressionMap).update(e)]})})},t.prototype.add=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){if(e instanceof Array&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new o(this,this.expressionMap).update(e)]})})},t.prototype.remove=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){if(e instanceof Array&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set(null) method instead.");return[2,new s(this,this.expressionMap).remove(e)]})})},t.prototype.addAndRemove=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(n){switch(n.label){case 0:return[4,this.remove(t)];case 1:return n.sent(),[4,this.add(e)];case 2:return n.sent(),[2]}})})},t.prototype.loadOne=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,this.loadMany().then(function(e){return e[0]})]})})},t.prototype.loadMany=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.d(this,function(n){if(!((e=this.expressionMap.of)instanceof Object)){if((t=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new Error("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=t.primaryColumns[0].createValueMap(e)}return[2,this.connection.relationLoader.load(this.expressionMap.relationMetadata,e)]})})},t}(i.a)},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(36),a=n(48),o=n(8),s=n(3),u=n(52),c=n(110),l=n(88),f=function(e){function t(){var n=e.call(this)||this;return n.name="InsertValuesMissingError",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.',n}return r.c(t,e),t}(Error),p=n(114),h=n(18),d=n(49),m=n(39),y=n(13),v=n(12);n.d(t,"InsertQueryBuilder",function(){return g});var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.c(t,e),t.prototype.getQuery=function(){return this.createInsertExpression().trim()},t.prototype.execute=function(){return r.b(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u,l,f,h,y,v=this;return r.d(this,function(g){switch(g.label){case 0:e=this.obtainQueryRunner(),t=!1,g.label=1;case 1:return g.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:g.sent(),t=!0,g.label=3;case 3:return n=this.getValueSets(),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(i=new m.a,n.forEach(function(t){e.broadcaster.broadcastBeforeInsertEvent(i,v.expressionMap.mainAlias.metadata,t)}),i.promises.length>0?[4,Promise.all(i.promises)]:[3,5]):[3,5];case 4:g.sent(),g.label=5;case 5:return a=new p.a(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.extraReturningColumns=a.getInsertionReturningColumns()),o=r.e(this.getQueryAndParameters(),2),s=o[0],u=o[1],l=new c.a,f=l,[4,e.query(s,u)];case 6:return f.raw=g.sent(),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata?[4,a.insert(l,n)]:[3,8];case 7:g.sent(),g.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(h=new m.a,n.forEach(function(t){e.broadcaster.broadcastAfterInsertEvent(h,v.expressionMap.mainAlias.metadata,t)}),h.promises.length>0?[4,Promise.all(h.promises)]:[3,10]):[3,10];case 9:g.sent(),g.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:g.sent(),g.label=12;case 12:return[2,l];case 13:if(y=g.sent(),!t)return[3,17];g.label=14;case 14:return g.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return g.sent(),[3,17];case 16:return g.sent(),[3,17];case 17:throw y;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:g.sent(),g.label=20;case 20:return this.connection.driver instanceof d.a&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:g.sent(),g.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.into=function(e,t){e=e instanceof y.EntitySchema?e.options.name:e;var n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new l.a;return this.expressionMap.returning=e,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.orIgnore=function(e){return void 0===e&&(e=!0),this.expressionMap.onIgnore=e,this},t.prototype.orUpdate=function(e){return this.expressionMap.onUpdate={},e&&e.conflict_target instanceof Array&&(this.expressionMap.onUpdate.conflict=" ( "+e.conflict_target.join(", ")+" ) "),e&&"string"==typeof e.conflict_target&&(this.expressionMap.onUpdate.conflict=" ON CONSTRAINT "+e.conflict_target+" "),e&&e.columns instanceof Array&&(this.expressionMap.onUpdate.columns=e.columns.map(function(e){return e+" = :"+e}).join(", ")),e&&e.overwrite instanceof Array&&(this.connection.driver instanceof s.e?this.expressionMap.onUpdate.overwrite=e.overwrite.map(function(e){return e+" = VALUES("+e+")"}).join(", "):this.connection.driver instanceof s.g&&(this.expressionMap.onUpdate.overwrite=e.overwrite.map(function(e){return e+" = EXCLUDED."+e}).join(", "))),this},t.prototype.createInsertExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createValuesExpression(),n=this.createReturningExpression(),r=this.createColumnNamesExpression(),a="INSERT ";if(this.connection.driver instanceof s.e&&(a+=this.expressionMap.onIgnore?" IGNORE ":""),a+="INTO "+e,r?a+="("+r+")":!t&&this.connection.driver instanceof s.e&&(a+="()"),n&&this.connection.driver instanceof o.a&&(a+=" OUTPUT "+n),t?a+=" VALUES "+t:this.connection.driver instanceof s.e?a+=" VALUES ()":a+=" DEFAULT VALUES",this.connection.driver instanceof s.g||this.connection.driver instanceof h.a){if(a+=this.expressionMap.onIgnore?" ON CONFLICT DO NOTHING ":"",a+=this.expressionMap.onConflict?" ON CONFLICT "+this.expressionMap.onConflict:"",this.expressionMap.onUpdate){var u=this.expressionMap.onUpdate,c=u.overwrite,l=u.columns,f=u.conflict;a+=l?" ON CONFLICT "+f+" DO UPDATE SET "+l:"",a+=c?" ON CONFLICT "+f+" DO UPDATE SET "+c:""}}else if(this.connection.driver instanceof s.e&&this.expressionMap.onUpdate){var p=this.expressionMap.onUpdate;c=p.overwrite;a+=(l=p.columns)?" ON DUPLICATE KEY UPDATE "+l:"",a+=c?" ON DUPLICATE KEY UPDATE "+c:""}return n&&(this.connection.driver instanceof s.g||this.connection.driver instanceof v.a||this.connection.driver instanceof i.a)&&(a+=" RETURNING "+n),a},t.prototype.getInsertedColumns=function(){var e=this;return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(function(t){return e.expressionMap.insertColumns.length?-1!==e.expressionMap.insertColumns.indexOf(t.propertyPath):!t.isGenerated||"increment"!==t.generationStrategy||e.connection.driver instanceof v.a||e.connection.driver instanceof s.e}):[]},t.prototype.createColumnNamesExpression=function(){var e=this,t=this.getInsertedColumns();if(t.length>0)return t.map(function(t){return e.escape(t.databaseName)}).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){var n=this.getValueSets();if(1===n.length)return Object.keys(n[0]).map(function(t){return e.escape(t)}).join(", ")}return this.expressionMap.insertColumns.map(function(t){return e.escape(t)}).join(", ")},t.prototype.createValuesExpression=function(){var e=this,t=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){var r="",i=Object.keys(this.expressionMap.nativeParameters).length;return t.forEach(function(a,c){n.forEach(function(l,f){0===f&&(r+="(");var p="i"+c+"_"+l.databaseName,d=l.getEntityValue(a);if(d=e.connection.driver.preparePersistentValue(d,l),l.isVersion)r+="1";else if(l.isDiscriminator)e.expressionMap.nativeParameters.discriminator_value=e.expressionMap.mainAlias.metadata.discriminatorValue,r+=e.connection.driver.createParameter("discriminator_value",i),i++;else if(l.isGenerated&&"uuid"===l.generationStrategy&&!e.connection.driver.isUUIDGenerationSupported()&&void 0===d){var m="uuid_"+l.databaseName+c;d=u.a.uuid4(),e.expressionMap.nativeParameters[m]=d,r+=e.connection.driver.createParameter(m,i),i++}else void 0===d?e.connection.driver instanceof h.a?void 0!==l.default?r+=e.connection.driver.normalizeDefault(l):r+="NULL":r+="DEFAULT":d instanceof Function?r+=d():(e.connection.driver instanceof o.a&&(d=e.connection.driver.parametrizeValue(l,d)),e.expressionMap.nativeParameters[p]=d,e.connection.driver instanceof s.e&&-1!==e.connection.driver.spatialTypes.indexOf(l.type)?r+="GeomFromText("+e.connection.driver.createParameter(p,i)+")":e.connection.driver instanceof s.g&&-1!==e.connection.driver.spatialTypes.indexOf(l.type)?null!=l.srid?r+="ST_SetSRID(ST_GeomFromGeoJSON("+e.connection.driver.createParameter(p,i)+"), "+l.srid+")::"+l.type:r+="ST_GeomFromGeoJSON("+e.connection.driver.createParameter(p,i)+")::"+l.type:r+=e.connection.driver.createParameter(p,i),i++);f===n.length-1?c===t.length-1?r+=")":r+="), ":r+=", "})}),"()"===r?"":r}return t.map(function(t,n){var r=Object.keys(t).map(function(r){var i="i"+n+"_"+r,a=t[r];return a instanceof Function?a():void 0===a?e.connection.driver instanceof h.a?"NULL":"DEFAULT":(e.expressionMap.nativeParameters[i]=a,e.connection.driver.createParameter(i,Object.keys(e.expressionMap.nativeParameters).length-1))}).join(", ").trim();return r?"("+r+")":""}).join(", ")},t.prototype.getValueSets=function(){if(this.expressionMap.valuesSet instanceof Array&&this.expressionMap.valuesSet.length>0)return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new f},t}(a.a)},function(e,t,n){e.exports=n.p+"html/alphabeticListFragment.html"},function(e,t,n){e.exports=!n(34)&&!n(15)(function(){return 7!=Object.defineProperty(n(116)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(14),i=n(35),a=n(70),o=n(117),s=n(30).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,n){var r=n(45),i=n(47),a=n(96)(!1),o=n(118)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,c=[];for(n in s)n!=o&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(c,n)||c.push(n));return c}},function(e,t,n){var r=n(30),i=n(16),a=n(71);e.exports=n(34)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){var r=n(47),i=n(74).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?function(e){try{return i(e)}catch(e){return o.slice()}}(e):i(r(e))}},function(e,t,n){"use strict";var r=n(71),i=n(97),a=n(91),o=n(41),s=n(90),u=Object.assign;e.exports=!u||n(15)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=o(e),u=arguments.length,c=1,l=i.f,f=a.f;u>c;)for(var p,h=s(arguments[c++]),d=l?r(h).concat(l(h)):r(h),m=d.length,y=0;m>y;)f.call(h,p=d[y++])&&(n[p]=h[p]);return n}:u},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){"use strict";var r=n(59),i=n(17),a=n(155),o=[].slice,s={};e.exports=Function.bind||function(e){var t=r(this),n=o.call(arguments,1),u=function(){var r=n.concat(o.call(arguments));return this instanceof u?function(e,t,n){if(!(t in s)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";s[t]=Function("F,a","return new F("+r.join(",")+")")}return s[t](e,n)}(t,r.length,r):a(t,r,e)};return i(t.prototype)&&(u.prototype=t.prototype),u}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(14).parseInt,i=n(98).trim,a=n(123),o=/^[-+]?0[xX]/;e.exports=8!==r(a+"08")||22!==r(a+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(o.test(n)?16:10))}:r},function(e,t,n){var r=n(14).parseFloat,i=n(98).trim;e.exports=1/r(n(123)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},function(e,t,n){var r=n(60);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},function(e,t,n){var r=n(17),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,n){"use strict";var r=n(73),i=n(68),a=n(78),o={};n(46)(o,n(22)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var r=n(16);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},function(e,t,n){var r=n(59),i=n(41),a=n(90),o=n(27);e.exports=function(e,t,n,s,u){r(t);var c=i(e),l=a(c),f=o(c.length),p=u?f-1:0,h=u?-1:1;if(n<2)for(;;){if(p in l){s=l[p],p+=h;break}if(p+=h,u?p<0:f<=p)throw TypeError("Reduce of empty array with no initial value")}for(;u?p>=0:f>p;p+=h)p in l&&(s=t(s,l[p],p,c));return s}},function(e,t,n){"use strict";var r=n(41),i=n(72),a=n(27);e.exports=[].copyWithin||function(e,t){var n=r(this),o=a(n.length),s=i(e,o),u=i(t,o),c=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===c?o:i(c,o))-u,o-s),f=1;for(u<s&&s<u+l&&(f=-1,u+=l-1,s+=l-1);l-- >0;)u in n?n[s]=n[u]:delete n[s],s+=f,u+=f;return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";var r=n(138);n(4)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,n){n(34)&&"g"!=/./g.flags&&n(30).f(RegExp.prototype,"flags",{configurable:!0,get:n(100)})},function(e,t,n){"use strict";var r,i,a,o,s=n(70),u=n(14),c=n(58),l=n(92),f=n(4),p=n(17),h=n(59),d=n(82),m=n(103),y=n(93),v=n(140).set,g=n(320)(),b=n(169),E=n(321),T=n(104),w=n(170),N=u.TypeError,C=u.process,S=C&&C.versions,A=S&&S.v8||"",O=u.Promise,R="process"==l(C),M=function(){},_=i=b.f,P=!!function(){try{var e=O.resolve(1),t=(e.constructor={})[n(22)("species")]=function(e){e(M,M)};return(R||"function"==typeof PromiseRejectionEvent)&&e.then(M)instanceof t&&0!==A.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(e){}}(),x=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},I=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,i=1==e._s,a=0,o=function(t){var n,a,o,s=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(i||(2==e._h&&D(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),o=!0)),n===t.promise?c(N("Promise-chain cycle")):(a=x(n))?a.call(n,u,c):u(n)):c(r)}catch(e){l&&!o&&l.exit(),c(e)}};n.length>a;)o(n[a++]);e._c=[],e._n=!1,t&&!e._h&&L(e)})}},L=function(e){v.call(u,function(){var t,n,r,i=e._v,a=j(e);if(a&&(t=E(function(){R?C.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=R||j(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},j=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){v.call(u,function(){var t;R?C.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},k=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),I(t,!0))},q=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw N("Promise can't be resolved itself");(t=x(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,c(q,r,1),c(k,r,1))}catch(e){k.call(r,e)}}):(n._v=e,n._s=1,I(n,!1))}catch(e){k.call({_w:n,_d:!1},e)}}};P||(O=function(e){d(this,O,"Promise","_h"),h(e),r.call(this);try{e(c(q,this,1),c(k,this,1))}catch(e){k.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(83)(O.prototype,{then:function(e,t){var n=_(y(this,O));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=R?C.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&I(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r;this.promise=e,this.resolve=c(q,e,1),this.reject=c(k,e,1)},b.f=_=function(e){return e===O||e===o?new a(e):i(e)}),f(f.G+f.W+f.F*!P,{Promise:O}),n(78)(O,"Promise"),n(81)("Promise"),o=n(35).Promise,f(f.S+f.F*!P,"Promise",{reject:function(e){var t=_(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!P),"Promise",{resolve:function(e){return w(s&&this===o?O:this,e)}}),f(f.S+f.F*!(P&&n(99)(function(e){O.all(e).catch(M)})),"Promise",{all:function(e){var t=this,n=_(t),r=n.resolve,i=n.reject,a=E(function(){var n=[],a=0,o=1;m(e,!1,function(e){var s=a++,u=!1;n.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--o||r(n))},i)}),--o||r(n)});return a.e&&i(a.v),n.promise},race:function(e){var t=this,n=_(t),r=n.reject,i=E(function(){m(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(e,t,n){"use strict";var r=n(59);function i(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},function(e,t,n){var r=n(16),i=n(17),a=n(169);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(30).f,i=n(73),a=n(83),o=n(58),s=n(82),u=n(103),c=n(129),l=n(165),f=n(81),p=n(34),h=n(64).fastKey,d=n(76),m=p?"_s":"size",y=function(e,t){var n,r=h(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e(function(e,r){s(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,null!=r&&u(r,n,e[c],e)});return a(l.prototype,{clear:function(){for(var e=d(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var n=d(this,t),r=y(n,e);if(r){var i=r.n,a=r.p;delete n._i[r.i],r.r=!0,a&&(a.n=i),i&&(i.p=a),n._f==r&&(n._f=i),n._l==r&&(n._l=a),n[m]--}return!!r},forEach:function(e){d(this,t);for(var n,r=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(d(this,t),e)}}),p&&r(l.prototype,"size",{get:function(){return d(this,t)[m]}}),l},def:function(e,t,n){var r,i,a=y(e,t);return a?a.v=n:(e._l=a={i:i=h(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[m]++,"F"!==i&&(e._i[i]=a)),e},getEntry:y,setStrong:function(e,t,n){c(e,t,function(e,n){this._t=d(e,t),this._k=n,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))},n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){"use strict";var r=n(83),i=n(64).getWeak,a=n(16),o=n(17),s=n(82),u=n(103),c=n(56),l=n(45),f=n(76),p=c(5),h=c(6),d=0,m=function(e){return e._l||(e._l=new y)},y=function(){this.a=[]},v=function(e,t){return p(e.a,function(e){return e[0]===t})};y.prototype={get:function(e){var t=v(this,e);if(t)return t[1]},has:function(e){return!!v(this,e)},set:function(e,t){var n=v(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=h(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,a){var c=e(function(e,r){s(e,c,t,"_i"),e._t=t,e._i=d++,e._l=void 0,null!=r&&u(r,n,e[a],e)});return r(c.prototype,{delete:function(e){if(!o(e))return!1;var n=i(e);return!0===n?m(f(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!o(e))return!1;var n=i(e);return!0===n?m(f(this,t)).has(e):n&&l(n,this._i)}}),c},def:function(e,t,n){var r=i(a(t),!0);return!0===r?m(e).set(t,n):r[e._i]=n,e},ufstore:m}},function(e,t,n){var r=n(53),i=n(27);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){var r=n(74),i=n(97),a=n(16),o=n(14).Reflect;e.exports=o&&o.ownKeys||function(e){var t=r.f(a(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){var r=n(27),i=n(125),a=n(61);e.exports=function(e,t,n,o){var s=String(a(e)),u=s.length,c=void 0===n?" ":String(n),l=r(t);if(l<=u||""==c)return s;var f=l-u,p=i.call(c,Math.ceil(f/c.length));return p.length>f&&(p=p.slice(0,f)),o?p+s:s+p}},function(e,t,n){var r=n(71),i=n(47),a=n(91).f;e.exports=function(e){return function(t){for(var n,o=i(t),s=r(o),u=s.length,c=0,l=[];u>c;)a.call(o,n=s[c++])&&l.push(e?[n,o[n]]:o[n]);return l}}},function(e){e.exports={events:"Veranstaltungen",churches:"Kirchen","about us":"Über uns",language:"Sprache DE/EN",contact:"Kontakt","privacy policy":"Datenschutz",imprint:"Impressum",churchoverview:"Gemeindeübersicht","Here you can find all churches and organizations in Cologne that share their events through ECHO.":"Hier findest du alle Gemeinden und Organisationen in Köln, die ihre Veranstaltungen über ECHO teilen.","Find out more":"Mehr erfahren","multiple locations":"mehrere Standorte","document-title":"ECHO",uhr:"Uhr"}},function(e){e.exports={}},function(e,t,n){e.exports=n.p+"html/tabFragment.html"},function(e,t,n){e.exports=n.p+"html/navbar.html"},function(e,t,n){e.exports=n.p+"html/menuSite.html"},function(e,t,n){e.exports=n.p+"html/swipeFragment.html"},function(e,t,n){e.exports=n.p+"html/chooseDialog.html"},function(e){e.exports={Sunday:"Sonntag",Monday:"Montag",Tuesday:"Dienstag",Wednesday:"Mittwoch",Thursday:"Donnerstag",Friday:"Freitag",Saturday:"Samstag",January:"Januar",February:"Februar",March:"März",April:"April",May:"Mai",June:"Juni",July:"Juli",August:"August",September:"September",October:"Oktober",November:"November",December:"Dezember",Sun:"So",Mon:"Mo",Tue:"Di",Wed:"Mi",Thu:"Do",Fri:"Fr",Sat:"Sa",Jan:"Jan",Feb:"Feb",Mar:"Mär",Apr:"Apr",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Okt",Nov:"Nov",Dec:"Dez"}},function(e){e.exports={Sunday:"Sunday",Monday:"Monday",Tuesday:"Tuesday",Wednesday:"Wednesday",Thursday:"Thursday",Friday:"Friday",Saturday:"Saturday",January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December",Sun:"Sun",Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri",Sat:"Sat",Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec"}},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r=n(0),i=n(57),a=n(37),o=n(11),s=n(2),u=n(26),c=n(24),l=n(21),f=n(20),p=n(5),h=n(28),d=n(9),m=n(29),y=n(67),v=n(32),g=n(13),b=function(e){function t(t,n){void 0===n&&(n="master");var r=e.call(this)||this;return r.queryResponsibilityChain=[],r.driver=t,r.connection=t.connection,r.broadcaster=new v.a(r),r.mode=n,r}return r.c(t,e),t.prototype.connect=function(){return Promise.resolve()},t.prototype.release=function(){return this.isReleased=!0,Promise.resolve()},t.prototype.startTransaction=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.d(this,function(n){if(this.isReleased)throw new l.a;if(this.isTransactionActive)throw new i.a;return[2,new Promise(function(n,i){return r.b(t,void 0,void 0,function(){var t,a,o=this;return r.d(this,function(r){switch(r.label){case 0:return this.isTransactionActive=!0,[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return t=r.sent(),this.databaseConnection=t.transaction(),a=function(t){if(t)return o.isTransactionActive=!1,i(t);n(),o.connection.logger.logQuery("BEGIN TRANSACTION"),e&&o.connection.logger.logQuery("SET TRANSACTION ISOLATION LEVEL "+e)},e?this.databaseConnection.begin(this.convertIsolationLevel(e),a):this.databaseConnection.begin(a),[2]}})})})]})})},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){if(this.isReleased)throw new l.a;if(!this.isTransactionActive)throw new a.a;return[2,new Promise(function(t,n){e.databaseConnection.commit(function(r){if(r)return n(r);e.isTransactionActive=!1,e.databaseConnection=null,t(),e.connection.logger.logQuery("COMMIT")})})]})})},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){if(this.isReleased)throw new l.a;if(!this.isTransactionActive)throw new a.a;return[2,new Promise(function(t,n){e.databaseConnection.rollback(function(r){if(r)return n(r);e.isTransactionActive=!1,e.databaseConnection=null,t(),e.connection.logger.logQuery("ROLLBACK")})})]})})},t.prototype.query=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s=this;return r.d(this,function(u){switch(u.label){case 0:if(this.isReleased)throw new l.a;return i=new Promise(function(e){return n=e}),this.queryResponsibilityChain.length?(a=r.f(this.queryResponsibilityChain),this.queryResponsibilityChain.push(i),[4,Promise.all(a)]):[3,2];case 1:u.sent(),u.label=2;case 2:return o=new Promise(function(a,u){return r.b(s,void 0,void 0,function(){var s,c,l,p,d=this;return r.d(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return s=r.sent(),c=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:s),t&&t.length&&t.forEach(function(e,t){if(e instanceof f.a){var n=d.mssqlParameterToNativeParameter(e);n?c.input(t,n,e.value):c.input(t,e.value)}else c.input(t,e)}),l=+new Date,c.query(e,function(r,s){var c=d.driver.connection.options.maxQueryExecutionTime,f=+new Date-l;c&&f>c&&d.driver.connection.logger.logQuerySlow(f,e,t,d);var p=function(){-1!==m&&d.queryResponsibilityChain.splice(m,1),-1!==y&&d.queryResponsibilityChain.splice(y,1),n()},m=d.queryResponsibilityChain.indexOf(o),y=d.queryResponsibilityChain.indexOf(i);if(r)return d.driver.connection.logger.logQueryError(r,e,t,d),p(),u(new h.a(e,t,r));switch(e.slice(0,e.indexOf(" "))){case"DELETE":a([s.recordset,s.rowsAffected[0]]);break;default:a(s.recordset)}p()}),[3,3];case 2:return p=r.sent(),u(p),[3,3];case 3:return[2]}})})}),this.queryResponsibilityChain.push(o),[2,o]}})})},t.prototype.stream=function(e,t,n,i){return r.b(this,void 0,void 0,function(){var a,o,s,u,c=this;return r.d(this,function(p){switch(p.label){case 0:if(this.isReleased)throw new l.a;return o=new Promise(function(e){return a=e}),this.queryResponsibilityChain.length?(s=r.f(this.queryResponsibilityChain),this.queryResponsibilityChain.push(o),[4,Promise.all(s)]):[3,2];case 1:p.sent(),p.label=2;case 2:return u=new Promise(function(s,l){return r.b(c,void 0,void 0,function(){var c,p,h=this;return r.d(this,function(r){switch(r.label){case 0:return this.driver.connection.logger.logQuery(e,t,this),[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return c=r.sent(),(p=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:c)).stream=!0,t&&t.length&&t.forEach(function(e,t){e instanceof f.a?p.input(t,h.mssqlParameterToNativeParameter(e),e.value):p.input(t,e)}),p.query(e,function(n,r){var i=function(){-1!==c&&h.queryResponsibilityChain.splice(c,1),-1!==f&&h.queryResponsibilityChain.splice(f,1),a()},c=h.queryResponsibilityChain.indexOf(u),f=h.queryResponsibilityChain.indexOf(o);if(n)return h.driver.connection.logger.logQueryError(n,e,t,h),i(),l(n);s(r.recordset),i()}),n&&p.on("done",n),i&&p.on("error",i),s(p),[2]}})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(u),[2,u]}})})},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return[4,this.query("EXEC sp_databases")];case 1:return[2,e.sent().map(function(e){return e.DATABASE_NAME})]}})})},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return t=e?'SELECT * FROM "'+e+'"."sys"."schema"':'SELECT * FROM "sys"."schemas"',[4,this.query(t)];case 1:return[2,n.sent().map(function(e){return e.name})]}})})},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return[4,this.query("SELECT DB_ID('"+e+'\') as "db_id"')];case 1:return t=n.sent(),[2,!!t[0].db_id]}})})},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return[4,this.query("SELECT SCHEMA_ID('"+e+'\') as "schema_id"')];case 1:return t=n.sent(),[2,!!t[0].schema_id]}})})},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,function(){var t,n,i;return r.d(this,function(r){switch(r.label){case 0:return t=this.parseTableName(e),n="SCHEMA_NAME()"===t.schema?t.schema:"'"+t.schema+"'",i='SELECT * FROM "'+t.database+'"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = \''+t.tableName+'\' AND "TABLE_SCHEMA" = '+n,[4,this.query(i)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a;return r.d(this,function(r){switch(r.label){case 0:return n=this.parseTableName(e),i="SCHEMA_NAME()"===n.schema?n.schema:"'"+n.schema+"'",a='SELECT * FROM "'+n.database+'"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = \''+n.tableName+"' AND \"COLUMN_NAME\" = '"+t+'\' AND "TABLE_SCHEMA" = '+i,[4,this.query(a)];case 1:return[2,!!r.sent().length]}})})},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n=t?"IF DB_ID('"+e+"') IS NULL CREATE DATABASE \""+e+'"':'CREATE DATABASE "'+e+'"',i='DROP DATABASE "'+e+'"',[4,this.executeQueries(n,i)];case 1:return r.sent(),[2]}})})},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n=t?"IF DB_ID('"+e+"') IS NOT NULL DROP DATABASE \""+e+'"':'DROP DATABASE "'+e+'"',i='CREATE DATABASE "'+e+'"',[4,this.executeQueries(n,i)];case 1:return r.sent(),[2]}})})},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s,u;return r.d(this,function(r){switch(r.label){case 0:return n=[],i=[],-1!==e.indexOf(".")?[3,1]:(u=t?"IF SCHEMA_ID('"+e+"') IS NULL BEGIN EXEC ('CREATE SCHEMA \""+e+"\"') END":'CREATE SCHEMA "'+e+'"',n.push(u),i.push('DROP SCHEMA "'+e+'"'),[3,3]);case 1:return a=e.split(".")[0],o=e.split(".")[1],[4,this.getCurrentDatabase()];case 2:s=r.sent(),n.push('USE "'+a+'"'),i.push('USE "'+s+'"'),u=t?"IF SCHEMA_ID('"+o+"') IS NULL BEGIN EXEC ('CREATE SCHEMA \""+o+"\"') END":'CREATE SCHEMA "'+o+'"',n.push(u),i.push('DROP SCHEMA "'+o+'"'),n.push('USE "'+s+'"'),i.push('USE "'+a+'"'),r.label=3;case 3:return[4,this.executeQueries(n,i)];case 4:return r.sent(),[2]}})})},t.prototype.dropSchema=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,s,u;return r.d(this,function(r){switch(r.label){case 0:return n=[],i=[],-1!==e.indexOf(".")?[3,1]:(u=t?"IF SCHEMA_ID('"+e+"') IS NULL BEGIN EXEC ('DROP SCHEMA \""+e+"\"') END":'DROP SCHEMA "'+e+'"',n.push(u),i.push('CREATE SCHEMA "'+e+'"'),[3,3]);case 1:return a=e.split(".")[0],o=e.split(".")[1],[4,this.getCurrentDatabase()];case 2:s=r.sent(),n.push('USE "'+a+'"'),i.push('USE "'+s+'"'),u=t?"IF SCHEMA_ID('"+o+"') IS NULL BEGIN EXEC ('DROP SCHEMA \""+o+"\"') END":'DROP SCHEMA "'+o+'"',n.push(u),i.push('CREATE SCHEMA "'+o+'"'),n.push('USE "'+s+'"'),i.push('USE "'+a+'"'),r.label=3;case 3:return[4,this.executeQueries(n,i)];case 4:return r.sent(),[2]}})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,function(){var a,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return o.push(s.dropForeignKeySql(e,t))}),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,function(){var a,o,u,c,l,f=this;return r.d(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof s.a?(u=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:u=r.sent(),r.label=5;case 5:return o=u,c=[],l=[],i&&o.indices.forEach(function(e){c.push(f.dropIndexSql(o,e)),l.push(f.createIndexSql(o,e))}),n&&o.foreignKeys.forEach(function(e){return c.push(f.dropForeignKeySql(o,e))}),c.push(this.dropTableSql(o)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u,c,l,f,p,h,d,m,y,v=this;return r.d(this,function(r){switch(r.label){case 0:return n=[],i=[],e instanceof s.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return u=(a=o).clone(),c=void 0,l=void 0,f=a.name,3===(p=a.name.split(".")).length?(c=p[0],f=p[2],""!==p[1]&&(l=p[1])):2===p.length&&(l=p[0],f=p[1]),u.name=this.driver.buildTableName(t,l,c),[4,this.getCurrentDatabase()];case 4:return h=r.sent(),c&&c!==h&&(n.push('USE "'+c+'"'),i.push('USE "'+h+'"')),n.push('EXEC sp_rename "'+this.escapeTableName(a,!0)+'", "'+t+'"'),i.push('EXEC sp_rename "'+this.escapeTableName(u,!0)+'", "'+f+'"'),u.primaryColumns.length>0&&(d=u.primaryColumns.map(function(e){return e.name}),m=this.connection.namingStrategy.primaryKeyName(a,d),y=this.connection.namingStrategy.primaryKeyName(u,d),n.push('EXEC sp_rename "'+this.escapeTableName(u,!0)+"."+m+'", "'+y+'"'),i.push('EXEC sp_rename "'+this.escapeTableName(u,!0)+"."+y+'", "'+m+'"')),u.uniques.forEach(function(e){var t=v.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);n.push('EXEC sp_rename "'+v.escapeTableName(u,!0)+"."+e.name+'", "'+t+'"'),i.push('EXEC sp_rename "'+v.escapeTableName(u,!0)+"."+t+'", "'+e.name+'"'),e.name=t}),u.indices.forEach(function(e){var t=v.connection.namingStrategy.indexName(u,e.columnNames,e.where);n.push('EXEC sp_rename "'+v.escapeTableName(u,!0)+"."+e.name+'", "'+t+'", "INDEX"'),i.push('EXEC sp_rename "'+v.escapeTableName(u,!0)+"."+t+'", "'+e.name+'", "INDEX"'),e.name=t}),u.foreignKeys.forEach(function(e){var t=v.connection.namingStrategy.foreignKeyName(u,e.columnNames);n.push('EXEC sp_rename "'+v.buildForeignKeyName(e.name,l,c)+'", "'+t+'"'),i.push('EXEC sp_rename "'+v.buildForeignKeyName(t,l,c)+'", "'+e.name+'"'),e.name=t}),c&&c!==h&&(n.push('USE "'+h+'"'),i.push('USE "'+c+'"')),[4,this.executeQueries(n,i)];case 5:return r.sent(),a.name=u.name,this.replaceCachedTable(a,u),[2]}})})},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u,c,l,f,p,h,m,y,v;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),u=[],(o=[]).push("ALTER TABLE "+this.escapeTableName(n)+" ADD "+this.buildCreateColumnSql(n,t,!1,!1)),u.push("ALTER TABLE "+this.escapeTableName(n)+' DROP COLUMN "'+t.name+'"'),t.isPrimary&&((c=a.primaryColumns).length>0&&(l=this.connection.namingStrategy.primaryKeyName(a.name,c.map(function(e){return e.name})),f=c.map(function(e){return'"'+e.name+'"'}).join(", "),o.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+l+'"'),u.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+l+'" PRIMARY KEY ('+f+")")),c.push(t),p=this.connection.namingStrategy.primaryKeyName(a.name,c.map(function(e){return e.name})),h=c.map(function(e){return'"'+e.name+'"'}).join(", "),o.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+h+")"),u.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+p+'"')),(m=a.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))&&(o.push(this.createIndexSql(n,m)),u.push(this.dropIndexSql(n,m))),t.isUnique&&(y=new d.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(y),o.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+y.name+'" UNIQUE ("'+t.name+'")'),u.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+y.name+'"')),null!==t.default&&void 0!==t.default&&(v=this.connection.namingStrategy.defaultConstraintName(n.name,t.name),o.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+v+'" DEFAULT '+t.default+' FOR "'+t.name+'"'),u.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+v+'"')),[4,this.executeQueries(o,u)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}})})},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,g.PromiseUtils.runInSequence(t,function(t){return n.addColumn(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,u,c;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(u=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c=void 0,n instanceof o.a?c=n:(c=u.clone()).name=n,[4,this.changeColumn(i,u,c)];case 4:return r.sent(),[2]}})})},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,u,c,l,f,p,h,m,y,v,g,b,E,T,w,N,C,S,A=this;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(u=(i=a).clone(),c=[],l=[],!(f=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n.isGenerated!==f.isGenerated&&"uuid"!==n.generationStrategy||n.type!==f.type||n.length!==f.length?[4,this.dropColumn(i,f)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),u=i.clone(),[3,10];case 6:return n.name===f.name?[3,8]:(p=void 0,h=void 0,3===(m=i.name.split(".")).length?(p=m[0],""!==m[1]&&(h=m[1])):2===m.length&&(h=m[0]),[4,this.getCurrentDatabase()]);case 7:y=r.sent(),p&&p!==y&&(c.push('USE "'+p+'"'),l.push('USE "'+y+'"')),c.push('EXEC sp_rename "'+this.escapeTableName(i,!0)+"."+f.name+'", "'+n.name+'"'),l.push('EXEC sp_rename "'+this.escapeTableName(i,!0)+"."+n.name+'", "'+f.name+'"'),!0===f.isPrimary&&(E=u.primaryColumns,N=E.map(function(e){return e.name}),v=this.connection.namingStrategy.primaryKeyName(u,N),N.splice(N.indexOf(f.name),1),N.push(n.name),g=this.connection.namingStrategy.primaryKeyName(u,N),c.push('EXEC sp_rename "'+this.escapeTableName(u,!0)+"."+v+'", "'+g+'"'),l.push('EXEC sp_rename "'+this.escapeTableName(u,!0)+"."+g+'", "'+v+'"')),u.findColumnIndices(f).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=A.connection.namingStrategy.indexName(u,e.columnNames,e.where);c.push('EXEC sp_rename "'+A.escapeTableName(u,!0)+"."+e.name+'", "'+t+'", "INDEX"'),l.push('EXEC sp_rename "'+A.escapeTableName(u,!0)+"."+t+'", "'+e.name+'", "INDEX"'),e.name=t}),u.findColumnForeignKeys(f).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=A.connection.namingStrategy.foreignKeyName(u,e.columnNames);c.push('EXEC sp_rename "'+A.buildForeignKeyName(e.name,h,p)+'", "'+t+'"'),l.push('EXEC sp_rename "'+A.buildForeignKeyName(t,h,p)+'", "'+e.name+'"'),e.name=t}),u.findColumnChecks(f).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=A.connection.namingStrategy.checkConstraintName(u,e.expression);c.push('EXEC sp_rename "'+A.escapeTableName(u,!0)+"."+e.name+'", "'+t+'"'),l.push('EXEC sp_rename "'+A.escapeTableName(u,!0)+"."+t+'", "'+e.name+'"'),e.name=t}),u.findColumnUniques(f).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=A.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);c.push('EXEC sp_rename "'+A.escapeTableName(u,!0)+"."+e.name+'", "'+t+'"'),l.push('EXEC sp_rename "'+A.escapeTableName(u,!0)+"."+t+'", "'+e.name+'"'),e.name=t}),p&&p!==y&&(c.push('USE "'+y+'"'),l.push('USE "'+p+'"')),b=u.columns.find(function(e){return e.name===f.name}),u.columns[u.columns.indexOf(b)].name=n.name,f.name=n.name,r.label=8;case 8:return this.isColumnChanged(f,n)&&(c.push("ALTER TABLE "+this.escapeTableName(i)+" ALTER COLUMN "+this.buildCreateColumnSql(i,n,!0,!1)),l.push("ALTER TABLE "+this.escapeTableName(i)+" ALTER COLUMN "+this.buildCreateColumnSql(i,f,!0,!1))),n.isPrimary!==f.isPrimary&&((E=u.primaryColumns).length>0&&(w=this.connection.namingStrategy.primaryKeyName(u.name,E.map(function(e){return e.name})),N=E.map(function(e){return'"'+e.name+'"'}).join(", "),c.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+w+'"'),l.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+N+")")),!0===n.isPrimary?(E.push(n),u.columns.find(function(e){return e.name===n.name}).isPrimary=!0,w=this.connection.namingStrategy.primaryKeyName(u.name,E.map(function(e){return e.name})),N=E.map(function(e){return'"'+e.name+'"'}).join(", "),c.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+N+")"),l.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+w+'"')):(T=E.find(function(e){return e.name===n.name}),E.splice(E.indexOf(T),1),u.columns.find(function(e){return e.name===n.name}).isPrimary=!1,E.length>0&&(w=this.connection.namingStrategy.primaryKeyName(u.name,E.map(function(e){return e.name})),N=E.map(function(e){return'"'+e.name+'"'}).join(", "),c.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+N+")"),l.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+w+'"')))),n.isUnique!==f.isUnique&&(!0===n.isUnique?(C=new d.a({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),u.uniques.push(C),c.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+C.name+'" UNIQUE ("'+n.name+'")'),l.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+C.name+'"')):(C=u.uniques.find(function(e){return 1===e.columnNames.length&&!!e.columnNames.find(function(e){return e===n.name})}),u.uniques.splice(u.uniques.indexOf(C),1),c.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+C.name+'"'),l.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+C.name+'" UNIQUE ("'+n.name+'")'))),n.default!==f.default&&(null!==n.default&&void 0!==n.default?(S=this.connection.namingStrategy.defaultConstraintName(i.name,n.name),c.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+S+'" DEFAULT '+n.default+' FOR "'+n.name+'"'),l.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+S+'"')):null!==f.default&&void 0!==f.default&&(S=this.connection.namingStrategy.defaultConstraintName(i.name,f.name),c.push("ALTER TABLE "+this.escapeTableName(i)+' DROP CONSTRAINT "'+S+'"'),l.push("ALTER TABLE "+this.escapeTableName(i)+' ADD CONSTRAINT "'+S+'" DEFAULT '+f.default+' FOR "'+f.name+'"'))),[4,this.executeQueries(c,l)];case 9:r.sent(),this.replaceCachedTable(i,u),r.label=10;case 10:return[2]}})})},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,g.PromiseUtils.runInSequence(t,function(t){return n.changeColumn(e,t.oldColumn,t.newColumn)})];case 1:return r.sent(),[2]}})})},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,u,c,l,f,p,h,d,m,y,v,g;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return u=n.clone(),c=[],l=[],a.isPrimary&&(f=this.connection.namingStrategy.primaryKeyName(u.name,u.primaryColumns.map(function(e){return e.name})),p=u.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),c.push("ALTER TABLE "+this.escapeTableName(u)+' DROP CONSTRAINT "'+f+'"'),l.push("ALTER TABLE "+this.escapeTableName(u)+' ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+p+")"),u.findColumnByName(a.name).isPrimary=!1,u.primaryColumns.length>0&&(h=this.connection.namingStrategy.primaryKeyName(u.name,u.primaryColumns.map(function(e){return e.name})),d=u.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),c.push("ALTER TABLE "+this.escapeTableName(u)+' ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+d+")"),l.push("ALTER TABLE "+this.escapeTableName(u)+' DROP CONSTRAINT "'+h+'"'))),(m=u.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(u.indices.splice(u.indices.indexOf(m),1),c.push(this.dropIndexSql(n,m)),l.push(this.createIndexSql(n,m))),(y=u.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(u.checks.splice(u.checks.indexOf(y),1),c.push(this.dropCheckConstraintSql(n,y)),l.push(this.createCheckConstraintSql(n,y))),(v=u.uniques.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(u.uniques.splice(u.uniques.indexOf(v),1),c.push(this.dropUniqueConstraintSql(n,v)),l.push(this.createUniqueConstraintSql(n,v))),null!==a.default&&void 0!==a.default&&(g=this.connection.namingStrategy.defaultConstraintName(n.name,a.name),c.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+g+'"'),l.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+g+'" DEFAULT '+a.default+' FOR "'+a.name+'"')),c.push("ALTER TABLE "+this.escapeTableName(n)+' DROP COLUMN "'+a.name+'"'),l.push("ALTER TABLE "+this.escapeTableName(n)+" ADD "+this.buildCreateColumnSql(n,a,!1,!1)),[4,this.executeQueries(c,l)];case 4:return r.sent(),u.removeColumn(a),this.replaceCachedTable(n,u),[2]}})})},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,g.PromiseUtils.runInSequence(t,function(t){return n.dropColumn(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),u=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u,c,l,f,p,h,d;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=t.map(function(e){return e.name}),u=[],c=[],(l=a.primaryColumns).length>0&&(f=this.connection.namingStrategy.primaryKeyName(a.name,l.map(function(e){return e.name})),p=l.map(function(e){return'"'+e.name+'"'}).join(", "),u.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+f+'"'),c.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+p+")")),a.columns.filter(function(e){return-1!==o.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),h=this.connection.namingStrategy.primaryKeyName(a.name,o),d=o.map(function(e){return'"'+e+'"'}).join(", "),u.push("ALTER TABLE "+this.escapeTableName(n)+' ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+d+")"),c.push("ALTER TABLE "+this.escapeTableName(n)+' DROP CONSTRAINT "'+h+'"'),[4,this.executeQueries(u,c)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name})),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createUniqueConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.a?t:n.uniques.find(function(e){return e.name===t})))throw new Error("Supplied unique constraint was not found in table "+n.name);return o=this.dropUniqueConstraintSql(n,a),u=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropUniqueConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof m.a?t:n.checks.find(function(e){return e.name===t})))throw new Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),u=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("SqlServer does not support exclusion constraints.")})})},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("SqlServer does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("SqlServer does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("SqlServer does not support exclusion constraints.")})})},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,c;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof u.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),c=this.createForeignKeySql(n,a),[4,this.executeQueries(o,c)];case 4:return r.sent(),n.removeForeignKey(a),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.a?t:n.indices.find(function(e){return e.name===t})))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(n,a),u=this.createIndexSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapeTableName(e))];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a=this;return r.d(this,function(o){switch(o.label){case 0:return e?[4,this.hasDatabase(e)]:[3,2];case 1:if(!o.sent())return[2,Promise.resolve()];o.label=2;case 2:return[4,this.startTransaction()];case 3:o.sent(),o.label=4;case 4:return o.trys.push([4,9,,14]),t=e?'SELECT * FROM "'+e+'"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_TYPE" = \'BASE TABLE\'':'SELECT * FROM "INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_TYPE" = \'BASE TABLE\'',[4,this.query(t)];case 5:return n=o.sent(),[4,Promise.all(n.map(function(e){return r.b(a,void 0,void 0,function(){var t,n,i=this;return r.d(this,function(r){switch(r.label){case 0:return t="SELECT 'ALTER TABLE \""+e.TABLE_CATALOG+'"."\' + OBJECT_SCHEMA_NAME("fk"."parent_object_id", DB_ID(\''+e.TABLE_CATALOG+'\')) + \'"."\' + OBJECT_NAME("fk"."parent_object_id", DB_ID(\''+e.TABLE_CATALOG+'\')) + \'" DROP CONSTRAINT "\' + "fk"."name" + \'"\' as "query" FROM "'+e.TABLE_CATALOG+'"."sys"."foreign_keys" AS "fk" WHERE "fk"."referenced_object_id" = OBJECT_ID(\'"'+e.TABLE_CATALOG+'"."'+e.TABLE_SCHEMA+'"."'+e.TABLE_NAME+"\"')",[4,this.query(t)];case 1:return n=r.sent(),[2,Promise.all(n.map(function(e){return e.query}).map(function(e){return i.query(e)}))]}})})}))];case 6:return o.sent(),[4,Promise.all(n.map(function(e){var t='DROP TABLE "'+e.TABLE_CATALOG+'"."'+e.TABLE_SCHEMA+'"."'+e.TABLE_NAME+'"';return a.query(t)}))];case 7:return o.sent(),[4,this.commitTransaction()];case 8:return o.sent(),[3,14];case 9:i=o.sent(),o.label=10;case 10:return o.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:return o.sent(),[3,13];case 12:return o.sent(),[3,13];case 13:throw i;case 14:return[2]}})})},t.prototype.getCurrentDatabase=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT DB_NAME() AS "db_name"')];case 1:return[2,e.sent()[0].db_name]}})})},t.prototype.getCurrentSchema=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT SCHEMA_NAME() AS "schema_name"')];case 1:return[2,e.sent()[0].schema_name]}})})},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,l,f,h,y,v,g,b,E,T,w,N,C,S,A,O,R,M,_,P=this;return r.d(this,function(x){switch(x.label){case 0:return e&&e.length?(t=[],[4,this.getCurrentSchema()]):[2,[]];case 1:return n=x.sent(),[4,this.getCurrentDatabase()];case 2:return i=x.sent(),a=function(e){var t=r.e(e.split("."),3),i=t[0],a=t[1],o=t[2];return o?""===a&&(a=P.driver.options.schema||n):a?(o=a,a=i):(o=i,a=P.driver.options.schema||n),[a,o]},e.filter(function(e){return-1!==e.indexOf(".")}).forEach(function(e){3===e.split(".").length?""!==e.split(".")[1]&&t.push(e.split(".")[1]):t.push(e.split(".")[0])}),t.push(this.driver.options.schema||n),l=e.filter(function(e){return 3===e.split(".").length}).map(function(e){return e.split(".")[0]}),this.driver.database&&!l.find(function(e){return e===P.driver.database})&&l.push(this.driver.database),f=t.map(function(e){return"'"+e+"'"}).join(", "),h=e.map(function(e){var t=r.e(a(e),2);return'("TABLE_SCHEMA" = \''+t[0]+"' AND \"TABLE_NAME\" = '"+t[1]+"')"}).join(" OR "),y=l.map(function(e){return'SELECT * FROM "'+e+'"."INFORMATION_SCHEMA"."TABLES" WHERE '+h}).join(" UNION ALL "),v=l.map(function(e){return'SELECT * FROM "'+e+'"."INFORMATION_SCHEMA"."COLUMNS" WHERE '+h}).join(" UNION ALL "),g=e.map(function(e){var t=r.e(a(e),2),n=t[0],i=t[1];return'("columnUsages"."TABLE_SCHEMA" = \''+n+'\' AND "columnUsages"."TABLE_NAME" = \''+i+'\' AND "tableConstraints"."TABLE_SCHEMA" = \''+n+'\' AND "tableConstraints"."TABLE_NAME" = \''+i+"')"}).join(" OR "),b=l.map(function(e){return'SELECT "columnUsages".*, "tableConstraints"."CONSTRAINT_TYPE", "chk"."definition" FROM "'+e+'"."INFORMATION_SCHEMA"."CONSTRAINT_COLUMN_USAGE" "columnUsages" INNER JOIN "'+e+'"."INFORMATION_SCHEMA"."TABLE_CONSTRAINTS" "tableConstraints" ON "tableConstraints"."CONSTRAINT_NAME" = "columnUsages"."CONSTRAINT_NAME" LEFT JOIN "'+e+'"."sys"."check_constraints" "chk" ON "chk"."name" = "columnUsages"."CONSTRAINT_NAME" WHERE ('+g+") AND \"tableConstraints\".\"CONSTRAINT_TYPE\" IN ('PRIMARY KEY', 'UNIQUE', 'CHECK')"}).join(" UNION ALL "),E=l.map(function(e){return'SELECT "fk"."name" AS "FK_NAME", \''+e+'\' AS "TABLE_CATALOG", "s1"."name" AS "TABLE_SCHEMA", "t1"."name" AS "TABLE_NAME", "col1"."name" AS "COLUMN_NAME", "s2"."name" AS "REF_SCHEMA", "t2"."name" AS "REF_TABLE", "col2"."name" AS "REF_COLUMN", "fk"."delete_referential_action_desc" AS "ON_DELETE", "fk"."update_referential_action_desc" AS "ON_UPDATE" FROM "'+e+'"."sys"."foreign_keys" "fk" INNER JOIN "'+e+'"."sys"."foreign_key_columns" "fkc" ON "fkc"."constraint_object_id" = "fk"."object_id" INNER JOIN "'+e+'"."sys"."tables" "t1" ON "t1"."object_id" = "fk"."parent_object_id" INNER JOIN "'+e+'"."sys"."schemas" "s1" ON "s1"."schema_id" = "t1"."schema_id" INNER JOIN "'+e+'"."sys"."tables" "t2" ON "t2"."object_id" = "fk"."referenced_object_id" INNER JOIN "'+e+'"."sys"."schemas" "s2" ON "s2"."schema_id" = "t2"."schema_id" INNER JOIN "'+e+'"."sys"."columns" "col1" ON "col1"."column_id" = "fkc"."parent_column_id" AND "col1"."object_id" = "fk"."parent_object_id" INNER JOIN "'+e+'"."sys"."columns" "col2" ON "col2"."column_id" = "fkc"."referenced_column_id" AND "col2"."object_id" = "fk"."referenced_object_id"'}).join(" UNION ALL "),T=l.map(function(e){return'SELECT "TABLE_CATALOG", "TABLE_SCHEMA", "COLUMN_NAME", "TABLE_NAME" FROM "'+e+'"."INFORMATION_SCHEMA"."COLUMNS" WHERE COLUMNPROPERTY(object_id("TABLE_CATALOG" + \'.\' + "TABLE_SCHEMA" + \'.\' + "TABLE_NAME"), "COLUMN_NAME", \'IsIdentity\') = 1 AND "TABLE_SCHEMA" IN ('+f+")"}).join(" UNION ALL "),'SELECT "NAME", "COLLATION_NAME" FROM "sys"."databases"',w=l.map(function(e){return"SELECT '"+e+'\' AS "TABLE_CATALOG", "s"."name" AS "TABLE_SCHEMA", "t"."name" AS "TABLE_NAME", "ind"."name" AS "INDEX_NAME", "col"."name" AS "COLUMN_NAME", "ind"."is_unique" AS "IS_UNIQUE", "ind"."filter_definition" as "CONDITION" FROM "'+e+'"."sys"."indexes" "ind" INNER JOIN "'+e+'"."sys"."index_columns" "ic" ON "ic"."object_id" = "ind"."object_id" AND "ic"."index_id" = "ind"."index_id" INNER JOIN "'+e+'"."sys"."columns" "col" ON "col"."object_id" = "ic"."object_id" AND "col"."column_id" = "ic"."column_id" INNER JOIN "'+e+'"."sys"."tables" "t" ON "t"."object_id" = "ind"."object_id" INNER JOIN "'+e+'"."sys"."schemas" "s" ON "s"."schema_id" = "t"."schema_id" WHERE "ind"."is_primary_key" = 0 AND "ind"."is_unique_constraint" = 0 AND "t"."is_ms_shipped" = 0'}).join(" UNION ALL "),[4,Promise.all([this.query(y),this.query(v),this.query(b),this.query(E),this.query(T),this.query('SELECT "NAME", "COLLATION_NAME" FROM "sys"."databases"'),this.query(w)])];case 3:return N=r.e.apply(void 0,[x.sent(),7]),C=N[0],S=N[1],A=N[2],O=N[3],R=N[4],M=N[5],_=N[6],C.length?[4,Promise.all(C.map(function(e){return r.b(P,void 0,void 0,function(){var t,a,l,f,h,y,v,g,b,E=this;return r.d(this,function(T){return t=new s.a,a=e.TABLE_CATALOG===i?void 0:e.TABLE_CATALOG,l=e.TABLE_SCHEMA!==n||this.driver.options.schema?e.TABLE_SCHEMA:void 0,t.name=this.driver.buildTableName(e.TABLE_NAME,l,a),f=this.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG),h=M.find(function(t){return t.NAME===e.TABLE_CATALOG}),t.columns=S.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===f}).map(function(e){var n,i,a=A.filter(function(t){return E.driver.buildTableName(t.TABLE_NAME,t.CONSTRAINT_SCHEMA,t.CONSTRAINT_CATALOG)===f&&t.COLUMN_NAME===e.COLUMN_NAME}),s=a.find(function(e){return"UNIQUE"===e.CONSTRAINT_TYPE}),u=!!s&&!!A.find(function(t){return"UNIQUE"===t.CONSTRAINT_TYPE&&t.CONSTRAINT_NAME===s.CONSTRAINT_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME}),c=!!a.find(function(e){return"PRIMARY KEY"===e.CONSTRAINT_TYPE}),l=!!R.find(function(t){return E.driver.buildTableName(t.TABLE_NAME,t.TABLE_SCHEMA,t.TABLE_CATALOG)===f&&t.COLUMN_NAME===e.COLUMN_NAME}),p=new o.a;if(p.name=e.COLUMN_NAME,p.type=e.DATA_TYPE.toLowerCase(),-1!==E.driver.withLengthColumnTypes.indexOf(p.type)&&e.CHARACTER_MAXIMUM_LENGTH){var d=e.CHARACTER_MAXIMUM_LENGTH.toString();p.length="-1"===d?"MAX":E.isDefaultColumnLength(t,p,d)?"":d}if("decimal"!==p.type&&"numeric"!==p.type||(null===e.NUMERIC_PRECISION||E.isDefaultColumnPrecision(t,p,e.NUMERIC_PRECISION)||(p.precision=e.NUMERIC_PRECISION),null===e.NUMERIC_SCALE||E.isDefaultColumnScale(t,p,e.NUMERIC_SCALE)||(p.scale=e.NUMERIC_SCALE)),"nvarchar"===p.type){var m=a.filter(function(e){return"CHECK"===e.CONSTRAINT_TYPE});if(m.length){var y=new RegExp("^\\(\\["+p.name+"\\]='[^']+'(?: OR \\["+p.name+"\\]='[^']+')*\\)$");try{for(var v=r.g(m),g=v.next();!g.done;g=v.next()){var b=g.value;if(y.test(b.definition)){p.type="simple-enum",p.enum=[];for(var T=new RegExp("\\["+p.name+"\\]='([^']+)'","g"),w=void 0;null!==(w=T.exec(b.definition));)p.enum.unshift(w[1]);break}}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}}}return p.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?E.removeParenthesisFromDefault(e.COLUMN_DEFAULT):void 0,p.isNullable="YES"===e.IS_NULLABLE,p.isPrimary=c,p.isUnique=!!s&&!u,p.isGenerated=l,l&&(p.generationStrategy="increment"),"newsequentialid()"===p.default&&(p.isGenerated=!0,p.generationStrategy="uuid",p.default=void 0),p.collation=e.COLLATION_NAME===h.COLLATION_NAME?void 0:e.COLLATION_NAME,"datetime2"!==p.type&&"time"!==p.type&&"datetimeoffset"!==p.type||(p.precision=E.isDefaultColumnPrecision(t,p,e.DATETIME_PRECISION)?void 0:e.DATETIME_PRECISION),p}),y=p.a.uniq(A.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.CONSTRAINT_SCHEMA,e.CONSTRAINT_CATALOG)===f&&"UNIQUE"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME}),t.uniques=y.map(function(e){var t=A.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new d.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME})})}),v=p.a.uniq(A.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.CONSTRAINT_SCHEMA,e.CONSTRAINT_CATALOG)===f&&"CHECK"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME}),t.checks=v.map(function(e){var t=A.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new m.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),expression:e.definition})}),g=p.a.uniq(O.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===f}),function(e){return e.FK_NAME}),t.foreignKeys=g.map(function(e){var t=O.filter(function(t){return t.FK_NAME===e.FK_NAME}),r=e.TABLE_CATALOG===i?void 0:e.TABLE_CATALOG,a=e.REF_SCHEMA===n?void 0:e.REF_SCHEMA,o=E.driver.buildTableName(e.REF_TABLE,a,r);return new u.a({name:e.FK_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:o,referencedColumnNames:t.map(function(e){return e.REF_COLUMN}),onDelete:e.ON_DELETE.replace("_"," "),onUpdate:e.ON_UPDATE.replace("_"," ")})}),b=p.a.uniq(_.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===f}),function(e){return e.INDEX_NAME}),t.indices=b.map(function(e){var n=_.filter(function(t){return t.INDEX_NAME===e.INDEX_NAME});return new c.a({table:t,name:e.INDEX_NAME,columnNames:n.map(function(e){return e.COLUMN_NAME}),isUnique:e.IS_UNIQUE,where:e.CONDITION})}),[2,t]})})}))]:[2,[]];case 4:return[2,x.sent()]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(t){return n.buildCreateColumnSql(e,t,!1,!0)}).join(", "),i="CREATE TABLE "+this.escapeTableName(e)+" ("+r;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new d.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),e.uniques.length>0)&&(i+=", "+e.uniques.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map(function(e){return'"'+e+'"'}).join(", ")+")"}).join(", "));e.checks.length>0&&(i+=", "+e.checks.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"}).join(", "));e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames));var i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+n.escapeTableName(t.referencedTableName)+" ("+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a}).join(", "));var a=e.columns.filter(function(e){return e.isPrimary});a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'" PRIMARY KEY ('+a.map(function(e){return'"'+e.name+'"'}).join(", ")+")");return i+=")"},t.prototype.dropTableSql=function(e,t){return t?"DROP TABLE IF EXISTS "+this.escapeTableName(e):"DROP TABLE "+this.escapeTableName(e)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return"CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON '+this.escapeTableName(e)+" ("+n+") "+(t.where?"WHERE "+t.where:"")},t.prototype.dropIndexSql=function(e,t){return'DROP INDEX "'+(t instanceof c.a?t.name:t)+'" ON '+this.escapeTableName(e)},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'"'+e+'"'}).join(", ");return"ALTER TABLE "+this.escapeTableName(e)+' ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")"},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return"ALTER TABLE "+this.escapeTableName(e)+' DROP CONSTRAINT "'+n+'"'},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return"ALTER TABLE "+this.escapeTableName(e)+' ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")"},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof d.a?t.name:t;return"ALTER TABLE "+this.escapeTableName(e)+' DROP CONSTRAINT "'+n+'"'},t.prototype.createCheckConstraintSql=function(e,t){return"ALTER TABLE "+this.escapeTableName(e)+' ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")"},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof m.a?t.name:t;return"ALTER TABLE "+this.escapeTableName(e)+' DROP CONSTRAINT "'+n+'"'},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),i="ALTER TABLE "+this.escapeTableName(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") REFERENCES "+this.escapeTableName(t.referencedTableName)+"("+r+")";return t.onDelete&&(i+=" ON DELETE "+t.onDelete),t.onUpdate&&(i+=" ON UPDATE "+t.onUpdate),i},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof u.a?t.name:t;return"ALTER TABLE "+this.escapeTableName(e)+' DROP CONSTRAINT "'+n+'"'},t.prototype.escapeTableName=function(e,t){var n=e instanceof s.a?e.name:e;if(this.driver.options.schema)if(-1===n.indexOf("."))n=this.driver.options.schema+"."+n;else if(3===n.split(".").length){var r=n.split("."),i=r[0],a=r[2];n=i+"."+this.driver.options.schema+"."+a}return n.split(".").map(function(e){return""===e?e:t?e:'"'+e+'"'}).join(".")},t.prototype.parseTableName=function(e){var t=e instanceof s.a?e.name:e;return 3===t.split(".").length?{database:t.split(".")[0],schema:""===t.split(".")[1]?"SCHEMA_NAME()":t.split(".")[1],tableName:t.split(".")[2]}:2===t.split(".").length?{database:this.driver.database,schema:t.split(".")[0],tableName:t.split(".")[1]}:{database:this.driver.database,schema:this.driver.options.schema?this.driver.options.schema:"SCHEMA_NAME()",tableName:t}},t.prototype.buildForeignKeyName=function(e,t,n){var r=e;return t&&(r=t+"."+r),n&&(r=n+"."+r),r},t.prototype.removeParenthesisFromDefault=function(e){if("("!==e.substr(0,1))return e;var t=e.substr(1,e.lastIndexOf(")")-1);return this.removeParenthesisFromDefault(t)},t.prototype.buildCreateColumnSql=function(e,t,n,r){var i='"'+t.name+'" '+this.connection.driver.createFullType(t);(t.enum&&(i+=" CHECK( "+t.name+" IN ("+t.enum.map(function(e){return"'"+e+"'"}).join(",")+") )"),t.collation&&(i+=" COLLATE "+t.collation),!0!==t.isNullable&&(i+=" NOT NULL"),!0!==t.isGenerated||"increment"!==t.generationStrategy||n||(i+=" IDENTITY(1,1)"),void 0!==t.default&&null!==t.default&&r)&&(i+=' CONSTRAINT "'+this.connection.namingStrategy.defaultConstraintName(e.name,t.name)+'" DEFAULT '+t.default);t.isGenerated&&"uuid"===t.generationStrategy&&!t.default&&(i+=' CONSTRAINT "'+this.connection.namingStrategy.defaultConstraintName(e.name,t.name)+'" DEFAULT NEWSEQUENTIALID()');return i},t.prototype.mssqlParameterToNativeParameter=function(e){var t,n,i,a,o,s,u,c,l,f;switch(this.driver.normalizeType({type:e.type})){case"bit":return this.driver.mssql.Bit;case"bigint":return this.driver.mssql.BigInt;case"decimal":return(t=this.driver.mssql).Decimal.apply(t,r.f(e.params));case"float":return this.driver.mssql.Float;case"int":return this.driver.mssql.Int;case"money":return this.driver.mssql.Money;case"numeric":return(n=this.driver.mssql).Numeric.apply(n,r.f(e.params));case"smallint":return this.driver.mssql.SmallInt;case"smallmoney":return this.driver.mssql.SmallMoney;case"real":return this.driver.mssql.Real;case"tinyint":return this.driver.mssql.TinyInt;case"char":return(i=this.driver.mssql).Char.apply(i,r.f(e.params));case"nchar":return(a=this.driver.mssql).NChar.apply(a,r.f(e.params));case"text":return this.driver.mssql.Text;case"ntext":return this.driver.mssql.Ntext;case"varchar":return(o=this.driver.mssql).VarChar.apply(o,r.f(e.params));case"nvarchar":return(s=this.driver.mssql).NVarChar.apply(s,r.f(e.params));case"xml":return this.driver.mssql.Xml;case"time":return(u=this.driver.mssql).Time.apply(u,r.f(e.params));case"date":return this.driver.mssql.Date;case"datetime":return this.driver.mssql.DateTime;case"datetime2":return(c=this.driver.mssql).DateTime2.apply(c,r.f(e.params));case"datetimeoffset":return(l=this.driver.mssql).DateTimeOffset.apply(l,r.f(e.params));case"smalldatetime":return this.driver.mssql.SmallDateTime;case"uniqueidentifier":return this.driver.mssql.UniqueIdentifier;case"variant":return this.driver.mssql.Variant;case"binary":return this.driver.mssql.Binary;case"varbinary":return(f=this.driver.mssql).VarBinary.apply(f,r.f(e.params));case"image":return this.driver.mssql.Image;case"udt":return this.driver.mssql.UDT;case"rowversion":return this.driver.mssql.RowVersion}},t.prototype.convertIsolationLevel=function(e){var t=this.driver.mssql.ISOLATION_LEVEL;switch(e){case"READ UNCOMMITTED":return t.READ_UNCOMMITTED;case"REPEATABLE READ":return t.REPEATABLE_READ;case"SERIALIZABLE":return t.SERIALIZABLE;case"READ COMMITTED":default:return t.READ_COMMITTED}},t}(y.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var r=n(0),i=n(57),a=n(37),o=n(11),s=n(2),u=n(26),c=n(24),l=n(21),f=n(28),p=n(9),h=n(32),d=n(67),m=n(5),y=n(29),v=n(13),g=function(e){function t(t,n){void 0===n&&(n="master");var r=e.call(this)||this;return r.driver=t,r.connection=t.connection,r.broadcaster=new h.a(r),r.mode=n,r}return r.c(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}),this.databaseConnectionPromise)},t.prototype.release=function(){var e=this;return new Promise(function(t,n){e.isReleased=!0,e.databaseConnection?e.databaseConnection.close(function(e){if(e)return n(e);t()}):t()})},t.prototype.startTransaction=function(e){return void 0===e&&(e="READ COMMITTED"),r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:if(this.isReleased)throw new l.a;if(this.isTransactionActive)throw new i.a;if("SERIALIZABLE"!==e&&"READ COMMITTED"!==e)throw new Error("Oracle only supports SERIALIZABLE and READ COMMITTED isolation");return[4,this.query("SET TRANSACTION ISOLATION LEVEL "+e)];case 1:return t.sent(),this.isTransactionActive=!0,[2]}})})},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.a;return new Promise(function(i,a){return r.b(n,void 0,void 0,function(){var n,o,s,u,c=this;return r.d(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),n=+new Date,o=function(r,o){var s=c.driver.connection.options.maxQueryExecutionTime,u=+new Date-n;if(s&&u>s&&c.driver.connection.logger.logQuerySlow(u,e,t,c),r)return c.driver.connection.logger.logQueryError(r,e,t,c),a(new f.a(e,t,r));i(o.rows||o.outBinds)},s={autoCommit:!this.isTransactionActive},[4,this.connect()];case 1:return r.sent().execute(e,t||{},s,o),[3,3];case 2:return u=r.sent(),a(u),[3,3];case 3:return[2]}})})})},t.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by Oracle driver.")},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve(!1)]})})},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve(!1)]})})},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.d(this,function(r){switch(r.label){case 0:return t=e instanceof s.a?e.name:e,n='SELECT "TABLE_NAME" FROM "USER_TABLES" WHERE "TABLE_NAME" = \''+t+"'",[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.d(this,function(r){switch(r.label){case 0:return n=e instanceof s.a?e.name:e,i='SELECT "COLUMN_NAME" FROM "USER_TAB_COLS" WHERE "TABLE_NAME" = \''+n+"' AND \"COLUMN_NAME\" = '"+t+"'",[4,this.query(i)];case 1:return[2,!!r.sent().length]}})})},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.query('CREATE DATABASE IF NOT EXISTS "'+e+'"')];case 1:return t.sent(),[2]}})})},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Schema create queries are not supported by Oracle driver.")})})},t.prototype.dropSchema=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Schema drop queries are not supported by Oracle driver.")})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,function(){var a,o,s=this;return r.d(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return o.push(s.dropForeignKeySql(e,t))}),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,function(){var a,o,u,c,l,f=this;return r.d(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof s.a?(u=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:u=r.sent(),r.label=5;case 5:return o=u,c=[],l=[],i&&o.indices.forEach(function(e){c.push(f.dropIndexSql(e)),l.push(f.createIndexSql(o,e))}),n&&o.foreignKeys.forEach(function(e){return c.push(f.dropForeignKeySql(o,e))}),c.push(this.dropTableSql(o)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u,c,l,f,p=this;return r.d(this,function(r){switch(r.label){case 0:return n=[],i=[],e instanceof s.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return u=(a=o).clone(),t instanceof s.a?u=t:u.name=t,n.push('ALTER TABLE "'+a.name+'" RENAME TO "'+u.name+'"'),i.push('ALTER TABLE "'+u.name+'" RENAME TO "'+a.name+'"'),u.primaryColumns.length>0&&(c=u.primaryColumns.map(function(e){return e.name}),l=this.connection.namingStrategy.primaryKeyName(a,c),f=this.connection.namingStrategy.primaryKeyName(u,c),n.push('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+l+'" TO "'+f+'"'),i.push('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+f+'" TO "'+l+'"')),u.uniques.forEach(function(e){var t=p.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);n.push('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"'),i.push('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"'),e.name=t}),u.indices.forEach(function(e){var t=p.connection.namingStrategy.indexName(u,e.columnNames,e.where);n.push('ALTER INDEX "'+e.name+'" RENAME TO "'+t+'"'),i.push('ALTER INDEX "'+t+'" RENAME TO "'+e.name+'"'),e.name=t}),u.foreignKeys.forEach(function(e){var t=p.connection.namingStrategy.foreignKeyName(u,e.columnNames);n.push('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"'),i.push('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"'),e.name=t}),[4,this.executeQueries(n,i)];case 4:return r.sent(),a.name=u.name,this.replaceCachedTable(a,u),[2]}})})},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u,c,l,f,h,d,m,y;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),u=[],(o=[]).push('ALTER TABLE "'+n.name+'" ADD '+this.buildCreateColumnSql(t)),u.push('ALTER TABLE "'+n.name+'" DROP COLUMN "'+t.name+'"'),t.isPrimary&&((c=a.primaryColumns).length>0&&(l=this.connection.namingStrategy.primaryKeyName(a.name,c.map(function(e){return e.name})),f=c.map(function(e){return'"'+e.name+'"'}).join(", "),o.push('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+l+'"'),u.push('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+l+'" PRIMARY KEY ('+f+")")),c.push(t),h=this.connection.namingStrategy.primaryKeyName(a.name,c.map(function(e){return e.name})),d=c.map(function(e){return'"'+e.name+'"'}).join(", "),o.push('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+d+")"),u.push('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+h+'"')),(m=a.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))&&(a.indices.splice(a.indices.indexOf(m),1),o.push(this.createIndexSql(n,m)),u.push(this.dropIndexSql(m))),t.isUnique&&(y=new p.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(y),o.push('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+y.name+'" UNIQUE ("'+t.name+'")'),u.push('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+y.name+'"')),[4,this.executeQueries(o,u)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}})})},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,v.PromiseUtils.runInSequence(t,function(t){return n.addColumn(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,u,c;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(u=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c=void 0,n instanceof o.a?c=n:(c=u.clone()).name=n,[4,this.changeColumn(i,u,c)];case 4:return r.sent(),[2]}})})},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,a,u,c,l,f,h,d,m,y,v,g,b,E,T,w,N,C,S=this;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(u=(i=a).clone(),c=[],l=[],!(f=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n.isGenerated!==f.isGenerated&&"uuid"!==n.generationStrategy||f.type!==n.type||f.length!==n.length?[4,this.dropColumn(i,f)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),u=i.clone(),[3,8];case 6:return n.name!==f.name&&(c.push('ALTER TABLE "'+i.name+'" RENAME COLUMN "'+f.name+'" TO "'+n.name+'"'),l.push('ALTER TABLE "'+i.name+'" RENAME COLUMN "'+n.name+'" TO "'+f.name+'"'),!0===f.isPrimary&&(E=u.primaryColumns,N=E.map(function(e){return e.name}),h=this.connection.namingStrategy.primaryKeyName(u,N),N.splice(N.indexOf(f.name),1),N.push(n.name),d=this.connection.namingStrategy.primaryKeyName(u,N),c.push('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+h+'" TO "'+d+'"'),l.push('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+d+'" TO "'+h+'"')),u.findColumnUniques(f).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);c.push('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"'),l.push('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"'),e.name=t}),u.findColumnIndices(f).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.indexName(u,e.columnNames,e.where);c.push('ALTER INDEX "'+e.name+'" RENAME TO "'+t+'"'),l.push('ALTER INDEX "'+t+'" RENAME TO "'+e.name+'"'),e.name=t}),u.findColumnForeignKeys(f).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.foreignKeyName(u,e.columnNames);c.push('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"'),l.push('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"'),e.name=t}),m=u.columns.find(function(e){return e.name===f.name}),u.columns[u.columns.indexOf(m)].name=n.name,f.name=n.name),this.isColumnChanged(f,n,!0)&&(y="",v="",g="",b="",null!==n.default&&void 0!==n.default?(y="DEFAULT "+n.default,v=null!==f.default&&void 0!==f.default?"DEFAULT "+f.default:"DEFAULT NULL"):null!==f.default&&void 0!==f.default&&(y="DEFAULT NULL",v="DEFAULT "+f.default),n.isNullable!==f.isNullable&&(!0===n.isNullable?(g="NULL",b="NOT NULL"):(g="NOT NULL",b="NULL")),c.push('ALTER TABLE "'+i.name+'" MODIFY "'+f.name+'" '+this.connection.driver.createFullType(n)+" "+y+" "+g),l.push('ALTER TABLE "'+i.name+'" MODIFY "'+f.name+'" '+this.connection.driver.createFullType(f)+" "+v+" "+b)),n.isPrimary!==f.isPrimary&&((E=u.primaryColumns).length>0&&(w=this.connection.namingStrategy.primaryKeyName(u.name,E.map(function(e){return e.name})),N=E.map(function(e){return'"'+e.name+'"'}).join(", "),c.push('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+w+'"'),l.push('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+N+")")),!0===n.isPrimary?(E.push(n),u.columns.find(function(e){return e.name===n.name}).isPrimary=!0,w=this.connection.namingStrategy.primaryKeyName(u.name,E.map(function(e){return e.name})),N=E.map(function(e){return'"'+e.name+'"'}).join(", "),c.push('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+N+")"),l.push('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+w+'"')):(T=E.find(function(e){return e.name===n.name}),E.splice(E.indexOf(T),1),u.columns.find(function(e){return e.name===n.name}).isPrimary=!1,E.length>0&&(w=this.connection.namingStrategy.primaryKeyName(u.name,E.map(function(e){return e.name})),N=E.map(function(e){return'"'+e.name+'"'}).join(", "),c.push('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+N+")"),l.push('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+w+'"')))),n.isUnique!==f.isUnique&&(!0===n.isUnique?(C=new p.a({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),u.uniques.push(C),c.push('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+C.name+'" UNIQUE ("'+n.name+'")'),l.push('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+C.name+'"')):(C=u.uniques.find(function(e){return 1===e.columnNames.length&&!!e.columnNames.find(function(e){return e===n.name})}),u.uniques.splice(u.uniques.indexOf(C),1),c.push('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+C.name+'"'),l.push('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+C.name+'" UNIQUE ("'+n.name+'")'))),[4,this.executeQueries(c,l)];case 7:r.sent(),this.replaceCachedTable(i,u),r.label=8;case 8:return[2]}})})},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,v.PromiseUtils.runInSequence(t,function(t){return n.changeColumn(e,t.oldColumn,t.newColumn)})];case 1:return r.sent(),[2]}})})},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,u,c,l,f,p,h,d,m,y,v;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return u=n.clone(),c=[],l=[],a.isPrimary&&(f=this.connection.namingStrategy.primaryKeyName(u.name,u.primaryColumns.map(function(e){return e.name})),p=u.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),c.push('ALTER TABLE "'+u.name+'" DROP CONSTRAINT "'+f+'"'),l.push('ALTER TABLE "'+u.name+'" ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+p+")"),u.findColumnByName(a.name).isPrimary=!1,u.primaryColumns.length>0&&(h=this.connection.namingStrategy.primaryKeyName(u.name,u.primaryColumns.map(function(e){return e.name})),d=u.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),c.push('ALTER TABLE "'+u.name+'" ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+d+")"),l.push('ALTER TABLE "'+u.name+'" DROP CONSTRAINT "'+h+'"'))),(m=u.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(c.push(this.dropIndexSql(m)),l.push(this.createIndexSql(n,m))),(y=u.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(u.checks.splice(u.checks.indexOf(y),1),c.push(this.dropCheckConstraintSql(n,y)),l.push(this.createCheckConstraintSql(n,y))),(v=u.uniques.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(u.uniques.splice(u.uniques.indexOf(v),1),c.push(this.dropUniqueConstraintSql(n,v)),l.push(this.createUniqueConstraintSql(n,v))),c.push('ALTER TABLE "'+n.name+'" DROP COLUMN "'+a.name+'"'),l.push('ALTER TABLE "'+n.name+'" ADD '+this.buildCreateColumnSql(a)),[4,this.executeQueries(c,l)];case 4:return r.sent(),u.removeColumn(a),this.replaceCachedTable(n,u),[2]}})})},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,function(){var n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,v.PromiseUtils.runInSequence(t,function(t){return n.dropColumn(e,t)})];case 1:return r.sent(),[2]}})})},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),u=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u,c,l,f,p,h,d;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=t.map(function(e){return e.name}),o=n.clone(),u=[],c=[],(l=o.primaryColumns).length>0&&(f=this.connection.namingStrategy.primaryKeyName(o.name,l.map(function(e){return e.name})),p=l.map(function(e){return'"'+e.name+'"'}).join(", "),u.push('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+f+'"'),c.push('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+p+")")),o.columns.filter(function(e){return-1!==a.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),h=this.connection.namingStrategy.primaryKeyName(o.name,a),d=a.map(function(e){return'"'+e+'"'}).join(", "),u.push('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+d+")"),c.push('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+h+'"'),[4,this.executeQueries(u,c)];case 4:return r.sent(),this.replaceCachedTable(n,o),[2]}})})},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name})),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createUniqueConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof p.a?t:n.uniques.find(function(e){return e.name===t})))throw new Error("Supplied unique constraint was not found in table "+n.name);return o=this.dropUniqueConstraintSql(n,a),u=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropUniqueConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof y.a?t:n.checks.find(function(e){return e.name===t})))throw new Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),u=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Oracle does not support exclusion constraints.")})})},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Oracle does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Oracle does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){throw new Error("Oracle does not support exclusion constraints.")})})},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,c;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof u.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),c=this.createForeignKeySql(n,a),[4,this.executeQueries(o,c)];case 4:return r.sent(),n.removeForeignKey(a),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,a,o,u;return r.d(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.a?t:n.indices.find(function(e){return e.name===t})))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(a),u=this.createIndexSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,function(){var n,i=this;return r.d(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE "'+e+'"')];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return r.b(this,void 0,void 0,function(){var e,t,n=this;return r.d(this,function(r){switch(r.label){case 0:return[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,6,,11]),'SELECT \'DROP TABLE "\' || TABLE_NAME || \'" CASCADE CONSTRAINTS\' AS "query" FROM "USER_TABLES"',[4,this.query('SELECT \'DROP TABLE "\' || TABLE_NAME || \'" CASCADE CONSTRAINTS\' AS "query" FROM "USER_TABLES"')];case 3:return e=r.sent(),[4,Promise.all(e.map(function(e){return n.query(e.query)}))];case 4:return r.sent(),[4,this.commitTransaction()];case 5:return r.sent(),[3,11];case 6:t=r.sent(),r.label=7;case 7:return r.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return r.sent(),[3,10];case 9:return r.sent(),[3,10];case 10:throw t;case 11:return[2]}})})},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,a,l,f,h,d,v,g,b,E,T=this;return r.d(this,function(w){switch(w.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),n='SELECT * FROM "USER_TABLES" WHERE "TABLE_NAME" IN ('+t+")",i='SELECT * FROM "USER_TAB_COLS" WHERE "TABLE_NAME" IN ('+t+")",a='SELECT "IND"."INDEX_NAME", "IND"."TABLE_NAME", "IND"."UNIQUENESS", LISTAGG ("COL"."COLUMN_NAME", \',\') WITHIN GROUP (ORDER BY "COL"."COLUMN_NAME") AS "COLUMN_NAMES" FROM "USER_INDEXES" "IND" INNER JOIN "USER_IND_COLUMNS" "COL" ON "COL"."INDEX_NAME" = "IND"."INDEX_NAME" LEFT JOIN "USER_CONSTRAINTS" "CON" ON "CON"."CONSTRAINT_NAME" = "IND"."INDEX_NAME" WHERE "IND"."TABLE_NAME" IN ('+t+') AND "CON"."CONSTRAINT_NAME" IS NULL GROUP BY "IND"."INDEX_NAME", "IND"."TABLE_NAME", "IND"."UNIQUENESS"',l='SELECT "C"."CONSTRAINT_NAME", "C"."TABLE_NAME", "COL"."COLUMN_NAME", "REF_COL"."TABLE_NAME" AS "REFERENCED_TABLE_NAME", "REF_COL"."COLUMN_NAME" AS "REFERENCED_COLUMN_NAME", "C"."DELETE_RULE" AS "ON_DELETE" FROM "USER_CONSTRAINTS" "C" INNER JOIN "USER_CONS_COLUMNS" "COL" ON "COL"."OWNER" = "C"."OWNER" AND "COL"."CONSTRAINT_NAME" = "C"."CONSTRAINT_NAME" INNER JOIN "USER_CONS_COLUMNS" "REF_COL" ON "REF_COL"."OWNER" = "C"."R_OWNER" AND "REF_COL"."CONSTRAINT_NAME" = "C"."R_CONSTRAINT_NAME" AND "REF_COL"."POSITION" = "COL"."POSITION" WHERE "C"."TABLE_NAME" IN ('+t+') AND "C"."CONSTRAINT_TYPE" = \'R\'',f='SELECT "C"."CONSTRAINT_NAME", "C"."CONSTRAINT_TYPE", "C"."TABLE_NAME", "COL"."COLUMN_NAME", "C"."SEARCH_CONDITION" FROM "USER_CONSTRAINTS" "C" INNER JOIN "USER_CONS_COLUMNS" "COL" ON "COL"."OWNER" = "C"."OWNER" AND "COL"."CONSTRAINT_NAME" = "C"."CONSTRAINT_NAME" WHERE "C"."TABLE_NAME" IN ('+t+") AND \"C\".\"CONSTRAINT_TYPE\" IN ('C', 'U', 'P') AND \"C\".\"GENERATED\" = 'USER NAME'",[4,Promise.all([this.query(n),this.query(i),this.query(a),this.query(l),this.query(f)])]):[2,[]];case 1:return h=r.e.apply(void 0,[w.sent(),5]),d=h[0],v=h[1],g=h[2],b=h[3],E=h[4],d.length?[2,d.map(function(e){var t=new s.a;t.name=e.TABLE_NAME,t.columns=v.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=E.filter(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME}),r=n.find(function(e){return"U"===e.CONSTRAINT_TYPE}),i=!!r&&!!E.find(function(t){return"U"===t.CONSTRAINT_TYPE&&t.CONSTRAINT_NAME===r.CONSTRAINT_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME}),a=!!r&&!i,s=!!n.find(function(e){return"P"===e.CONSTRAINT_TYPE}),u=new o.a;if(u.name=e.COLUMN_NAME,u.type=e.DATA_TYPE.toLowerCase(),-1!==u.type.indexOf("(")&&(u.type=u.type.replace(/\([0-9]*\)/,"")),-1!==T.driver.withLengthColumnTypes.indexOf(u.type)){var c="raw"===u.type?e.DATA_LENGTH:e.CHAR_COL_DECL_LENGTH;u.length=c&&!T.isDefaultColumnLength(t,u,c)?c.toString():""}return"number"===u.type||"float"===u.type?(null===e.DATA_PRECISION||T.isDefaultColumnPrecision(t,u,e.DATA_PRECISION)||(u.precision=e.DATA_PRECISION),null===e.DATA_SCALE||T.isDefaultColumnScale(t,u,e.DATA_SCALE)||(u.scale=e.DATA_SCALE)):"timestamp"!==u.type&&"timestamp with time zone"!==u.type&&"timestamp with local time zone"!==u.type||null===e.DATA_SCALE||(u.precision=T.isDefaultColumnPrecision(t,u,e.DATA_SCALE)?void 0:e.DATA_SCALE),u.default=null!==e.DATA_DEFAULT&&void 0!==e.DATA_DEFAULT&&"NULL"!==e.DATA_DEFAULT.trim()?u.default=e.DATA_DEFAULT.trim():void 0,u.isNullable="Y"===e.NULLABLE,u.isUnique=a,u.isPrimary=s,u.isGenerated="YES"===e.IDENTITY_COLUMN,u.isGenerated&&(u.generationStrategy="increment",u.default=void 0),u.comment="",u});var n=m.a.uniq(E.filter(function(e){return e.TABLE_NAME===t.name&&"U"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME});t.uniques=n.map(function(e){var t=E.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME})})});var r=m.a.uniq(E.filter(function(e){return e.TABLE_NAME===t.name&&"C"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME});t.checks=r.map(function(e){var t=E.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new y.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),expression:e.SEARCH_CONDITION})});var i=m.a.uniq(b.filter(function(e){return e.TABLE_NAME===t.name}),function(e){return e.CONSTRAINT_NAME});return t.foreignKeys=i.map(function(e){var t=b.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new u.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:e.REFERENCED_TABLE_NAME,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:"NO ACTION"===e.ON_DELETE?void 0:e.ON_DELETE})}),t.indices=g.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){return new c.a({name:e.INDEX_NAME,columnNames:e.COLUMN_NAMES.split(","),isUnique:"UNIQUE"===e.UNIQUENESS})}),t})]:[2,[]]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(e){return n.buildCreateColumnSql(e)}).join(", "),i='CREATE TABLE "'+e.name+'" ('+r;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new p.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),e.uniques.length>0)&&(i+=", "+e.uniques.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map(function(e){return'"'+e+'"'}).join(", ")+")"}).join(", "));e.checks.length>0&&(i+=", "+e.checks.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"}).join(", "));e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames));var i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'" ('+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),a}).join(", "));var a=e.columns.filter(function(e){return e.isPrimary});a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'" PRIMARY KEY ('+a.map(function(e){return'"'+e.name+'"'}).join(", ")+")");return i+=")"},t.prototype.dropTableSql=function(e,t){var n=e instanceof s.a?e.name:e;return t?'DROP TABLE IF EXISTS "'+n+'"':'DROP TABLE "'+n+'"'},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return"CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e.name+'" ('+n+")"},t.prototype.dropIndexSql=function(e){return'DROP INDEX "'+(e instanceof c.a?e.name:e)+'"'},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'"'+e+'"'}).join(", ");return'ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")"},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return'ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"'},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return'ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")"},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof p.a?t.name:t;return'ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"'},t.prototype.createCheckConstraintSql=function(e,t){return'ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")"},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof y.a?t.name:t;return'ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"'},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),i='ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+') REFERENCES "'+t.referencedTableName+'" ('+r+")";return t.onDelete&&(i+=" ON DELETE "+t.onDelete),i},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof u.a?t.name:t;return'ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"'},t.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+this.connection.driver.createFullType(e);return e.charset&&(t+=" CHARACTER SET "+e.charset),e.collation&&(t+=" COLLATE "+e.collation),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(t+=" GENERATED ALWAYS AS IDENTITY"),t},t}(d.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(0),i=n(21),a=n(50),o=n(32),s=n(28),u=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new o.a(n),n}return r.c(t,e),t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,e.prototype.commitTransaction.call(this)];case 1:return t.sent(),[4,this.driver.autoSave()];case 2:return t.sent(),[2]}})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new i.a;return new Promise(function(i,a){return r.b(n,void 0,void 0,function(){var n,o,u,c,l,f,p;return r.d(this,function(r){n=this.driver.databaseConnection,this.driver.connection.logger.logQuery(e,t,this),o=+new Date;try{for((u=n.prepare(e)).bind(t),c=this.driver.connection.options.maxQueryExecutionTime,l=+new Date,f=l-o,c&&f>c&&this.driver.connection.logger.logQuerySlow(f,e,t,this),p=[];u.step();)p.push(u.getAsObject());u.free(),i(p)}catch(n){u&&u.free(),this.driver.connection.logger.logQueryError(n,e,t,this),a(new s.a(e,t,n))}return[2]})})})},t}(a.a)},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return u});var r=n(0),i=n(31),a=n(190),o=n(38),s=n(1),u=function(t){function n(e){var n=t.call(this,e)||this;if(n.connection=e,n.options=e.options,n.database=n.options.database,!n.options.database)throw new o.a("database");return n.loadDependencies(),n}return r.c(n,t),n.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?n(e):t()})})]})})},n.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new a.a(this)),this.queryRunner},n.prototype.normalizeType=function(n){return n.type===e?"blob":t.prototype.normalizeType.call(this,n)},n.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){return r.b(e,void 0,void 0,function(){var e,i=this;return r.d(this,function(r){switch(r.label){case 0:return[4,this.createDatabaseDirectory(this.options.database)];case 1:return r.sent(),e=new this.sqlite.Database(this.options.database,function(r){if(r)return n(r);e.run("PRAGMA foreign_keys = ON;",function(r,i){if(r)return n(r);t(e)}),i.options.key&&e.run("PRAGMA key = "+i.options.key+";",function(r,i){if(r)return n(r);t(e)})}),[2]}})})})},n.prototype.loadDependencies=function(){try{this.sqlite=s.a.load("sqlite3").verbose()}catch(e){throw new i.a("SQLite","sqlite3")}},n.prototype.createDatabaseDirectory=function(e){return new Promise(function(t,n){s.a.load("mkdirp")(s.a.load("path").dirname(e),function(e){return e?n(e):t()})})},n}(n(18).a)}).call(this,n(65).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(0),i=n(21),a=n(28),o=n(50),s=n(32),u=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new s.a(n),n}return r.c(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new i.a;var o=this.driver.connection;return new Promise(function(i,s){return r.b(n,void 0,void 0,function(){var n,u,c,l;return r.d(this,function(r){switch(r.label){case 0:return n=function(n,r){var u=o.options.maxQueryExecutionTime,f=+new Date-c;u&&f>u&&o.logger.logQuerySlow(f,e,t,this),n?(o.logger.logQueryError(n,e,t,this),s(new a.a(e,t,n))):i(l?this.lastID:r)},[4,this.connect()];case 1:return u=r.sent(),this.driver.connection.logger.logQuery(e,t,this),c=+new Date,(l="INSERT INTO"===e.substr(0,11))?u.run(e,t,n):u.all(e,t,n),[2]}})})})},t}(o.a)},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return u});var r=n(0),i=n(18),a=n(192),o=n(38),s=n(31),u=function(t){function n(e){var n=t.call(this,e)||this;if(n.connection=e,n.options=e.options,n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new o.a("database");return n.loadDependencies(),n}return r.c(n,t),n.prototype.disconnect=function(){return r.b(this,void 0,void 0,function(){var e=this;return r.d(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close().then(t).catch(n)})]})})},n.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new a.a(this)),this.queryRunner},n.prototype.normalizeType=function(n){return n.type===e?"blob":t.prototype.normalizeType.call(this,n)},n.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{name:e.options.database},e.options.extra||{});new e.sqlite(r.name,function(r,i){if(r)return n(r);i.resultType(e.sqlite.RESULTSASOBJECT),i.execSQL("PRAGMA foreign_keys = ON;",[],function(e,r){if(e)return n(e);t(i)})})})},n.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new s.a("Nativescript","nativescript-sqlite")},n}(i.a)}).call(this,n(65).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(0),i=n(21),a=n(28),o=n(50),s=n(32),u=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new s.a(n),n}return r.c(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new i.a;var r=this.driver.connection;return new Promise(function(i,o){var s="INSERT INTO"===e.substr(0,11),u=function(n,s){var u=r.options.maxQueryExecutionTime,l=+new Date-c;u&&l>u&&r.logger.logQuerySlow(l,e,t,this),n?(r.logger.logQueryError(n,e,t,this),o(new a.a(e,t,n))):i(s)};n.driver.connection.logger.logQuery(e,t,n);var c=+new Date;n.connect().then(function(n){s?n.execSQL(e,t,u):n.all(e,t,u)})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'"'+e+'"=?'})},t}(o.a)},function(e,t,n){e.exports=n.p+"html/welcomeSite.html"},function(e,t,n){e.exports=n.p+"html/absoluteBarMenuSiteTemplate.html"},function(e,t,n){e.exports=n.p+"html/footerFragment.html"},function(e,t,n){e.exports=n.p+"html/calendarSite.html"},function(e,t,n){e.exports=n.p+"html/footerSite.html"},function(e,t,n){e.exports=n.p+"html/eventSite.html"},function(e,t){e.exports="img/component.png"},function(e,t,n){e.exports=n.p+"html/listChurchesSite.html"},function(e,t,n){e.exports=n.p+"html/menuFooterSiteTemplate.html"},function(e,t,n){e.exports=n.p+"html/churchListFragment.html"},function(e,t,n){e.exports=n.p+"html/showChurchSite.html"},,function(e,t,n){n(206),n(378),e.exports=n(377)},function(e,t,n){"use strict";(function(e){n(207),n(351),n(353),n(355),n(357),n(359),n(361),n(363),n(365),n(367),n(371),e._babelPolyfill&&"undefined"!=typeof console&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),e._babelPolyfill=!0}).call(this,n(94))},function(e,t,n){n(208),n(211),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(285),n(286),n(287),n(289),n(290),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(137),n(314),n(166),n(315),n(167),n(316),n(317),n(318),n(319),n(168),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),e.exports=n(35)},function(e,t,n){"use strict";var r=n(14),i=n(45),a=n(34),o=n(4),s=n(40),u=n(64).KEY,c=n(15),l=n(95),f=n(78),p=n(69),h=n(22),d=n(117),m=n(148),y=n(210),v=n(120),g=n(16),b=n(17),E=n(47),T=n(63),w=n(68),N=n(73),C=n(151),S=n(54),A=n(30),O=n(71),R=S.f,M=A.f,_=C.f,P=r.Symbol,x=r.JSON,I=x&&x.stringify,L=h("_hidden"),j=h("toPrimitive"),D={}.propertyIsEnumerable,k=l("symbol-registry"),q=l("symbols"),B=l("op-symbols"),U=Object.prototype,F="function"==typeof P,V=r.QObject,Q=!V||!V.prototype||!V.prototype.findChild,K=a&&c(function(){return 7!=N(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=R(U,t);r&&delete U[t],M(e,t,n),r&&e!==U&&M(U,t,r)}:M,W=function(e){var t=q[e]=N(P.prototype);return t._k=e,t},H=F&&"symbol"==typeof P.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof P},Y=function(e,t,n){return e===U&&Y(B,t,n),g(e),t=T(t,!0),g(n),i(q,t)?(n.enumerable?(i(e,L)&&e[L][t]&&(e[L][t]=!1),n=N(n,{enumerable:w(0,!1)})):(i(e,L)||M(e,L,w(1,{})),e[L][t]=!0),K(e,t,n)):M(e,t,n)},z=function(e,t){g(e);for(var n,r=y(t=E(t)),i=0,a=r.length;a>i;)Y(e,n=r[i++],t[n]);return e},J=function(e){var t=D.call(this,e=T(e,!0));return!(this===U&&i(q,e)&&!i(B,e))&&(!(t||!i(this,e)||!i(q,e)||i(this,L)&&this[L][e])||t)},G=function(e,t){if(e=E(e),t=T(t,!0),e!==U||!i(q,t)||i(B,t)){var n=R(e,t);return!n||!i(q,t)||i(e,L)&&e[L][t]||(n.enumerable=!0),n}},X=function(e){for(var t,n=_(E(e)),r=[],a=0;n.length>a;)i(q,t=n[a++])||t==L||t==u||r.push(t);return r},Z=function(e){for(var t,n=e===U,r=_(n?B:E(e)),a=[],o=0;r.length>o;)!i(q,t=r[o++])||n&&!i(U,t)||a.push(q[t]);return a};F||(s((P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(n){this===U&&t.call(B,n),i(this,L)&&i(this[L],e)&&(this[L][e]=!1),K(this,e,w(1,n))};return a&&Q&&K(U,e,{configurable:!0,set:t}),W(e)}).prototype,"toString",function(){return this._k}),S.f=G,A.f=Y,n(74).f=C.f=X,n(91).f=J,n(97).f=Z,a&&!n(70)&&s(U,"propertyIsEnumerable",J,!0),d.f=function(e){return W(h(e))}),o(o.G+o.W+o.F*!F,{Symbol:P});for(var $="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;$.length>ee;)h($[ee++]);for(var te=O(h.store),ne=0;te.length>ne;)m(te[ne++]);o(o.S+o.F*!F,"Symbol",{for:function(e){return i(k,e+="")?k[e]:k[e]=P(e)},keyFor:function(e){if(!H(e))throw TypeError(e+" is not a symbol!");for(var t in k)if(k[t]===e)return t},useSetter:function(){Q=!0},useSimple:function(){Q=!1}}),o(o.S+o.F*!F,"Object",{create:function(e,t){return void 0===t?N(e):z(N(e),t)},defineProperty:Y,defineProperties:z,getOwnPropertyDescriptor:G,getOwnPropertyNames:X,getOwnPropertySymbols:Z}),x&&o(o.S+o.F*(!F||c(function(){var e=P();return"[null]"!=I([e])||"{}"!=I({a:e})||"{}"!=I(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!H(e))return v(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!H(t))return t}),r[1]=t,I.apply(x,r)}}),P.prototype[j]||n(46)(P.prototype,j,P.prototype.valueOf),f(P,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){e.exports=n(95)("native-function-to-string",Function.toString)},function(e,t,n){var r=n(71),i=n(97),a=n(91);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var o,s=n(e),u=a.f,c=0;s.length>c;)u.call(e,o=s[c++])&&t.push(o);return t}},function(e,t,n){var r=n(4);r(r.S,"Object",{create:n(73)})},function(e,t,n){var r=n(4);r(r.S+r.F*!n(34),"Object",{defineProperty:n(30).f})},function(e,t,n){var r=n(4);r(r.S+r.F*!n(34),"Object",{defineProperties:n(150)})},function(e,t,n){var r=n(47),i=n(54).f;n(55)("getOwnPropertyDescriptor",function(){return function(e,t){return i(r(e),t)}})},function(e,t,n){var r=n(41),i=n(75);n(55)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(41),i=n(71);n(55)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){n(55)("getOwnPropertyNames",function(){return n(151).f})},function(e,t,n){var r=n(17),i=n(64).onFreeze;n(55)("freeze",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(17),i=n(64).onFreeze;n(55)("seal",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(17),i=n(64).onFreeze;n(55)("preventExtensions",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(17);n(55)("isFrozen",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){var r=n(17);n(55)("isSealed",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){var r=n(17);n(55)("isExtensible",function(e){return function(t){return!!r(t)&&(!e||e(t))}})},function(e,t,n){var r=n(4);r(r.S+r.F,"Object",{assign:n(152)})},function(e,t,n){var r=n(4);r(r.S,"Object",{is:n(153)})},function(e,t,n){var r=n(4);r(r.S,"Object",{setPrototypeOf:n(122).set})},function(e,t,n){"use strict";var r=n(92),i={};i[n(22)("toStringTag")]="z",i+""!="[object z]"&&n(40)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},function(e,t,n){var r=n(4);r(r.P,"Function",{bind:n(154)})},function(e,t,n){var r=n(30).f,i=Function.prototype,a=/^\s*function ([^ (]*)/;"name"in i||n(34)&&r(i,"name",{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var r=n(17),i=n(75),a=n(22)("hasInstance"),o=Function.prototype;a in o||n(30).f(o,a,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,n){var r=n(4),i=n(156);r(r.G+r.F*(parseInt!=i),{parseInt:i})},function(e,t,n){var r=n(4),i=n(157);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},function(e,t,n){"use strict";var r=n(14),i=n(45),a=n(60),o=n(124),s=n(63),u=n(15),c=n(74).f,l=n(54).f,f=n(30).f,p=n(98).trim,h=r.Number,d=h,m=h.prototype,y="Number"==a(n(73)(m)),v="trim"in String.prototype,g=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,a=(t=v?t.trim():p(t,3)).charCodeAt(0);if(43===a||45===a){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var o,u=t.slice(2),c=0,l=u.length;c<l;c++)if((o=u.charCodeAt(c))<48||o>i)return NaN;return parseInt(u,r)}}return+t};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof h&&(y?u(function(){m.valueOf.call(n)}):"Number"!=a(n))?o(new d(g(t)),n,h):g(t)};for(var b,E=n(34)?c(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),T=0;E.length>T;T++)i(d,b=E[T])&&!i(h,b)&&f(h,b,l(d,b));h.prototype=m,m.constructor=h,n(40)(r,"Number",h)}},function(e,t,n){"use strict";var r=n(4),i=n(53),a=n(158),o=n(125),s=1..toFixed,u=Math.floor,c=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",f=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*c[n],c[n]=r%1e7,r=u(r/1e7)},p=function(e){for(var t=6,n=0;--t>=0;)n+=c[t],c[t]=u(n/e),n=n%e*1e7},h=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==c[e]){var n=String(c[e]);t=""===t?n:t+o.call("0",7-n.length)+n}return t},d=function(e,t,n){return 0===t?n:t%2==1?d(e,t-1,n*e):d(e*e,t/2,n)};r(r.P+r.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(15)(function(){s.call({})})),"Number",{toFixed:function(e){var t,n,r,s,u=a(this,l),c=i(e),m="",y="0";if(c<0||c>20)throw RangeError(l);if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return String(u);if(u<0&&(m="-",u=-u),u>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(u*d(2,69,1))-69)<0?u*d(2,-t,1):u/d(2,t,1),n*=4503599627370496,(t=52-t)>0){for(f(0,n),r=c;r>=7;)f(1e7,0),r-=7;for(f(d(10,r,1),0),r=t-1;r>=23;)p(1<<23),r-=23;p(1<<r),f(1,1),p(2),y=h()}else f(0,n),f(1<<-t,0),y=h()+o.call("0",c);return y=c>0?m+((s=y.length)<=c?"0."+o.call("0",c-s)+y:y.slice(0,s-c)+"."+y.slice(s-c)):m+y}})},function(e,t,n){"use strict";var r=n(4),i=n(15),a=n(158),o=1..toPrecision;r(r.P+r.F*(i(function(){return"1"!==o.call(1,void 0)})||!i(function(){o.call({})})),"Number",{toPrecision:function(e){var t=a(this,"Number#toPrecision: incorrect invocation!");return void 0===e?o.call(t):o.call(t,e)}})},function(e,t,n){var r=n(4);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,n){var r=n(4),i=n(14).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},function(e,t,n){var r=n(4);r(r.S,"Number",{isInteger:n(159)})},function(e,t,n){var r=n(4);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,n){var r=n(4),i=n(159),a=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&a(e)<=9007199254740991}})},function(e,t,n){var r=n(4);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(4);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(4),i=n(157);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(e,t,n){var r=n(4),i=n(156);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,n){var r=n(4),i=n(160),a=Math.sqrt,o=Math.acosh;r(r.S+r.F*!(o&&710==Math.floor(o(Number.MAX_VALUE))&&o(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+a(e-1)*a(e+1))}})},function(e,t,n){var r=n(4),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},function(e,t,n){var r=n(4),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,n){var r=n(4),i=n(126);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,n){var r=n(4);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,n){var r=n(4),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},function(e,t,n){var r=n(4),i=n(127);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},function(e,t,n){var r=n(4);r(r.S,"Math",{fround:n(253)})},function(e,t,n){var r=n(126),i=Math.pow,a=i(2,-52),o=i(2,-23),s=i(2,127)*(2-o),u=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),c=r(e);return i<u?c*(i/u/o+1/a-1/a)*u*o:(n=(t=(1+o/a)*i)-(t-i))>s||n!=n?c*(1/0):c*n}},function(e,t,n){var r=n(4),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,a=0,o=0,s=arguments.length,u=0;o<s;)u<(n=i(arguments[o++]))?(a=a*(r=u/n)*r+1,u=n):a+=n>0?(r=n/u)*r:n;return u===1/0?1/0:u*Math.sqrt(a)}})},function(e,t,n){var r=n(4),i=Math.imul;r(r.S+r.F*n(15)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(e,t){var n=+e,r=+t,i=65535&n,a=65535&r;return 0|i*a+((65535&n>>>16)*a+i*(65535&r>>>16)<<16>>>0)}})},function(e,t,n){var r=n(4);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},function(e,t,n){var r=n(4);r(r.S,"Math",{log1p:n(160)})},function(e,t,n){var r=n(4);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,n){var r=n(4);r(r.S,"Math",{sign:n(126)})},function(e,t,n){var r=n(4),i=n(127),a=Math.exp;r(r.S+r.F*n(15)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(a(e-1)-a(-e-1))*(Math.E/2)}})},function(e,t,n){var r=n(4),i=n(127),a=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(a(e)+a(-e))}})},function(e,t,n){var r=n(4);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,n){var r=n(4),i=n(72),a=String.fromCharCode,o=String.fromCodePoint;r(r.S+r.F*(!!o&&1!=o.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,o=0;r>o;){if(t=+arguments[o++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?a(t):a(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},function(e,t,n){var r=n(4),i=n(47),a=n(27);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=a(t.length),r=arguments.length,o=[],s=0;n>s;)o.push(String(t[s++])),s<r&&o.push(String(arguments[s]));return o.join("")}})},function(e,t,n){"use strict";n(98)("trim",function(e){return function(){return e(this,3)}})},function(e,t,n){"use strict";var r=n(128)(!0);n(129)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){"use strict";var r=n(4),i=n(128)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(4),i=n(27),a=n(130),o="".endsWith;r(r.P+r.F*n(132)("endsWith"),"String",{endsWith:function(e){var t=a(this,e,"endsWith"),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),s=void 0===n?r:Math.min(i(n),r),u=String(e);return o?o.call(t,u,s):t.slice(s-u.length,s)===u}})},function(e,t,n){"use strict";var r=n(4),i=n(130);r(r.P+r.F*n(132)("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(4);r(r.P,"String",{repeat:n(125)})},function(e,t,n){"use strict";var r=n(4),i=n(27),a=n(130),o="".startsWith;r(r.P+r.F*n(132)("startsWith"),"String",{startsWith:function(e){var t=a(this,e,"startsWith"),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return o?o.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){"use strict";n(42)("anchor",function(e){return function(t){return e(this,"a","name",t)}})},function(e,t,n){"use strict";n(42)("big",function(e){return function(){return e(this,"big","","")}})},function(e,t,n){"use strict";n(42)("blink",function(e){return function(){return e(this,"blink","","")}})},function(e,t,n){"use strict";n(42)("bold",function(e){return function(){return e(this,"b","","")}})},function(e,t,n){"use strict";n(42)("fixed",function(e){return function(){return e(this,"tt","","")}})},function(e,t,n){"use strict";n(42)("fontcolor",function(e){return function(t){return e(this,"font","color",t)}})},function(e,t,n){"use strict";n(42)("fontsize",function(e){return function(t){return e(this,"font","size",t)}})},function(e,t,n){"use strict";n(42)("italics",function(e){return function(){return e(this,"i","","")}})},function(e,t,n){"use strict";n(42)("link",function(e){return function(t){return e(this,"a","href",t)}})},function(e,t,n){"use strict";n(42)("small",function(e){return function(){return e(this,"small","","")}})},function(e,t,n){"use strict";n(42)("strike",function(e){return function(){return e(this,"strike","","")}})},function(e,t,n){"use strict";n(42)("sub",function(e){return function(){return e(this,"sub","","")}})},function(e,t,n){"use strict";n(42)("sup",function(e){return function(){return e(this,"sup","","")}})},function(e,t,n){var r=n(4);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){"use strict";var r=n(4),i=n(41),a=n(63);r(r.P+r.F*n(15)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(e){var t=i(this),n=a(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},function(e,t,n){var r=n(4),i=n(288);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(e,t,n){"use strict";var r=n(15),i=Date.prototype.getTime,a=Date.prototype.toISOString,o=function(e){return e>9?e:"0"+e};e.exports=r(function(){return"0385-07-25T07:06:39.999Z"!=a.call(new Date(-5e13-1))})||!r(function(){a.call(new Date(NaN))})?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+o(e.getUTCMonth()+1)+"-"+o(e.getUTCDate())+"T"+o(e.getUTCHours())+":"+o(e.getUTCMinutes())+":"+o(e.getUTCSeconds())+"."+(n>99?n:"0"+o(n))+"Z"}:a},function(e,t,n){var r=Date.prototype,i=r.toString,a=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(40)(r,"toString",function(){var e=a.call(this);return e==e?i.call(this):"Invalid Date"})},function(e,t,n){var r=n(22)("toPrimitive"),i=Date.prototype;r in i||n(46)(i,r,n(291))},function(e,t,n){"use strict";var r=n(16),i=n(63);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),"number"!=e)}},function(e,t,n){var r=n(4);r(r.S,"Array",{isArray:n(120)})},function(e,t,n){"use strict";var r=n(58),i=n(4),a=n(41),o=n(162),s=n(133),u=n(27),c=n(134),l=n(135);i(i.S+i.F*!n(99)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,f,p=a(e),h="function"==typeof this?this:Array,d=arguments.length,m=d>1?arguments[1]:void 0,y=void 0!==m,v=0,g=l(p);if(y&&(m=r(m,d>2?arguments[2]:void 0,2)),null==g||h==Array&&s(g))for(n=new h(t=u(p.length));t>v;v++)c(n,v,y?m(p[v],v):p[v]);else for(f=g.call(p),n=new h;!(i=f.next()).done;v++)c(n,v,y?o(f,m,[i.value,v],!0):i.value);return n.length=v,n}})},function(e,t,n){"use strict";var r=n(4),i=n(134);r(r.S+r.F*n(15)(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},function(e,t,n){"use strict";var r=n(4),i=n(47),a=[].join;r(r.P+r.F*(n(90)!=Object||!n(51)(a)),"Array",{join:function(e){return a.call(i(this),void 0===e?",":e)}})},function(e,t,n){"use strict";var r=n(4),i=n(121),a=n(60),o=n(72),s=n(27),u=[].slice;r(r.P+r.F*n(15)(function(){i&&u.call(i)}),"Array",{slice:function(e,t){var n=s(this.length),r=a(this);if(t=void 0===t?n:t,"Array"==r)return u.call(this,e,t);for(var i=o(e,n),c=o(t,n),l=s(c-i),f=new Array(l),p=0;p<l;p++)f[p]="String"==r?this.charAt(i+p):this[i+p];return f}})},function(e,t,n){"use strict";var r=n(4),i=n(59),a=n(41),o=n(15),s=[].sort,u=[1,2,3];r(r.P+r.F*(o(function(){u.sort(void 0)})||!o(function(){u.sort(null)})||!n(51)(s)),"Array",{sort:function(e){return void 0===e?s.call(a(this)):s.call(a(this),i(e))}})},function(e,t,n){"use strict";var r=n(4),i=n(56)(0),a=n(51)([].forEach,!0);r(r.P+r.F*!a,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,n){var r=n(300);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(17),i=n(120),a=n(22)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){"use strict";var r=n(4),i=n(56)(1);r(r.P+r.F*!n(51)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(4),i=n(56)(2);r(r.P+r.F*!n(51)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(4),i=n(56)(3);r(r.P+r.F*!n(51)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(4),i=n(56)(4);r(r.P+r.F*!n(51)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(4),i=n(163);r(r.P+r.F*!n(51)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(4),i=n(163);r(r.P+r.F*!n(51)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},function(e,t,n){"use strict";var r=n(4),i=n(96)(!1),a=[].indexOf,o=!!a&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(o||!n(51)(a)),"Array",{indexOf:function(e){return o?a.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(4),i=n(47),a=n(53),o=n(27),s=[].lastIndexOf,u=!!s&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(u||!n(51)(s)),"Array",{lastIndexOf:function(e){if(u)return s.apply(this,arguments)||0;var t=i(this),n=o(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,a(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){var r=n(4);r(r.P,"Array",{copyWithin:n(164)}),n(80)("copyWithin")},function(e,t,n){var r=n(4);r(r.P,"Array",{fill:n(136)}),n(80)("fill")},function(e,t,n){"use strict";var r=n(4),i=n(56)(5),a=!0;"find"in[]&&Array(1).find(function(){a=!1}),r(r.P+r.F*a,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(80)("find")},function(e,t,n){"use strict";var r=n(4),i=n(56)(6),a="findIndex",o=!0;a in[]&&Array(1)[a](function(){o=!1}),r(r.P+r.F*o,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(80)(a)},function(e,t,n){n(81)("Array")},function(e,t,n){var r=n(14),i=n(124),a=n(30).f,o=n(74).f,s=n(131),u=n(100),c=r.RegExp,l=c,f=c.prototype,p=/a/g,h=/a/g,d=new c(p)!==p;if(n(34)&&(!d||n(15)(function(){return h[n(22)("match")]=!1,c(p)!=p||c(h)==h||"/a/i"!=c(p,"i")}))){c=function(e,t){var n=this instanceof c,r=s(e),a=void 0===t;return!n&&r&&e.constructor===c&&a?e:i(d?new l(r&&!a?e.source:e,t):l((r=e instanceof c)?e.source:e,r&&a?u.call(e):t),n?this:f,c)};for(var m=function(e){e in c||a(c,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},y=o(l),v=0;y.length>v;)m(y[v++]);f.constructor=c,c.prototype=f,n(40)(r,"RegExp",c)}n(81)("RegExp")},function(e,t,n){"use strict";n(167);var r=n(16),i=n(100),a=n(34),o=/./.toString,s=function(e){n(40)(RegExp.prototype,"toString",e,!0)};n(15)(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?s(function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!a&&e instanceof RegExp?i.call(e):void 0)}):"toString"!=o.name&&s(function(){return o.call(this)})},function(e,t,n){"use strict";var r=n(16),i=n(27),a=n(139),o=n(101);n(102)("match",1,function(e,t,n,s){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=s(n,e,this);if(t.done)return t.value;var u=r(e),c=String(this);if(!u.global)return o(u,c);var l=u.unicode;u.lastIndex=0;for(var f,p=[],h=0;null!==(f=o(u,c));){var d=String(f[0]);p[h]=d,""===d&&(u.lastIndex=a(c,i(u.lastIndex),l)),h++}return 0===h?null:p}]})},function(e,t,n){"use strict";var r=n(16),i=n(41),a=n(27),o=n(53),s=n(139),u=n(101),c=Math.max,l=Math.min,f=Math.floor,p=/\$([$&`']|\d\d?|<[^>]*>)/g,h=/\$([$&`']|\d\d?)/g;n(102)("replace",2,function(e,t,n,d){return[function(r,i){var a=e(this),o=null==r?void 0:r[t];return void 0!==o?o.call(r,a,i):n.call(String(a),r,i)},function(e,t){var i=d(n,e,this,t);if(i.done)return i.value;var f=r(e),p=String(this),h="function"==typeof t;h||(t=String(t));var y=f.global;if(y){var v=f.unicode;f.lastIndex=0}for(var g=[];;){var b=u(f,p);if(null===b)break;if(g.push(b),!y)break;""===String(b[0])&&(f.lastIndex=s(p,a(f.lastIndex),v))}for(var E,T="",w=0,N=0;N<g.length;N++){b=g[N];for(var C=String(b[0]),S=c(l(o(b.index),p.length),0),A=[],O=1;O<b.length;O++)A.push(void 0===(E=b[O])?E:String(E));var R=b.groups;if(h){var M=[C].concat(A,S,p);void 0!==R&&M.push(R);var _=String(t.apply(void 0,M))}else _=m(C,p,S,A,R,t);S>=w&&(T+=p.slice(w,S)+_,w=S+C.length)}return T+p.slice(w)}];function m(e,t,r,a,o,s){var u=r+e.length,c=a.length,l=h;return void 0!==o&&(o=i(o),l=p),n.call(s,l,function(n,i){var s;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(u);case"<":s=o[i.slice(1,-1)];break;default:var l=+i;if(0===l)return n;if(l>c){var p=f(l/10);return 0===p?n:p<=c?void 0===a[p-1]?i.charAt(1):a[p-1]+i.charAt(1):n}s=a[l-1]}return void 0===s?"":s})}})},function(e,t,n){"use strict";var r=n(16),i=n(153),a=n(101);n(102)("search",1,function(e,t,n,o){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=o(n,e,this);if(t.done)return t.value;var s=r(e),u=String(this),c=s.lastIndex;i(c,0)||(s.lastIndex=0);var l=a(s,u);return i(s.lastIndex,c)||(s.lastIndex=c),null===l?-1:l.index}]})},function(e,t,n){"use strict";var r=n(131),i=n(16),a=n(93),o=n(139),s=n(27),u=n(101),c=n(138),l=n(15),f=Math.min,p=[].push,h=!l(function(){RegExp(4294967295,"y")});n(102)("split",2,function(e,t,n,l){var d;return d="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var a,o,s,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,h=void 0===t?4294967295:t>>>0,d=new RegExp(e.source,l+"g");(a=c.call(d,i))&&!((o=d.lastIndex)>f&&(u.push(i.slice(f,a.index)),a.length>1&&a.index<i.length&&p.apply(u,a.slice(1)),s=a[0].length,f=o,u.length>=h));)d.lastIndex===a.index&&d.lastIndex++;return f===i.length?!s&&d.test("")||u.push(""):u.push(i.slice(f)),u.length>h?u.slice(0,h):u}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),a=null==n?void 0:n[t];return void 0!==a?a.call(n,i,r):d.call(String(i),n,r)},function(e,t){var r=l(d,e,this,t,d!==n);if(r.done)return r.value;var c=i(e),p=String(this),m=a(c,RegExp),y=c.unicode,v=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(h?"y":"g"),g=new m(h?c:"^(?:"+c.source+")",v),b=void 0===t?4294967295:t>>>0;if(0===b)return[];if(0===p.length)return null===u(g,p)?[p]:[];for(var E=0,T=0,w=[];T<p.length;){g.lastIndex=h?T:0;var N,C=u(g,h?p:p.slice(T));if(null===C||(N=f(s(g.lastIndex+(h?0:T)),p.length))===E)T=o(p,T,y);else{if(w.push(p.slice(E,T)),w.length===b)return w;for(var S=1;S<=C.length-1;S++)if(w.push(C[S]),w.length===b)return w;T=E=N}}return w.push(p.slice(E)),w}]})},function(e,t,n){var r=n(14),i=n(140).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(60)(o);e.exports=function(){var e,t,n,c=function(){var r,i;for(u&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(c)};else if(!a||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(c)}}else n=function(){i.call(r,c)};else{var f=!0,p=document.createTextNode("");new a(c).observe(p,{characterData:!0}),n=function(){p.data=f=!f}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){"use strict";var r=n(171),i=n(76);e.exports=n(105)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){"use strict";var r=n(171),i=n(76);e.exports=n(105)("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r,i=n(14),a=n(56)(0),o=n(40),s=n(64),u=n(152),c=n(172),l=n(17),f=n(76),p=n(76),h=!i.ActiveXObject&&"ActiveXObject"in i,d=s.getWeak,m=Object.isExtensible,y=c.ufstore,v=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},g={get:function(e){if(l(e)){var t=d(e);return!0===t?y(f(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return c.def(f(this,"WeakMap"),e,t)}},b=e.exports=n(105)("WeakMap",v,g,c,!0,!0);p&&h&&(u((r=c.getConstructor(v,"WeakMap")).prototype,g),s.NEED=!0,a(["delete","has","get","set"],function(e){var t=b.prototype,n=t[e];o(t,e,function(t,i){if(l(t)&&!m(t)){this._f||(this._f=new r);var a=this._f[e](t,i);return"set"==e?this:a}return n.call(this,t,i)})}))},function(e,t,n){"use strict";var r=n(172),i=n(76);n(105)("WeakSet",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(i(this,"WeakSet"),e,!0)}},r,!1,!0)},function(e,t,n){"use strict";var r=n(4),i=n(106),a=n(141),o=n(16),s=n(72),u=n(27),c=n(17),l=n(14).ArrayBuffer,f=n(93),p=a.ArrayBuffer,h=a.DataView,d=i.ABV&&l.isView,m=p.prototype.slice,y=i.VIEW;r(r.G+r.W+r.F*(l!==p),{ArrayBuffer:p}),r(r.S+r.F*!i.CONSTR,"ArrayBuffer",{isView:function(e){return d&&d(e)||c(e)&&y in e}}),r(r.P+r.U+r.F*n(15)(function(){return!new p(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(e,t){if(void 0!==m&&void 0===t)return m.call(o(this),e);for(var n=o(this).byteLength,r=s(e,n),i=s(void 0===t?n:t,n),a=new(f(this,p))(u(i-r)),c=new h(this),l=new h(a),d=0;r<i;)l.setUint8(d++,c.getUint8(r++));return a}}),n(81)("ArrayBuffer")},function(e,t,n){var r=n(4);r(r.G+r.W+r.F*!n(106).ABV,{DataView:n(141).DataView})},function(e,t,n){n(62)("Int8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(62)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(62)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(e,t,n){n(62)("Int16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(62)("Uint16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(62)("Int32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(62)("Uint32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(62)("Float32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(62)("Float64",8,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){var r=n(4),i=n(59),a=n(16),o=(n(14).Reflect||{}).apply,s=Function.apply;r(r.S+r.F*!n(15)(function(){o(function(){})}),"Reflect",{apply:function(e,t,n){var r=i(e),u=a(n);return o?o(r,t,u):s.call(r,t,u)}})},function(e,t,n){var r=n(4),i=n(73),a=n(59),o=n(16),s=n(17),u=n(15),c=n(154),l=(n(14).Reflect||{}).construct,f=u(function(){function e(){}return!(l(function(){},[],e)instanceof e)}),p=!u(function(){l(function(){})});r(r.S+r.F*(f||p),"Reflect",{construct:function(e,t){a(e),o(t);var n=arguments.length<3?e:a(arguments[2]);if(p&&!f)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var u=n.prototype,h=i(s(u)?u:Object.prototype),d=Function.apply.call(e,h,t);return s(d)?d:h}})},function(e,t,n){var r=n(30),i=n(4),a=n(16),o=n(63);i(i.S+i.F*n(15)(function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,n){a(e),t=o(t,!0),a(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},function(e,t,n){var r=n(4),i=n(54).f,a=n(16);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(a(e),t);return!(n&&!n.configurable)&&delete e[t]}})},function(e,t,n){"use strict";var r=n(4),i=n(16),a=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(161)(a,"Object",function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}}),r(r.S,"Reflect",{enumerate:function(e){return new a(e)}})},function(e,t,n){var r=n(54),i=n(75),a=n(45),o=n(4),s=n(17),u=n(16);o(o.S,"Reflect",{get:function e(t,n){var o,c,l=arguments.length<3?t:arguments[2];return u(t)===l?t[n]:(o=r.f(t,n))?a(o,"value")?o.value:void 0!==o.get?o.get.call(l):void 0:s(c=i(t))?e(c,n,l):void 0}})},function(e,t,n){var r=n(54),i=n(4),a=n(16);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(a(e),t)}})},function(e,t,n){var r=n(4),i=n(75),a=n(16);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(a(e))}})},function(e,t,n){var r=n(4);r(r.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,n){var r=n(4),i=n(16),a=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!a||a(e)}})},function(e,t,n){var r=n(4);r(r.S,"Reflect",{ownKeys:n(174)})},function(e,t,n){var r=n(4),i=n(16),a=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return a&&a(e),!0}catch(e){return!1}}})},function(e,t,n){var r=n(30),i=n(54),a=n(75),o=n(45),s=n(4),u=n(68),c=n(16),l=n(17);s(s.S,"Reflect",{set:function e(t,n,s){var f,p,h=arguments.length<4?t:arguments[3],d=i.f(c(t),n);if(!d){if(l(p=a(t)))return e(p,n,s,h);d=u(0)}if(o(d,"value")){if(!1===d.writable||!l(h))return!1;if(f=i.f(h,n)){if(f.get||f.set||!1===f.writable)return!1;f.value=s,r.f(h,n,f)}else r.f(h,n,u(0,s));return!0}return void 0!==d.set&&(d.set.call(h,s),!0)}})},function(e,t,n){var r=n(4),i=n(122);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},function(e,t,n){n(352),e.exports=n(35).Array.includes},function(e,t,n){"use strict";var r=n(4),i=n(96)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(80)("includes")},function(e,t,n){n(354),e.exports=n(35).String.padStart},function(e,t,n){"use strict";var r=n(4),i=n(175),a=n(104),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a);r(r.P+r.F*o,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){n(356),e.exports=n(35).String.padEnd},function(e,t,n){"use strict";var r=n(4),i=n(175),a=n(104),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a);r(r.P+r.F*o,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,n){n(358),e.exports=n(117).f("asyncIterator")},function(e,t,n){n(148)("asyncIterator")},function(e,t,n){n(360),e.exports=n(35).Object.getOwnPropertyDescriptors},function(e,t,n){var r=n(4),i=n(174),a=n(47),o=n(54),s=n(134);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=a(e),u=o.f,c=i(r),l={},f=0;c.length>f;)void 0!==(n=u(r,t=c[f++]))&&s(l,t,n);return l}})},function(e,t,n){n(362),e.exports=n(35).Object.values},function(e,t,n){var r=n(4),i=n(176)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){n(364),e.exports=n(35).Object.entries},function(e,t,n){var r=n(4),i=n(176)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},function(e,t,n){"use strict";n(168),n(366),e.exports=n(35).Promise.finally},function(e,t,n){"use strict";var r=n(4),i=n(35),a=n(14),o=n(93),s=n(170);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,i.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){n(368),n(369),n(370),e.exports=n(35)},function(e,t,n){var r=n(14),i=n(4),a=n(104),o=[].slice,s=/MSIE .\./.test(a),u=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&o.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*s,{setTimeout:u(r.setTimeout),setInterval:u(r.setInterval)})},function(e,t,n){var r=n(4),i=n(140);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,n){for(var r=n(137),i=n(71),a=n(40),o=n(14),s=n(46),u=n(79),c=n(22),l=c("iterator"),f=c("toStringTag"),p=u.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},d=i(h),m=0;m<d.length;m++){var y,v=d[m],g=h[v],b=o[v],E=b&&b.prototype;if(E&&(E[l]||s(E,l,p),E[f]||s(E,f,v),u[v]=p,g))for(y in r)E[y]||a(E,y,r[y],!0)}},function(e,t){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=E;var f="suspendedStart",p="suspendedYield",h="executing",d="completed",m={},y={};y[o]=function(){return this};var v=Object.getPrototypeOf,g=v&&v(v(P([])));g&&g!==r&&i.call(g,o)&&(y=g);var b=C.prototype=w.prototype=Object.create(y);N.prototype=b.constructor=C,C.constructor=N,C[u]=N.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===N||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(b),e},l.awrap=function(e){return{__await:e}},S(A.prototype),A.prototype[s]=function(){return this},l.AsyncIterator=A,l.async=function(e,t,n,r){var i=new A(E(e,t,n,r));return l.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},S(b),b[u]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},l.values=P,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),m}}}function E(e,t,n,r){var i=t&&t.prototype instanceof w?t:w,a=Object.create(i.prototype),o=new _(r||[]);return a._invoke=function(e,t,n){var r=f;return function(i,a){if(r===h)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw a;return x()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=O(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=T(e,t,n);if("normal"===u.type){if(r=n.done?d:p,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function T(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function N(){}function C(){}function S(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function A(e){var t;this._invoke=function(n,r){function a(){return new Promise(function(t,a){!function t(n,r,a,o){var s=T(e[n],e,r);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,a,o)},function(e){t("throw",e,a,o)}):Promise.resolve(c).then(function(e){u.value=e,a(u)},function(e){return t("throw",e,a,o)})}o(s.arg)}(n,r,t,a)})}return t=t?t.then(a,a):a()}}function O(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,O(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=T(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}return{next:x}}function x(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){(function(e,t){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;!function(n){!function(r){var i="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),a=o(n);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===i.Reflect?i.Reflect=n:a=o(i.Reflect,a),function(t){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,s={__proto__:[]}instanceof Array,u=!o&&!s,c={create:o?function(){return I(Object.create(null))}:s?function(){return I({__proto__:null})}:function(){return I({})},has:u?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:u?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),f="object"==typeof e&&e.env&&"true"===e.env.REFLECT_METADATA_USE_MAP_POLYFILL,p=f||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,i)},t.prototype.entries=function(){return new n(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function i(e,t){return t}function o(e,t){return[e,t]}}():Map,h=f||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new p}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}():Set,d=new(f||"function"!=typeof WeakMap?function(){var e=16,t=c.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=a(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=a(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){var n=a(e,!0);return n[this._key]=t,this},e.prototype.delete=function(e){var t=a(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+s()}while(c.has(t,e));return t[e]=!0,e}function a(e,t){if(!n.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:c.create()})}return e[r]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(){var t=function(e){if("function"==typeof Uint8Array)return"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e);return o(new Array(e),e)}(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function m(e,t,n){var r=d.get(e);if(T(r)){if(!n)return;r=new p,d.set(e,r)}var i=r.get(t);if(T(i)){if(!n)return;i=new p,r.set(t,i)}return i}function y(e,t,n){var r=m(t,n,!1);return!T(r)&&!!r.has(e)}function v(e,t,n){var r=m(t,n,!1);if(!T(r))return r.get(e)}function g(e,t,n,r){var i=m(n,r,!0);i.set(e,t)}function b(e,t){var n=[],r=m(e,t,!1);if(T(r))return n;for(var i=r.keys(),o=function(e){var t=M(e,a);if(!O(t))throw new TypeError;var n=t.call(e);if(!N(n))throw new TypeError;return n}(i),s=0;;){var u=_(o);if(!u)return n.length=s,n;var c=u.value;try{n[s]=c}catch(e){try{P(o)}finally{throw e}}s++}}function E(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function T(e){return void 0===e}function w(e){return null===e}function N(e){return"object"==typeof e?null!==e:"function"==typeof e}function C(e,t){switch(E(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=M(e,i);if(void 0!==r){var a=r.call(e,n);if(N(a))throw new TypeError;return a}return function(e,t){if("string"===t){var n=e.toString;if(O(n)){var r=n.call(e);if(!N(r))return r}var i=e.valueOf;if(O(i)){var r=i.call(e);if(!N(r))return r}}else{var i=e.valueOf;if(O(i)){var r=i.call(e);if(!N(r))return r}var a=e.toString;if(O(a)){var r=a.call(e);if(!N(r))return r}}throw new TypeError}(e,"default"===n?"number":n)}function S(e){var t=C(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function A(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function O(e){return"function"==typeof e}function R(e){return"function"==typeof e}function M(e,t){var n=e[t];if(null!=n){if(!O(n))throw new TypeError;return n}}function _(e){var t=e.next();return!t.done&&t}function P(e){var t=e.return;t&&t.call(e)}function x(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i?t:i===e?t:i}function I(e){return e.__=void 0,delete e.__,e}t("decorate",function(e,t,n,r){if(T(n)){if(!A(e))throw new TypeError;if(!R(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=e[n],i=r(t);if(!T(i)&&!w(i)){if(!R(i))throw new TypeError;t=i}}return t}(e,t)}if(!A(e))throw new TypeError;if(!N(t))throw new TypeError;if(!N(r)&&!T(r)&&!w(r))throw new TypeError;return w(r)&&(r=void 0),n=S(n),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=e[i],o=a(t,n,r);if(!T(o)&&!w(o)){if(!N(o))throw new TypeError;r=o}}return r}(e,t,n,r)}),t("metadata",function(e,t){return function(n,r){if(!N(n))throw new TypeError;if(!T(r)&&!function(e){switch(E(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;g(e,t,n,r)}}),t("defineMetadata",function(e,t,n,r){if(!N(n))throw new TypeError;T(r)||(r=S(r));return g(e,t,n,r)}),t("hasMetadata",function(e,t,n){if(!N(t))throw new TypeError;T(n)||(n=S(n));return function e(t,n,r){var i=y(t,n,r);if(i)return!0;var a=x(n);if(!w(a))return e(t,a,r);return!1}(e,t,n)}),t("hasOwnMetadata",function(e,t,n){if(!N(t))throw new TypeError;T(n)||(n=S(n));return y(e,t,n)}),t("getMetadata",function(e,t,n){if(!N(t))throw new TypeError;T(n)||(n=S(n));return function e(t,n,r){var i=y(t,n,r);if(i)return v(t,n,r);var a=x(n);if(!w(a))return e(t,a,r);return}(e,t,n)}),t("getOwnMetadata",function(e,t,n){if(!N(t))throw new TypeError;T(n)||(n=S(n));return v(e,t,n)}),t("getMetadataKeys",function(e,t){if(!N(e))throw new TypeError;T(t)||(t=S(t));return function e(t,n){var r=b(t,n);var i=x(t);if(null===i)return r;var a=e(i,n);if(a.length<=0)return r;if(r.length<=0)return a;var o=new h;var s=[];for(var u=0,c=r;u<c.length;u++){var l=c[u],f=o.has(l);f||(o.add(l),s.push(l))}for(var p=0,d=a;p<d.length;p++){var l=d[p],f=o.has(l);f||(o.add(l),s.push(l))}return s}(e,t)}),t("getOwnMetadataKeys",function(e,t){if(!N(e))throw new TypeError;T(t)||(t=S(t));return b(e,t)}),t("deleteMetadata",function(e,t,n){if(!N(t))throw new TypeError;T(n)||(n=S(n));var r=m(t,n,!1);if(T(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=d.get(t);return i.delete(n),i.size>0||(d.delete(t),!0)})}(a)}()}(n||(n={}))}).call(this,n(373),n(94))},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,f=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&h())}function h(){if(!l){var e=s(p);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||l||s(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){for(var t,n=c(e),r=n[0],o=n[1],s=new a(function(e,t,n){return 3*(t+n)/4-n}(0,r,o)),u=0,l=o>0?r-4:r,f=0;f<l;f+=4)t=i[e.charCodeAt(f)]<<18|i[e.charCodeAt(f+1)]<<12|i[e.charCodeAt(f+2)]<<6|i[e.charCodeAt(f+3)],s[u++]=t>>16&255,s[u++]=t>>8&255,s[u++]=255&t;2===o&&(t=i[e.charCodeAt(f)]<<2|i[e.charCodeAt(f+1)]>>4,s[u++]=255&t);1===o&&(t=i[e.charCodeAt(f)]<<10|i[e.charCodeAt(f+1)]<<4|i[e.charCodeAt(f+2)]>>2,s[u++]=t>>8&255,s[u++]=255&t);return s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,s=n-i;o<s;o+=16383)a.push(l(e,o,o+16383>s?s:o+16383));1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return a.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,p=n?-1:1,h=e[t+f];for(f+=p,a=h&(1<<-l)-1,h>>=-l,l+=s;l>0;a=256*a+e[t+f],f+=p,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+f],f+=p,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),a-=c}return(h?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,f=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:a-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+f>=1?p/u:p*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=l?(s=0,o=l):o+f>=1?(s=(t*u-1)*Math.pow(2,i),o+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=255&s,h+=d,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+h]=255&o,h+=d,o/=256,c-=8);e[n+h-d]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){e.exports=n.p+"index.css"},function(e,t,n){"use strict";n.r(t);var r=n(177),i=n(178);function a(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){a(o,r,i,s,u,"next",e)}function u(e){a(o,r,i,s,u,"throw",e)}s(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,n=null,r=[{key:"setItem",value:function(){var e=o(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){return NativeStorage.setItem(t,n,e,r)}));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getItem",value:function(){var e=o(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.nonNull(n,!0),e.abrupt("return",new Promise(function(e,r){NativeStorage.getItem(t,e,function(t){n?e(null):r(t)})}));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){return NativeStorage.keys(e,t)}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){return NativeStorage.remove(t,e,n)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){return NativeStorage.clear(e,t)}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}],n&&s(t.prototype,n),r&&s(t,r),e}();function c(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){c(a,r,i,o,s,"next",e)}function s(e){c(a,r,i,o,s,"throw",e)}o(void 0)})}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=y.nonNull(t,{}),this._translations={},this.addDynamicTranslations(e._translations),this.addDynamicTranslations(t.translations||{}),this._fallbackLanguage=t.fallbackLanguage||"en",this._currentLanguage=t.currentLanguage||this._fallbackLanguage,this._nativeStorageKey=t.nativeStorageKey||"language",this._translationClass=t.translationClass||"translation",this._markUntranslatedTranslations=t.markUntranslatedTranslations,this._markTranslations=t.markTranslations,this._logMissingTranslations=t.logMissingTranslations,this._translationCallbacks=new Map,this._lastTranslationCallbackId=0,this.loadUserLanguage().then(function(e){return n.setLanguage(e.toLowerCase())})}var t,n,r;return t=e,n=[{key:"setLanguage",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._currentLanguage!==t){e.next=3;break}return this.updateTranslations(),e.abrupt("return");case 3:if(this._translations[t]){e.next=5;break}return e.abrupt("return");case 5:return"undefined"!=typeof document&&document.getElementsByTagName("html")[0].setAttribute("lang",t),this._currentLanguage=t,this.updateTranslations(),e.next=10,u.setItem(this._nativeStorageKey,this._currentLanguage);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"translate",value:function(t,n){if(y.isNull(t))return"";var r=null;return t=t.toLowerCase(),this._translations[this._currentLanguage]&&this._translations[this._currentLanguage][t]&&(r=this._translations[this._currentLanguage][t]),e._isValid(r)||(this._logMissingTranslations&&console.warn("missing translation for language "+this._currentLanguage+" and key "+t),this._translations[this._fallbackLanguage]&&(r=this._translations[this._fallbackLanguage][t]),e._isValid(r)||(this._logMissingTranslations&&console.error("missing base translation for key "+t+". FIX IT"),r=t),this._markUntranslatedTranslations&&(r="&gt;&gt;"+r+"&lt;&lt;")),this._markTranslations&&(r="$"+r+"$"),void 0!==n&&(r=e._format(r,n)),r}},{key:"addDynamicTranslations",value:function(e){for(var t in e)for(var n in this._translations[t]||(this._translations[t]={}),e[t])this._translations[t][n.toLowerCase()]=e[t][n]}},{key:"addTranslationCallback",value:function(e,t){return t=y.nonNull(t,!0),this._lastTranslationCallbackId++,this._translationCallbacks.set(this._lastTranslationCallbackId,e),t&&e(),this._lastTranslationCallbackId}},{key:"removeTranslationCallback",value:function(e){this._translationCallbacks.delete(e)}},{key:"updateTranslations",value:function(t){if(void 0!==(t=y.nonNull(t,document)))for(var n=t.getElementsByClassName(this._translationClass),r=0,i=n.length;r<i;r++){var a=e._isValid(n[r].dataset.translation)?n[r].dataset.translation:n[r].innerText||"";if(""!==a)try{var o=this.translate(a,void 0!==n[r].dataset.translationArgs?JSON.parse(n[r].dataset.translationArgs):void 0);"1"===n[r].dataset.translationUseText?n[r].innerText=o:n[r].innerHTML=o,n[r].dataset.translation=a}catch(e){console.error("wrong configured translation: "+e)}for(var s in n[r].dataset)if(s.startsWith("translation")&&!s.endsWith("Args"))try{n[r][s.substr(11).toLowerCase()]=this.translate(n[r].dataset[s],void 0!==n[r].dataset[s+"Args"]?JSON.parse(n[r].dataset[s+"Args"]):void 0)}catch(e){console.error("wrong configured translation: "+e)}}this._translationCallbacks.forEach(function(e){return e(t)})}},{key:"loadUserLanguage",value:function(){var t=l(regeneratorRuntime.mark(function t(){var n,r,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.getItem(this._nativeStorageKey);case 2:if(n=t.sent,e._isValid(n)&&n in this._translations){t.next=16;break}r=[],void 0!==navigator.language&&r.push(navigator.language),"languages"in navigator&&(r=navigator.languages.slice(0)),r.push(this._fallbackLanguage),i=0,a=r.length;case 9:if(!(i<a)){t.next=16;break}if(!(r[i]in this._translations)){t.next=13;break}return n=r[i],t.abrupt("break",16);case 13:i++,t.next=9;break;case 16:return t.abrupt("return",n);case 17:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"makePersistentTranslation",value:function(e,t,n,r){if(r=y.nonNull(r,n,t,!1),n=n||"span","undefined"!=typeof document){var i=document.createElement(n);return i.dataset.translation=e,i.classList.add(this._translationClass),void 0!==t&&(i.dataset.translationArgs=JSON.stringify(t)),!0===r?(i.innerText=this.translate(e,t),i.dataset.translationUseText="1"):i.innerHTML=this.translate(e,t),i}}},{key:"getTranslationClass",value:function(){return this._translationClass}},{key:"getCurrentLanguage",value:function(){return this._currentLanguage}},{key:"getFallbackLanguage",value:function(){return this._fallbackLanguage}}],r=[{key:"setLanguage",value:function(){var t=l(regeneratorRuntime.mark(function t(n){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.getInstance())){t.next=3;break}return t.abrupt("return",r.setLanguage(n));case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},{key:"translate",value:function(t,n){var r=e.getInstance();return r?r.translate(t,n):""}},{key:"addDynamicTranslations",value:function(t){var n=e.getInstance();if(n)return n.addDynamicTranslations(t);Object.keys(t).forEach(function(n){y.isNull(e._translations[n])&&(e._translations[n]={}),Object.assign(e._translations[n],t[n])})}},{key:"makePersistentTranslation",value:function(t,n,r,i){var a=e.getInstance();if(a)return a.makePersistentTranslation(t,n,r,i)}},{key:"addTranslationCallback",value:function(t,n){var r=e.getInstance();if(r)return r.addTranslationCallback(t,n)}},{key:"removeTranslationCallback",value:function(t){var n=e.getInstance();if(n)return n.removeTranslationCallback(t)}},{key:"updateTranslations",value:function(t){var n=e.getInstance();if(n)return n.updateTranslations(t)}},{key:"init",value:function(t){e.instance=new e(t)}},{key:"getInstance",value:function(){return e.instance}},{key:"_isValid",value:function(e){return"string"==typeof e}},{key:"_format",value:function(e,t){return e.replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})}}],n&&f(t.prototype,n),r&&f(t,r),e}();function h(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}p._translations={},p.logMissingTranslations=!0,p.instance=null;var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,n=null,r=[{key:"isNull",value:function(e){return null==e}},{key:"isNotNull",value:function(t){return!e.isNull(t)}},{key:"nonNull",value:function(t,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];for(var o=0;o<arguments.length;o++)if(e.isNotNull(arguments[o]))return arguments[o];return null}},{key:"isSet",value:function(t){if(e.isNotNull(t)){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return 0===r.length||e.isSet.apply(null,[t[r[0]]].concat(r.slice(1)))}return!1}},{key:"empty",value:function(t){return e.isNull(t)||"string"==typeof t&&""===t.trim()}},{key:"notEmpty",value:function(t){return!e.empty(t)}},{key:"strftime",value:function(t,n,r){n instanceof Date||(n=new Date(n));var i=(r=e.nonNull(r,!1))?n.getUTCDay():n.getDay(),a=r?n.getUTCDate():n.getDate(),o=r?n.getUTCMonth():n.getMonth(),s=r?n.getUTCFullYear():n.getFullYear(),u=r?n.getUTCHours():n.getHours(),c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"],f=[0,31,59,90,120,151,181,212,243,273,304,334],h=function(){var e=new Date(n);return e.setDate(a-(i+6)%7+3),e},d=function(e,t){return(""+(Math.pow(10,t)+e)).slice(1)};return t.replace(/%[a-z]/gi,function(e){return{"%a":p.makePersistentTranslation(c[i].slice(0,3)).outerHTML,"%A":p.makePersistentTranslation(c[i]).outerHTML,"%b":p.makePersistentTranslation(l[o].slice(0,3)).outerHTML,"%B":p.makePersistentTranslation(l[o]).outerHTML,"%c":n.toUTCString(),"%C":Math.floor(s/100),"%d":d(a,2),"%e":a,"%f":d(n.getTime()%1e3,4),"%F":n.toISOString().slice(0,10),"%G":h().getFullYear(),"%g":(""+h().getFullYear()).slice(2),"%H":d(u,2),"%I":d((u+11)%12+1,2),"%j":d(f[o]+a+(o>1&&0==(3&s)&&(s%100!=0||s%400==0)?1:0),3),"%k":""+u,"%l":(u+11)%12+1,"%m":d(o+1,2),"%M":d(n.getMinutes(),2),"%p":u<12?"AM":"PM","%P":u<12?"am":"pm","%s":Math.round(n.getTime()/1e3),"%S":d(n.getSeconds(),2),"%u":i||7,"%V":function(){var e=h(),t=e.valueOf();e.setMonth(0,1);var n=e.getDay();return 4!==n&&e.setMonth(0,1+(4-n+7)%7),d(1+Math.ceil((t-e)/6048e5),2)}(),"%w":""+i,"%x":n.toLocaleDateString(),"%X":n.toLocaleTimeString(),"%y":(""+s).slice(2),"%Y":s,"%z":n.toTimeString().replace(/.+GMT([+-]\d+).+/,"$1"),"%Z":n.toTimeString().replace(/.+\((.+?)\)$/,"$1")}[e]||e})}},{key:"cloneJson",value:function(t){var n;if(e.isNull(t)||"object"!==d(t))return t;if(t instanceof Array){var r=[];for(n=0;n<t.length;++n)r[n]=e.cloneJson(t[n]);return r}if(t instanceof Date)return new Date(t.getTime());var i={};for(n in t)i[n]=e.cloneJson(t[n]);return i}},{key:"formDataFromObject",value:function(e){var t=new FormData;for(var n in e)t.set(n,e[n]);return t}},{key:"removeAllChildren",value:function(e){if(e instanceof Node)for(;e.firstChild;)e.removeChild(e.firstChild);return e}},{key:"shuffleArray",value:function(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}},{key:"padZero",value:function(t,n,r){return r=e.nonNull(r,"0"),t+="",n=e.nonNull(n,1),t.length>=n?t:new Array(n-t.length+1).join(r)+t}},{key:"deepEqual",value:function(t,n){if(t===n)return!0;if("object"===d(t)&&"object"===d(n)){var r=Object.keys(n);return Object.keys(t).every(function(i){var a=r.indexOf(i);return!(a<0)&&(r.splice(a,1),e.deepEqual(t[i],n[i]))})&&0===r.length}return!1}},{key:"invertKeyValues",value:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}},{key:"asyncForEach",value:function(){var t,n=(t=regeneratorRuntime.mark(function t(n,r,i){var a,o,s,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=e.nonNull(i,!1),a=[],o=0;case 3:if(!(o<n.length)){t.next=13;break}if(s=o,u=Promise.resolve(r(n[s],s,n)),i){t.next=9;break}return t.next=9,u;case 9:a.push(u);case 10:o++,t.next=3;break;case 13:return t.abrupt("return",Promise.all(a));case 14:case"end":return t.stop()}},t)}),function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(e){h(a,r,i,o,s,"next",e)}function s(e){h(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e,t,r){return n.apply(this,arguments)}}()},{key:"escapeRegExp",value:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},{key:"objectForEach",value:function(e,t){Object.keys(e).forEach(function(n){t(e[n],n,e)})}},{key:"toArray",value:function(e){var t=[];for(var n in e)t.push(e[n]);return t}},{key:"newPromiseWithResolve",value:function(){var e=null,t=null,n=new Promise(function(n,r){e=n,t=r});return n.resolve=e,n.reject=t,n}}],n&&m(t.prototype,n),r&&m(t,r),e}();function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function b(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){g(a,r,i,o,s,"next",e)}function s(e){g(a,r,i,o,s,"throw",e)}o(void 0)})}}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,n=null,r=[{key:"fetch",value:function(){var t=b(regeneratorRuntime.mark(function t(n,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,r){var i=new XMLHttpRequest;i.onload=function(){t(new Response(i.responseText,{status:0===i.status?200:i.status}))},i.onerror=function(e){r(e)},i.open("GET",n),Object.keys(e._additionalHeaders).forEach(function(t){i.setRequestHeader(t,e._additionalHeaders[t])}),i.send(null)}));case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"load",value:function(){var t=b(regeneratorRuntime.mark(function t(n,r,i){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=y.nonNull(r,!0),i=y.nonNull(i,!0),n=i?e.basePath(n):n,t.abrupt("return",e.fetch(n,{credentials:"same-origin"}).then(function(e){return r?e.json():e.text()}).catch(function(e){return console.error(e)}));case 4:case"end":return t.stop()}},t)}));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"loadAsset",value:function(){var e=b(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.load(t,!1,!1));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"buildQuery",value:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return"?"+t.join("&")}},{key:"send",value:function(){var t=b(regeneratorRuntime.mark(function t(n,r){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.basePath(n),i={},r instanceof FormData||"object"!==v(r)||(r=JSON.stringify(r),i={"Content-Type":"application/json"}),t.abrupt("return",fetch(n,{credentials:"same-origin",method:"POST",headers:i,body:r}).then(function(e){return e.json()}).catch(function(e){return console.error("error",e),{success:!1,errors:["not-online"]}}));case 4:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"basePath",value:function(t){return e._basePath+t}},{key:"setHeader",value:function(t,n){e._additionalHeaders[t]=n}}],n&&E(t.prototype,n),r&&E(t,r),e}();function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),e}T._additionalHeaders={},T._basePath="";var C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingPromises={}}return N(e,null,[{key:"getInstance",value:function(){return y.isNull(e.instance)&&(e.instance=new e),e.instance}}]),N(e,[{key:"load",value:function(t,n){if(-1!==(n=y.cloneJson(y.nonNull(n,[]))).indexOf(t))return Promise.reject("views are in a circuit! cannot resolve view for url "+n[0]+"! url "+t+" is in stack before!");if(n.push(t),y.isNotNull(this.loadingPromises[t]))return this.loadingPromises[t].then(function(e){return e.cloneNode(!0)});var r=Promise.resolve();return r=t instanceof Element?Promise.resolve(t):T.loadAsset(t).then(function(t){var n=(new DOMParser).parseFromString(t,"text/html");y.isNull(n)&&((n=document.implementation.createHTMLDocument("")).body.innerHTML=t);var r=document.createElement("span");return r.classList.add("injected-span"),e.moveChildren(n.body,r)}),this.loadingPromises[t]=r.then(function(t){var r=[];return t.querySelectorAll("[data-view]").forEach(function(t){r.push(e.getInstance().load(t.dataset.view,n).then(function(n){t.replaceWith(n),e.replaceWithChildren(n)}))}),Promise.all(r).then(function(){return t})}),this.loadingPromises[t].then(function(e){return e.cloneNode(!0)})}}],[{key:"inflateElementsFromString",value:function(e){var t=document.createElement("template");return t.innerHTML=e,t.content.childNodes}},{key:"createLoadingSymbol",value:function(e){var t="http://www.w3.org/2000/svg",n=document.createElement("div");n.classList.add("loader"),e&&n.classList.add(e);var r=document.createElementNS(t,"svg");r.setAttribute("viewBox","0 0 32 32"),r.setAttribute("width","32"),r.setAttribute("height","32");var i=document.createElementNS(t,"circle");return i.setAttribute("class","spinner"),i.setAttribute("cx","16"),i.setAttribute("cy","16"),i.setAttribute("r","14"),i.setAttribute("fill","none"),r.appendChild(i),n.appendChild(r),n}},{key:"moveChildren",value:function(e,t){var n=[];return e.childNodes.forEach(function(e){n.push(e)}),n.forEach(function(n){e.removeChild(n),t.appendChild(n)}),t}},{key:"replaceWithChildren",value:function(e){var t=[];e.childNodes.forEach(function(e){t.push(e)});var n=e.parentElement;t.forEach(function(t){e.removeChild(t),n.insertBefore(t,e)}),e.remove()}}]),e}();function S(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function A(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){S(a,r,i,o,s,"next",e)}function s(e){S(a,r,i,o,s,"throw",e)}o(void 0)})}}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}C.instance=null;var R=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._pauseParameters=[],this._view=null,this._fragments=[],this._state=e.STATE_CREATED,this._viewLoadedPromise=y.newPromiseWithResolve(),this._viewPromise=C.getInstance().load(t).then(function(e){return n._view=e,e}).catch(function(e){n._viewLoadedPromise.reject(e)})}var t,n,r;return t=e,(n=[{key:"getState",value:function(){return this._state}},{key:"onConstruct",value:function(){var t=A(regeneratorRuntime.mark(function t(n){var r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(i in this._state=e.STATE_CONSTRUCTED,r=[],this._fragments)r.push(this._fragments[i].onConstruct.apply(this._fragments[i],[n])),r.push(this._fragments[i]._viewPromise);return t.abrupt("return",Promise.all(r));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"onViewLoaded",value:function(){var t=A(regeneratorRuntime.mark(function t(){var n,r,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(i in this._state=e.STATE_CONSTRUCTED,n=[],r=function(e){n.push(a._fragments[e]._viewPromise.then(function(){return a._fragments[e].onViewLoaded()}).then(function(){return a._fragments[e]._viewLoadedPromise.resolve()}))},this._fragments)r(i);return t.abrupt("return",Promise.all(n));case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"onStart",value:function(){var t=A(regeneratorRuntime.mark(function t(n){var r,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this._state=e.STATE_RUNNING,r=regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a._fragments[t],e.t0=n.onStart,e.t1=a._fragments[t],e.next=5,a._fragments[t]._pauseParameters;case 5:e.t2=e.sent,e.t3=[e.t2],e.t0.apply.call(e.t0,e.t1,e.t3),a._fragments[t]._viewPromise.then(function(e){n.isActive()?e.classList.remove("hidden"):e.classList.add("hidden")});case 9:case"end":return e.stop()}},e)}),t.t0=regeneratorRuntime.keys(this._fragments);case 3:if((t.t1=t.t0()).done){t.next=8;break}return i=t.t1.value,t.delegateYield(r(i),"t2",6);case 6:t.next=3;break;case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"onPause",value:function(){var t=A(regeneratorRuntime.mark(function t(){var n,r,i=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n in this._state=e.STATE_PAUSED,this._fragments)r=this._fragments[n].onPause.apply(this._fragments[n],i),this._fragments[n].setPauseParameters(r);case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"onDestroy",value:function(){var t=A(regeneratorRuntime.mark(function t(){var n,r=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n in this._state=e.STATE_DESTROYED,this._fragments)this._fragments[n].onDestroy.apply(this._fragments[n],r);case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"addFragment",value:function(e,t){this._fragments.push(t),t.setViewQuery(e),this._viewPromise=Promise.all([this._viewPromise,t._viewPromise]).then(function(t){return t[0].querySelector(e).appendChild(t[1]),t[0]}).catch(function(e){return console.error(e)})}},{key:"findBy",value:function(e,t,n){t=y.nonNull(t,!1),n=y.nonNull(n,!1);var r=function(n){var r=null;return t?(r=n.querySelectorAll(e),n.matches(e)&&r.push(n)):r=n.matches(e)?n:n.querySelector(e),r};return n?this._viewPromise.then(function(e){return r(e)}):r(this._view)}},{key:"setPauseParameters",value:function(e){this._pauseParameters=e}},{key:"getViewPromise",value:function(){return this._viewPromise}}])&&O(t.prototype,n),r&&O(t,r),e}();function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function P(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){_(a,r,i,o,s,"next",e)}function s(e){_(a,r,i,o,s,"throw",e)}o(void 0)})}}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e,t,n){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=j(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}R.STATE_CREATED=0,R.STATE_CONSTRUCTED=1,R.STATE_RUNNING=2,R.STATE_PAUSED=3,R.STATE_DESTROYING=4,R.STATE_DESTROYED=5;var k=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=I(this,j(t).call(this,n)))._finishPromiseResolver={resolve:null,reject:null},r._finishPromise=new Promise(function(e,t){r._finishPromiseResolver={resolve:e,reject:t}}),r._onConstructPromise=null,r._parameters={},r._result=null,r._siteManager=e,r._title={element:null,text:null},r._loadingSymbol=null,r._historyId=null,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,R),n=t,(r=[{key:"getTitle",value:function(){return this._title}},{key:"onConstruct",value:function(){var e=P(regeneratorRuntime.mark(function e(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=L(j(t.prototype),"onConstruct",this).call(this,n),this.setParameters(y.nonNull(n,{})),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onStart",value:function(){var e=P(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(j(t.prototype),"onStart",this).call(this,n);case 2:this._updateTitle(),this.updateUrl(this._parameters);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setTitle",value:function(e,t){if("string"==typeof e){var n=t;t=e,e=p.makePersistentTranslation(t,n)}t=y.nonNull(t,e.textContent),this._title={element:e,text:t},this._updateTitle()}},{key:"setParameter",value:function(e,t){this._parameters[e]=t,this.updateUrl(this._parameters)}},{key:"setParameters",value:function(e){this._parameters=e,this.updateUrl(this._parameters)}},{key:"getParameters",value:function(){return this._parameters}},{key:"showLoadingSymbol",value:function(){var e=P(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(y.isNull(this._loadingSymbol)&&this._state>=R.STATE_PAUSED)){e.next=6;break}return this._loadingSymbol=C.createLoadingSymbol(),e.next=4,this.getViewPromise();case 4:t=e.sent,y.isNotNull(this._loadingSymbol)&&t.appendChild(this._loadingSymbol);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"removeLoadingSymbol",value:function(){var e=P(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:y.isNotNull(this._loadingSymbol)&&(this._loadingSymbol.remove(),this._loadingSymbol=null);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_updateTitle",value:function(){this._state===R.STATE_RUNNING&&this._siteManager.updateTitle(this._title.text)}},{key:"updateUrl",value:function(e){this._state===R.STATE_RUNNING&&this._siteManager.updateUrl(this,e)}},{key:"startSite",value:function(e,t){return this._siteManager.startSite(e,t)}},{key:"finishAndStartSite",value:function(e,t,n){var r=this.startSite(e,t);return this.finish(n),r}},{key:"finish",value:function(e){if(this._state!==R.STATE_DESTROYING&&this._state!==R.STATE_DESTROYED)return this._state=R.STATE_DESTROYING,y.isNotNull(e)&&this.setResult(e),this._siteManager.endSite(this)}},{key:"goBack",value:function(){this._state===R.STATE_RUNNING&&this._siteManager.goBack()}},{key:"onBackPressed",value:function(){}},{key:"onMenuPressed",value:function(){}},{key:"onSearchPressed",value:function(){}},{key:"getFinishPromise",value:function(){return this._finishPromise}},{key:"setResult",value:function(e){this._result=e}},{key:"getFinishResolver",value:function(){return this._finishPromiseResolver}}])&&x(n.prototype,r),i&&x(n,i),t}();function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._lastStateId=-1,this._states={},this._stack=[],this._ignoreOnPopState=!1,this._isUpdateNativeStack=!1,this._onPopStateListener=null,this._currentStackIndex=-1,window.onpopstate=function(e){if(t._isUpdateNativeStack)t._isUpdateNativeStack=!1;else{var n=e.state.type;if(t._currentStackIndex+=n,t._updateNativeHistoryStack(),t._ignoreOnPopState)t._ignoreOnPopState=!1;else if("function"==typeof t._onPopStateListener){var r={};t._stack.length>t._currentStackIndex&&t._currentStackIndex>=0&&(r=t._states[t._stack[t._currentStackIndex]]),t._onPopStateListener(r,n,e)}}},this._updateNativeHistoryStack()}var t,n,r;return t=e,r=[{key:"getInstance",value:function(){return y.isNull(e._instance)&&(e._instance=new e),e._instance}}],(n=[{key:"_updateNativeHistoryStack",value:function(t){t=y.nonNull(t,window.location.href),this._currentStackIndex>=0&&history.pushState({type:e.BACK},"back",t),history.pushState({type:e.CURRENT},"current",t),this._currentStackIndex<this._stack.length-1&&(history.pushState({type:e.FORWARD},"forward",t),this._isUpdateNativeStack=!0,history.go(-1))}},{key:"pushState",value:function(e,t,n){var r={state:e,title:t,url:n};return this._lastStateId++,this._states[this._lastStateId]=r,this._currentStackIndex++,this._stack.splice(this._currentStackIndex,this._stack.length,this._lastStateId),this._updateNativeHistoryStack(n),this._lastStateId}},{key:"replaceState",value:function(e,t,n,r){r=y.nonNull(r,this._stack[this._currentStackIndex]),this._stack.length>this._currentStackIndex&&this._currentStackIndex>=0&&(this._states[r]={state:e,title:t,url:n},this._updateNativeHistoryStack(n))}},{key:"stateToCurrentPosition",value:function(e){if(y.isNotNull(this._states[e])){var t=this._stack.indexOf(e);-1!==t&&(this._stack.splice(t,1),this._stack.splice(this._currentStackIndex+(t<=this._currentStackIndex)?-1:0,0,e))}}},{key:"go",value:function(e,t){this._ignoreOnPopState=!0===y.nonNull(t,!1),history.go(e)}},{key:"cutStack",value:function(e){e=y.nonNull(e,this._currentStackIndex+1),this._stack.splice(e),this._currentStackIndex=Math.min(this._currentStackIndex,this._stack.length-1),this._updateNativeHistoryStack()}},{key:"back",value:function(){this.go(-1)}},{key:"forward",value:function(){this.go(1)}},{key:"setOnPopStateListener",value:function(e){this._onPopStateListener=e}}])&&q(t.prototype,n),r&&q(t,r),e}();function U(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function F(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){U(a,r,i,o,s,"next",e)}function s(e){U(a,r,i,o,s,"throw",e)}o(void 0)})}}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}B._instance=null,B.BACK=-1,B.FORWARD=1,B.CURRENT=0;var Q=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._siteDiv=null,this._siteStack=[],this._siteDiv=document.getElementById(t),this._titleTranslationCallbackId=null,this._appEndedListener=null,this._inversedDeepLinks=y.invertKeyValues(n),B.getInstance().setOnPopStateListener(function(e,t){t===B.BACK?r.goBack():B.FORWARD===t&&(-1!==r._siteStack.indexOf(e.state.site)?r.toForeground(e.state.site):r.startSite(e.state.site.constructor,e.state.parameters))}),document.addEventListener("pause",function(){return r._pauseSite()},!1),document.addEventListener("resume",F(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._resumeSite();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),!1),document.addEventListener("menubutton",function(){var e=r.getCurrentSite();y.isNotNull(e)&&e.onMenuPressed()},!1),document.addEventListener("searchbutton",function(){var e=r.getCurrentSite();y.isNotNull(e)&&e.onSearchPressed()},!1)}var t,n,r;return t=e,(n=[{key:"setAppEndedListener",value:function(e){this._appEndedListener=e}},{key:"goBack",value:function(){if(this._siteStack.length>=1){var e=this.getCurrentSite();e&&!1!==e.onBackPressed()&&this.endSite(e)}}},{key:"getCurrentSite",value:function(){return this._siteStack.length>=1?this._siteStack[this._siteStack.length-1]:null}},{key:"startSite",value:function(){var e=F(regeneratorRuntime.mark(function e(t,n){var r,i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.prototype instanceof k){e.next=2;break}throw{error:"wrong class given! Expected AbstractSite, given "+t.name};case 2:return r=C.createLoadingSymbol("overlay"),this._siteDiv.appendChild(r),i=new t(this),this._siteStack.unshift(i),Promise.resolve(n).then(function(){var e=F(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i._onConstructPromise=i.onConstruct(t),e.next=3,Promise.all([i._onConstructPromise,i.getViewPromise()]);case 3:if(i._state===R.STATE_DESTROYED||i._state===R.STATE_DESTROYING){e.next=8;break}return e.next=6,i.onViewLoaded();case 6:return i._viewLoadedPromise.resolve(),e.abrupt("return",a._show(i));case 8:console.log("site has ended"),r.remove();case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.error("site start error for site ",t.name,e),i.getFinishResolver().reject(e),r.remove();for(var n=a._siteStack.length-1;n>=0;n--)if(a._siteStack[n]!==i)return a._show(a._siteStack[n]);i._viewLoadedPromise.reject()}),e.abrupt("return",i.getFinishPromise());case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateUrl",value:function(e,t){var n=this._generateUrl(e,t);B.getInstance().replaceState({site:e,parameters:t},e.constructor.name,n)}},{key:"_generateUrl",value:function(e,t){var n=this.getDeepLinkFor(e),r=[location.protocol,"//",location.host,location.pathname].join("");return y.isNotNull(n)&&(t.s=n,r=[r,T.buildQuery(t)].join("")),r}},{key:"getDeepLinkFor",value:function(e){return this._inversedDeepLinks[e.constructor]}},{key:"_pauseSite",value:function(e){e=y.nonNull(e,this.getCurrentSite()),y.isNotNull(e)&&e._state===R.STATE_RUNNING&&(e._pauseParameters=e.onPause(),y.removeAllChildren(this._siteDiv).appendChild(C.createLoadingSymbol()))}},{key:"_resumeSite",value:function(){var e=F(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=y.nonNull(t,this.getCurrentSite()),!y.isNotNull(t)||t._state!==R.STATE_PAUSED&&t._state!==R.STATE_CONSTRUCTED){e.next=9;break}return e.next=4,t.getViewPromise();case 4:return y.removeAllChildren(this._siteDiv).appendChild(t._view),p.getInstance().updateTranslations(),y.isNull(t._historyId)?t._historyId=B.getInstance().pushState({site:t,parameters:t.getParameters()},t.constructor.name,this._generateUrl(t,t.getParameters())):B.getInstance().stateToCurrentPosition(t._historyId),e.next=9,t.onStart(t._pauseParameters);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_show",value:function(){var e=F(regeneratorRuntime.mark(function e(t){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t._state!==R.STATE_DESTROYING&&t._state!==R.STATE_DESTROYED){e.next=2;break}return e.abrupt("return");case 2:if(t._state!==R.STATE_RUNNING||this.getCurrentSite()!==t){e.next=4;break}return e.abrupt("return");case 4:return this._pauseSite(),y.removeAllChildren(this._siteDiv).appendChild(C.createLoadingSymbol()),-1!==(n=this._siteStack.indexOf(t))&&this._siteStack.splice(n,1),this._siteStack.push(t),e.abrupt("return",t.getViewPromise().then(F(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.getCurrentSite()!==t){e.next=3;break}return e.next=3,r._resumeSite(t);case 3:case"end":return e.stop()}},e)}))));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"endSite",value:function(){var e=F(regeneratorRuntime.mark(function e(t){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._siteStack.indexOf(t),this._siteStack.splice(n,1),n===this._siteStack.length&&(this._pauseSite(t),this._siteDiv.appendChild(C.createLoadingSymbol("overlay")),t.getFinishPromise().then(function(){var e=r.getCurrentSite();y.isNotNull(e)&&r.toForeground(e)})),this._siteStack.length<=0&&(console.log("stack is empty, starting normal site!"),B.getInstance().cutStack(0),B.getInstance().go(-1*history.length,!0),y.removeAllChildren(this._siteDiv).appendChild(document.createTextNode("App ist beendet")),"function"==typeof this._appEndedListener&&this._appEndedListener(this)),e.next=6,t.onDestroy();case 6:t.getFinishResolver().resolve(t._result);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"toForeground",value:function(e){return this._show(e)}},{key:"updateTitle",value:function(e,t,n){n=y.nonNull(n,y.isNull(e)?"document-title-empty":"document-title"),y.isNotNull(this._titleTranslationCallbackId)&&p.removeTranslationCallback(this._titleTranslationCallbackId),this._titleTranslationCallbackId=p.addTranslationCallback(function(){!1!==t&&(e=p.translate(e,t)),document.title=p.translate(n,[e])})}}])&&V(t.prototype,n),r&&V(t,r),e}();function K(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function W(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){K(a,r,i,o,s,"next",e)}function s(e){K(a,r,i,o,s,"throw",e)}o(void 0)})}}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._resolver={resolve:null,reject:null},this._readyPromise=new Promise(function(e){return document.addEventListener("deviceready",e,!1)}),this._deepLinks={},this._siteManager=null}var t,n,r;return t=e,n=[{key:"addDeepLink",value:function(e,t){this._deepLinks[e]=t}},{key:"startSite",value:function(){var e=W(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._siteManager){e.next=2;break}return e.abrupt("return",this._siteManager.startSite(t,n));case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"start",value:function(){var t=W(regeneratorRuntime.mark(function t(n){var r,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ready();case 2:r=n,i=e._getStartParams(),y.isNotNull(i.s)&&(n=y.nonNull(this._deepLinks[i.s],n),delete i.s),a=new Q("site",this._deepLinks),y.removeAllChildren(document.getElementById("site")),a.startSite(n,i),a.setAppEndedListener(function(e){e.startSite(r)}),this._siteManager=a;case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"ready",value:function(){var t=W(regeneratorRuntime.mark(function t(n){var r,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this._readyPromise.then(function(){return e._resolver.resolve(i),Promise.all(e._promises)}),!n){t.next=5;break}return t.abrupt("return",r.then(n));case 5:return t.abrupt("return",r);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}],r=[{key:"addInitialization",value:function(t){if("function"==typeof t){var n=t;t=e._mainPromise.then(function(e){return n(e)})}e._promises.push(t)}},{key:"_getStartParams",value:function(){return e._extractParams(window.location.search.substr(1))}},{key:"_extractParams",value:function(e){if(y.isNull(e))return null;for(var t={},n=[],r=e.split("&"),i=0;i<r.length;i++)(n=r[i].split("="))[0].trim().length>0&&(t[n[0]]=decodeURIComponent(n[1]));return t}}],n&&H(t.prototype,n),r&&H(t,r),e}();function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Y._promises=[],Y._resolver={resolve:null,reject:null},Y._mainPromise=new Promise(function(e,t){Y._resolver={resolve:e,reject:t}});var J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getInstance",value:function(){return this._instance||(this._instance=new this),this._instance}}],(n=null)&&z(t.prototype,n),r&&z(t,r),e}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var te=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Z(this,$(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,J),n=t,(r=[{key:"getAverageImgColor",value:function(e,t,n){var r,i,a,o,s={r:255,g:255,b:255},u=document.createElement("canvas"),c=u.getContext&&u.getContext("2d"),l=-20,f={r:0,g:0,b:0},p=0;if(!c)return s;a=u.height=e.naturalHeight||e.offsetHeight||e.height,i=u.width=e.naturalWidth||e.offsetWidth||e.width,t=y.nonNull(t,i),n=y.nonNull(t,a),c.drawImage(e,0,0);try{r=c.getImageData(0,0,Math.min(i,t),Math.min(a,n))}catch(e){return console.error(e),s}for(o=r.data.length;(l+=20)<o;)++p,f.r+=r.data[l],f.g+=r.data[l+1],f.b+=r.data[l+2];return f.r=~~(f.r/p),f.g=~~(f.g/p),f.b=~~(f.b/p),f}},{key:"invertColorBW",value:function(e,t,n){return this.invertColor(e,t,n,!0)}},{key:"invertColor",value:function(e,t,n,r){return"object"===G(e)&&(r=t||r,t=e.g,n=e.b,e=e.r),r?.299*e+.587*t+.114*n>186?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:e=255-e,g:t=255-t,b:n=255-n}}},{key:"toHEX",value:function(e,t,n){return"object"===G(e)&&(t=e.g,n=e.b,e=e.r),e=e.toString(16),t=t.toString(16),n=n.toString(16),"#"+y.padZero(e)+y.padZero(t)+y.padZero(n)}}])&&X(n.prototype,r),i&&X(n,i),t}();function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ie(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var se=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ie(this,ae(t).call(this,n)))._site=e,r._viewQuery=null,r._active=!0,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(t,R),n=t,(r=[{key:"getSite",value:function(){return this._site instanceof t?this._site.getSite():this._site}},{key:"isActive",value:function(){return this._active}},{key:"setViewQuery",value:function(e){this._viewQuery=e}},{key:"getViewQuery",value:function(){return this._viewQuery}},{key:"setActive",value:function(e){this._active=e,y.isNotNull(this._view)&&(e?this._view.classList.remove("hidden"):this._view.classList.add("hidden"))}}])&&re(n.prototype,r),i&&re(n,i),t}();function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function le(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){ce(a,r,i,o,s,"next",e)}function s(e){ce(a,r,i,o,s,"throw",e)}o(void 0)})}}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pe(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function he(e,t,n){return(he="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=de(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function me(e,t){return(me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ye=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=pe(this,de(t).call(this,e,n)))._delegates=[],r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}(t,k),n=t,(r=[{key:"addDelegate",value:function(e){this._delegates.push(e)}},{key:"onConstruct",value:function(){var e=le(regeneratorRuntime.mark(function e(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=he(de(t.prototype),"onConstruct",this).call(this,n),e.next=3,y.asyncForEach(this._delegates,function(){var e=le(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onConstruct(n);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onStart",value:function(){var e=le(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he(de(t.prototype),"onStart",this).call(this,n);case 2:return e.next=4,y.asyncForEach(this._delegates,function(){var e=le(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onStart(n);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onBackPressed",value:function(){he(de(t.prototype),"onBackPressed",this).call(this),this._delegates.forEach(function(e){e.onBackPressed()})}},{key:"onMenuPressed",value:function(){he(de(t.prototype),"onMenuPressed",this).call(this),this._delegates.forEach(function(e){e.onMenuPressed()})}},{key:"onSearchPressed",value:function(){he(de(t.prototype),"onSearchPressed",this).call(this),this._delegates.forEach(function(e){e.onSearchPressed()})}},{key:"onViewLoaded",value:function(){var e=le(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=he(de(t.prototype),"onViewLoaded",this).call(this),e.next=3,y.asyncForEach(this._delegates,function(){var e=le(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onViewLoaded();case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onPause",value:function(){var e=le(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he(de(t.prototype),"onPause",this).call(this);case 2:return e.next=4,y.asyncForEach(this._delegates,function(){var e=le(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onPause();case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onDestroy",value:function(){var e=le(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he(de(t.prototype),"onDestroy",this).call(this);case 2:return e.next=4,y.asyncForEach(this._delegates,function(){var e=le(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onDestroy();case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}])&&fe(n.prototype,r),i&&fe(n,i),t}();function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,t){return!t||"object"!==ve(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function be(e){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Te=function(e){function t(e,n,r,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=ge(this,be(t).call(this,e,r)))._viewPromise=Promise.all([a._viewPromise,C.getInstance().load(n)]).then(function(e){return e[0].querySelector(i).replaceWith(e[1]),C.replaceWithChildren(e[1]),a._view=e[0],e[0]}).catch(function(e){return console.error(e)}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(t,ye),t}();n(107);var we=n(146),Ne=n.n(we);function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Oe(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Re(e,t,n){return(Re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Me(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pe=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Oe(this,Me(t).call(this,e,y.nonNull(n,Ne.a))))._elements={},r._sideScrolling=!1,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(t,se),n=t,(r=[{key:"onViewLoaded",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Re(Me(t.prototype),"onViewLoaded",this).call(this),this.findBy(".alphabetic-list-sidealphabet").addEventListener("mousedown",function(){r._sideScrolling=!0}),window.addEventListener("touchstart",function(e){r._sideScrolling=!0}),window.addEventListener("mouseup",function(){r._sideScrolling=!1}),window.addEventListener("touchend",function(){r._sideScrolling=!1}),this.findBy(".alphabet-scroll-to",!0).forEach(function(e){var t=function(t){r._sideScrolling&&r.findBy(".alphabet-section."+e.dataset.letter).scrollIntoView({behavior:"smooth",block:"start"})};e.addEventListener("mousedown",function(e){r._sideScrolling=!0,t()}),e.addEventListener("mousemove",t),e.addEventListener("touchstart",function(e){r._sideScrolling=!0,t()}),e.addEventListener("touchmove",t)}),this.renderList(),e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Se(a,r,i,o,s,"next",e)}function s(e){Se(a,r,i,o,s,"throw",e)}o(void 0)})});return function(){return n.apply(this,arguments)}}()},{key:"setElements",value:function(e){var t=this;this._elements={},Object.keys(e).sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}).forEach(function(n){t._elements[n]=e[n]})}},{key:"renderElement",value:function(e){console.warn("should be overloaded?");var t=document.createElement("div");return t.innerText=e,t}},{key:"renderList",value:function(){var e=this;this.findBy(".alphabet-section",!0).forEach(function(e){y.removeAllChildren(e)});var t="A",n=this.findBy(".alphabet-section.A");Object.keys(this._elements).forEach(function(r){var i=r.substring(0,1).toUpperCase();if(i!==t){t=i;var a=e.findBy(".alphabet-section."+i);null!==a&&(n=a)}var o=e.renderElement(e._elements[r]);n.appendChild(o)})}}])&&Ae(n.prototype,r),i&&Ae(n,i),t}();n(179);function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ie=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._action=n,this._showFor=y.nonNull(r,e.SHOW_FOR_MEDIUM),this._order=y.nonNull(i,1e3),this._icon=a,this._id=e.lastId++,this._liClass="",this._shouldTranslate=!0,this._visible=!0,this._activated=!0,this._menu=null}var t,n,r;return t=e,(n=[{key:"copy",value:function(t){var n=y.nonNull(t,new e);return n._name=this._name,n._action=this._action,n._showFor=this._showFor,n._order=this._order,n._liClass=this._liClass,n._shouldTranslate=this._shouldTranslate,n._visible=this._visible,n._activated=this._activated,n._id=e.lastId++,n}},{key:"redraw",value:function(){y.isNotNull(this._menu)&&this._menu.redrawAction(this)}},{key:"update",value:function(){this._menu.updateAction(this)}},{key:"getOrder",value:function(){return this._order}},{key:"isActivated",value:function(){return this._activated}},{key:"isShouldTranslate",value:function(){return this._shouldTranslate}},{key:"isVisible",value:function(){return this._visible}},{key:"getName",value:function(){return this._name}},{key:"getAction",value:function(){return this._action}},{key:"getId",value:function(){return this._id}},{key:"getIcon",value:function(){return this._icon}},{key:"getShowFor",value:function(){return this._showFor}},{key:"getLiClass",value:function(){return this._liClass}},{key:"getMenu",value:function(){return this._menu}},{key:"setMenu",value:function(e){this._menu=e}}])&&xe(t.prototype,n),r&&xe(t,r),e}();function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e,t,n){return(ke="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qe(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Ie.lastId=0,Ie.SHOW_ALWAYS="always",Ie.SHOW_FOR_SMEDIUM="smedium",Ie.SHOW_FOR_MEDIUM="medium",Ie.SHOW_FOR_LARGE="large",Ie.SHOW_NEVER="never";var Ue=function(e){function t(e,n,r,i,a){var o,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=this,(o=!(u=qe(t).call(this,e,function(e){e.getSubmenu().toggle(),e.update()},r,i,a))||"object"!==Le(u)&&"function"!=typeof u?De(s):u)._submenu=n,n.setParentAction(De(o)),o}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(t,Ie),n=t,(r=[{key:"copy",value:function(e){return e=y.nonNull(e,new t(null,this._submenu.copy())),(e=ke(qe(t.prototype),"copy",this).call(this,e))._submenu.setParentAction(e),e}},{key:"getSubmenu",value:function(){return this._submenu}}])&&je(n.prototype,r),i&&je(n,i),t}();function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ve=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._actions=[],this._renderers=[],this._submenus=[],Array.isArray(t)?this._renderers=t:this._renderers=[t],this._onClickListener=this._generateOnClickListener(),y.nonNull(n,[]).forEach(function(e){r.addAction(e,!1)}),this._openSubmenuListener=null}var t,n,r;return t=e,(n=[{key:"copy",value:function(t){return(t=y.nonNull(t,new e))._actions=[],this._actions.forEach(function(e){t.addAction(e.copy())}),t._renderers=this._renderers,t._onClickListener=this._onClickListener,t}},{key:"close",value:function(){this._submenus.forEach(function(e){e.close()})}},{key:"addAction",value:function(e,t){e instanceof Ie&&-1===this._actions.indexOf(e)&&(e instanceof Ue&&this._submenus.push(e.getSubmenu()),this._actions.push(e),e.setMenu(this),y.nonNull(t,!0)&&this.redraw())}},{key:"draw",value:function(){var e=this;try{this.sortActions(),this._renderers.forEach(function(t){t.render(e)})}catch(e){console.error(e)}}},{key:"sortActions",value:function(){this._actions=this._actions.sort(function(e,t){return e.getOrder()-t.getOrder()})}},{key:"openSubmenu",value:function(e){this._openSubmenuListener&&this._openSubmenuListener(e)}},{key:"setOpenSubmenuListener",value:function(e){this._openSubmenuListener=e}},{key:"_generateOnClickListener",value:function(){var e=this;return function(t){var n=t.target;if(n.matches("li")||n.matches("li *")){n=n.closest("li");for(var r=parseInt(n.dataset.id),i=0,a=e._actions.length;i<a;i++)if(e._actions[i].getId()===r)return"function"==typeof e._actions[i].getAction()&&e._actions[i].isActivated()&&(e._actions[i].getAction()(e._actions[i],t),t.preventDefault()),e._actions[i];for(var o=0,s=e._submenus.length;o<s;o++){var u=e._submenus[o].click(r,t);if(u)return u}}return null}}},{key:"setOnClickListener",value:function(e){this._onClickListener=e}},{key:"getOnClickListener",value:function(){return this._onClickListener}},{key:"getActions",value:function(){return this._actions}},{key:"redrawAction",value:function(e){this._renderers.forEach(function(t){t._triggerRenderAction(e)})}},{key:"updateAction",value:function(e){this._renderers.forEach(function(t){t.updateAction(e)})}},{key:"redraw",value:function(){this.draw()}}])&&Fe(t.prototype,n),r&&Fe(t,r),e}();function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){return!t||"object"!==Qe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ye=function(e){function t(e,n,r,i,a){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ke(this,We(t).call(this,e,function(){t._app&&(Array.isArray(n)&&n.length>=2?t._app.startSite(n[0],n[1]):t._app.startSite(n))},r,i,a))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}(t,Ie),t}();Ye._app=null,Y.addInitialization(function(e){Ye._app=e});var ze=n(180),Je=n.n(ze);function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parentElement=t,this._renderedElements={}}var t,n,r;return t=e,(n=[{key:"render",value:function(e,t){var n=this,r=e.getActions();t=y.nonNull(t,this._parentElement),y.isNotNull(t)&&(y.removeAllChildren(t),r.forEach(function(e){t.appendChild(n.getElementForAction(e))}),t.onclick=function(t){"function"==typeof e.getOnClickListener()&&e.getOnClickListener()(t)})}},{key:"_triggerRenderAction",value:function(e){var t=this._renderedElements[e.getId()];return this._renderedElements[e.getId()]=e instanceof Ue?this.renderSubmenuAction(e):this.renderAction(e),this.updateAction(e),y.isNotNull(t)&&t.replaceWith(this._renderedElements[e.getId()]),this._renderedElements[e.getId()]}},{key:"getElementForAction",value:function(e){return y.isNull(this._renderedElements[e.getId()])&&this._triggerRenderAction(e),this._renderedElements[e.getId()]}},{key:"renderAction",value:function(e){}},{key:"updateAction",value:function(e){}},{key:"renderSubmenuAction",value:function(e){var t=this.renderAction(e);e.getSubmenu().sortActions();var n=this.createSubmenuParentElement(e);return this.render(e.getSubmenu(),n),t.appendChild(n),t}},{key:"createSubmenuParentElement",value:function(e){return document.createElement("ul")}}])&&Ge(t.prototype,n),r&&Ge(t,r),e}();function Ze(e){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function et(e,t){return!t||"object"!==Ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tt(e,t,n){return(tt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nt(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rt(e,t){return(rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var it=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),et(this,nt(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rt(e,t)}(t,Xe),n=t,(r=[{key:"renderAction",value:function(e){var t=this.renderLinkElement(e),n=this.renderLiElement(e);return n.insertBefore(t,n.firstChild),n}},{key:"renderLinkElement",value:function(e){var t=document.createElement("a");if("string"==typeof e.getAction()&&(t.href=e.getAction()),y.isNotNull(e.getIcon())){var n=document.createElement("img");n.src=e.getIcon(),n.classList.add("action-image"),e.isShouldTranslate()?(n.dataset.translationTitle=e.getName(),n.classList.add(p.getInstance().getTranslationClass())):n.title=e.getName(),t.appendChild(n)}var r=e.getName();return r=e.isShouldTranslate()?p.makePersistentTranslation(r):document.createTextNode(r),t.appendChild(r),t}},{key:"renderLiElement",value:function(e){var t=document.createElement("li");return""!==e.getLiClass().trim()&&t.classList.add(e.getLiClass()),t.dataset.id=e.getId(),y.isNotNull(e.getIcon())&&t.classList.add("img"),e.isVisible()||t.classList.add("hidden"),t.classList.add(e.getShowFor()),t}},{key:"renderSubmenuAction",value:function(e){var n=tt(nt(t.prototype),"renderSubmenuAction",this).call(this,e);return n.classList.remove("is-dropdown-submenu-parent"),n.classList.add("is-accordion-submenu-parent"),n}},{key:"createSubmenuParentElement",value:function(e){var t=document.createElement("ul");return t.classList.add("menu"),t.classList.add("vertical"),t.classList.add("submenu"),t.classList.add("accordion-menu"),t.classList.add("is-accordion-submenu"),t.classList.add("first-sub"),t}},{key:"updateAction",value:function(e){if(e instanceof Ue){var t=this.getElementForAction(e).querySelector(".submenu");e.getSubmenu().isOpen()?(this.getElementForAction(e).setAttribute("aria-expanded",!0),t.classList.add("js-active"),t.style=""):(this.getElementForAction(e).removeAttribute("aria-expanded"),t.classList.remove("js-activ"),t.style="display:none;")}}}])&&$e(n.prototype,r),i&&$e(n,i),t}();function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function st(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e,t,n){return(ut="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ct(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lt(e,t){return(lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ft=function(e){function t(e,n,r,i){var a,o,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(a=!(s=ct(t).call(this,[]))||"object"!==at(s)&&"function"!=typeof s?st(o):s)._parentAction=new Ue(e,st(a),n,r,i),a._isOpen=!1,a}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lt(e,t)}(t,Ve),n=t,(r=[{key:"copy",value:function(e){return e=y.nonNull(e,new t),(e=ut(ct(t.prototype),"copy",this).call(this,e))._isOpen=this._isOpen,e}},{key:"setParentAction",value:function(e){this._parentAction=e}},{key:"getParentMenu",value:function(){return this._parentAction.getMenu()}},{key:"_generateOnClickListener",value:function(){return null}},{key:"click",value:function(e,t){for(var n=0,r=this._actions.length;n<r;n++)if(this._actions[n].getId()===e)return"function"==typeof this._actions[n].getAction()&&this._actions[n].isActivated()&&(this._actions[n].getAction()(this._actions[n],t),t.preventDefault()),this._actions[n]instanceof Ue||this.close(),this._actions[n];for(var i=0,a=this._submenus.length;i<a;i++){var o=this._submenus[i].click(e,t);if(o)return o}return null}},{key:"toggle",value:function(){this._isOpen?this.close():this.open()}},{key:"open",value:function(){this._isOpen=!0,this.openSubmenu(this),y.isNotNull(this._parentAction)&&this._parentAction.update()}},{key:"openSubmenu",value:function(e){this.getParentMenu().openSubmenu(e)}},{key:"close",value:function(){this._isOpen=!1,ut(ct(t.prototype),"close",this).call(this),y.isNotNull(this._parentAction)&&this._parentAction.update()}},{key:"getParentAction",value:function(){return this._parentAction}},{key:"updateAction",value:function(e){this.getParentMenu().updateAction(e)}},{key:"isOpen",value:function(){return this._isOpen}}])&&ot(n.prototype,r),i&&ot(n,i),t}();function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function dt(e,t){return!t||"object"!==pt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function mt(e,t,n){return(mt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yt(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function yt(e){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vt(e,t){return(vt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gt=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=dt(this,yt(t).call(this,e)))._accordionMenuRenderer=new it,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vt(e,t)}(t,it),n=t,(r=[{key:"renderSubmenuAction",value:function(e){if(e.getMenu()instanceof ft)return mt(yt(t.prototype),"renderSubmenuAction",this).call(this,e);var n=mt(yt(t.prototype),"renderSubmenuAction",this).call(this,e);return n.classList.add("is-dropdown-submenu-parent"),n.classList.add("opens-right"),n}},{key:"createSubmenuParentElement",value:function(e){if(e.getMenu()instanceof ft)return mt(yt(t.prototype),"createSubmenuParentElement",this).call(this,e);var n=document.createElement("ul");return n.classList.add("menu"),n.classList.add("vertical"),n.classList.add("submenu"),n.classList.add("accordion-menu"),n.classList.add("is-dropdown-submenu"),n.classList.add("first-sub"),n}},{key:"updateAction",value:function(e){if(e.getMenu()instanceof ft)return mt(yt(t.prototype),"updateAction",this).call(this,e);if(e instanceof Ue){var n=this.getElementForAction(e).querySelector(".submenu");e.getSubmenu().isOpen()?n.classList.add("js-dropdown-active"):n.classList.remove("js-dropdown-active")}}}])&&ht(n.prototype,r),i&&ht(n,i),t}();function bt(e){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Tt(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Et(a,r,i,o,s,"next",e)}function s(e){Et(a,r,i,o,s,"throw",e)}o(void 0)})}}function wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nt(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ct(e,t,n){return(Ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=St(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ot=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Nt(this,St(t).call(this,e,y.nonNull(n,Je.a))))._menu=null,r._responsiveMenu=null,r._backgroundImage="",r._menuActions=[],t.defaultActions.forEach(function(e){r._menuActions.push(e.copy())}),r._scrollWidget=null,r._canGoBack=!0,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(t,se),n=t,r=[{key:"setCanGoBack",value:function(e){this._canGoBack=e,this._view&&(this._canGoBack?this.findBy(".back-button").classList.remove("hidden"):this.findBy(".back-button").classList.add("hidden"))}},{key:"setScrollWidget",value:function(e){var t=this;if(this._scrollWidget=e,this._view&&this._scrollWidget){var n=this.findBy(".top-bar > span"),r=this.findBy(".background-img"),i=function(){var e=t.findBy("nav.top-bar");n.getBoundingClientRect().bottom>=r.getBoundingClientRect().bottom?e.classList.add("solid"):e.classList.remove("solid")};r.addEventListener("load",i),e.addEventListener("scroll",i),requestAnimationFrame(i)}}},{key:"setBackgroundImage",value:function(e){var t=this;if(this._backgroundImage=e,this._view){var n=this.findBy("nav.top-bar");if(y.isNotNull(this._backgroundImage)){var r=this.findBy(".background-img"),i=te.getInstance();r.addEventListener("load",function(){if(""!==t._backgroundImage){var e=i.getAverageImgColor(r,void 0,150),a=i.invertColorBW(e);0===a.r&&0===a.g&&0===a.b?(n.classList.remove("color-white"),n.classList.add("color-black")):(n.classList.remove("color-black"),n.classList.add("color-white"))}else n.classList.remove("color-black"),n.classList.remove("color-white")}),requestAnimationFrame(function(){var e=n.querySelector(".grid-container");n.style="min-height:"+e.getBoundingClientRect().height+"px",e.addEventListener("resize",function(){n.style="min-height:"+e.getBoundingClientRect().height+"px"})}),r.src=this._backgroundImage,n.classList.add("with-image")}else n.classList.remove("with-image")}}},{key:"onViewLoaded",value:function(){var e=Tt(regeneratorRuntime.mark(function e(){var n,r,i,a,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ct(St(t.prototype),"onViewLoaded",this).call(this),this.setTitleElement(document.createTextNode(t.title)),(r=[]).push(new gt(this.findBy("#navbar-menu-visible"))),r.push(new it(this.findBy("#navbar-menu-hidden"))),this._menu=new Ve(r,this._menuActions),this._closeListenerContainer=this.findBy("#navbar-close-listener-container"),this._menu.setOpenSubmenuListener(function(){o._showCloseListener()}),i=this._menu.getOnClickListener(),this._menu.setOnClickListener(function(e){i(e)instanceof Ue||o.closeMenu()}),this._responsiveMenu=this.findBy("#responsive-menu"),this.findBy("#responsive-menu-toggle").onclick=function(){o._responsiveMenu.classList.contains("visible")?o.closeMenu():o.openMenu()},a=this,this.findBy("#navbar-close-listener").addEventListener("click",function(e){e.target===this&&a.closeMenu()}),window.addEventListener("resize",function(){o._state===R.STATE_RUNNING&&o.updateToggleButton()}),this.drawMenu(),this.findBy(".back-button").addEventListener("click",function(){o.goBack()}),this.setCanGoBack(this._canGoBack),this.setBackgroundImage(this._backgroundImage),this.setScrollWidget(this._scrollWidget),e.abrupt("return",n);case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"goBack",value:function(){this._canGoBack&&this.getSite().goBack()}},{key:"onStart",value:function(){var e=Tt(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Ct(St(t.prototype),"onStart",this).call(this,n),this.updateToggleButton();case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_showCloseListener",value:function(){this._closeListenerContainer&&(this._closeListenerContainer.style.display="block")}},{key:"closeMenu",value:function(){y.isNotNull(this._responsiveMenu)&&this._responsiveMenu.classList.remove("visible"),this._closeListenerContainer&&(this._closeListenerContainer.style.display="none"),this._menu&&this._menu.close()}},{key:"openMenu",value:function(){y.isNotNull(this._responsiveMenu)&&this._responsiveMenu.classList.add("visible"),this._showCloseListener()}},{key:"drawMenu",value:function(){y.isNotNull(this._menu)&&this._menu.draw()}},{key:"updateToggleButton",value:function(){var e=t._getCurrentSize(),n=this.findBy("#navbar-menu-visible");("medium"===e||"smedium"===e||"small"===e)&&n.querySelectorAll("."+Ie.SHOW_FOR_LARGE+":not(.hidden)").length>0||("smedium"===e||"small"===e)&&n.querySelectorAll("."+Ie.SHOW_FOR_MEDIUM+":not(.hidden)").length>0||"small"===e&&n.querySelectorAll("."+Ie.SHOW_FOR_SMEDIUM+":not(.hidden)").length>0||n.querySelectorAll("."+Ie.SHOW_NEVER+":not(.hidden)").length>0?document.getElementById("responsive-menu-toggle").style.display="block":(document.getElementById("responsive-menu-toggle").style.display="none",this.closeMenu())}},{key:"addAction",value:function(e){this._menuActions.push(e),y.nonNull(this._menu)&&this._menu.addAction(e)}},{key:"setTitleElement",value:function(e){y.removeAllChildren(this.findBy("#title-element-container")).appendChild(e)}}],i=[{key:"_getCurrentSize",value:function(){for(var e,n=t._getViewQueries(),r=0;r<n.length;r++){var i=n[r];matchMedia(i._value).matches&&(e=i)}return"object"===bt(e)?e._name:e}},{key:"_getViewQueries",value:function(){return 0===t.queries.length&&(t.queries=t._calculateViewQueries()),t.queries}},{key:"_calculateViewQueries",value:function(){var e=document.getElementsByClassName("foundation-mq");if(0!==e.length){var t,n,r=[];for(var i in t=window.getComputedStyle(e[0]).getPropertyValue("font-family"),n={},e="string"!=typeof t?n:(t=t.trim().slice(1,-1))?n=t.split("&").reduce(function(e,t){var n=t.replace(/\+/g," ").split("="),r=n[0],i=n[1];return r=decodeURIComponent(r),i=void 0===i?null:decodeURIComponent(i),e.hasOwnProperty(r)?Array.isArray(e[r])?e[r].push(i):e[r]=[e[r],i]:e[r]=i,e},{}):n)e.hasOwnProperty(i)&&r.push({_name:i,_value:"only screen and (min-width: "+e[i]+")"});return r}}}],r&&wt(n.prototype,r),i&&wt(n,i),t}();Ot.queries=[],Ot.title="MeinBerufBau",Ot.defaultActions=[];var Rt=n(181),Mt=n.n(Rt);function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function xt(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Pt(a,r,i,o,s,"next",e)}function s(e){Pt(a,r,i,o,s,"throw",e)}o(void 0)})}}function It(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jt(e,t,n){return(jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dt(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Dt(e){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kt(e,t){return(kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qt=function(e){function t(e,n,r){var i,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,(i=!(o=Dt(t).call(this,e,n,y.nonNull(r,Mt.a),"#site-content"))||"object"!==_t(o)&&"function"!=typeof o?Lt(a):o)._navbarFragment=new Ot(Lt(i)),i.addFragment("#navbar-fragment",i._navbarFragment),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kt(e,t)}(t,Te),n=t,(r=[{key:"onConstruct",value:function(){var e=xt(regeneratorRuntime.mark(function e(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jt(Dt(t.prototype),"onConstruct",this).call(this,n);case 2:return r=e.sent,this.onCreateMenu(this._navbarFragment),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onMenuPressed",value:function(){this._navbarFragment.openMenu()}},{key:"onViewLoaded",value:function(){var e=xt(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=jt(Dt(t.prototype),"onViewLoaded",this).call(this),this._navbarFragment.setScrollWidget(this.findBy("#main-content-container")),e.abrupt("return",n);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_updateTitle",value:function(){jt(Dt(t.prototype),"_updateTitle",this).call(this),this._title.element&&this._state===R.STATE_RUNNING&&this._navbarFragment.setTitleElement(this._title.element)}},{key:"onCreateMenu",value:function(e){}}])&&It(n.prototype,r),i&&It(n,i),t}();function Bt(e){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ut(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ft(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ut(a,r,i,o,s,"next",e)}function s(e){Ut(a,r,i,o,s,"throw",e)}o(void 0)})}}function Vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qt(e,t){return!t||"object"!==Bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kt(e){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wt(e,t){return(Wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ht=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Qt(this,Kt(t).call(this,e,n)))._parent=null,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wt(e,t)}(t,se),n=t,(r=[{key:"onSwipeRight",value:function(){var e=Ft(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.previousFragment();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onSwipeLeft",value:function(){var e=Ft(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.nextFragment();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setParent",value:function(e){this._parent=e}},{key:"nextFragment",value:function(){y.isNotNull(this._parent)&&this._parent.nextFragment()}},{key:"previousFragment",value:function(){y.isNotNull(this._parent)&&this._parent.previousFragment()}}])&&Vt(n.prototype,r),i&&Vt(n,i),t}(),Yt=n(182),zt=n.n(Yt);function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Xt(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Gt(a,r,i,o,s,"next",e)}function s(e){Gt(a,r,i,o,s,"throw",e)}o(void 0)})}}function Zt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $t(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function en(e,t,n){return(en="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nn(e,t){return(nn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rn=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=$t(this,tn(t).call(this,e,zt.a)))._activeIndex=0,n._touchStart=null,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nn(e,t)}(t,se),n=t,(r=[{key:"onViewLoaded",value:function(){var e=Xt(regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._view.addEventListener("touchstart",function(e){n._touchStart=e.touches[0]},!1),this._view.addEventListener("touchend",function(e){n._handleSwipe(e.changedTouches[0].clientX,e.changedTouches[0].clientY),n._touchStart=null}),this._view.addEventListener("mousedown",function(e){n._touchStart=e},!1),this._view.addEventListener("mouseup",function(e){n._handleSwipe(e.clientX,e.clientY),n._touchStart=null}),e.abrupt("return",en(tn(t.prototype),"onViewLoaded",this).call(this));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_handleSwipe",value:function(){var e=Xt(regeneratorRuntime.mark(function e(n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!y.isNull(this._touchStart)){e.next=2;break}return e.abrupt("return");case 2:if(i=this._touchStart,this._touchStart=null,a=i.clientX-n,!(Math.abs(i.clientY-r)<=t.MAX_Y&&Math.abs(a)>=t.MIN_X)){e.next=13;break}if(!(a>0)){e.next=11;break}return e.next=9,this._fragments[this._activeIndex].onSwipeLeft();case 9:e.next=13;break;case 11:return e.next=13,this._fragments[this._activeIndex].onSwipeRight();case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onStart",value:function(){var e=Xt(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._activeIndex>=0&&this._activeIndex<this._fragments.length&&this.setActiveFragment(this._activeIndex),e.abrupt("return",en(tn(t.prototype),"onStart",this).call(this,n));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setActiveFragment",value:function(e){var t=this;e instanceof Ht&&(e=this._fragments.indexOf(e)),e>=0&&e<this._fragments.length&&(this._activeIndex=e,this._fragments.forEach(function(e,n){e.setActive(n===t._activeIndex)}))}},{key:"nextFragment",value:function(){this.setActiveFragment((this._activeIndex+1)%this._fragments.length)}},{key:"previousFragment",value:function(){this.setActiveFragment((this._activeIndex+this._fragments.length-1)%this._fragments.length)}},{key:"addFragment",value:function(e){if(e instanceof Ht)return e.setParent(this),en(tn(t.prototype),"addFragment",this).call(this,".swipe-container",e)}}])&&Zt(n.prototype,r),i&&Zt(n,i),t}();rn.MAX_Y=80,rn.MIN_X=150;n(183);function an(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function on(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){an(a,r,i,o,s,"next",e)}function s(e){an(a,r,i,o,s,"throw",e)}o(void 0)})}}function sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var un=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._toastContainer=document.querySelector(e._toastContainerSelector),this._toastTemplate=this._toastContainer.querySelector(".toast-template"),this._toastTemplate.classList.remove("toast-template"),this._toastTemplate.remove()}var t,n,r;return t=e,n=[{key:"showToast",value:function(){var e=on(regeneratorRuntime.mark(function e(t){var n,r,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getMessage(),n=t.isShouldTranslate()?p.makePersistentTranslation(n,t.getTranslationArgs()):document.createTextNode(n),(r=this._toastTemplate.cloneNode(!0)).querySelector(".message").appendChild(n),t.setToastElement(r),this._toastContainer.appendChild(r),r.style.opacity=1,e.abrupt("return",new Promise(function(e){r.querySelector(".message").onclick=function(){i.hideToast(t),e(!0)},setTimeout(function(){i.hideToast(t),e(!1)},t.getDuration())}));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"hideToast",value:function(){var e=on(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getToastElement(),!y.isNotNull(n)){e.next=4;break}return n.style.opacity=0,e.abrupt("return",new Promise(function(e){setTimeout(function(){n.remove(),e()},250)}));case 4:return e.abrupt("return",Promise.reject("toast is not showing"));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}],r=[{key:"setToastContainerSelector",value:function(t){e._toastContainerSelector=t}},{key:"getInstance",value:function(){return e._instance||(e._instance=new e),e._instance}}],n&&sn(t.prototype,n),r&&sn(t,r),e}();function cn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ln(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){cn(a,r,i,o,s,"next",e)}function s(e){cn(a,r,i,o,s,"throw",e)}o(void 0)})}}function fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}un._instance=null,un._toastContainerSelector="#toast-container";var pn=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._message=t,this._duration=y.nonNull(n,e.DEFAULT_DURATION),this._shouldTranslate=!1!==r,this._translationArgs=y.nonNull(r,[]),this._id=e.LAST_ID++,this._toastElement=null}var t,n,r;return t=e,(n=[{key:"getId",value:function(){return this._id}},{key:"getMessage",value:function(){return this._message}},{key:"getDuration",value:function(){return this._duration}},{key:"isShouldTranslate",value:function(){return this._shouldTranslate}},{key:"getTranslationArgs",value:function(){return this._translationArgs}},{key:"setToastElement",value:function(e){this._toastElement=e}},{key:"getToastElement",value:function(){return this._toastElement}},{key:"show",value:function(){var e=ln(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",un.getInstance().showToast(this));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"hide",value:function(){var e=ln(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",un.getInstance().hideToast(this));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}])&&fn(t.prototype,n),r&&fn(t,r),e}();pn.LAST_ID=0,pn.DEFAULT_DURATION=2500;var hn=n(184),dn=n(185);Y.addInitialization(function(){p.addDynamicTranslations({de:hn,en:dn})});var mn=n(13);function yn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function vn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){yn(a,r,i,o,s,"next",e)}function s(e){yn(a,r,i,o,s,"throw",e)}o(void 0)})}}function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var bn=mn;bn.default&&(bn=bn.default);var En=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=this._createConnectionOptions(t);this._connectionPromise=bn.createConnection(n).catch(function(e){return console.error(e),Promise.reject(e)})}var t,n,r;return t=e,n=[{key:"_createConnectionOptions",value:function(t){var n=e.CONNECTION_OPTIONS;if("undefined"==typeof device||"browser"!==device.platform)n.type="cordova",n.database=t;else{var r=null;n.type="sqljs",n.location=t,n.autoSave=!0,n.useLocalForage=!0,n.autoSaveCallback=function(){clearTimeout(r),r=setTimeout(function(){bn.getSqljsManager().saveDatabase()},150)}}return n.entities=this.getEntityDefinitions(),n}},{key:"getEntityDefinitions",value:function(){var t=this,n=[];return Object.keys(e._models).forEach(function(r){e._models[r]._database=t,n.push(new bn.EntitySchema(e._models[r].getSchemaDefinition()))}),n}},{key:"saveEntity",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,!Array.isArray(t)){e.next=9;break}if(0!==t.length){e.next=4;break}return e.abrupt("return",t);case 4:return e.next=6,this._getRepository(t[0].constructor);case 6:n=e.sent,e.next=12;break;case 9:return e.next=11,this._getRepository(t.constructor);case 11:n=e.sent;case 12:return e.abrupt("return",n.save(t));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findEntities",value:function(){var t=vn(regeneratorRuntime.mark(function t(n,r,i,a,o,s){var u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRepository(n);case 2:return u=t.sent,t.abrupt("return",e._setLoaded(u.find(e._buildQuery(r,i,a,o,s))));case 4:case"end":return t.stop()}},t,this)}));return function(e,n,r,i,a,o){return t.apply(this,arguments)}}()},{key:"findAndCountEntities",value:function(){var t=vn(regeneratorRuntime.mark(function t(n,r,i,a,o,s){var u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRepository(n);case 2:return u=t.sent,t.abrupt("return",e._setLoaded(u.findAndCount(e._buildQuery(r,i,a,o,s))));case 4:case"end":return t.stop()}},t,this)}));return function(e,n,r,i,a,o){return t.apply(this,arguments)}}()},{key:"findOneEntity",value:function(){var t=vn(regeneratorRuntime.mark(function t(n,r,i,a,o){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRepository(n);case 2:return s=t.sent,t.abrupt("return",e._setLoaded(s.findOne(e._buildQuery(r,i,void 0,a,o))));case 4:case"end":return t.stop()}},t,this)}));return function(e,n,r,i,a){return t.apply(this,arguments)}}()},{key:"findById",value:function(){var t=vn(regeneratorRuntime.mark(function t(n,r,i){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRepository(n);case 2:return a=t.sent,t.abrupt("return",e._setLoaded(a.findOne(r,e._buildQuery(void 0,void 0,void 0,void 0,i))));case 4:case"end":return t.stop()}},t,this)}));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"findByIds",value:function(){var t=vn(regeneratorRuntime.mark(function t(n,r,i){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRepository(n);case 2:return a=t.sent,t.abrupt("return",e._setLoaded(a.findByIds(r,e._buildQuery(void 0,void 0,void 0,void 0,i))));case 4:case"end":return t.stop()}},t,this)}));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"clearModel",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getRepository(t);case 2:return n=e.sent,e.abrupt("return",n.clear());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_getRepository",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._connectionPromise;case 2:return n=e.sent,e.abrupt("return",n.getRepository(t));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteEntity",value:function(){var e=vn(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=7;break}if(0!==t.length){e.next=3;break}return e.abrupt("return",t);case 3:null===n&&(n=t[0].constructor),"number"!=typeof t[0]&&(r=[],t.forEach(function(e){return r.push(e.id)}),t=r),e.next=9;break;case 7:null===n&&(n=t.constructor),"number"!=typeof t&&(t=t.id);case 9:return e.next=11,this._getRepository(n);case 11:return i=e.sent,e.abrupt("return",i.delete(t));case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"waitForConnection",value:function(){var e=vn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._connectionPromise);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}],r=[{key:"_buildQuery",value:function(e,t,n,r,i){var a={};return e&&(a.where=e),t&&(a.order=t),n&&(a.take=n),r&&(a.skip=r),i&&(a.relations=i),a}},{key:"_setLoaded",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return(n=Array.isArray(t))||(t=[t]),t.forEach(function(e){return e._isLoaded=!0}),e.abrupt("return",n?t:t[0]);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getInstance",value:function(){return this.instance||(this.instance=new this),this.instance}},{key:"addModel",value:function(t){e._models[t.getSchemaName()]=t}},{key:"getModel",value:function(e){return e?this._models[e]:this._models}}],n&&gn(t.prototype,n),r&&gn(t,r),e}();function Tn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function wn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Tn(a,r,i,o,s,"next",e)}function s(e){Tn(a,r,i,o,s,"throw",e)}o(void 0)})}}function Nn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}En._models={},En.CONNECTION_OPTIONS={location:"default",logging:["error","warn"],synchronize:!0},En.TYPES={INTEGER:"int",FLOAT:"float",DATE:"datetime",STRING:"varchar",TEXT:"text",MEDIUMTEXT:"mediumtext",BOOLEAN:"boolean",JSON:"json",SIMPLE_JSON:"simple-json"};var Cn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this._isLoaded=!1}var t,n,r;return t=e,n=[{key:"getId",value:function(){return this.id}},{key:"setId",value:function(e){this.id=e}},{key:"save",value:function(){var e=wn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.constructor._database.saveEntity(this));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=wn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.constructor._database.deleteEntity(this));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}],r=[{key:"getColumnDefinitions",value:function(){return{id:{primary:!0,type:En.TYPES.INTEGER,generated:!0}}}},{key:"getRelationDefinitions",value:function(){return{}}},{key:"getRelations",value:function(){return Object.keys(this.getRelationDefinitions())}},{key:"getSchemaDefinition",value:function(){var e=this.getColumnDefinitions();return Object.keys(e).forEach(function(t){"string"==typeof e[t]&&(e[t]={type:e[t]})}),{name:this.getSchemaName(),target:this,columns:e,relations:this.getRelationDefinitions()}}},{key:"getSchemaName",value:function(){return this.SCHEMA_NAME||(this.SCHEMA_NAME=this.name),this.SCHEMA_NAME}},{key:"find",value:function(){var e=wn(regeneratorRuntime.mark(function e(t,n,r,i,a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._database.findEntities(this,t,n,r,i,a));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"findAndCount",value:function(){var e=wn(regeneratorRuntime.mark(function e(t,n,r,i,a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._database.findAndCountEntities(this,t,n,r,i,a));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"findOne",value:function(){var e=wn(regeneratorRuntime.mark(function e(t,n,r,i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._database.findOneEntity(this,t,n,r,i));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"findById",value:function(){var e=wn(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._database.findById(this,t,n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findByIds",value:function(){var e=wn(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._database.findByIds(this,t,n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=wn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._database.clearModel(this));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}],n&&Nn(t.prototype,n),r&&Nn(t,r),e}();function Sn(e){return(Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function An(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function On(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){An(a,r,i,o,s,"next",e)}function s(e){An(a,r,i,o,s,"throw",e)}o(void 0)})}}function Rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mn(e,t){return!t||"object"!==Sn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _n(e,t,n){return(_n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Pn(e){return(Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xn(e,t){return(xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Cn._database=null;var In=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Mn(this,Pn(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xn(e,t)}(t,Cn),n=t,r=[{key:"save",value:function(){var e=On(regeneratorRuntime.mark(function e(n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=9;break}return r=this.toJSON(),e.next=4,T.send(t.SAVE_PATH,{model:this.constructor.getSchemaName(),values:r});case 4:if(!(i=e.sent).error){e.next=7;break}throw new Error(i.error);case 7:return e.next=9,this.constructor._fromJson(i,this);case 9:return e.abrupt("return",_n(Pn(t.prototype),"save",this).call(this));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}],i=[{key:"getColumnDefinitions",value:function(){var e=_n(Pn(t),"getColumnDefinitions",this).call(this);return e.id&&e.id.generated&&(e.id.generated=!1),e}},{key:"_fromJson",value:function(){var e=On(regeneratorRuntime.mark(function e(t,n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSchemaDefinition",value:function(){var e=_n(Pn(t),"getSchemaDefinition",this).call(this);return Object.keys(e.columns).forEach(function(t){e.columns[t].type===En.TYPES.MEDIUMTEXT&&(e.columns[t].type=En.TYPES.TEXT),e.columns[t].type===En.TYPES.JSON&&(e.columns[t].type=En.TYPES.SIMPLE_JSON)}),e}}],r&&Rn(n.prototype,r),i&&Rn(n,i),t}();function Ln(e){return(Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Dn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){jn(a,r,i,o,s,"next",e)}function s(e){jn(a,r,i,o,s,"throw",e)}o(void 0)})}}function kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qn(e,t){return!t||"object"!==Ln(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bn(e,t,n){return(Bn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Un(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Un(e){return(Un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fn(e,t){return(Fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}In.SAVE_PATH="/sync";var Vn=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=qn(this,Un(t).call(this))).createdAt=new Date,e.updatedAt=new Date,e.version=1,e.deleted=!1,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fn(e,t)}(t,Cn),n=t,r=[{key:"toJSON",value:function(e){var t=this,n=this.constructor.getRelationDefinitions(),r=this.constructor.getColumnDefinitions(),i={};return Object.keys(r).forEach(function(e){i[e]=t[e]}),Object.keys(n).forEach(function(n){if(!0===e)i[n]=t[n];else if(Array.isArray(t[n])){var r=[];t[n].forEach(function(e){return e&&r.push(e.id)}),i[n]=r}else t[n]instanceof Cn?i[n]=t[n].id:i[n]=null}),i}}],i=[{key:"getColumnDefinitions",value:function(){var e=Bn(Un(t),"getColumnDefinitions",this).call(this);return e.createdAt={type:En.TYPES.DATE},e.updatedAt={type:En.TYPES.DATE},e.version={type:En.TYPES.INTEGER},e.deleted={type:En.TYPES.BOOLEAN},e}},{key:"_fromJson",value:function(){var e=Dn(regeneratorRuntime.mark(function e(t,n,r){var i,a,o,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||[],(i=Array.isArray(t))||(t=[t]),Array.isArray(n)||(n=[n]),a=this.getRelationDefinitions(),o=[],t.forEach(function(e,t){o.push(new Promise(function(){var i=Dn(regeneratorRuntime.mark(function i(u){var c;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(c=null,!(n.length>t)){i.next=5;break}c=n[t],i.next=9;break;case 5:if(null===e.id||void 0===e.id){i.next=9;break}return i.next=8,s.findById(e.id,s.getRelations());case 8:c=i.sent;case 9:null===c&&(c=new s),e.version||(e.version=1),n[t]=Object.assign(c,e),Object.keys(a).forEach(function(e){var i=n[t][e];if("number"==typeof i||Array.isArray(i)&&i.length>=1&&"number"==typeof i[0])if(!0===r){var s=null;s=Array.isArray(i)?En.getModel(a[e].target).findByIds(i):En.getModel(a[e].target).findById(i),o.push(s.then(function(r){console.log("loaded element(s):",e,r),n[t][e]=r}))}else!1===r&&("many-to-many"===a[e].type||"one-to-many"===a[e].type?n[t][e]=[]:n[t][e]=null)}),u();case 14:case"end":return i.stop()}},i)}));return function(e){return i.apply(this,arguments)}}()))}),e.next=9,Promise.all(o);case 9:return i||(n=n.length>0?n[0]:null),e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}],r&&kn(n.prototype,r),i&&kn(n,i),t}();function Qn(e){return(Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Wn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Kn(a,r,i,o,s,"next",e)}function s(e){Kn(a,r,i,o,s,"throw",e)}o(void 0)})}}function Hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Yn(e,t){return!t||"object"!==Qn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function zn(e,t,n){return(zn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Jn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Jn(e){return(Jn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gn(e,t){return(Gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Vn.CAN_BE_SYNCED=!0;var Xn=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Yn(this,Jn(t).call(this,e||"EasySync"))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gn(e,t)}(t,En),n=t,(r=[{key:"_createConnectionOptions",value:function(e){return Object.setPrototypeOf(Vn,In),Object.setPrototypeOf(Vn.prototype,In.prototype),zn(Jn(t.prototype),"_createConnectionOptions",this).call(this,e)}}])&&Hn(n.prototype,r),i&&Hn(n,i),t}();function Zn(e){return(Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function er(e,t){return!t||"object"!==Zn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tr(e){return(tr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nr(e,t){return(nr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Xn.BASE_MODEL=null,Y.addInitialization(Wn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xn.getInstance()._connectionPromise;case 2:case"end":return e.stop()}},e)})));var rr=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=er(this,tr(t).call(this))).model="",e.lastSynced=new Date(0),e.where={},e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nr(e,t)}(t,Cn),n=t,i=[{key:"getColumnDefinitions",value:function(){var e=Cn.getColumnDefinitions();return e.model={type:En.TYPES.STRING},e.lastSynced={type:En.TYPES.DATE},e.where={type:En.TYPES.SIMPLE_JSON},e}}],(r=[{key:"getModel",value:function(){return this.model}},{key:"setModel",value:function(e){this.model=e}},{key:"getLastSynced",value:function(){return this.lastSynced}},{key:"setLastSynced",value:function(e){this.lastSynced=e}}])&&$n(n.prototype,r),i&&$n(n,i),t}();function ir(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ar(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){ir(a,r,i,o,s,"next",e)}function s(e){ir(a,r,i,o,s,"throw",e)}o(void 0)})}}function or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}rr.SCHEMA_NAME="easy-sync-last-sync-dates",En.addModel(rr);var sr=mn;sr.default&&(sr=sr.default);var ur=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,n=[{key:"sync",value:function(){var t=ar(regeneratorRuntime.mark(function t(n){var r,i,a,o,s,u,c,l,f,p,h,d,m,y,v=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],i={},a=Xn.getModel(),n.forEach(function(e){r.push(e.getSchemaName()),i[e.getSchemaName()]={}}),o={},t.next=7,rr.find({model:sr.In(r)});case 7:t.sent.forEach(function(e){i[e.getModel()].lastSynced=e.getLastSynced().getTime(),o[e.getModel()]=e}),s=null,u=[],c=0,l=[],f=!1,p={},h=regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f=!1,t.next=3,e._fetchModel(i,c);case 3:u=t.sent,c=u.nextOffset,s||(s=u.newLastSynced,r.forEach(function(e){o[e]||(o[e]=new rr,o[e].setModel(e)),o[e].setLastSynced(new Date(s))})),n={},r.forEach(function(e){v._processModelResult(u.models[e],a[e],l,p)&&(f=!0,n[e]={},i[e].lastSynced&&(n[e].lastSynced=i[e].lastSynced))}),i=n;case 9:case"end":return t.stop()}},t)});case 16:return t.delegateYield(h(),"t0",17);case 17:if(f){t.next=16;break}case 18:return t.next=20,Promise.all(l);case 20:return u=t.sent,d=[],Object.keys(p).forEach(function(e){var t=a[e].getRelationDefinitions();Object.keys(p[e]).forEach(function(n){var r=p[e][n].entity,i=p[e][n].relations,o=[];Object.keys(i).forEach(function(e){var n=null;n=Array.isArray(i[e])?a[t[e].target].findByIds(i[e]):a[t[e].target].findById(i[e]),o.push(n.then(function(t){r[e]=t}))}),d.push(Promise.all(o).then(function(){return r.save(!0)}))})}),t.next=25,Promise.all(d);case 25:return m=[],Object.keys(o).forEach(function(e){m.push(o[e].save())}),t.next=29,Promise.all(m);case 29:return y={},u.forEach(function(e){e&&(y[e.model]||(y[e.model]={deleted:[],changed:[]}),e.deleted?y[e.model].deleted=y[e.model].deleted.concat(e.entities):y[e.model].changed=y[e.model].changed.concat(e.entities))}),t.abrupt("return",y);case 32:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},{key:"_processModelResult",value:function(e,t,n,r){var i=!1;if(e){var a=t.getSchemaName(),o=[],s=[];e.entities.forEach(function(e){e.deleted?o.push(e.id):s.push(e)}),n.push(t._fromJson(s).then(function(e){var n=t.getRelations();return e.forEach(function(e){n.forEach(function(t){e[t]&&(r[a]=y.nonNull(r[a],{}),r[a][e.id]=y.nonNull(r[a][e.id],{}),r[a][e.id].entity=e,r[a][e.id].relations=y.nonNull(r[a][e.id].relations,{}),r[a][e.id].relations[t]=e[t],e[t]=null)})}),Xn.getInstance().saveEntity(e).then(function(e){return{model:a,entities:e,deleted:!1}}).catch(function(e){return console.error(e),Promise.reject(e)})})),n.push(Xn.getInstance().deleteEntity(o,t).then(function(e){return{model:a,entities:e,deleted:!0}}).catch(function(e){return console.error(e),Promise.reject(e)})),e.shouldAskAgain&&(i=!0)}return i}}],r=[{key:"_fetchModel",value:function(){var t=ar(regeneratorRuntime.mark(function t(n,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T.load(e.SYNC_PATH_PREFIX+T.buildQuery({models:JSON.stringify(n),offset:r}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}],n&&or(t.prototype,n),r&&or(t,r),e}();ur.SYNC_PATH_PREFIX="sync";var cr=n(193),lr=n.n(cr),fr=n(194),pr=n.n(fr),hr=n(195),dr=n.n(hr);function mr(e){return(mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vr(e,t){return!t||"object"!==mr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function gr(e,t,n){return(gr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=br(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function br(e){return(br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Er(e,t){return(Er=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tr=function(e){function Church(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Church),(e=vr(this,br(Church).call(this))).names=[],e.descriptions=[],e.places=[],e.images=[],e.website=null,e}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Er(e,t)}(Church,Vn),t=Church,r=[{key:"getColumnDefinitions",value:function(){var e=gr(br(Church),"getColumnDefinitions",this).call(this);return e.names=En.TYPES.JSON,e.descriptions=En.TYPES.JSON,e.places=En.TYPES.JSON,e.images=En.TYPES.JSON,e.website=En.TYPES.STRING,e}}],(n=[{key:"getNameTranslation",value:function(){return"church-name-"+this.id}},{key:"getDescriptionTranslation",value:function(){return"church-description-"+this.id}},{key:"getDynamicTranslations",value:function(){var e=this,t={};return Object.keys(this.names).forEach(function(n){t[n]=t[n]||{},t[n][e.getNameTranslation()]=e.names[n]}),Object.keys(this.descriptions).forEach(function(n){t[n]=t[n]||{},t[n][e.getDescriptionTranslation()]=e.descriptions[n]}),t}}])&&yr(t.prototype,n),r&&yr(t,r),Church}();function wr(e){return(wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cr(e,t){return!t||"object"!==wr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Sr(e,t,n){return(Sr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ar(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ar(e){return(Ar=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Or(e,t){return(Or=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Tr.SCHEMA_NAME="Church",En.addModel(Tr);var Rr=function(e){function Event(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Event),(e=Cr(this,Ar(Event).call(this))).names=null,e.descriptions=null,e.startTime=null,e.endTime=null,e.type=null,e.images=[],e.organisers=null,e.places=[],e}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Or(e,t)}(Event,Vn),t=Event,r=[{key:"getColumnDefinitions",value:function(){var e=Sr(Ar(Event),"getColumnDefinitions",this).call(this);return e.names=En.TYPES.JSON,e.descriptions=En.TYPES.JSON,e.places=En.TYPES.JSON,e.images=En.TYPES.JSON,e.startTime=En.TYPES.DATE,e.endTime=En.TYPES.DATE,e}},{key:"getRelationDefinitions",value:function(){var e=Vn.getRelationDefinitions();return e.organisers={target:Tr.getSchemaName(),type:"many-to-many",joinTable:{name:"churchEvent"}},e}}],(n=[{key:"getNameTranslation",value:function(){return"event-name-"+this.id}},{key:"getDescriptionTranslation",value:function(){return"event-description-"+this.id}},{key:"getDynamicTranslations",value:function(){var e=this,t={};return Object.keys(this.names).forEach(function(n){t[n]=t[n]||{},t[n][e.getNameTranslation()]=e.names[n]}),Object.keys(this.descriptions).forEach(function(n){t[n]=t[n]||{},t[n][e.getDescriptionTranslation()]=e.descriptions[n]}),t}}])&&Nr(t.prototype,n),r&&Nr(t,r),Event}();Rr.SCHEMA_NAME="Event",En.addModel(Rr);var Mr=n(196),_r=n.n(Mr),Pr=n(197),xr=n.n(Pr);function Ir(e){return(Ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function jr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Dr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kr(e,t,n){return(kr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function qr(e){return(qr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Br(e,t){return(Br=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ur=function(e){function t(e,n){var r,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,(r=!(a=qr(t).call(this,e,n,xr.a,"#site-content"))||"object"!==Ir(a)&&"function"!=typeof a?Dr(i):a)._footerFragment=new bi(Dr(r)),r.addFragment("#footer-fragment",r._footerFragment),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Br(e,t)}(t,Te),n=t,(r=[{key:"onStart",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,kr(qr(t.prototype),"onStart",this).call(this,n);case 2:window.StatusBar&&(StatusBar.overlaysWebView(!0),StatusBar.backgroundColorByHexString("#33000000"));case 3:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Lr(a,r,i,o,s,"next",e)}function s(e){Lr(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e){return n.apply(this,arguments)}}()}])&&jr(n.prototype,r),i&&jr(n,i),t}(),Fr=n(198),Vr=n.n(Fr);function Qr(e){return(Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Wr(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Kr(a,r,i,o,s,"next",e)}function s(e){Kr(a,r,i,o,s,"throw",e)}o(void 0)})}}function Hr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Yr(e,t){return!t||"object"!==Qr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function zr(e,t,n){return(zr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Jr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Jr(e){return(Jr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gr(e,t){return(Gr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xr=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Yr(this,Jr(t).call(this,e,Vr.a)))._footerFragment.setSelected(".icon.calendar"),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gr(e,t)}(t,Ur),n=t,(r=[{key:"onConstruct",value:function(){var e=Wr(regeneratorRuntime.mark(function e(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=zr(Jr(t.prototype),"onConstruct",this).call(this,n),y.isSet(n,"id")){e.next=5;break}return new pn("no id given").show(),this.finish(),e.abrupt("return");case 5:return e.next=7,Rr.findById(n.id);case 7:if(this._event=e.sent,this._event){e.next=12;break}return new pn("no event found").show(),this.finish(),e.abrupt("return");case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onViewLoaded",value:function(){var e=Wr(regeneratorRuntime.mark(function e(){var n,r,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=zr(Jr(t.prototype),"onViewLoaded",this).call(this),(r=p.getInstance()).addDynamicTranslations(this._event.getDynamicTranslations()),this.findBy("#event-name").appendChild(r.makePersistentTranslation(this._event.getNameTranslation())),this.findBy("#event-description").appendChild(r.makePersistentTranslation(this._event.getDescriptionTranslation())),this._event.images.length>0&&(this.findBy("#event-img").src=this._event.images[0]),i=this.findBy("#event-time"),this._event.startTime.getFullYear()===this._event.endTime.getFullYear()&&this._event.startTime.getMonth()===this._event.endTime.getMonth()&&this._event.startTime.getDate()===this._event.endTime.getDate()?this._event.startTime.getHours()===this._event.endTime.getHours()&&this._event.startTime.getMinutes()===this._event.endTime.getMinutes()?i.innerHTML=y.strftime("%d. %B ´%y %H.%M ",this._event.startTime)+r.makePersistentTranslation("uhr").outerHTML:i.innerHTML=y.strftime("%d. %B ´%y<br/>%H.%M",this._event.startTime)+" - "+y.strftime("%H.%M",this._event.endTime):i.innerHTML=y.strftime("%d. %b ´%y %H.%M",this._event.startTime)+" -<br/>"+y.strftime("%d. %b ´%y %H.%M",this._event.endTime),a=this.findBy("#places-container"),(o=a.querySelector(".place")).remove(),this._event.places.forEach(function(e){var t=o.cloneNode(!0);t.querySelector(".place-name").innerText=e,a.appendChild(t)}),e.abrupt("return",n);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}])&&Hr(n.prototype,r),i&&Hr(n,i),t}();function Zr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function $r(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Zr(a,r,i,o,s,"next",e)}function s(e){Zr(a,r,i,o,s,"throw",e)}o(void 0)})}}function ei(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Y.addInitialization(function(e){e.addDeepLink("event",Xr)});var ti=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"scaleHeightThroughWidth",value:function(){var e=$r(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.style.transition="none",e.next=3,this.scale(n,$r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.getBoundingClientRect().height);case 1:case"end":return e.stop()}},e)})),$r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.getBoundingClientRect().width);case 1:case"end":return e.stop()}},e)})),function(e){console.log("newWidth",Math.fround(1e3*e+1e-5)/1e3),t.style.width=Math.fround(1e3*e+1e-5)/1e3+"px"},null,t);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"scale",value:function(){var e=$r(regeneratorRuntime.mark(function e(t,n,r,i,a,o){var s,u,c,l,f,p,h,d=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=y.nonNull(a,.01),s=0,"function"!=typeof t){e.next=8;break}return e.next=5,t();case 5:s=e.sent,e.next=9;break;case 8:s=t;case 9:return s=parseFloat(s),u=0,c=[],e.t0=parseFloat,e.next=15,n();case 15:e.t1=e.sent,l=(0,e.t0)(e.t1),f=Math.abs(s-l);case 18:if(!(f>a)){e.next=45;break}return p=l,c.push(p),e.t2=parseFloat,e.next=24,r();case 24:return e.t3=e.sent,h=(0,e.t2)(e.t3),console.log("T",h,"-",s," - ",l," - ",h*s/l),e.next=29,i(h*s/l);case 29:return e.t4=parseFloat,e.next=32,n();case 32:if(e.t5=e.sent,l=(0,e.t4)(e.t5),console.log("diffs",Math.abs(p-l)," - ",Math.abs(s-l)," - ",a),!(Math.abs(p-l)<a/2||-1!==c.indexOf(l))){e.next=38;break}return console.log("change too small or value already having, break"),e.abrupt("break",45);case 38:if(f=Math.abs(s-l),!(++u>=25)){e.next=43;break}return console.log("breaking after ",u," iterations"),e.abrupt("break",45);case 43:e.next=18;break;case 45:o&&o.addEventListener("resize",$r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.scale(t,n,r,i,a);case 2:case"end":return e.stop()}},e)})));case 46:case"end":return e.stop()}},e)}));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()}])&&ei(t.prototype,n),r&&ei(t,r),e}();function ni(e){return(ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ri(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ii(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){ri(a,r,i,o,s,"next",e)}function s(e){ri(a,r,i,o,s,"throw",e)}o(void 0)})}}function ai(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oi(e,t){return!t||"object"!==ni(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function si(e,t,n){return(si="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ui(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ui(e){return(ui=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ci(e,t){return(ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var li=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=oi(this,ui(t).call(this,e,_r.a)))._date=new Date,n._footerFragment.setSelected(".icon.calendar"),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ci(e,t)}(t,Ur),n=t,(r=[{key:"onViewLoaded",value:function(){var e=ii(regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._dayTemplate=this.findBy("#day-template"),this._dayContainer=this.findBy("#day-container"),this._dayTemplate.removeAttribute("id"),this._dayTemplate.remove(),this._eventOverviewContainer=this.findBy("#event-overview-container"),this._eventOverviewTemplate=this.findBy("#event-overview-template"),this._eventOverviewTemplate.removeAttribute("id"),this._eventOverviewTemplate.remove(),this._monthName=this.findBy("#month-name"),this.findBy("#button-left").addEventListener("click",function(){n._date.setMonth(n._date.getMonth()-1),n.drawMonth(n._date)}),this.findBy("#button-right").addEventListener("click",function(){n._date.setMonth(n._date.getMonth()+1),n.drawMonth(n._date)}),e.abrupt("return",si(ui(t.prototype),"onViewLoaded",this).call(this));case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadEventsForMonth",value:function(){var e=ii(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Date(t)).setDate(1),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),(r=new Date(n)).setMonth(r.getMonth()+1),e.abrupt("return",Rr.find({startTime:Object(mn.LessThan)(y.strftime("%Y-%m-%d %H:%M:%S",r)),endTime:Object(mn.MoreThanOrEqual)(y.strftime("%Y-%m-%d %H:%M:%S",n))}));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"onStart",value:function(){var e=ii(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.drawMonth(this._date);case 2:return e.next=4,si(ui(t.prototype),"onStart",this).call(this,n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"drawMonth",value:function(){var e=ii(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l,f,h,d,m,v,g,b,E=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=["January","February","March","April","May","June","July","August","September","October","November","December"],e.next=3,this.loadEventsForMonth(t);case 3:for(r=e.sent,(t=new Date(y.nonNull(t,new Date))).setDate(1),i=t.getMonth(),a=new Date,o=a.getFullYear()===t.getFullYear()&&a.getMonth()===i,s=(t.getDay()+6)%7,t.setMonth(t.getMonth()+1),t.setDate(0),u=t.getDate(),c={},r.forEach(function(e){var t=e.startTime.getDate(),n=e.endTime.getDate();i>e.startTime.getMonth()?t=1:i<e.endTime.getMonth()&&(n=u);for(var r=t-1;r<n;r++)c[r]||(c[r]=[]),c[r].push(e)}),y.removeAllChildren(this._monthName),this._monthName.appendChild(p.makePersistentTranslation(n[t.getMonth()])),this._monthName.appendChild(document.createTextNode(" "+t.getFullYear())),y.removeAllChildren(this._dayContainer),l=0;l<s;l++)(f=this._dayTemplate.cloneNode(!0)).classList.add("oldMonth"),this._dayContainer.appendChild(f);for(h=function(e){var t=E._dayTemplate.cloneNode(!0);t.querySelector(".day-number").innerText=e+1,o&&a.getDate()===e+1&&t.classList.add("today"),c[e]?(t.classList.add("has-event"),t.addEventListener("click",function(){var n=E.findBy(".day.active");n&&n.classList.remove("active"),t.classList.add("active"),E.showEventOverviews(c[e])})):t.addEventListener("click",function(){var e=E.findBy(".day.active");e&&e.classList.remove("active"),t.classList.add("active"),E.showEventOverviews([])}),E._dayContainer.appendChild(t)},d=0;d<u;d++)h(d);for(m=s+u;m<37;m++)(v=this._dayTemplate.cloneNode(!0)).classList.add("nextMonth"),this._dayContainer.appendChild(v);return g=new ti,b=window.getComputedStyle(this.findBy("#calendar")).getPropertyValue("height").replace("px",""),e.next=27,g.scaleHeightThroughWidth(this.findBy("#scale-container"),.65*b);case 27:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"showEventOverviews",value:function(e){var t=this;y.removeAllChildren(this._eventOverviewContainer),e.forEach(function(e){var n=p.getInstance();n.addDynamicTranslations(e.getDynamicTranslations());var r=t._eventOverviewTemplate.cloneNode(!0);r.querySelector(".name").appendChild(n.makePersistentTranslation(e.getNameTranslation())),r.querySelector(".time").innerText=y.strftime("%H:%M",e.startTime),e.places.length>0&&r.querySelector(".place .place-name").appendChild(1===e.places.length?document.createTextNode(e.places[0]):p.makePersistentTranslation("Multiple locations")),r.addEventListener("click",function(){t.startSite(Xr,{id:e.id})}),t._eventOverviewContainer.appendChild(r)}),0===e.length&&this._eventOverviewContainer.appendChild(p.makePersistentTranslation("no events"))}}])&&ai(n.prototype,r),i&&ai(n,i),t}();function fi(e){return(fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pi(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function hi(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){pi(a,r,i,o,s,"next",e)}function s(e){pi(a,r,i,o,s,"throw",e)}o(void 0)})}}function di(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mi(e,t){return!t||"object"!==fi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yi(e,t,n){return(yi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=vi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function vi(e){return(vi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gi(e,t){return(gi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Y.addInitialization(function(e){e.addDeepLink("calendar",li)});var bi=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),mi(this,vi(t).call(this,e,dr.a))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gi(e,t)}(t,se),n=t,(r=[{key:"onViewLoaded",value:function(){var e=hi(regeneratorRuntime.mark(function e(){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=yi(vi(t.prototype),"onViewLoaded",this).call(this),this.findBy(".icon.home").addEventListener("click",function(){r.getSite().startSite(Li)}),this.findBy(".icon.calendar").addEventListener("click",function(){r.getSite().startSite(li)}),this.findBy(".icon",!0).forEach(function(e){e.addEventListener("click",function(e){r.setSelected(e.target)})}),e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setSelected",value:function(){var e=hi(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._viewPromise;case 2:n=this.findBy(".selected"),y.isNotNull(n)&&n.classList.remove("selected"),"string"==typeof t&&(t=this.findBy(t)),t&&t.classList.add("selected");case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}])&&di(n.prototype,r),i&&di(n,i),t}();function Ei(e){return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ti(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function wi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ni(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ci(e,t,n){return(Ci="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Si(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Si(e){return(Si=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ai(e,t){return(Ai=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Oi=function(e){function t(e,n){var r,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,(r=!(a=Si(t).call(this,e,n,pr.a))||"object"!==Ei(a)&&"function"!=typeof a?Ni(i):a)._navbarFragment.setBackgroundImage(""),r._footerFragment=new bi(Ni(r)),r.addFragment("#footer-fragment",r._footerFragment),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ai(e,t)}(t,qt),n=t,(r=[{key:"onStart",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ci(Si(t.prototype),"onStart",this).call(this,n);case 2:window.StatusBar&&(StatusBar.overlaysWebView(!0),StatusBar.backgroundColorByHexString("#33000000"));case 3:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ti(a,r,i,o,s,"next",e)}function s(e){Ti(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e){return n.apply(this,arguments)}}()}])&&wi(n.prototype,r),i&&wi(n,i),t}(),Ri=n(199),Mi=n.n(Ri);function _i(e){return(_i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pi(e,t){return!t||"object"!==_i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xi(e){return(xi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ii(e,t){return(Ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Li=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Pi(this,xi(t).call(this,e,lr.a)))._navbarFragment.setCanGoBack(!1),n._footerFragment.setSelected(".icon.home"),n._navbarFragment.setBackgroundImage(Mi.a),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ii(e,t)}(t,Oi),t}();function ji(e){return(ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Di(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ki(e,t){return!t||"object"!==ji(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qi(e,t,n){return(qi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Bi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Bi(e){return(Bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ui(e,t){return(Ui=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fi=function(e){function Region(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Region),(e=ki(this,Bi(Region).call(this))).name=null,e.churches=null,e.events=null,e}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ui(e,t)}(Region,Vn),t=Region,r=[{key:"getColumnDefinitions",value:function(){var e=qi(Bi(Region),"getColumnDefinitions",this).call(this);return e.name={type:En.TYPES.STRING},e}},{key:"getRelationDefinitions",value:function(){var e=Vn.getRelationDefinitions();return e.churches={target:Tr.getSchemaName(),type:"many-to-many",joinTable:{name:"churchRegion"}},e.events={target:Rr.getSchemaName(),type:"many-to-many",joinTable:{name:"eventRegion"}},e}}],(n=[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"setChurches",value:function(e){this.churches=e}},{key:"getChurches",value:function(){return this.churches}}])&&Di(t.prototype,n),r&&Di(t,r),Region}();Fi.SCHEMA_NAME="Region",En.addModel(Fi);var Vi=n(200),Qi=n.n(Vi),Ki=n(201),Wi=n.n(Ki);function Hi(e){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yi(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function zi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ji(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gi(e,t,n){return(Gi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Xi(e){return(Xi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zi(e,t){return(Zi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $i=function(e){function t(e,n){var r,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,(r=!(a=Xi(t).call(this,e,n,Wi.a))||"object"!==Hi(a)&&"function"!=typeof a?Ji(i):a)._footerFragment=new bi(Ji(r)),r.addFragment("#footer-fragment",r._footerFragment),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zi(e,t)}(t,qt),n=t,(r=[{key:"onStart",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Gi(Xi(t.prototype),"onStart",this).call(this,n);case 2:window.StatusBar&&(StatusBar.overlaysWebView(!0),StatusBar.backgroundColorByHexString("#33000000"));case 3:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Yi(a,r,i,o,s,"next",e)}function s(e){Yi(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e){return n.apply(this,arguments)}}()}])&&zi(n.prototype,r),i&&zi(n,i),t}(),ea=n(202),ta=n.n(ea),na=n(203),ra=n.n(na);function ia(e){return(ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function aa(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function oa(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){aa(a,r,i,o,s,"next",e)}function s(e){aa(a,r,i,o,s,"throw",e)}o(void 0)})}}function sa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ua(e,t){return!t||"object"!==ia(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ca(e,t,n){return(ca="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=la(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function la(e){return(la=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fa(e,t){return(fa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pa=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ua(this,la(t).call(this,e,ra.a)))._footerFragment.setSelected(".icon.home"),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fa(e,t)}(t,Oi),n=t,(r=[{key:"onConstruct",value:function(){var e=oa(regeneratorRuntime.mark(function e(n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=ca(la(t.prototype),"onConstruct",this).call(this,n),(y.isNull(n)||y.isNull(n.id))&&(new pn("no id given").show(),this.finish()),e.next=4,Tr.findById(parseInt(n.id));case 4:return this._church=e.sent,y.isNull(this._church)&&(new pn("no church found").show(),this.finish()),(i=this._church.images).length>0&&this._navbarFragment.setBackgroundImage(i[0]),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onViewLoaded",value:function(){var e=oa(regeneratorRuntime.mark(function e(){var n,r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=ca(la(t.prototype),"onViewLoaded",this).call(this),(r=p.getInstance()).addDynamicTranslations(this._church.getDynamicTranslations()),this.findBy("#name").appendChild(r.makePersistentTranslation(this._church.getNameTranslation(),!0)),this.findBy("#description").appendChild(r.makePersistentTranslation(this._church.getDescriptionTranslation(),!0)),i=this.findBy("#website"),(a=this._church.website).startsWith("http")||a.startsWith("//")||(a="//"+a),i.href=a,i.appendChild(document.createTextNode(this._church.website)),o=this.findBy("#places-container"),(s=o.querySelector(".place")).remove(),this._church.places.forEach(function(e){var t=s.cloneNode(!0);t.querySelector(".place-name").innerText=e,o.appendChild(t)}),e.abrupt("return",n);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}])&&sa(n.prototype,r),i&&sa(n,i),t}();function ha(e){return(ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function da(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ma(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ya(e,t){return!t||"object"!==ha(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function va(e,t,n){return(va="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ga(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ga(e){return(ga=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ba(e,t){return(ba=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Y.addInitialization(function(e){e.addDeepLink("church",pa)});var Ea=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ya(this,ga(t).call(this,e,ta.a))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ba(e,t)}(t,Pe),n=t,(r=[{key:"onViewLoaded",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._template=this.findBy(".church-info-template"),this._template.remove(),this._template.classList.remove("church-info-template"),e.abrupt("return",va(ga(t.prototype),"onViewLoaded",this).call(this));case 4:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){da(a,r,i,o,s,"next",e)}function s(e){da(a,r,i,o,s,"throw",e)}o(void 0)})});return function(){return n.apply(this,arguments)}}()},{key:"renderElement",value:function(e){var t=this;p.getInstance().addDynamicTranslations(e.getDynamicTranslations());var n=this._template.cloneNode(!0);return n.querySelector(".name").appendChild(p.makePersistentTranslation(e.getNameTranslation())),e.places.length>0&&n.querySelector(".place .place-name").appendChild(1===e.places.length?document.createTextNode(e.places[0]):p.makePersistentTranslation("Multiple locations")),n.addEventListener("click",function(){t.getSite().startSite(pa,{id:e.id})}),n}}])&&ma(n.prototype,r),i&&ma(n,i),t}();function Ta(e){return(Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wa(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Na(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ca(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Sa(e,t,n){return(Sa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Aa(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Aa(e){return(Aa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oa(e,t){return(Oa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ra=function(e){function t(e){var n,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=!(i=Aa(t).call(this,e,Qi.a))||"object"!==Ta(i)&&"function"!=typeof i?Ca(r):i)._alphabeticListFragment=new Ea(Ca(n)),n.addFragment("#church-list",n._alphabeticListFragment),n._footerFragment.setSelected(".icon.home"),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oa(e,t)}(t,$i),n=t,(r=[{key:"onConstruct",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(n){var r,i,a,o,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Sa(Aa(t.prototype),"onConstruct",this).call(this,n),i=[],n&&y.nonNull(n.regionIds,[]),a=[],!(i.length>=1)){e.next=10;break}return e.next=7,Fi.findByIds(i,Fi.getRelations());case 7:a=e.sent,e.next=13;break;case 10:return e.next=12,Fi.find(void 0,void 0,void 0,void 0,Fi.getRelations());case 12:a=e.sent;case 13:return o={},a.forEach(function(e){e.churches&&e.churches.forEach(function(e){o[e.id]=e})}),s=p.getInstance().getCurrentLanguage(),u=p.getInstance().getFallbackLanguage(),c={},Object.values(o).forEach(function(e){var t=y.nonNull(e.names[s],e.names[u],e.names[Object.keys(e.names)[0]],"");c[t+"-"+e.id]=e}),this._alphabeticListFragment.setElements(c),e.abrupt("return",r);case 21:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){wa(a,r,i,o,s,"next",e)}function s(e){wa(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e){return n.apply(this,arguments)}}()},{key:"goBack",value:function(){this.finishAndStartSite(Li)}}])&&Na(n.prototype,r),i&&Na(n,i),t}();function Ma(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _a(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ma(a,r,i,o,s,"next",e)}function s(e){Ma(a,r,i,o,s,"throw",e)}o(void 0)})}}Y.addInitialization(function(e){e.addDeepLink("churches",Ra)}),Cn._databaseClass=Xn,Xn.BASE_MODEL=Vn,console.log("before initialisation",new Date),Y.addInitialization(_a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return window.StatusBar&&(StatusBar.overlaysWebView(!0),StatusBar.backgroundColorByHexString("#33000000")),p.init({translations:{de:r,en:i},fallbackLanguage:"de",markUntranslatedTranslations:!0}),Ot.title="",Ot.defaultActions.push(new Ye("events",Li)),Ot.defaultActions.push(new Ye("churches",Ra)),Ot.defaultActions.push(new Ye("about us",Li)),Ot.defaultActions.push(new Ie("language",_a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("en"!==p.getInstance().getCurrentLanguage()){e.next=5;break}return e.next=3,p.getInstance().setLanguage("de");case 3:e.next=7;break;case 5:return e.next=7,p.getInstance().setLanguage("en");case 7:case"end":return e.stop()}},e)})),Ie.SHOW_FOR_LARGE)),Ot.defaultActions.push(new Ye("contact",Li,Ie.SHOW_NEVER)),Ot.defaultActions.push(new Ye("privacy policy",Li,Ie.SHOW_NEVER)),Ot.defaultActions.push(new Ye("imprint",Li,Ie.SHOW_NEVER)),e.next=12,(new ur).sync([Tr,Rr,Fi]).catch(function(e){return console.error(e)});case 12:case"end":return e.stop()}},e)}))),T._basePath="http://192.168.0.51:3001/api/v1/",Object.assign(En.CONNECTION_OPTIONS,{logging:["error"]}),(new Y).start(Li).catch(function(e){return console.error(e)}).then(function(){console.log("initialisation done!",new Date)})}]);